# 不要在 CSS 过渡中使用“all”关键字

> 原文:[https://dev . to/pnodev/don-t-use-the-all-keyword-in-CSS-transitions-5eic](https://dev.to/pnodev/don-t-use-the-all-keyword-in-css-transitions-5eic)

CSS 动画和过渡非常棒。它们赋予我们丰富网络体验的力量，让我们感觉更加“生动”。然而，与此同时，动画和过渡如果做得不对，会让网络体验变得更糟。

## [](#beware-of-junk-from-bad-performing-animations)谨防劣质动画中的“垃圾”

如果你做一点研究，你会很快注意到，你必须非常小心哪些 CSS 属性应该动画，哪些不应该。要理解为什么需要对浏览器中的渲染过程有一个基本的了解。

有三个阶段对我们很重要:*布局*、*喷漆*、*复合*。

### [](#layout)布局

在布局阶段，浏览器会考虑元素的宽度和高度，以及边距、填充、边框、位置等等，来判断哪些元素应该放在哪里。

### [](#paint)作画

在绘画阶段，浏览器开始填充像素。它基本上意味着将元素的每一个可视部分都呈现在屏幕上。这包括文本、颜色、图像、边框、阴影等等。通常，绘画是在多个“层”上完成的，这对下一步很重要。

### [](#composite)复合

此时，我们已经将视觉元素绘制到不同的图层上。在最后一步中，所有层都需要以正确的顺序绘制到屏幕上。这个顺序对于确保相互重叠的元素将正确的元素放在最上面是很重要的。

我们不需要太深入，但是你要记住的是，在转换过程中，浏览器需要反复计算来更新屏幕上的内容。

现在，根据您在动画过程中更改的属性，这可能涉及或多或少的工作。想象你会做以下事情:

```
.box {
    transition: width .3s ease-out;
} 
```

如果您要更改该框的宽度，这也会影响它周围的所有元素。例如，下例中的盒子会被正在增长的盒子推到一边，这又会触发其他元素也重新定位。如果我们回到我们讨论的三个阶段，你会很快意识到浏览器必须为动画的每一步重新计算布局，接下来是另外两个阶段。这是相当多的工作，也是为什么做得不好的动画会在页面上产生大量垃圾的主要原因。

[https://codepen.io/kaesetoast/embed/jgWVzy?height=600&default-tab=result&embed-version=2](https://codepen.io/kaesetoast/embed/jgWVzy?height=600&default-tab=result&embed-version=2)

## [](#change-properties-that-trigger-the-least-amount-of-work)改变触发最少工作量的属性

有一个很棒的网站列出了每个 css 属性在哪个阶段发生了变化:【https://csstriggers.com。我强烈建议去看看。有几个属性使用起来总是安全的，最具性能的动画尽量坚持这些属性:`opacity`和`transform`。每当我做动画或过渡时，我都试图将我想要达到的效果转换回这两个属性。

## [](#avoid-unwanted-sideeffects)避免不必要的副作用

意识到转换错误的属性集可能会导致垃圾，您可能会明白为什么我认为使用`all`关键字是一种不好的做法。当然，如果你确保只改变`opacity`和`transform`，你可以设置`transition: all .3s ease-out;`并且仍然有一个表现良好的动画，但是很有可能其他人会在不知道这会触发动画的情况下改变一个属性。

## 明确你的代码做什么

在编写动画和过渡时，你应该考虑的另一个方面是可维护性。我遇到了很多大量使用`all`关键字的遗留代码库，可能是因为它更容易编写。但是如果你不确切知道作者想要达到什么目的，把它改回一个更明确的过渡会非常令人沮丧。您必须检查动画，找出哪些属性确实发生了变化，哪些没有。只为明确的关键字编写过渡和动画，不仅可以防止不必要的垃圾，还可以帮助其他人(以及将来的你自己)更容易理解你的代码。

## [](#let-the-computer-yell-at-you)让电脑对你大吼

我总是喜欢把这样的规则放到我的构建过程中，或者把它们集成到我的文本编辑器中。我宁愿在我写坏代码的时候让计算机对我大喊大叫，也不愿让我的同事(或者很可能是我自己)在一年后对我大喊大叫。如果你正在使用 stylelint 检查你的 CSS，这里有一个简洁的小规则可以做到这一点:[https://github . com/krister Kari/stylelint-high-performance-animation](https://github.com/kristerkari/stylelint-high-performance-animation)
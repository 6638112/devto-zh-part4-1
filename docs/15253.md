# Rust、迭代器和技能回归

> 原文：<https://dev.to/rpalo/rust-iterators-and-skill-regression-5dgn>

马太·亨利在 Unsplash 上拍摄的封面图片。

我们的训狗教练告诉我们，一个情况对狗来说变得更难处理——基于 3 D:与你的距离、分心和活动的持续时间。当你增加这三个 D 中的任何一个时，那些你和你的宠物一起努力学习的高级技能会变得更难，当它们变得太难管理时，它们会退回到更简单的技能水平。如果他们不能*跟*走，也许他们可以应付*坐*。如果他们不能坐下，也许他们可以处理*看着我*或者，至少*找到我扔的食物*。

这似乎就是我的大脑处理代码问题的方式。除此之外，我用的不是 3 D，而是 3 L:语言、逻辑和关注度。如果我在用一种我非常熟悉的语言工作，我想做的事情的逻辑很简单，我有足够的食物/睡眠/咖啡/安静/不焦虑，我很自豪我能写出一些漂亮的、可读的、地道的代码。然而，当使用一种我不太熟悉的语言工作时，事情的逻辑会稍微复杂一点，或者我超出了关注点，我会回归到更简单、更容易处理的技能。

连线:

```
return [value*2 for value in values] 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

累:

```
result = []
for value in values:
    result.append(value * 2) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

被解雇:

```
result = []
for i in range(len(values)):
    result.append(values[i] * 2) 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

进展通常是这样的:

1.  我是否知道一个巧妙的特定语言技巧/内置/标准库模块可以简洁明了地解决我的问题？
2.  我是否知道一个第三方库可以完成我想要的功能(我对导入/安装/使用该库的成本是否满意)？
3.  好吧。我们要来硬的。我会遍历所有的值。
4.  好吧，这样不行或者太复杂了。我将添加更多的助手变量，使我的循环更冗长，但每行都更简单。
5.  好吧，你知道吗？去他的。我要去核化，求助于整数索引。

不变的是，当我离我的舒适区越来越远时，我最终会通过指数循环集合。为什么？因为它通常是所有语言中非常一致的行为，所以它是有效的，并且它不是*那么*容易出错和难以阅读(或者，至少，这是我在这个黑暗的地方说服自己的)。

所以，这就是为什么，每当我能找到回去的路，感觉真的很好，意味着我学到了一些好东西。昨天我就遇到了这种情况。下面是我试图解决的问题(主问题中一个更小的子问题):

> 决定一个字符串是否有一组双字母(例如 ll，rr，aa，ee)。

似乎很简单。我只想比较每一对连续的！但是我有点累了，我在 Rust 工作，我还在学习它的细节——特别是在编写惯用代码方面。我从最底层开始…索引:

```
fn has_double(s: &str) -> bool {
    for i in 0..s.len() {
        if i == s.len() - 1 {
            return false;
        }
        if s[i] == s[i + 1] {
            return true;
        }
    }

    false
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

**不漂亮。**我知道。还有，也不管用。

没错！由于 Rust 负责任地处理字符串，不幸的是，很难在原始字符串中间索引到一个字符。出于 UTF 8/ASCII/编码的原因。这其实是一件很好很负责的事情。但这意味着我的代码不起作用。

然后，当我在我的搜索引擎中小心翼翼地左右打开标签，寻找某种答案时，在一个原本不相关的线程上出现了一些东西，让一切都变得更清楚，就像有人掀起了窗帘:迭代器。

我的 Python 大脑启动了，并连接到我愚蠢的小铁锈大脑(也许有我现有的但变形的 Ruby 大脑的一点帮助)，齿轮啮合，我想到了:

```
fn has_double(s: &str) -> bool {
    s.chars().zip(s.chars().skip(1))
        .any(|(a, b)| a == b)
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

是啊！任何时候你可以迭代条目而不是索引，这几乎总是更干净，更不容易出错。在这种情况下，我使用了四种出色的迭代器方法:

1.  `chars`:将一个字符串转换成其字符的迭代器。
2.  `zip`:并行迭代两个或更多迭代器。当试图同时浏览多个集合或同一集合的视图时，几乎总是正确的选择。当任何集合用完时，它就会停止，这有助于我们避免索引错误。
3.  跳过我们的迭代器向前一项，这样它就在另一项的前面。这一点，再加上`zip`的“最短停”行为，给了我们所需要的。
4.  `any`:在迭代器中搜索任何会导致其**lambda/匿名函数参数**返回 true 的实例。短路，如果它发现一个真实的，因为它是额外的真棒。

所以，当我在字符串`"banana"` :
上运行这个

```
ba
an
na
an
na
# => false 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

但是当我在`"apple"` :
运行它的时候

```
ap
pp
# => true 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

我恢复了对人性和我自己的信心，并且当我写这段代码的时候，我实际上正在学习一些东西。我很高兴 Rust 在这方面很像 Python。

> 如果你试图使用索引进行迭代，你可能不会用生疏的方式。可能有更好的方法，可能是 shwoopy 迭代器方法的巧妙组合。
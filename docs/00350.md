# 我应该为 Vue.js 组件编写单元测试吗？

> 原文：<https://dev.to/monas/should-i-write-unit-tests-for-vue-js-components-2no0>

对我来说，考试就像是保证良好睡眠的保证🙂每个人都喜欢好的睡眠。前端也🙂但是这如何在日常生活中应用呢？用测试覆盖你的基于 Vue 的应用有多容易/多难？

## 我对测试了解多少？

作为我的开发人员载体的大部分的全栈开发人员，我肯定可以说一些关于测试的事情。这是一个非常好的功能，在某些情况下，这是一个必须具备的功能。如果一个公司正在做一个大项目，并且没有投资一些测试——问题只是时间问题。通常一切都很好，直到有些事情因为某种原因需要改变。有些事情可能是非常小的细节，但却与一些非常复杂的逻辑紧密相关。我不会深入探讨这个问题——有大量关于失败的例子和故事，如果对代码进行测试，这些失败是很容易避免的。

在我的公司里，我有机会在投资测试的非常好的公司工作。我可以告诉你一件事——当人们确信他们的代码经过了很好的测试时，他们的行为也会有所不同。你可以从每一句话和微笑中嗅到自信🙂这就像你会驾驶一辆在世界上最糟糕的道路上脱颖而出的汽车，或者从达喀尔拉力赛中完好无损地回来。这是你可以引以为豪的事情，并告诉你的朋友。

与之相反的是根本没有测试。人们带着可怕的眼神走路，他们经常被要求为任何紧急情况做好准备，并在一些重要的事情上长时间工作。是的，我也遇到过这种情况。即使他们在你下班后付给你双倍的工资，这通常也不是一笔完美的交易——压力太大了，你得到的钱永远都不够买你失去的健康。因此，如果你有这样的情况，我建议你从长计议。在这样的公司工作后，任何其他可以选择支付双倍加班费的提议都给我敲响了警钟，迫使我询问那个项目的测试情况。

## 那么测试 Vue 组件有多难呢？

我(还)不是 Vue.js 的超级大师，为了开始测试，我参考了官方文档[https://vue js . org/v2/cookbook/unit-testing-vue-components . html](https://vuejs.org/v2/cookbook/unit-testing-vue-components.html)。令人敬畏的文档是我开始学习 Vue.js 的原因之一，所以我期望通过测试它将是我需要知道的全部。基本上这是真的——至少你会在这个官方文档中找到所有的提示和大部分链接。但是为了利用所有最好的工具，你肯定会想检查更多的东西。看看我的清单。

## 从哪里开始 Vue 测试？

正如我说的，我是 Vue 测试的新人，所以我一个人扔了所有的东西。对于新人，我会说，沿着这条路走下去，你会处于有利位置:

*   查看官方文档
*   查看 vue-test-utils 文档
*   选择您的测试设置——我建议使用 vue-cli 或更好的 vue vue-cli 提供的 web UI 设置几个独立项目——这将帮助您发现所有选项并选择最适合您的选项，然后接下来的步骤将取决于您选择的设置类型——Jest 或 webpack + Karma
*   试着做一些测试
*   …

我试图使用 Jest 和 webpack & Karma，但是 Jest 看起来更简单，所以我在 Jest 中做了所有的测试。然而在文档中有一个注释，有些东西不能用 Jest 测试。我没有发现任何类似的东西。也许这个项目太简单了。

## 大概就是这样…

不完全是。测试 Vue 组件的一个令人困惑的部分是理解测试什么。这似乎很明显——我们需要尽可能多的报道，我们会做得很好。是的，但是这个单元测试意味着我们应该一次测试尽可能少的东西。例如，当你的组件有一个按钮和@click 处理程序时，你可以试着做一个测试，试着点击那个按钮，然后检查 DOM 是否像预期的那样更新了，等等。但基本上这有点太多了。我们需要做的就是运行这个处理程序，看看发生了什么——内部状态是否以某种方式改变了。通常这对于单元测试来说已经足够了。

我发现的另一个令人困惑的地方是记住您选择的挂载选项，并找出 mount 和 shalowMount 之间的区别。当我意识到这是多么强大和有用时，我被震撼了，并开始享受测试。我必须承认——理解它花了我不少心思。谷歌永远是你的朋友🙂

另一个帮助我理解事情进展的好东西是快照。快照是一个文件，它保存您拍摄快照时渲染组件的所有输出。你需要多少就有多少，随时都可以做。关于快照还有一点需要注意，那就是只有在组件被修改后，这些快照才应该被更新。要使用快照，您不应该在某些测试环境中更新它们。快照就像文件的校验和。您对组件进行更改，然后运行测试，只有当测试由于快照原因失败时，您才应该再次运行测试(通常像 yarn test:unit -u 或 npm run test:unit -u ),然后将所有新的快照推送到服务器。我还注意到，当使用–coverage 标志时，有时快照可能会失败，所以在进行一些更改之后，在将所有内容推送到存储库之前，我总是只运行和-u 以及不运行–coverage 的测试。除非你在你的测试环境中做测试。

## 就这么简单？

像在任何技术中一样，有容易和不那么容易的事情要做。因此，在 Vue 测试中，实际上有些情况下，您需要更深入地挖掘。如果这是你第一次做任何类型的测试，那么你只需要习惯它，并了解像模拟，间谍，存根这样的事情是如何工作的。当你在测试一个组件时，如果这个组件进行一些 API 调用，或者以异步的方式做一些其他的事情，或者想要实现更多的隔离，这些都是必要的。但是再次记住谷歌是你的朋友。我现在找到了这个名为 jest-mock-axios 的包，我确信它可以在大多数 axios 用例中工作。当我写第一个包含 axios 的测试时，我没有找到那个包，所以我自己做了 axios 模拟。所以继续谷歌，因为 Vue 开发者社区发展非常快，每天都有很多新东西出现。

## 从公司的角度来看，效益如何？

这些天人们通常移动很快。在一个地方留住相同的员工并不容易。我在航母上见过各种情况和队友。他们中的一些人在某个公司工作了 8 年，另一些人每 2 年甚至每 1 年换一次工作。哪种情况对公司更好？我会说这要看情况。如果公司是聪明的，他们就会明白拥有一个高质量的员工有多重要。然后，这些公司做了很多事情来提升他们的员工——会议、学习预算、内部知识共享项目等等。其他公司对此无动于衷，只是期望超级人才会加入团队，做一些令人敬畏的工作。有时做一件事，有时做另一件事。但是，如果没有测试，那些超级人才中的任何人离开，那么公司中的某个人将很难找到另一个愿意接替你的痛苦并解决它的超级人才。通常这类人才会放弃，并试图寻找更好的工作环境。所以我认为测试可以帮助公司吸引和留住人才。

### 好运！

一如既往地感谢你的阅读，如果你在这篇文章中发现了一些价值，请分享、点赞、评论等等。不要害怕 Vue 测试——这很简单，它会帮助你发现你没有预料到的事情。我在我的组件上发现了几个错误，仅仅通过尝试使用这些组件并不明显，所以我要说测试肯定是有价值的。睡得好
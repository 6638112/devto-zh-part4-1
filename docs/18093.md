# 处理遗留代码的技巧——part Deux

> 原文：<https://dev.to/petermorlion/techniques-for-tackling-legacy-code-parte-deux-4n7c>

在我的上一篇文章中，我就如何开始扭转传统局面给出了一些见解。最后，我谈到了开始之前应该满足的先决条件。我现在就来深入探讨一下。

## 组织上的

首先，组织必须同意处理遗留代码是他们想要做的事情。“组织”可以在几个层次上定义:从团队到高层管理。但是向上的支持越多越好。因为你将在这上面投入时间，也就是公司的钱。

如果你的组织看不到处理遗留代码的好处，试着理解他们的理由。应用程序可能会产生金钱，而这里有一些开发者想要打破常规。你将不得不解释技术债务的概念，以及它是如何成为他们每天都要支付的东西，除非得到解决，否则会变得越来越糟糕，从长远来看，甚至会让开发人员离开。

对于大多数开发人员来说，这是一个困难的问题，因为这需要他们走出技术舒适区，谈论业务术语。我发现，像 NDepend 这样的工具可以在这方面有所帮助，因为它们有一种计算技术债务并将其转化为实数的方法。或者看看您是否能指出发生的特定错误，以及由于技术债务而导致的查找和修复这些错误的成本。或者向他们展示实现一个微小的改变需要多长时间。

另一方面，如果应用程序运行良好，不需要任何新功能，问问自己是否有必要重构。也许不是。

最后，根据遗留代码的复杂性，组织必须能够容忍所犯的错误。持续集成、自动化测试、试运行环境和其他技术都有助于减少犯错误的数量。但是你必须考虑到它们会发生。因此，请记住该应用程序是多么关键。

## 作战

在你开始修改那些丑陋的代码之前，你最好已经准备好了基本的东西。

确保你有一个像样的源代码控制系统。不仅仅是拥有和使用它，还要确保你的团队很好地使用它。这意味着使用描述性的提交消息。你应该陈述什么改变了，但是提及你为什么改变它通常是非常有用的。这在一般情况下是正确的，但特别是对于遗留项目，它有助于解释变更背后的原因。奇怪的代码通常意味着奇怪的变化，因为你不能一下子修复它。几周甚至几个月后，你会定期查看提交日志，以理解为什么一段代码看起来是这样。

接下来是持续集成和部署管道。如果您还没有集成，请从集成开始。确保构建了每个提交并运行了所有测试。如果没有编译或者测试失败，让构建失败。一定要通知团队，非常重要的是，当构建失败时要修复它。

当您设置了源代码控制和构建服务器后，就可以使用简单的部署管道了。如果您仍然将二进制文件复制到服务器，那么您应该研究自动化部署方法。大多数构建服务器都支持这一点。不需要在一个成功的构建上立即进行部署，但是您至少应该能够通过单击鼠标来进行部署。

因此，您已经建立了构建和部署管道，一切进展顺利。当您部署严重破坏数据的东西时会发生什么？你确实有备份，不是吗？即使在没有遗留代码的项目中，备份也很重要。因此，如果您的应用程序还没有定期备份，请花时间将它们放在适当的位置。

最后，尘埃落定后，您能多容易地诊断出问题所在？确保将有用的语句写入日志文件或服务。万一出错，也许可以发一封邮件或短信，这样你就可以迅速介入。

## 结论

组织必须同意处理遗留代码，但是在接受之前需要进行一些协商。这使得最小化风险变得更加重要。这可以通过优化你的工作方式来实现。
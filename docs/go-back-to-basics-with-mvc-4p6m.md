# 使用 MVC 回到基础

> 原文：<https://dev.to/quii/go-back-to-basics-with-mvc-4p6m>

这是我前几天听的一集 [Go time](https://changelog.com/gotime/92) 的另一个后续帖子，它似乎让我的创造力源源不断。

它谈到了 Go 中的 web 开发和一些让我印象深刻的东西

## 生成 HTML 的警示故事

在这一集的开始，我们描述了内置模板库是如何缺乏表现力，以及 Go Buffalo 框架使用了[长毛绒](https://github.com/gobuffalo/plush)

> 强大，灵活，可扩展，长毛绒是有让你写模板更容易。

### 输入玉石

大约 8 年前，我参与了一个用 Scala 编写的相当大的项目。我们决定使用 Jade 模板引擎来生成我们的 HTML，它像长毛绒一样允许你在你的模板中做很多聪明的编码。

起初这感觉很神奇，但是**很快变成了一场噩梦**。由于杰德给了我们灵活性，我们搞得有点乱。随着越来越多的业务逻辑泄露到我们的模板中，我们的模板变得丑陋、难以理解和难以测试

在软件领域，我经常将*灵活性*视为团队可以用来吊死自己的绳索，我倾向于选择非常固执己见和受约束的事情(比如 Go！).

### 我们学到了什么？

软件工程师注定要重新学习东西。我们已经忘记了关注点的分离，特别是模型-视图-控制器设计模式规定的指导。

## MVC

人们对 MVC 的误解有多严重，这是相当令人惊讶的。如果你上 Reddit 或 Twitter，你会听到人们告诉其他开发者“MVC 不适合去”。

人们似乎经常认为 MVC 是关于文件夹结构、类名或其他相当肤浅的问题。因此，当来自 Rails 背景的开发人员展示他们的 Go 代码和一系列文件夹时，他们会受到嘲笑并被扔进狮子堆。

MVC 没有规定文件夹结构，我担心很多人似乎忽略了这个原则的要点。

> 模型-视图-控制器(通常称为 MVC)是一种架构模式，通常用于开发用户界面，将应用程序分为三个相互连接的部分。

### 控制器

拦截“请求”(如 HTTP)，解析它们，然后调用适当的“模型”，获得某种数据作为结果，然后将其发送到“视图”。在围棋界，这通常是一个`http.Handler`

### 型号

不严格地说，它是您的领域逻辑所在的地方。我个人认为它的名字很糟糕，但重要的是关注点的分离。它必须与控制器和视图解耦，所以如果您看到任何与 HTTP 相关的东西从控制器传递过来，很可能您违反了这种解耦。他们也应该对视图一无所知。

### 视图

它对控制器或模型一无所知。可能应该传递给它某种类型的`ViewModel`,这只是它呈现视图所需的数据集合。一个设计良好的视图是简单的，没有领域逻辑；因为模板很难廉价测试。

### 这些原则给你买了什么？

您的域代码与系统的其余部分完全分离，因此易于测试，并且可以“插入”到 web 服务器之外的不同用途中；例如一个 CLI 工具，或者只是一个供他人使用的包。

创建和编辑视图很简单，因为它们仅仅是从一组通用数据到 HTML(或其他任何东西)的映射。这也使得前端开发人员等更容易访问它们。

您的控制器有明确的关注点，并且易于测试。

回到起点，我会非常谨慎地为我的视图编写非常有表现力的代码。这些类型的工具用便利和强大的承诺欺骗开发人员，但通常会导致抽象泄漏，除非你非常自律。

现在想一想你可能读过的所有关于 HTTP 服务器的教程，开始吧。好的人会推荐所有这些原则，而不需要大声说出来。与其让社区围着 MVC 的理念跳舞，不如拥抱它。这是一种屡试不爽的模式，大多数人都支持这种模式，只是没有明确表示出来。如果我们是明确的，也许就不会每周都有关于如何构建 HTTP 服务器的新帖子了！

## 如何构建你的网络应用

1.  了解 MVC 的*理念*。
2.  你的`http.Handler`是你的控制者，确保他们只做控制者根据上面所做的事情。
3.  所有其他的业务逻辑(模型)都存在于其他地方，在以真实事物为中心的包中。如果是银行，我可能会有`Account`、`Currency`、`Customer`等的包。你的控制器会调用你包里的东西来做有用的事情。
4.  根据你构建的内容，你可以使用编码包来生成 XML 或 JSON，或者如果是 HTML，就使用`template/html`。
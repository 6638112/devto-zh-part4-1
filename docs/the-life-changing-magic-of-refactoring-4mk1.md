# 重构改变生活的魔力

> 原文：<https://dev.to/martingaston/the-life-changing-magic-of-refactoring-4mk1>

我的桌子下面有一个抽屉，我用来存放我随机积累的所有零碎东西，很少使用，但真的不想扔掉。但是这个抽屉里的东西也有一个淘气的习惯，从这个空间逃走，然后迅速蔓延到我的桌子、办公室，最终蔓延到公寓的其他地方。

在一个完美的宇宙中，我会找到一种有效存储所有这些垃圾的方法。尽管如此，也没有必要对此过于教条。这是真实的世界。有时你不得不把客厅里一半的东西塞进橱柜里，因为你有客人要来。

在我们的编码生活中，这被称为重构:在不改变核心功能的情况下，对我们的代码进行小的修改，以此来美化我们的设计。还是，重构？我觉得这个词有点冷，几乎是数学化的——它给我一种学术、科学过程的感觉。我认为这听起来既精确又客观，而且，好像一点也不好玩。感觉是*工作*。

许多聪明人帮助围绕代码味道和重构模式创建了一种通用语言，这是有奇妙的原因的，当然，这不仅仅是为了让你在写博客时看起来聪明。拥有共享的约定意味着你可以在团队中讨论它们，并且一个通用的规则来交流代码的涨落，创造了一个令人欣慰的可靠的环境。我非常高兴围绕软件设计的讨论存在，今天的软件工程师可以站在巨人的肩膀上，我梦想能够做出这些杰出人物的积极影响的一部分。

不过，有时候，所有这些原始的智慧可能有点令人生厌。有这么多正式的和听起来复杂的名字，对于新程序员来说，甚至讨论重构模式都是令人生畏的。然后他们经常用一些好得难以置信的例子来解释，这些例子很难在你当前的工作中联系起来，这总是让我头晕- *我如何将这种美丽的模式应用到我的实际代码中？我还认为，除非你被重构模式刺痛，否则很难理解为什么你应该使用重构模式。我被暗示完全犹豫不决。*

但是，实际上，重构只是做一些整理工作。它是在你吃下最后一大盘之前决定洗碗，或者确保你在睡觉前把洗碗机装好，这样你就不用在早上处理它了。

我不擅长举例，所以让我在写这篇文章的时候，毫不夸张地说出我正在做的事情。我急于实现一个特性来通过测试(如果 Java 可以找到一个“app.port”系统属性，那么一个服务器将绑定到那个端口号)，并抛出了下面的:

```
public static void main(String[] args) throws IOException {
    Connection connection;  
    if(System.getProperty("app.port") == null) {
        connection = new Connection();
    } else {
        int port = Integer.parseInt(System.getProperty("app.port")); 
        connection = new Connection(port)
    }  
    Server app = new Server(connection);  
    app.start();  
} 
```

测试通过了。太棒了。我不会假装 75%的我还没有准备好去吃午饭。但是没有！有时间打扫一下。

所以，首先——除了设置类，我不喜欢在`main`中做任何事情，所以我觉得提取大部分的`if`语句会使代码对未来的我来说更容易阅读。

```
public static void main(String[] args) throws IOException {
    var connection = makeConnection();
    var app = new Server(connection);
    app.start();
} 
```

当然，这只是移动代码。但是将我们的代码分成更小的功能通常会有副作用，使我们的工作更容易测试、维护和扩展。现在，我的下一步是让所有的布尔逻辑更有表现力，更能表达我们的意图。

```
private makeConnection() throws IOException { 
    if (hasSpecifiedPort()) {  
        int port = getPort();  
        return new Connection(port);  
    }   

    return new Connection();
}

private static int getPort() {  
    return Integer.parseInt(System.getProperty("app.port"));  
}  

private static boolean portIsSpecified() {  
    return !Objects.isNull(System.getProperty("app.port"));  
} 
```

我们刚刚提取了一些东西！哇哦。令人心痛的 meta。但是现在`makeConnection`不必担心我们在寻找什么样的 Java 系统属性，或者获取它的细节。它简单地...继续吧。

我们的`if`声明也被调整为如果匹配就提前保释。这是一个我很喜欢的小重构，因为它让我们摆脱了大括号，这对正在隐适美旅行的人来说确实是一件好事。

这只是几个简单的步骤，老实说，IntelliJ 完成了大部分工作。但是仅仅做了几小步，我就准备好了。然后我吃了一个三明治。很好吃，谢谢你。

*“等等”*，你可能在想。*“难道你没有更奢侈的例子，比如说，使用结构和协议重构一个长生不老药模块来实现多态性吗？”*你恳求道，泪眼婆娑，不约而同地想起了我正在做的最后一个项目。*“求你了，”*你乞求着，*“难道没有更复杂的图案可以应用吗？”*

当然了。有很多这样的例子，其中大部分都是从《重构》这本书里诞生的。然而，我认为，有时，这不是重点。尤其是当最后期限、项目经理和午休的需要开始起作用的时候。我们应该庆祝我们的每一个小胜利，而不是太担心几十个这样的胜利会成为一个前前后后的迷人例子。

我要说的是，做我们今天能做到的小事情总是值得的，而不是试图训练自己去做我们承诺明天会做的更大、更丰富、更有趣的重构*——如果我们诚实的话，明天可能永远不会发生。*

 *重构是一个广泛的教会，但我认为值得记住的是，它总是归结为从你家里用来堆放东西的椅子上拿走一件东西；你告诉自己的那个只是用来暂时装那堆书的。

小小的改变？这就是我们激发快乐的方式。*
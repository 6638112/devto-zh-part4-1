# 使用 Textadept 编写脚本

> 原文：<https://dev.to/bachmeil/scripting-with-textadept-1ikj>

昨天在黑客新闻上，有人[评论](https://news.ycombinator.com/item?id=20829818)

> 其他编辑器用户根本不知道在 emacs 中编写一些快速脚本来执行一些任务是多么容易。

我认为许多 Emacs 用户都有这种观点，作为一个长期的 Emacs 用户，我喜欢编写函数库并通过文本编辑器与它们交互的能力。不幸的是，这不是一个准确的说法。其他文本编辑器也有这种能力。textadept——可能受 Emacs 的影响——是我作为编程语言的前端广泛使用的一种语言。这是我的回答

> 我不想挑起战争，但是不久前我把我在 Emacs 中做的大部分事情都转移到了 Textadept，因为我发现 Textadept 更方便。这并不是说 TA 做了你在 Emacs 中能做的一切，但它取代了我用 Emacs 做的所有脚本。
> 
> 你在 TA 内部拥有 Lua 的全部力量。Emacs 在我启动的时候总是有滞后，而 TA 是即时的。我慢慢地在 TA 内部构建功能，以至于我意识到我可以取代我在 Emacs 中所做的一切。
> 
> 它是如此的小巧轻便，以至于，为了好玩，我在 TA 内部写了一个“网页浏览器”。它调用 lynx 并加载页面的可读文本版本。我使用键盘快捷键打开链接。我有搜索网页的功能，我可以搜索 YouTube，打开 VLC 的视频，等等。这是一件很实际的事情:我可以在非常旧的笔记本电脑上使用 TA 作为浏览器。
> 
> 也许不是每个人都这样，但是在 Emacs 中，当我这样做时[1]复制一行:
> 
> 空间 C-n M-w C-y
> 
> 我问为什么不用更好的文本编辑器。在 TA 中是 C-d，就像 Emacs 是 Emacs Lisp 的接口一样，TA 是 Lua 的接口，而且开销少很多。
> 
> [1][https://stack overflow . com/questions/88399/how-do-I-duplicate](https://stackoverflow.com/questions/88399/how-do-i-duplicate)...

从脚本的角度来看，最后一点并不重要。(但这是正确的——Emacs 不是一个轻量级的文本编辑器，当您试图更改一个键绑定时，您可能会陷入麻烦，除非您愿意接受冗长。Textadept 只是一个现成的文本编辑器，没有这个问题。)

我可能会在将来发布更多关于这个主题的文章，但是让我给你一个我用 Textadept 定制的例子。首先，我的工作流程的一些背景，让你明白我需要做什么。一天中，我有很多信息飞向我:我遇到的一个链接，它现在没有任何特殊的用途，但在将来可能会有用，有人发给我的一些服务项目的参考资料，一个会议请求，一个我想纳入明天讲座的随机想到的例子，一位合著者对我们论文中一个数字的问题的轻微评论，对研究生项目规则的澄清。这是几个大项目和许多小项目的无休止的流。

在我工作的时候，我根本没有办法把每天出现的几十个这样的问题组织好。在尝试了许多不同的解决方案后，我发现最有效的是一个名为 capture.txt 的文件，我知道在我有时间查看每个项目、决定需要做什么并采取适当的行动之前，这里的一切都是安全的。在我工作的时候，没有时间和精力去开发一个复杂的系统。我需要输入几个按键然后开始打字。

那么，我是如何在 Textadept 中实现这个系统的呢？我做的第一件事是添加一个打开捕获文件的菜单项，如果它还没有打开的话。(我更喜欢菜单项，因为我不经常做这项任务，而且菜单项的认知开销低于键盘快捷键或调用功能。)我在`menu.lua`文件中添加了这个:

```
{_L['Open Capture'], function() io.open_file(_HOME .. "/capture.txt") end}, 
```

重启时，这是瞬间的，我有一个打开文件的菜单项。

仅仅打开文件是不够的。当一个新项目进来时，我可能正在文档中间。我写了一个移动到文档顶部的函数，添加了两个换行符，并将光标移动到开头:

```
function new_capture()
    buffer.insert_text(0, "\n\n")
    buffer.goto_pos(0)
end 
```

函数体第一行的`0`告诉它在文档的开头插入文本。第二行将光标移动到文档的开头。我可以通过按 Ctrl-e 键并输入
来调用这个函数

```
new_capture 
```

这很不方便，所以我将该函数绑定到 Alt-i(用于插入)。在我的 init.lua 文件中，我添加了

```
keys.ai = new_capture 
```

现在我要做的就是按 Alt-i 键，开始打字。

我很快发现这不是一个完整的解决方案。如果我只是打字，我很快就会有一个很大的文本文件，当我在一天结束时处理所有事情时，处理这样的东西并不容易。这导致我抵制这种处理，如果我不每天都做这种处理，这个系统就是失败的。

解决方案是用一个标识符开始每一项，这样我就知道我在处理什么了。如果是我需要做的任务，就从`%task`开始。如果是便笺，它以`%note`开头，后面跟着时间戳，我知道这通常是有用的信息。我还有其他几个标识符，它们可能会不时改变。

对于注释，在我的 init.lua 文件中有如下内容:

```
snippets['n'] = '%%note ' .. '%<os.date("%x at %X")> ' 
```

要输入带有时间戳的新注释，我所做的全部工作是:

1.  按 Alt-i 在文件顶部为注释留出空间。
2.  按 n 键，然后按 tab 键插入代码片段。
3.  把我脑子里所有的信息都清除掉。

代码片段是这样的:

```
%note 08/30/2019 at 09:53:54 AM 
```

当然，你可以用 Emacs 做这些事情。关键是你可以在 Textadept 中做得一样好，甚至更容易，而且你可能更喜欢一个轻量级的、性能极高的编辑器。并不是说您*必须*使用 Emacs 才能获得这种功能。在 Lua 中(这是一个很大的工作量)或通过调用命令行程序(可能用 Emacs Lisp 编写)可以做的任何事情都可以在 Textadept 中完成。
# 在 docker 守护进程停机期间保持 Docker 活动

> 原文:[https://dev . to/ajayatgit/keep-docker-alive-during-docker-daemon-down time-4 PFI](https://dev.to/ajayatgit/keep-docker-alive-during-docker-daemon-downtime-4pfi)

当 docker 守护进程默认终止时，它会关闭正在运行的 docker 容器。在 Docker Engine 1.12 中，您可以配置守护进程，以便即使守护进程不可用，容器也能保持运行。
这个功能被命名为**实时恢复**。实时恢复选项有助于减少由于守护程序崩溃、计划内停机或升级而导致的容器停机时间。

### [](#how-do-we-enable-live-restore)我们如何启用实时恢复？

有两种方法可以启用实时还原

*   将配置添加到守护程序配置文件中。在 Linux 上，默认为/etc/docker/daemon.json

    使用以下 JSON 来启用实时恢复。

    ```
     {
         "live-restore": true
       } 
    ```

    您现在可以重新启动 docker 守护程序。如果你正在使用 systemd，那么使用命令 *systemctl reload docker* 。

*   您还可以使用- live-restore 标志手动启动 dockerd 进程。

### [](#impact-of-live-restore-on-running-containers)实时恢复对正在运行的容器的影响

如果守护进程长时间关闭，正在运行的容器可能会填满守护进程通常读取的 FIFO 日志。完整的日志会阻止容器记录更多数据。默认的缓冲区大小是 64K。如果缓冲区填满，您必须重新启动 Docker 守护程序来刷新它们。

在 Linux 上，可以通过更改/proc/sys/fs/pipe-max-size 来修改内核的缓冲区大小。

### [](#live-restore-and-swarm-mode)现场还原和蜂群模式

live restore 选项仅适用于独立容器，不适用于群集服务。群服务由群管理器管理。如果群管理器不可用，群服务将继续在工作节点上运行，但在有足够的群管理器来维持法定人数之前，无法对其进行管理。

### [](#live-restore-during-upgrades)升级过程中的实时恢复

Live restore 支持在 Docker 守护程序升级期间保持容器运行，尽管这仅限于补丁版本，不支持次要或主要守护程序升级。

如果在升级过程中跳过发行版，守护程序可能无法恢复其与容器的连接。如果守护进程不能恢复连接，它就不能管理正在运行的容器，您必须手动停止它们。

### [](#live-restore-upon-restart)重启后实时恢复

如果守护程序选项(如网桥 IP 地址和图形驱动程序)没有更改，则实时恢复选项仅适用于恢复容器。如果这些守护程序级配置选项中的任何一个发生了更改，实时恢复可能无法工作，您可能需要手动停止容器。
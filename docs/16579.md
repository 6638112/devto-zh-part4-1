# 使用 Cypress 进行端到端测试

> 原文:[https://dev . to/khpatel 4991/end-to-end-testing-with-cypress-203 f](https://dev.to/khpatel4991/end-to-end-testing-with-cypress-203f)

端到端测试让我们从头到尾测试我们的整个应用程序。它涉及到确保一个应用程序的所有组成部分都按照预期的那样工作。E2E 测试模拟真实的用户场景，本质上是测试真实用户将如何使用应用程序。

## [](#selenium)硒

Selenium 是一个用 Java 编写的应用程序，它让我们从浏览器的角度测试我们的应用程序。它有点老了，但让我们做了很多奇妙的事情，否则我们可能无法用集成工具的良好生态系统来做这些事情。

它是这样工作的，Selenium 有一个监听命令的 Java 服务。您用任何语言编写测试代码，然后它使用一个称为“webdriver API”的库来说 Selenium 的语言，并将这些命令发送给服务。然后，该服务将所有这些命令排队，并试图将它们发送到任何给定的浏览器，即正在执行测试的真正的浏览器。

不幸的是，有许多不同的抽象、集成和接口可能会出错。当测试失败时，可能是以下任何一个问题:

*   我们的测试代码有问题
*   与 Selenium 一起工作的平台相关的 API 可能表现不同
*   不同版本的 Selenium 可能会根据用途而有不同的工作方式
*   Java 服务中可能会出错
*   浏览器 web 驱动程序可能会有错误，如果到浏览器的套接字连接失控，消息多路复用可能会出错，导致有趣的前端行为

这种架构有很多地方可能会出错。再加上这该死的东西太慢了。

我们人类有很好的直觉能力，但计算机和代码没有。当我们的测试代码运行时，它完全按照要求去做，不做任何猜测。如果它点击一个按钮，并开始重新渲染，我们需要非常小心，在我们尝试做下一件事之前，知道它是否完成渲染。数据库、网络、磁盘读/写等异步服务中的任何缓慢都会破坏要执行的测试的顺序，从而导致测试的级联失败。

当我们采用这种沉重的架构，并试图与我们的应用程序融合时，事情变得格外有趣。这是令人沮丧的原因。我们会写一个提交，在本地运行测试，一切看起来都很好，我们会把它推到构建，唉，一些测试会失败。然后我们将再次运行测试，因为这不是提交应该破坏的东西，它将通过！万岁！

我们的应用程序应该简单，快速和一致。对吗？我们的页面进行复杂的交互，以始终如一地提供丰富的用户体验，因此我们的用户可以更加信任我们的服务，从而增加用户保留率和回报。

总的来说，Selenium 是一个非常受欢迎的软件，已经成为许多自动化策略的基础。它附带了一个优秀的社区、支持和工具，并允许我们进行跨浏览器测试。然而，它也有其局限性。我们能做得更好吗？

## [](#cypress)柏树

欢迎赛普拉斯！Cypress 是一个用 Javascript 编写的 OSS，它让我们可以像 Selenium 一样编写 E2E 测试。在[完美的](https://perfecttense.com)我们有可怕的`contenteditable`e2e 测试。由于 Selenium 的设置过程，我选择不使用它，我对它的总体印象是缓慢而脆弱。相比之下，Cypress 可以用两个简单的命令启动，运行测试也很简单。当我第一次运行 Cypress 时，我被样本测试运行的速度震惊了。Cypress 还在第一次启动时创建了几个 E2E 测试。这些是关于什么、为什么、如何测试以及如何使用的有用指南。对于学习如何使用 API 访问页面、查找元素并与之交互、处理 cookies、ajax 请求等等，它们也非常有用。

赛普拉斯的与众不同之处在于，它是建立在一种新的架构之上，这种架构消除了片状结构。它能够通过在与应用程序相同的运行循环中运行来实现，而 Selenium 通过网络执行远程命令。它可以与任何服务器渲染的页面(如我们的 HAML 页面)或任何现代框架(如 React、Vue 等)编写的 web 应用程序一起工作。

Cypress 测试是用来自 Mocha、Chai 和 Sinon 的熟悉的匹配器用 Javascript 编写的。它们在浏览器本身的相同环境中执行，不需要特殊的设置、语言或驱动程序绑定。JS 来统治他们。

因为没有网络延迟，也不需要任何设置，Cypress 运行速度极快。你实际上可以第一次使用完整的端到端测试来进行 TDD。您可以在用测试驱动整个开发过程的同时更快地开发，因为您可以看到您的应用程序，您可以访问开发人员工具，您可以访问服务器端代码，并且更改可以实时反映出来。它太快了，它会让你发现你不知道存在的错误。

下面是用 Cypress 和 Capybara 编写的测试的时间比较，它们访问相同的页面，对 DOM 执行相同的操作，最后有相同的期望。

[![Comparison Benchmark](../Images/758f6da87b1c68e74bcb96dc37685395.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--r0Pld_Ws--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/lbej5d6646c4qer93sa5.png)

Cypress 提供的其他一些有用的、值得拥有的特性和好处:

*   可靠地测试视口和滚动行为。
*   重放 DOM 快照并浏览我们的测试。
*   带有 web UI 的内置测试运行程序，可以单独或一起运行任何测试。
*   在期望之间轻松暂停和调试。
*   失败时会自动获取浏览器屏幕截图，当从 CLI 运行测试时，会录制整个测试套件的视频。
*   来自浏览器的实际`window`对象，以期待发送到全局的消息。
*   它又一次飞速前进。我们在 cypress 中的测试运行速度比 Selenium Webdriver 快 3-4 倍。

### [](#current-limitations)电流限制

*   仅适用于基于 Chromium 的浏览器，测试只能用 Javascript 编写。Cypress 团队一直在努力使它兼容其他浏览器。你可以在这里追踪进度[。](https://github.com/cypress-io/cypress/issues/3207)
*   测试 iframes 需要一些变通方法，但这肯定是可能的。

总的来说，Cypress 仍然是一个新的工具，有一个不断增长的社区，一个独特的体系结构，可以快速可靠地操作 DOM，没有任何网络延迟，并且是在考虑开发人员友好的情况下构建的。它也有很好的文档，有很多片段可以帮助我们编写更易管理的测试并坚持最佳实践。

希望这有所帮助！

## [](#further-readings)进一步阅读:

*   [为什么是柏树](https://docs.cypress.io/guides/overview/why-cypress.html#In-a-nutshell)
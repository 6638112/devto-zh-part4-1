# 伟大的 Azure DevOps 迁移-第 3 部分:清洁

> 原文：<https://dev.to/timothymcgrath/the-great-azure-devops-migration-part-3-clean-4dhl>

在将 TFS 数据迁移到 Azure DevOps 之前，最好删除任何不需要迁移到新服务中的数据。十年的 TFS 积累了海量的代码，我真的只需要把我最新的 repos 带上来就可以了。

这一部分将显示要消除哪些数据以及最快的方法。

如果你错过了之前的帖子，从这里开始。

我强烈推荐[微软的 Azure DevOps 服务迁移指南](https://azure.microsoft.com/en-us/services/devops/migrate/)。

## 团队项目

在我的例子中，我有大约 50 个团队项目集合。每个团队项目集合都包含自己的项目模板、代码存储库和工作项。

我有大约 50 个，因为我们在 10 年前从 SourceSafe 导入，导入过程是这样设置的。我们实际上只持续使用这些项目中的一个。在过去的 10 年中，我们将活动项目的代码迁移到这个主项目中，这样我们就可以共享工作项和项目模板。

正因为如此，我有大约 50 个额外的项目，它们都是很少(如果有的话)参与的老项目。他们都没有自己的工作项。我不想将这些项目带入 Azure DevOps 服务。

未来的计划是，如果我们需要访问其中一个项目的代码，我们将把它作为一个新的 GIT 仓库导入到我们的 Azure DevOps 服务项目中。

### 删除团队项目

因此，对于步骤 1，删除不必要的团队项目。这可以通过 TFS 的 Web 用户界面轻松完成。

确保你在 TFS 的网页界面上！

在 Web UI 中，您需要访问集合的设置。在 breadcrumb trail 中，在 UI 的顶部，单击根(我的是 DefaultCollection)。然后点击左下角的管理设置。这将显示您收藏的项目的完整列表。点按每个项目旁边的省略号(您想要保留的项目除外)，然后点按“删除”。

如果这些项目中的任何一个有一个大的代码库，这将需要很长时间。我的一个大的花了一个多小时，做好等的准备。

## Team Foundation 版本控制

在 GIT 之前，我们有 TFVC。TFVC 是 TFS 最初支持的唯一源代码控制，所以如果你已经使用它很长时间了，你可能会有挥之不去的 TFVC 库。

我们现在只使用 GIT，所以我不想将任何 TFVC 库迁移到 Azure DevOps 服务。如果您使用的是 TFVC，您可以迁移这些存储库...但是我还是建议你转到 GIT，因为它太棒了。

我当前正在迁移的项目包含 GIT 和 TFVC，所以我想在迁移前清除 TFVC。你不能真的摧毁 TFVC 仓库，它永远在那里...但是你可以清除里面的所有东西。

### 删除工作区

首先，删除所有的工作区。在附加的工作空间消失之前，TFS 不会让你删除代码。

我发现最好的方法是利用过去的爆炸: [TFS 伙伴](http://www.attrice.info/downloads/index.htm#tfssidekicks2015)！

TFS 助手对 TFVC 来说是一个方便的工具，但随着 GIT 的接管，它已经过时了。但是，它仍然可以在 Azure DevOps Server 2019 中工作。

将它安装到您的临时服务器上并运行它。转到“工作区”选项卡，突出显示并删除所有工作区。轻松点。

### 删除代码

现在说说代码。从数据库中永久删除代码的最佳方式是使用命令行“tf destroy”。这将从数据库中完全删除代码。

包含/startcleanup 参数也非常重要，因为这将告诉数据库立即删除它。否则，可能需要长达五天的时间才能删除。

有一个警告，如果运行时间过长，tf destroy 命令将会失败。所以，如果你有大量的代码，你需要把它分成小块来做。

我在 TFVC 有很多分支机构，所以我必须一次做一个分支机构。这花了一段时间，所以也许在你做这个的时候可以放一个电视节目...

tf destroy 命令需要从 Visual Studio 的开发人员命令提示符下运行。把它输入 Start 来查找。

然后运行* TF destroy $/[存储库]/[文件夹] /startcleanup

如果您的存储库足够小，跳过[FOLDER]并尝试在一次运行中销毁它。

## 总结

您的旧数据已被清除！这可能看起来没有必要，但这样做有两个原因。

1.  我们真的希望在迁移前低于 30 GB，以尽可能实现最简单的迁移。稍后会有更多相关内容...
2.  这是清理你不再需要的杂物的好机会。如果你认为你将来会需要这个代码，那就保留它。但就我而言，我 99%确定我再也不需要它了。如果我真的需要它，我还是想把它迁移到 GIT。

## 接下来是什么？

在下一篇文章中，我们开始验证。
# AWS Amplify 的安全 UX 不足且危险

> 原文：<https://dev.to/rosswilliams/aws-amplify-s-security-ux-is-insufficient-and-dangerous-378n>

Amplify 是一个后端即服务工具集，其目标是允许开发人员在没有底层基础设施高级知识的情况下构建云应用程序。让开发人员专注于创建业务逻辑的目标是值得称赞的，但是这个工具集也不是没有弱点。由于产品是新产品，一些弱点是缺少功能，这是可以理解的，但保护客户需要放在任何新功能之前，是 AWS 的首要任务。不幸的是，Amplify 授权工具不足以保护客户不暴露私人数据。保护客户并不是最优先考虑的事情。

亚马逊以前处理过这些问题。2006 年推出的 S3 因客户难以安全配置而臭名昭著。来自 Capital One、脸书、威瑞森、时代华纳和美国国防部的数据泄露只是由于难以理解和难以验证安全配置而泄露数据的一些较大的 AWS S3 客户。S3 的一些数据泄露是由于 UX 不佳，政策锁定了“任何经过认证的 AWS 用户”，这实际上意味着全球任何花 5 分钟注册账户的用户。未经验证的用户进行的基本安全检查会显示这些桶是不可用的，而实际上一个坏人可以在几分钟内窃取公司机密。

亚马逊已经通过创建更多的工具来帮助客户识别开放桶和设计更好的默认策略来应对这些事件。但在不破坏 10 年现有用户的情况下，能做的也就这么多了。结果是，UpGuard 的网络风险研究主管克里斯维克里(Chris Vickery)仍然认为数据泄露的程度与以前一样。不把保护 S3 客户放在第一位的经济影响是以数十亿美元来衡量的。现在 AWS Amplify 正在走上同样的道路，除非立即做出调整。

问题的关键在于，Amplify 将其认证模块营销为“为希望创建具有现实生产就绪用户认证的应用程序的开发人员提供认证 API 和构建模块”。多个 AWS 文档展示了 Amplify 如何通过 Graphql 指令实现正确的 authZ 控制。在笔记应用程序的简单例子中，AWS 示例代码显示了下面的代码片段，向用户解释“这些项目只对创建它们的用户可用”:

```
type Note @model @auth(rules: [{ allow: owner }]) {
    id: ID!
    title: String!
    content: String
} 
```

对于普通读者，甚至是使用 Amplify 的团队开发人员来说，这似乎是安全的。不幸的是，任何用户都可以在创建或修改这些笔记时阅读它们。怎么会？很简单，默认情况下，每个模型都会创建一个 graphql 订阅，当调用该订阅时，它会为任何用户返回一个通过 WSS 的 MQTT 的 AWS IoT 端点，在这里您可以订阅返回的主题，并监听模型的所有创建和更新事件。对于不需要具备底层基础设施高级知识的用户来说，这就够了。在我研究过的大多数 Amplify 项目中，都有实现私有数据的部分，订阅可以用来读取私有信息。虽然安全是每个人的工作，每个开发人员都应该是安全工程师，但责任不仅仅在于这些实现者，因为他们被告知 Amplify 正在为他们做繁重的工作。发现这个问题会迫使开发人员去理解他们可能不知道存在的不熟悉的语言和产品。

直到一个月前，Amplify 文档甚至不承认订阅可能会泄露私人信息以及如何关闭它们，尽管在这个问题上磕磕绊绊的用户已经通知 AWS 很长时间了。现在，在一个小时的阅读时间后，在一个至少需要 2 个小时阅读的页面中，有一个注释:“@auth 指令还不支持开箱即用的订阅。目前，您有两种选择来授权订阅字段。您可以通过将 subscriptions: null 传递给@model 来关闭订阅，或者您可以编写自定义授权逻辑”。不幸的是，这篇笔记并没有导致“如何在 60 分钟内完成一个安全的 Amplify 项目”教程的更新，包括那些由 AWS 发布的教程，在那里用户很可能会复制解决方案作为起点。

但不仅仅是订阅，让模型可搜索同样绕过了认证。AWS Amplify workshop 由 AWS 发布并拥有版权，包含以下 graphql 模式:

```
type Photo 
  @model 
  @auth(rules: [{allow: owner}]) 
  @searchable {
    id: ID!
    album: Album @connection(name: "AlbumPhotos")
    bucket: String!
    fullsize: PhotoS3Info!
    thumbnail: PhotoS3Info!
    labels: [String!]
} 
```

同样，普通读者、参加研讨会的开发人员或使用 Amplify 的团队中的开发人员会认为这个身份验证角色可以适当地保护照片模型。Amplify workshop 页面进一步声明了这种模式“增加了其他人根据具体情况查看和上传到我们相册的能力”。虽然这种说法对于生成的 listPhotos 和 getPhotos graphql 查询是正确的，但对于 searchPhotos 查询却不正确。Amplify 用户可以通过检查 amplify 在部署过程中生成的 velocity 模板代码来验证这一点。他们不能做的是在 Amplify 文档中找到这个安全旁路。自 2018 年 11 月以来，这种身份验证旁路已被标记为一个问题，似乎是为了更快地添加功能而不是集成到授权系统中而故意进行的权衡。与此同时，开发人员只能自己去发现这个安全漏洞，并学习编写 velocity 模板来实现他们自己的安全性。

每个人都有责任构建安全的系统，包括工具用户和提供者。Amplify 用户必须评估和验证工具的声明。信任但要核实。与此同时，随着 AWS 市场能够抽象出复杂的后端和云技术，并暗示他们正在转移共享责任模式中的分界线，以承担额外的安全责任。令人失望的是，当 Amplify 工具没有履行其创建工具来正确控制敏感数据的义务时，这种责任却被推销给了开发人员。

一些 Amplify 营销声明没有通过验证测试。用户确实需要担心花费时间来配置和保护多个不同的云后端服务，以支持他们的应用程序。未能维护安全责任将使企业及其客户面临风险。

这些安全问题可以通过用户实现额外的定制逻辑和了解更多 Amplify 为他们创造的云技术来解决。Amplify 没有固有的安全问题，并且可以对工具进行改进，以创建满足营销和教程要求的解决方案。但是 Amplify 的一些变化可能会给现有用户带来突破性的变化。每天这些已知的问题得不到解决，更多的用户将会实现不安全的系统，使 AWS 陷入不太理想的升级路径。Amplify 团队控制着未来十年有多少新闻报道会讨论由于错误配置的 Amplify APIs 而导致的安全漏洞。

我希望以上内容将向现有用户强调，他们需要检查自己系统的安全性，以防范这些风险。我希望 AWS 重新关注 Amplify，遵循 CTO 的建议，保护客户先于任何功能开发。
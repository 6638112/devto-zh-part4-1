# 那次我发布了不安全的代码

> 原文:[https://dev . to/renegade coder 94/that-time-I-shipped-unsecured-code-5acb](https://dev.to/renegadecoder94/that-time-i-shipped-insecure-code-5acb)

为了我可能无意中签署的保密协议，我将不得不限制我分享的细节。也就是说，我想谈谈我有一次故意发布不安全的代码。

## [](#multidisciplinary-teamwork)多学科团队合作

不久前，我在一家运输公司担任预测工程师。基本上，这意味着我正在开发运输系统的预测和诊断软件。

当时，我所在的团队主要是机械工程师，他们对这些运输系统有着广泛的了解，但对软件却知之甚少。自然，我在那里弥合差距。

### [](#introducing-the-code-base)介绍代码库

当我到达时，每个人都处于开发的快速原型阶段。特别是，他们使用 Python 与运输系统进行通信，以收集和分析数据。

当然，他们并没有真正的发展过程。取而代之的是，每个人都会在空闲时维护和修改他们自己版本的大量脚本。每当他们想要分享修改时，他们会通过电子邮件将脚本作为 ZIP 文件传递。

当我最终抽出时间查看代码时，它就像你所期望的那样粗糙。例如，没有函数——只有加载了复制粘贴代码的大量逐行脚本。此外，什么都没有真正记录下来，也没有标准。事实上，甚至连基本的命名约定也半途而废:

```
myVariable 
my_variable
MyVariable
MYVARIABLE 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

### [](#providing-value-to-the-team)为团队提供价值

当然，我的首要任务是找到一些方法来简化代码共享过程。很自然，我选择了 git 和 GitHub，这样我们终于可以开始对代码进行版本控制了。

之后，我必须弄清楚代码在做什么，这样我就可以开始建立一个可重用的函数库。当然，这并不太难，因为重复的代码到处都是。

在一些清理、文档和测试之后，我开始思考如何架构他们的系统，这导致了许多天的重构。最终，我们得到了我真正引以为豪的东西。

Python 脚本准备就绪后，我们添加了一个 C#前端。换句话说，我们有一些 UI 可以根据需要调用脚本。那时，我负责维护我们当前的脚本并实现新的脚本。

### [](#shifting-with-new-requirements)随着新的要求而转变

随着时间的推移，管理层开始增加新的需求。例如，他们不喜欢将 Python 脚本与 UI 一起发布，所以他们要求我将它们打包成可执行文件。很自然，我遵照命令，使用类似于 [py2pxe](http://www.py2exe.org/) 或 [PyInstaller](https://www.pyinstaller.org/) 的工具来完成它。

当然，您可能想知道如何将脚本打包成可执行文件会更“安全”嗯，不是的。毕竟，任何人都可以[下载一个反编译器](https://blog.nviso.be/2017/01/03/decompiling-py2exe-executables/)并在某种程度上检索 Python。也就是说， [PyInstaller 提供了一个选项来加密可执行文件](https://pyinstaller.readthedocs.io/en/stable/usage.html#encrypting-python-bytecode)。不幸的是，这种选择同样是徒劳的。毕竟，[解密密钥要和代码](https://stackoverflow.com/questions/39559677/pyinstaller-encryption-key)一起发货，那么你怎么做呢？

嗯，没什么。当你把你的代码直接交给客户时，他们就有了你的代码。如果他们的机器能够执行你的程序，不难想象有人也能搞清楚。

所以，有什么大不了的？当你交出代码时，你就接受了风险，对吗？嗯，我也是这么想的。然而，这与我的团队的理解不同。事实上，我曾经在一次会议上被问及代码是否安全，我坦率地说“不”。天哪，这让一些人很恼火。

几乎立刻，我就被问到类似“为什么我会故意设计不安全的软件？”或者说“[你的代码不够安全](https://therenegadecoder.com/blog/the-bewildering-bureaucracy/)”显然，我们有一个根本性的误解，人们对我或我提出的解决方案(即在服务器上托管代码)都不太满意。

## [](#insecurity-is-everywhere)不安全感无处不在

但是，我应该后退一步，因为这个不安全的软件比我已经提到的还要多。

### [](#handing-binaries-to-customers)将二进制文件交给客户

首先，我认为每个人主要担心的是有人会窃取我们的代码并试图从中获利。当然，最糟糕的情况是他们会发现我们的交通系统是如何工作的。

如果这些假想的黑客掌握了我们的软件，他们就能知道如何与我们的交通系统通信。然后，他们可以编写自己的软件系统来完成相同或相关的目标，并可能发布它。

此外，这些二进制文件中可能存在敏感信息，如系统密码，这可能会使系统容易受到超出我们软件能力范围的攻击。换句话说，很多事情可能会出错。

### [](#sniffing-network-traffic)嗅探网络流量

虽然每个人都明显关心我写的软件，但我更关心我们的软件和运输系统之间的接口。特别是，没有一个网络连接——串行或其他——是加密的，所以我们所有的流量都可以很容易地使用类似 [Wireshark](https://www.wireshark.org/) 的工具嗅探到。

换句话说，即使我们能够以某种方式完全混淆我们的代码，我们仍然会彻底完蛋。据我所知，我们能够阻止这类攻击的唯一方法是通过连接强制传输大量无用数据，这样就更难被发现。当然，像 Mark Rober 这样的人表明，用软件预测模式比你想象的要容易得多:

[https://www.youtube.com/embed/PmlRbfSavbI](https://www.youtube.com/embed/PmlRbfSavbI)

### [](#examining-running-programs)检查正在运行的程序

我们软件的一个很好的特点是我们有一个 Windows 原生应用前端。换句话说，我们使用 Python 与我们的交通系统进行交互并不明显。

然而，每当用户通过界面进行连接时，我们都会运行我们的 Python 脚本。由于它们是独立的程序，我们可以在任务管理器中看到它们的名字。更糟糕的是，数据分析通常是处理器密集型的，所以我们的脚本通常直接放在任务管理器的顶部。换句话说，它们并不难找到。

如果出于某种原因，用户能够识别哪个可执行文件做了什么，他们就可以快速分离出他们想要的可执行文件，并完成逆向工程的过程。显然，那并不理想。

## [](#reflection)倒影

正如你所看到的，我们的应用程序非常不安全，所以我仍然对袖手旁观说“不”。希望在我离开后接手这项工作的人能够说服团队走另一条路。否则，我可能刚刚向我们社区的一小撮黑客通风报信。哎呦！

不管怎样，这就是我要说的。我认为这篇文章的观点是双重的:

*   分享一个有趣的故事，关于我以前在这个行业工作时发生在我身上的事情
*   告诫他人安全的重要性

老实说，我对制作安全软件几乎一无所知，但我理解它的重要性。在我的特殊情况下，我能够识别我们的应用程序的三个主要风险领域，但我真的不知道我在做什么。换句话说，我们的情况可能比我想象的要糟糕得多。

如果你觉得这篇文章很有趣，实际上我之前已经在我的[工程咆哮系列](https://therenegadecoder.com/series/a-string-of-unfavorable-roles/)中写过这个话题。请随意查看！

既然你在这里，为什么不通过[成为社区](https://www.patreon.com/TheRenegadeCoder)的一员来表达你的支持呢？每一点帮助，你都会得到一点回报。如果你手头拮据，你可以随时加入[邮件列表](https://newsletter.therenegadecoder.com/)。这样，我可以每周给你发送网站的更新。

无论如何，再次感谢你的支持，希望下次能见到你！

那次我发布不安全代码的帖子[首先出现在](https://therenegadecoder.com/blog/that-time-i-shipped-insecure-code/)[这个变节的程序员](https://therenegadecoder.com)上。
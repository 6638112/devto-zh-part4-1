# C 语言中文件处理的顶级技巧——避免潜在的陷阱！

> 原文：<https://dev.to/anderson248/top-tips-for-file-handling-in-c-avoid-potential-pitfalls-5dnc>

一篇面向需要使用 C 语言文件处理的程序员的文章，有助于促进良好实践，提供一些标准解决方案，并避免陷阱。

## 代码范围

本文的目的是从一个较高的层次上介绍程序员应该了解的 C 语言中文件处理的各个方面。这些提示可能对每个软件开发人员都有用，即使你正在为专业公司从事增强软件开发。我们将着眼于:

*   文件类型；
*   如何打开和关闭文件；
*   如何读取和写入文件；
*   检查文件大小和测试文件结尾的方法。
*   在这个过程中，我们将指出任何潜在的陷阱和编程最佳实践。

## C 语言中文件处理的类型

程序员需要知道如何处理两种关键类型的文件:

*   顺序-一次一个字节(或字节块)；
*   随机访问——使用某种索引进行访问，没有特定的顺序。一个文件实际上可以分成两个部分——顺序访问索引(记录列表)和随机访问部分(记录数据),随机访问部分旨在提供更快的访问，而不仅仅是在试图找到所请求的项目时读取和丢弃记录。

程序员遇到的大多数文件往往是连续的。它们可以有两种格式:

*   文本可读文本，可能由操作系统解释，即 ASCII 与 EBCDIC
*   二进制-没有表示形式的纯数据，即字节(数字)值。

这两种文件类型都可以顺序访问或使用随机访问，文件类型在打开时指定。

## 打开和关闭文件

使用 fopen 函数打开一个文件，如果该文件不存在，可以使用设置为写入该文件的 fopen 函数创建该文件。为了避免覆盖现有文件，有必要尝试以只读方式打开它，如果不能，就以可写方式打开它。

注意:如果现有文件以可写方式打开，它将被截断。要追加到文件中，可以使用 append 标志。

fopen 的所有变体都返回一个文件指针(定义为 FILE *)，可以针对 NULL 对其进行测试，NULL 值表示该文件不存在。

随后关闭文件需要这个文件指针。

## 确定文件大小

要在不移动文件指针的情况下找出大小，需要:

*   存储当前文件位置；
*   快进到文件末尾；
*   注意位置；
*   倒回文件中的上一个位置。

编写文件大小函数一文对此进行了说明。注意，为了确定是否已经到达文件的末尾，可以根据常量 EOF 测试 fread 函数的返回值。

## 在 C #中读写文件

可以使用 getc 函数从文件中逐字节读取数据，该函数返回一个(解释的)字符值。伴随函数 putc 向文件中写入一个文本字符。

也可以使用 fprintf 和 fscanf 处理格式化数据，它们的工作方式与 stdio.h 函数 printf 和 scanf 相同。这些函数仅适用于文本文件。

使用 fread 和 fwrite 处理二进制文件。这些函数对使用 malloc 分配的内存进行操作，并转换为可用的数据类型。

在使用这些函数之前，必须获得一个有效的文件指针，否则结果是不确定的，有时会导致崩溃。
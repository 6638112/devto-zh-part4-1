# PaaS 与无服务器:2019 年选择哪个？

> 原文：<https://dev.to/heroku/paas-versus-serverless-which-to-choose-in-2019-5fep>

无服务器计算越来越受欢迎，因此在 2019 年构建新应用时，您应该选择无服务器还是坚持 PaaS？随着 AWS Lambda 服务的推出，AWS 在 2014 年开始了无服务器运动。那时候，感觉就像史蒂夫·乔布斯推出第一部 iPhone 一样具有革命性。主要想法是完全摆脱基础设施管理。你只需要写一小段代码，上传它，云会处理剩下的事情。感觉就像 PaaS 2.0。更大、更好、更先进的 PaaS 版本。

PaaS 试图使基础设施更易于管理，因此开发人员可以专注于在 web 框架内工作，而不是浪费时间处理底层基础设施。目标是简化部署和操作过程。同时，它们仍然提供对基础设施的访问，这在配置服务器的自动化和灵活性之间提供了平衡。例如，今天的 Heroku 让部署、管理和扩展服务器应用变得像一行命令一样简单。

那么今天我们应该选择哪种方法来构建应用程序呢？您应该切换到无服务器模式吗？第一步是客观地看待我们所有的选择，根据我们的具体情况评估它们，并做出合理的选择。两者都可以解决基本的开发需求:快速可靠地交付功能。理解技术差异将有助于您确定哪种方法最适合特定的项目。

有许多无服务器和 PaaS 平台可供我们比较。对于无服务器，流行的选项包括 AWS Lambda、谷歌云函数、Azure 函数和 OpenWhisk。在 PaaS 方面，我们有 Heroku、AWS Elastic Beanstalk、Google AppEngine 等等。

为了简化我们的比较，让我们以 AWS Lambda for serverless 和 Heroku for PaaS 作为典型例子。我们将尽可能公平地进行比较。

## 用 Lambda 实现无服务器的优势

无服务器提供了一些真正的优势。您不需要管理基础设施或应用服务器，因此您可以专注于编写函数代码。它也是按通话计费，而不是按小时计费。

*   没有需要管理的基础设施。
    只需写一小段代码，上传到云端，云服务就会做其他一切。不再需要设置和管理服务器。不再有扩展和负载平衡问题。不再对服务器和网络进行故障排除。听起来像一场梦！虽然 PaaS 解决了其中一些问题，但您可能仍然需要考虑管理 dynos、地理分布、容错和扩展。

*   **提高发展速度。**
    处理 HTTP、解析 JSON 之类的不需要写代码或者使用框架。你只需要在一个函数中编写纯业务逻辑。拉姆达会为你做好一切。使用 Heroku，您仍然需要编写代码来实现您的应用服务器。

*   只为实际使用的资源付费。
    对于任何平台即服务提供商，您都需要为特定计算资源(如 CPU 和 RAM)的可用性付费，无论它们是否在使用中。有了 Lambda，你只需在实际使用资源时付费。使用 Lambda，你将为调用次数、消耗的资源量和执行时间付费。这种计费模式本身促使开发人员编写紧凑高效的代码。有了 Heroku，你就要为运行 dynos 付费，即使它们没有被使用。你可以缩小不需要的 dynos，但是你必须运行至少一个来运行一个应用程序。

*   与其他 AWS 服务集成。
    Lambda 与许多其他 AWS 服务集成得非常好。如果你所有的基础设施都运行在 AWS 上，它会更容易使用。您甚至可能被迫使用 Lambda 作为将 AWS 服务与外部服务集成的一种方式，比如将 Cloudwatch 事件转发给一个监控服务。

*   **边缘计算可以降低平均延迟。**
    有一种和 AWS 完全不同的服务叫做 [Lambda@Edge](mailto:Lambda@Edge) 。想法是在靠近终端用户的 CDN 节点上运行定制的 JavaScript 代码。它可用于为客户端实现更低的延迟。

## PaaS 与 Heroku 的优势

PaaS 平台提供了自以为是的标准基础设施，这使得它们对开发人员非常友好。他们简化了底层基础架构的管理，同时仍然提供对基础架构的访问。

*   作为常规开发人员工作流程的一部分，易于使用。
    让你的应用在 Heroku 上运行需要更少的步骤，并且可以像 [Git 推送](https://devcenter.heroku.com/articles/git)一样简单。随着应用程序的成熟，Heroku 还将其他服务集成到一个方便的包中，如[持续集成和审查应用程序](https://www.heroku.com/continuous-delivery)。使用 Lambda，你必须将你的代码打包成一个 zip 文件，上传它，并配置触发器和权限。如果不配置 API Gateway，您将无法向互联网公开您的应用。

*   **同价不限 HTTP 请求。**
    Heroku 不按请求计费，所以更容易预测，一个 dyno 每秒可以处理数千个请求，这取决于你的代码。使用 Lambda，你必须使用 API Gateway 通过 HTTP 来公开它。这可能很贵，因为除了 Lambda 请求和带宽费用之外，你还要为每个请求付费。在写这篇文章的时候，仅 API Gateway 一项就花费了每 1M 请求 3.5 美元。乍一看，这似乎并不昂贵。但不要忘记，在我们生活的世界里，一个应用或服务可以像病毒一样传播，一夜之间变得非常受欢迎。问题是，之后你还能支付 AWS 的账单吗？

*   更少的长尾延迟问题。
    Heroku dynos 连续运行，随时准备请求。您甚至可以使用[预引导](https://devcenter.heroku.com/articles/preboot)功能来确保 dyno 在路由到它之前准备好接收流量。Lambda 最大的潜在问题之一是长尾延迟。当 Lambda 被触发时，它将启动一个基于鞭炮的微监控器，并在那里运行您的代码。这需要一些时间来启动，所以第一次响应会更长。所有落在现有 Lambda 实例上的后续请求都将在没有冷启动和相关延迟的情况下得到处理。根据我的经验，对于基于 Java 的 Lambda，冷启动可能需要 10 秒左右。这表明 JVM 对于这个用例来说是一个糟糕的选择。有了 Go，我的用例中的冷启动时间减少到了 1.5 秒——这是一个非常显著的改进，但仍然很长。

*   你可以运行任何代码。
    Heroku 让你部署、运行、管理用 Ruby、Node.js、Java、Python、Clojure、Scala、Go、PHP 编写的应用。你甚至可以用你选择的任何图像运行 Docker 容器。另一方面，Lambda 只支持有限数量的运行时。AWS 试图在去年的 re:Invent 中解决这个问题，发布了运行时 API 。现在，您可以用自己选择的编程语言构建一个 Linux 兼容的二进制文件，并在 Lambda 上运行它。然而，并不是所有的编程语言都允许你这样做。

*   没有必要重写现有的应用程序。
    如果你的应用已经在使用一个应用服务器，你通常不需要为了在 Heroku 上运行而做很多改变。另一方面，将现有应用移植到 Lambda 可能需要更多的努力——特别是那些最初没有编写成无服务器功能的应用。这也是假设 Lambda 支持必要的运行时。对于遗留应用程序，这可能是一个很大的限制。

*   你有更长的执行时间。
    当前[对λ](https://docs.aws.amazon.com/lambda/latest/dg/limits.html)执行的限制是 15 分钟。这对许多任务来说足够了，但对所有任务来说不够。一些特定的任务，比如来自 ETL 域的任务，可能需要比 Lambda 更长的执行时间。使用 Heroku，您可以使用 worker dyno 一次运行多个小时的任务。尽管如此，最好的做法是将 dynos 设计成无状态的，所以可以考虑使用作业队列并定期保存您的工作。

## 什么时候选择？

总之，对于基于任务的后台工作(如果你能适应 Lambda 的限制)，不常用的函数，以及长尾延迟不是问题的情况，当你有一些只需要以尽可能少的开销运行的代码时，Lambda 可能是一个很好的解决方案。如果您在边缘需要非常快的平均延迟，它也可能是正确的工具。您可以轻松地使用它将 AWS 服务与一些定制逻辑粘合在一起，并构建基础设施或自动化工具。考虑像解码小视频、调整图片大小或处理 AWS 事件这样的任务非常适合 Lambda。

另一方面，Heroku 非常适合新的 web 应用程序，因为它将开发生命周期的许多常见部分集成在一个更方便的包中，而不需要您配置多个服务。进行 Git 推送并在几分钟后获得一个可用的应用程序是轻而易举的事情。对于耗时超过几分钟的计算操作或频繁调用的函数来说，它也更好。访问 [Heroku 平台描述](https://www.heroku.com/platform)了解更多关于 Heroku 如何工作的信息。

你对 2019 年选择哪个有什么看法？请在下面的评论中告诉我们。
# 迁移到 Azure 的经验教训

> 原文：<https://dev.to/eromanowski/lessons-learned-moving-to-the-azure-cloud-1fcj>

# TLDR

走向云端是一种有趣的体验。预先花一些时间按照资源组和订阅来组织您的资源。将您的资源部署到您的生产环境可能会很棘手。花点时间看看 Azure 资源管理器 REST API。小心 Powershell Az 模块。我们被它烧伤了。

# 我们在 Azure 中利用了什么？

*   API 管理
*   逻辑应用
*   带 SSIS 运行时的数据工厂
*   应用洞察
*   集成帐户
*   功能
*   应用服务
*   Sql 数据库
*   存储帐户
*   服务总线

# 我们如何组织我们的云资源

*   通过订阅
    *   请注意订阅服务的限制、配额和约束。
    *   我们通过订阅将开发和生产环境分开，这允许我们限制对生产资源的访问，并对我们的计费进行明确划分。
*   按资源组
    *   请密切注意您放置资源组的位置。这将是您在该资源组中创建的任何资源的默认位置。资源不能跨位置对话。您在一个位置创建的 API 连接将不能在另一个位置重用。您不能跨资源组共享 API 连接。

# 需要注意什么

*   确保你花了一些心思来组织你的资源组
    *   微软有一个很好的 azure 资源命名约定指南
    *   [https://docs . Microsoft . com/en-us/azure/architecture/最佳实践/命名约定](https://docs.microsoft.com/en-us/azure/architecture/best-practices/naming-conventions)
    *   我们从一个资源组开始管理它们，当我们导出资源组时，发现有 200 个资源的硬性限制。
    *   即使在将资源分成各自的组之后，我们在试图导出只有大约 60 个资源的资源组时仍然会遇到超时。
    *   尽早考虑参数化您的资源，但要小心，例如，您会在 Logic Apps designer 中看不到这些值。即使当你进入你的逻辑应用程序的代码视图，那些值也可能是误导的。您必须导出您的逻辑应用程序的模板，才能看到传入的实际值。
*   有些资源需要比其他资源更多的工作才能进入可部署状态。例如，API 管理就是一个棘手的问题。我们仍在努力解决这个问题。如果您将端点连接到逻辑应用程序，当我们部署到生产时，您可能会失去与逻辑应用程序的连接。

# 将资源部署到生产环境中

*   我们最终构建了一个利用 Azure 资源管理器 Az Powershell 模块的 CLI，它允许我们拉和推资源。我们也必须跳到 powershell 6。
    *   我们从资源中提取参数，并将它们放入我们的环境特定的参数 JSON 文件中。
    *   我们设置了一个 git 存储库来存放我们所有的 ARM 模板。我们发现，从导出到导出，我们的 ARM 模板中属性的顺序变化很大，所以您可能需要通过对属性排序的东西来运行您的 ARM 模板。这将使你掌握的差异更具可读性。
*   使用 PowerShell Az 模块时要小心，我们遇到了属性值序列化不超过某个深度的问题。虽然您可以配置深度，但在推进到更高的环境之前，请密切关注您的 ARM 模板。

# 无服务器的想法

*   你只能把云工具带这么远。如果开始变得难以实施模式或跟踪依赖性，您可能需要下降到代码。如果这成为你的情况，后退一步，马上评估你的选择。
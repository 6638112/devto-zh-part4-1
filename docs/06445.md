# 维护黑客并从 AMP 继续前进

> 原文:[https://dev . to/EDM 00 se/maintaining-hacks-and-move-on-from-amp-4pij](https://dev.to/edm00se/maintaining-hacks-and-moving-on-from-amp-4pij)

注意:这篇文章是从我的博客交叉发布的，最初发布于 2019 年 8 月 22 日，通常涉及一些理论和方法，以基于 AMP 的网站黑客的用例作为中心思想。你可以在这里找到原文:

[https://edm00se.io/web/maintaining-hacks/](https://edm00se.io/web/maintaining-hacks/)

* * *

开发人员很少愿意写一点软件来“让某些东西工作”。它们是必要的犯罪行为，是瞬间产生的。真正的创新存在于完成任务的**需求**中，但有时我们只是做我们需要做的事情来完成工作。这篇文章举例说明了我的一种努力，以及我为阻止疯狂所做的进一步努力。

### 如果你一直生活在岩石下

加速移动网页，对于那些幸运地避开它的人来说，有时会得到一个坏名声。对 AMP 的一些主要批评包括:

*   它忽略并绕过了大多数 web 约定
    *   需要来自 Google 的大量 JavaScript 文件
    *   要加载的脚本完全由 Google 托管
    *   脚本可以在任何时候改变，没有版本，由谷歌维护
*   有效地为格式创建供应商锁定
*   在手机上观看时，屏幕上方有一个无法移除的栏
    *   不久前出现了一点骚动，因为出现了问题，链接无法点击，也无法被其他任何人删除或修复

需要明确的是，这并不都是悲观的。我最初在这个博客上尝试 AMP 是有原因的。它所取得的成就是令人印象深刻的，即使它打破了大多数 web 惯例规范。对于一个以内容为中心的网站来说，它成功地将焦点保持在内容上。这包括限制广告能做什么和如何显示。大多数情况下，那些要求你加入邮件列表或自动播放视频的弹出窗口已经不复存在了。它也限制了一个有效的 AMP 站点可以加载多少 JavaScript 只是加载网站，没有一个是允许 AMP 兼容的网页。根据 AMP 规范，该博客的搜索页面不验证。虽然这让 web 应用程序开发人员很恼火，但对于作为消费者的内容来说却很好，因为开发人员可以摆弄的东西更少了。

### [](#the-hacks-in-question)质疑中的黑客

所涉及的技巧最终是显示需要加载 JavaScript 的内容的机制。在这两种情况下，从第三方来源。具体来说，这与 GitHub gist 嵌入和 Disqus 注释都有关。使这些成为黑客的部分原因是 AMP 对 JS 的要求是它可以被加载，但不能从主机站点加载。这将我们引向通过`iframe`嵌入内容的路线；特别是 AMP 的 [`amp-iframe`](https://amp.dev/documentation/components/amp-iframe/) 实现，因为它们为组件使用了独特的名称空间。

在我的例子中，我编写了一对 HTML 页面，其中包含一些 JavaScript 和一些逻辑，以获取传递的 URL 查询参数来确定在生成的目的地的`iframe`中加载什么

注意:不再需要 gist 变通方法，因为在我做了一些工作后，AMP 最终将它作为本机组件添加进来。同样值得注意的是，我找到的 disqus 解决方案加载了它们的 JS，后者加载了另一个嵌套的`iframe`；如果您解析他们的查询参数逻辑，您可能不需要中间人，尽管这在我开始时并不清楚，因为这是一种新技术，当时几乎没有文档。

### [](#keeping-the-madness)保持疯狂

起初，我只是选择了一个我已经拥有和控制的域名，我知道我可以在不影响网站的情况下存放一对 HTML 文件。在 Disqus 的情况下，我必须允许授权的新域与我连接的帐户进行交互。虽然这完成了工作，但它缺乏坚持其目的的意识，并且是在与一个不相关的代码库一起移动。准备离开那个领域意味着我需要正确地处理事情。我的解决方案包括:

*   将黑客页面转移到新家
    *   在我的例子中，我使用了一个 GitHub 存储库，通过 GitHub 页面部署页面
    *   这是免费的，与我的根 GitHub 页面(用户站点)的现有自定义域名一起使用，意味着它仅仅是`<my domain>/amp-hacks`
*   更新现有参考
    *   更新我的 AMP 站点(博客)以指向新的目的地(从旧站点到新站点的域/路径的简单替换)
    *   更新关于授权域访问的问题
*   测试它
    *   这很奇怪，没有打嗝，万岁！🎉

现在在哪里？如果你有兴趣，可以查看我的资源库， [`github.com/edm00se/amp-hacks`](https://github.com/edm00se/amp-hacks) 。你可以随意查看，看看它是做什么的，或者叉开它，把它变成你自己的；或者惊恐地盯着需要的变通办法。参考库是新的，但页面可追溯到大约 3 年前，在一个不同的回购我已经存档；我终于把我的衣服塞进了他们自己的盒子里。

就这样，大揭秘。拥有让事情运转所需的技巧？把它们扔进自己的盒子里，保存起来，记录在案，可以使用，但要隔离。总有一天它们会被移除，世界会因此而变得更加光明。

### [](#a-leading-question)一个引导性问题

当您的“正常”开发实践*需要*使用 hacks 时，因为自 AMP 创建以来`amp-iframe`已经被许多人要求/使用来解决问题，这对该平台的开发的可取性意味着什么？如果一个正常的需求，比如一个站点特定的搜索页面，而不仅仅是一个提交 Google 站点搜索的表单，是无法实现的，那么它就不是一个可行的开发平台。这就是我的观点，我认为 AMP 是一种很好的内容消费方式，而不是一个开发平台。我可以继续以目前的形式生活在我的博客中，它很有效，而且做得很好。我只是向前看。

### [](#whats-to-come)什么来了

去年，我大概涉足了:

*   vuepress ，因为我喜欢 vue.js，它的文档也很热门
*   盖茨比，因为网络开发已经让盖茨比疯狂了
*   因为我喜欢 vue.js，它是和 vue 最像盖茨比的类比
*   因为虽然这个世界不需要另一个静态站点生成器，但它的目标是接近 jekyll，同时是一个不引人注目的构建系统
*   [苗条](https://svelte.dev/)，因为我爱 JS，也爱极致简约；这不是一个 SSG，而是一个关注低代码、反应性和无虚拟 DOM 的应用程序框架

我不确定我的博客将走向何方，但是考虑到我对开发工具的痴迷以及我作为尝试新事物的借口而修改我的博客的频率，我不禁想象这只是迟早的事情。这种格式已经有大约[三年了，所以大概是时候再次轮回了。](https://edm00se.io/admin/reincarnation/)

### [](#summary)总结

总而言之，AMP 有它的位置，但不适合我。我不认为这是邪恶的，它只是阻止了我平时玩东西，所以作为一个开发者而不是内容管理者，我是时候继续前进了。此外，这篇文章不是关于我的解决方案的细节；仅仅是关于这是多么疯狂，以及我最终决定处理黑客的改进方法。最初，它只是存放在我拥有和控制的部署域中的几个额外的页面，但最终我能够将它们存放在一个专用空间中，并为其服务，直到不再需要它们为止。
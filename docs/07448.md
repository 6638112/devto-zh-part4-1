# JSON 的动态导入

> 原文:[https://dev.to/thatamymac/dynamic-imports-of-json-ipl](https://dev.to/thatamymac/dynamic-imports-of-json-ipl)

## [](#tldr)TL:DR

如果您想用 Webpack 动态导入 JSON，那么当您试图提取值并在返回的模块上调用`default`以返回整个 JSON 对象时，一定要考虑到 JSON 文件没有默认导出。

* * *

作为一个在 web 开发领域工作了很长时间并经常从事落后于时代的大型企业软件工作的人，当你没有机会每天在工作中使用它(并且你家里有两个小孩要照顾)时，很难跟上所有最新的技术和趋势。因此，在过去的几个月里，我一直在努力寻找额外的时间来学习我在新工作中会用到的所有工具，并注册了一个[前端大师](https://frontendmasters.com/)账户来帮助我复习。

我以前用过的工具之一是 **Webpack** ，但我从未花时间去完全理解它。我只在之前的一份工作中使用过 Webpack，而且只使用了 4 个月，所以我知道我没有充分发挥它的潜力，最近我学会了如何使用 Webpack 做**动态导入**，这对于过去专门研究前端性能的人来说特别令人兴奋。如果你还没有接触过动态导入，那么它有助于解决性能问题，确保你只在真正需要的时候提供更大的代码包，而且都是[的普通 JS。](https://v8.dev/features/dynamic-import)

使用现代 JS，你经常会看到模块的静态导入:

```
import myLib from './myLib'; 
```

但是动态导入直到运行时才会从服务器获取。使用 Webpack 和动态导入结构，它创建了一个承诺，将在运行时检索块，并允许您在那时对它进行操作。简单的例子:

```
// This creates its own bundle chunk
const myLib = () => import('./myLib');

myButton.addEventListener('click', (e) => {
  // Chunk only downloads at this point and then you react to it
  myLib.then((libFunc) => {
    libFunc();
  });
}); 
```

在通过视频、阅读文档和示例了解这一点，并自己实践之后，我真的认为我掌握了它，并很兴奋地将它投入使用。几周后，我在工作中获得了一个绝佳的机会。我们有一些示例 JSON 数据，当客户数据不可用时，这些数据偶尔会作为备用数据来显示一个示例图。然而，它被加载了一个`() => require('myData.json')`语句。这是有问题的，因为这些大型 JSON 文件被包含在多个其他块中，而不是一个块中，并且所有这些大型文件都被提供，不管样本数据是否会被使用。

当然，现在有多种方法可以解决这个问题，我当然想过将 JSON 放到服务器上，并在需要时请求它，但我想尽可能减少更改，并想，“为什么我们不将它变成动态导入呢？”所以我很快将`require`改成了`import`,并立即看到大块的变化——很漂亮。样本数据文件变成了它们自己的数据块，其他的大数据块变得更小了。但我在访问这些文件中的信息时遇到了麻烦，这有几个不同的原因，但我想重点关注的是一个很难找到答案的原因，可能是因为事后看来这太明显了。

JSON 文件没有默认导出。由于我在解决遗留 React 组件中的承诺时遇到的其他问题，我首先在调试器中处理一个待定的承诺，而不是能够轻松地看到 Webpack 返回什么。所以我花了大量的时间在互联网上搜索，试图找出当你动态导入 JSON 文件时，是否需要一种特殊的方法来处理它们，最初甚至找不到任何人动态导入 JSON 文件的例子。

这很令人沮丧，但我最终在 StackOverflow 上的一个回答中发现了一个例子，它具体展示了我所需要的，并意识到这些信息需要存在于互联网的更多地方。当你处理一个 JSON 文件的承诺时，你需要专门调用它的 default，这是返回的模块对象中的一个键。

仅捕获数据对象的示例:

```
import('myData.json').then(({default: myData}) => myData);

// or

import('myData.json').then(module => module.default); 
```

同样值得注意的是，如果您在 Webpack 之外使用包或动态导入，情况就不是这样了。在这些情况下，JSON 将被返回；这也是为什么这如此令人困惑的部分原因。

所以我希望这能帮助那些不熟悉 Webpack 动态导入并试图使用 JSON 的人。
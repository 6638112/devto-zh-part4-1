# 用正确的方式构建 React-native app。

> 原文：<https://dev.to/unbug/build-react-native-app-in-the-right-way-4k8c>

# 反应原生训练

[![](img/ed29700ee73921fc26766484c59a52a5.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--LZI15pjC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-3.png)

GitHub:[https://GitHub . com/unbug/react-native-train/blob/master/readme . MD](https://github.com/unbug/react-native-train/blob/master/README.md)

视频在这里- [Udemy](https://www.udemy.com/react-native-train/?couponCode=LUCKY-0)

[![](img/bcb7950c4962342a7cdd398a512d3910.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--gMGmqlLP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160727-3.png)

请[留言](https://www.gitbook.com/book/unbug/react-native-training/discussions)或推特 [@unbug](https://twitter.com/unbug) 进一步询问。任何帮助将不胜感激:)

# 目录

*   [1 先看看](#1-first-look)
    *   [1.1 在 5 分钟内构建一个应用](#11-building-an-app-in-5-minutes)
    *   [1.2 工作原理](#12-how-it-works)
    *   [1.3 调试工具](#13-debug-tools)
    *   [1.4 文档&API](#14-docs--apis)
    *   [1.5 资源](#15-resources)
*   [2 个组件](#2-components)
    *   [2.1 渲染& JSX](#21-render--jsx)
    *   [2.2 视图、文本、图像等](#22-view-text-image-etc)
    *   2.3 生命周期
    *   [2.4 道具&状态](#24-props--states)
    *   [2.5 事件](#25-events)
    *   [2.6 资源](#26-resources)
*   [3 种风格](#3-styles)
    *   [3.1 柔性盒](#31-flexbox)
    *   [3.2 绝对&相对](#32-absolute--relative)
    *   [3.3 尺寸&尺寸&版面](#33-size--dimensions--onlayout)
    *   [3.4 继承](#34-inheritance)
    *   [3.5 资源](#35-resources)
*   [4 架构](#4-architecture)
    *   [4.1 Redux](#41-redux)
    *   4.2 反应还原
    *   [4.3 容器&组件](#43-containers--components)
    *   [4.4 Todo React 原生 App](#44-todo-react-native-app)
    *   [4.5 命名约定](#45-naming-convention)
    *   [4.6 资源](#46-resources)
*   [5 个数据](#5-data)
    *   [5.1 获取](#51-fetch)
    *   [5.2 持久](#52-persistent)
    *   [5.3 资源](#53-resources)
*   [6 路由器](#6-router)
    *   [6.1 导航器](#61-navigator)
    *   [6.2 资源](#62-resources)
*   [7 个原生模块(草案)](#7-native-modules)
    *   7.1 iOS
    *   7.1.1 JS 呼叫 OC
    *   7.1.2 OC 呼叫 JS
    *   本地视图组件
    *   7.2 安卓系统
    *   7.2.1 JS 调用 Java
    *   7.2.2 Java 调用 JS
    *   本地视图组件
    *   7.3 资源
*   [8 整合(草案)](#8-integration)
    *   [8.1 iOS](#81-ios)
    *   [8.1.1 包装](#811-package)
    *   图像
    *   [8.2 安卓](#82-android)
    *   [8.2.1 包装](#821-package)
    *   图像
    *   [8.3 发布前](#83-before-publishing)
    *   [8.4 资源](#83-resources)
*   [9 热更新(草稿)](#9-hot-update-draf)
    *   9.1 iOS
    *   9.2 安卓系统
    *   9.3 资源
*   [10 性能(草案)](#10-performance)
    *   [10.1 shouldComponentUpdate](#101-shouldcomponentupdate)
    *   [10.2 资源](#102-resources)
*   [资源](#resources)

* * *

# 1 第一眼

[介绍 React Native](https://facebook.github.io/react/blog/2015/03/26/introducing-react-native.html)

> 我们真正想要的是原生移动平台的用户体验，结合我们在 web 上使用 React 构建时的开发人员体验。只要稍加努力，我们就能让 GitHub 上的 React 成为真正的本地移动应用。移动环境中的唯一区别是，我们不是在浏览器中运行 React 并渲染到 div 和 spans，而是在我们的应用程序中运行 JavaScriptCore 的嵌入式实例，并渲染到更高级别的特定于平台的组件。
> 
> 值得注意的是，我们并不是在追逐**“写一次，运行到任何地方。”**不同的平台有不同的外观、感觉和功能，因此，我们仍然应该为每个平台开发独立的应用程序，但同一批工程师应该能够为他们选择的任何平台构建应用程序，而无需为每个平台学习一套完全不同的技术。我们称这种方法为**“一次学习，随处书写。”**

[展示区](https://facebook.github.io/react-native/showcase.html)

[![](img/f67979088a5e21c57d2d8c04578cb487.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--lKJpkPK9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160630-4.png)

# 1.1 5 分钟搭建一个 app

1.  需求遵循[入门](http://facebook.github.io/react-native/releases/next/docs/getting-started.html)
2.  生成新的 React 本机项目

```
 react-native init testRn 
```

1.  构建和运行项目

```
 react-native run-ios 
```

或者打开`testRn/ios/testRn.xcodeproj`，用 XCode 的播放按钮构建

[![](img/07ffc8c5abdc3cf616018fa2942c3902.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ecVEJvO3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160622-0.png)

或者如果应用程序已经构建好，启动网络服务器

```
npm start
//or
react-native start 
```

# 1.2 工作原理

1. [JavaScript 桥](https://www.infoq.com/articles/react-native-introduction)

[![](img/f6975889401fab28de3b25c689e1ea07.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--U3YaaFXr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/21.jpg)

2.[反应本地打包程序](https://github.com/facebook/react-native/tree/master/packager)

[![](img/88019cbbb444944aaeb2cb4dc52e6a96.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--PoliFDZl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/Pasted%20Graphic.jpg)

# 1.3 调试工具

1.[开发者菜单](https://facebook.github.io/react-native/docs/debugging.html)

[![](img/4b10498982bb644a5f6c47674452b616.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--550pcBqm--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160623-0.png)

2.Chrome 开发工具

[![](img/470a4c4215f1e3f2dfd8ffea8146e82b.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--gv-ge82X--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160623-2.png)T3】
3 . log

```
console.log('some text');
console.dir({a:1, b:2, c:3});
debugger;//breaking point 
```

4.[原子](https://atom.io/)T4[核素](https://nuclide.io/)

[![](img/fd7220a2a032fa924bc13aeca8e849ad.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--RgaWnV2B--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160623-3.png)

5 .检查

用`cmd-shift-p`打开 Atom [命令调色板包](https://atom.io/packages/command-palette)，搜索“检查器”，然后点击“核素反应原生检查器:显示”

[![](img/7b8d0f52fba71c56c679e9af794b7aa6.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--JxQtDItT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160624-0.png)

[![](img/65de5d0cd95dc1aa6a8d58a23ac9e300.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--zWQW5FcJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160623-4.png)

6.[真实装置](https://facebook.github.io/react-native/docs/debugging.html#chrome-developer-tools)

6.1 部署到真实设备

`project_name/ios/project_name/AppDelegate.m`

```
 //jsCodeLocation = [NSURL URLWithString:@"http://localhost:8081/index.ios.bundle?platform=ios&dev=true"];

  /**
   * OPTION 2
   * Load from pre-bundled file on disk. The static bundle is automatically
   * generated by the "Bundle React Native code and images" build step when
   * running the project on an actual device or running the project on the
   * simulator in the "Release" build configuration.
   */

   jsCodeLocation = [[NSBundle mainBundle] URLForResource:@"main" withExtension:@"jsbundle"]; 
```

6.2 在真实设备中调试

1.`project_name/ios/project_name/AppDelegate.m`

```
 jsCodeLocation = [NSURL URLWithString:@"http://172.28.0.230:8081/index.ios.bundle?platform=ios&dev=true"]; 
```

2.`node_modules/react-native/Libraries/WebSocket/RCTWebSocketExecutor.m`

```
 if (!_url) {
    NSUserDefaults *standardDefaults = [NSUserDefaults standardUserDefaults];
    NSInteger port = [standardDefaults integerForKey:@"websocket-executor-port"] ?: 8081;
    NSString *URLString = [NSString stringWithFormat:@"http://172.28.0.230:%zd/debugger-proxy?role=client", port];
    _url = [RCTConvert NSURL:URLString];
  } 
```

3.

[![](img/27b825a90509344eff8fe4cec0f73cd2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--zpyX2Rim--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160826-0.png)

# 1.4 文档&API

*   [反应堆](https://facebook.github.io/react/docs/getting-started.html)
*   [反应原生](https://facebook.github.io/react-native/docs/getting-started.html)
*   [核素](https://nuclide.io/docs/quick-start/getting-started/)

# 1.5 资源

*   [本地反应:将现代网络技术引入手机](https://code.facebook.com/posts/1014532261909640/react-native-bringing-modern-web-techniques-to-mobile/)
*   [Detailed explanation of React Native communication mechanism](http://blog.cnbang.net/tech/2698/)
*   [反应自然调研报告](http://blog.csdn.net/lihuiqwertyuiop/article/details/45241909)
*   [Overview of React Native: Background, Planning and Risks](https://github.com/tmallfe/tmallfe.github.io/issues/18)
*   [JavaScript 核心](http://trac.webkit.org/wiki/JavaScriptCore)
*   [反应原生 iOS 真机调试](http://www.jianshu.com/p/cc64bcb58df2)

# 2 个组件

1.MyComponent.js

```
//define component
class MyComponent extends React.Component {
  render() {
    return <Text>My component!</Text>;
  }
}
//export component
export default MyComponent; 
```

2.Main.js

```
//import component
import MyComponent from './MyComponent';
class Main extends React.Component {
  render() {
    //use component
    return <MyComponent>;
  }
} 
```

3.学徒制

```
AppRegistry.registerComponent('MyApp', () => Main); 
```

# 2.1 渲染& JSX

```
..
...
render() {
  const txt = 'Hello';
  function say(name){
    return 'I am '+name;
  }
  return (
    <View>
      <Text>This is a title!</Text>
      <Text>{txt}</Text>
      <View>
        <Text>{say('React')}</Text>
      </View>
    </View>
  );
}
..
... 
```

# 2.2 视图、文本、图像等

1.  [核心部件](https://facebook.github.io/react-native/docs/tutorial-core-components.html)

```
..
...
import {
  StyleSheet,
  Text,
  View,
  Image
} from 'react-native';

class Main extends Component {
  render() {
    return (
      <View>
        <Image source={require('./img/bg.png')}>
          <Image source={require('./img/icon.png')}/>
          <Text>
            some text!
          </Text>
        </Image>
      </View>
    );
  }
} 
```

# 2.3 生命周期

1.  实例化

1.1 第一次创建实例时调用的生命周期方法

*   getDefaultProps
*   **getInitialState** 的缩写形式
*   组件将安装
*   **渲染**
*   **组件安装**

1.2 对于该组件类别的所有后续使用:

*   getInitialState
*   组件将安装
*   提供；给予
*   componentDidMount "

1.  一生

*   componentWillReceiveProps
*   **shouldComponentUpdate//return true | false**T2】

    ```
     shouldComponentUpdate(nextProps, nextState) {
     return nextProps.id !== this.props.id;
     } 
    ```

*   componentWillUpdate//不为初始渲染调用

*   提供；给予

*   componentDidUpdate

1.  拆卸和清理

*   组件将卸载

[![](img/abcf6c7467f63b0169d186cf032af957.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--O15L2tI7--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160627-0.png)

# 2.4 道具&状态

1.props:属性被传递给一个组件，可以保存任何数据

```
class User extends Component {
  render(){
    const user = this.props.data;
    this.props.onReady('I am ready!');
    return(
      <View>
        <Text>
          score: {this.props.score}
          type: {this.props.type}
          Name: {user.name}
          Age: {user.age}
        </Text>
      </View>
    );
  }
}
//dufaultProps
User.propTypes = { score: React.PropTypes.number };
User.defaultProps = { score: 0 };

var user = {name: 'foo', age: 21};
class Main extends Component {
  handleReady(str){
    console.log(str);
  }
  render(){
    return(
      <View>
        <User type="Dev" data={user} onReady={this.handleReady}/>
      </View>
    );
  }
} 
```

2.state: State 不同于 props，因为它在组件内部。

```
class Timer extends Component {
  constructor(props) {
    super(props);
    this.state = {count: 0};
  }

  componentDidMount() {
    let that = this;
    setInterval(function () {
      that.increase();
    }, 1000);
  }

  increase() {
    this.setState({count: this.state.count + 1});
  }

  render() {
    return (
      <View>
        <Text>count: {this.state.count}</Text>
      </View>
    );
  }
}

class Main extends Component {
  render(){
    return(
      <View>
        <Timer/>
      </View>
    );
  }
} 
```

3.*道具* VS *状态*

*   使用 props 通过组件树传递数据和设置。
*   不要在组件内部修改 this.props 认为道具是不可变的。
*   使用 props 来使事件处理程序与子组件通信。
*   使用 state 存储简单的视图状态，如下拉选项是否可见。
*   切勿直接修改 this.state，而应使用 this.setstate。

[![](img/f70ba9cfa2f4f1e19815ebae6ae4693c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ddt76JBp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160702-0.png)

4.无状态组件

```
const Heading = ({title}) => <Text>{title}</Text>; 
..
...
<Heading title="test title"/>
...
.. 
```

# 2.5 事件

1.基本事件

1.1.[`<TouchableHighlight/>`](https://facebook.github.io/react-native/docs/touchablehighlight.html)T3】

```
class Touch extends Component {
  handlePress(){
    console.log('press');
  }
  handleLongPress(){
    console.log('longPress');
  }
  render() {
    return (
      <TouchableHighlight
        onPress={this.handlePress}
        onLongPress={this.handleLongPress}>
        <View>
          <Text>Press me!</Text>
        </View>
      </TouchableHighlight>
    );
  }
} 
```

1.2.[`<TextInput/>`](https://facebook.github.io/react-native/docs/textinput.html)T3】

```
class Test extends Component {
  //...
  //handle events
  //...
  render() {
    return (
      <TextInput 
        onBlur={...}
        onChange={...}
        onEndEditing={...}
        onSelectionChange={...}
        onSubmitEditing={...}
      </TextInput>
    );
  }
} 
```

一点三。[设备事件发生器](https://kpetrovi.ch/2015/09/30/react-native-ios-keyboard-events.html)

```
//keyboardWillShow, keyboardDidShow, keyboardWillHide, keyboardDidHide
//keyboardWillChangeFrame, keyboardDidChangeFrame
//add the listener
 var listener = DeviceEventEmitter.addListener('keyboardWillShow', (e) =>{
   console.log('Event is fired!');
 });
 //remove the listener
 listener.remove(); 
```

2.[手势应答系统](https://facebook.github.io/react-native/docs/gesture-responder-system.html#responder-lifecycle)

2.1 生命周期

[![](img/97bfed16953bb592f70db7fb1e556201.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--pZCrNHtp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160630-2.png) 

2.2 示例

```
class Test extends Component {
  /* Capture handles */
  //the responder system bubbles up from the deepest component, 
  //a parent View wants to prevent the child from becoming responder on a touch start
  handleStartShouldSetResponderCapture(evt){
    return true;
  }
  //the responder system bubbles up from the deepest component, 
  //a parent View wants to prevent the child from becoming responder on a touch move
  handleMoveShouldSetResponderCapture(evt){
    return true;
  }

  /* Lifecycle handles */
  //Does this view want to become responder on the start of a touch?
  handleStartShouldSetResponder(evt){
    return true;
  }
  //Called for every touch move on the View when it is not the responder: 
  //does this view want to "claim" touch responsiveness?
  handleMoveShouldSetResponder(evt){
    return true;
  }
  //The View is now responding for touch events. 
  handleResponderGrant(evt){
    console.log('you are touching me');
  }
  //Something else is the responder right now and will not release it
  handleResponderReject(evt){
    console.log('please wait in line');
  }

  /* event handles */
  //touch move
  handleResponderMove(evt){
    console.log('touch move at:', 'X='+evt.pageX, 'Y='+evt.pageY);
  }
  //touch end/up
  handleResponderRelease(evt){
    console.log('touch end');
  }
  //Something else wants to become responder. Should this view release the responder?
  handleResponderTerminationRequest(evt){
    return true;
  }
  //touch cancel
  handleResponderTerminate(evt){
    console.log('touch canceled');
  }
  render() {
    return (
      <View 
        onStartShouldSetResponderCapture={this.handleStartShouldSetResponderCapture}
        onMoveShouldSetResponderCapture={this.handleMoveShouldSetResponderCapture}
        onStartShouldSetResponder={this.handleStartShouldSetResponder}
        onMoveShouldSetResponder={this.handleMoveShouldSetResponder}
        onResponderGrant={this.handleResponderGrant} 
        onResponderReject={this.handleResponderReject}
        onResponderMove={this.handleResponderMove}
        onResponderRelease={this.handleResponderRelease}
        onResponderTerminationRequest={this.handleResponderTerminationRequest}
        onResponderTerminate={this.handleResponderTerminate}>
          <Text>Press me!</Text>
      </View>
    );
  }
} 
```

2.3 evt 是一个合成触摸事件，具有以下形式 nativeEvent:

*   changedTouches -自上次事件以来发生变化的所有触摸事件的数组
*   标识符-触摸的 ID
*   location X——触摸相对于元素的 X 位置
*   locationY -触摸相对于元素的 Y 位置
*   pageX -触摸的 X 位置，相对于根元素
*   pageY -触摸的 Y 位置，相对于根元素
*   目标-接收触摸事件的元素的节点 id
*   时间戳-触摸的时间标识符，用于速度计算
*   触摸-屏幕上所有当前触摸的数组

3. [PanResponder](https://facebook.github.io/react-native/docs/panresponder.html)

3.1

```
this._panResponder = PanResponder.create({
  // Ask to be the responder:
  onStartShouldSetPanResponder: (evt, gestureState) => true,
  onStartShouldSetPanResponderCapture: (evt, gestureState) => true,
  onMoveShouldSetPanResponder: (evt, gestureState) => true,
  onMoveShouldSetPanResponderCapture: (evt, gestureState) => true,
  //touch start
  onPanResponderGrant: (evt, gestureState) => {},
  //touch move
  onPanResponderMove: (evt, gestureState) => {},
  onPanResponderTerminationRequest: (evt, gestureState) => true,
  //touch end/up
  onPanResponderRelease: (evt, gestureState) => {},
  //touch cancel
  onPanResponderTerminate: (evt, gestureState) => {},
  onShouldBlockNativeResponder: (evt, gestureState) => true,
}); 
```

3.2 一个手势状态对象具有以下内容:

*   只要屏幕上至少有一次触摸，手势状态的 ID 就一直存在
*   moveX -最近移动的触摸的最新屏幕坐标
*   moveY -最近移动的触摸的最新屏幕坐标
*   x0 -应答者授权的屏幕坐标
*   y0 -应答者授权的屏幕坐标
*   dx -触摸开始后手势的累计距离
*   dy -自触摸开始以来手势的累积距离
*   vx -手势的当前速度
*   vy -手势的当前速度
*   numberActiveTouches -当前屏幕上的触摸次数

3.3 ui explorer 中的 [PanResponder 示例](https://github.com/facebook/react-native/blob/master/Examples/UIExplorer/PanResponderExample.js)

# 2.6 资源

*   [react.parts](https://react.parts/native)
*   [js.coach](https://js.coach/)
*   [道具 vs 状态](https://github.com/uberVU/react-guide/blob/master/props-vs-state.md)
*   [思考在反应](https://facebook.github.io/react/docs/thinking-in-react.html)
*   [深入 JSX](https://facebook.github.io/react/docs/jsx-in-depth.html)
*   [本章演示脚本](https://github.com/unbug/react-native-train-scripts)

# 3 种款式

1.声明样式

```
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: 'blue',
  },
  text: {
    fontSize: 14,
    color: 'red'
  }
}); 
```

2.使用样式

```
class Main extends Component {
  render() {
    return (
      <View style={styles.container}>
        <Text style={styles.text}>I am red.</Text>
      </View>
    );
  }
} 
```

3.性能

*   [查看属性](https://facebook.github.io/react-native/docs/view.html#style)
*   [图像属性](https://facebook.github.io/react-native/docs/image.html#style)
*   [文本属性](https://facebook.github.io/react-native/docs/text.html#style)
*   [弹性属性](https://facebook.github.io/react-native/docs/flexbox.html#content)
*   [变换属性](https://facebook.github.io/react-native/docs/transforms.html#content)

# 3.1 Flexbox

1.[柔性盒布局](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)

> flex 布局背后的主要思想是让容器能够改变其项目的宽度/高度(和顺序)，以最好地填充可用空间(主要是适应各种显示设备和屏幕尺寸)。flex 容器扩展项目以填充可用空间，或者收缩项目以防止溢出。

[![](img/b28e181cbad7b14b69c9a9f854be486c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--xntHxG7q--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-15.png)

flex:1

[![](img/06df66f63fe7c47874184515db80dc80.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--7_MVOFQD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-2.png)T3】

```
const styles = StyleSheet.create({
  container: {
    flex: 1
  },
  header: {
    height: 200,
    backgroundColor: 'red'
  },
  main: {
    flex: 1,
    backgroundColor: 'blue'
  },
  footer: {
    height: 200,
    backgroundColor: 'green'
  },
  text: {
    color: '#ffffff',
    fontSize: 80
  }
}); 
```

3.flexDirection:'行' | '列'

[![](img/c0826c8eafa4d233e0a0bef45bbf7355.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--3ox1J1jl--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-7.png)

[![](img/3e30fb5afaf196dec1d1832921fb2d2e.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--7TQgOFHr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-8.png)

4 . justify content:' flex-start ' | ' flex-end ' | ' center ' | ' space-between ' | ' space-around '

[![](img/ba1aae085ad019a1cdae673f80f55aa3.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--OBYJzj77--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-10.png)

5.alignItems:'弹性起点' | '弹性终点' | '中心' | '拉伸'

[![](img/2e599a781202739597f137e221c939cc.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--spBeo4Ea--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-12.png)

6.alignSelf:'自动' | '伸缩开始' | '伸缩结束' | '居中' | '拉伸'

[![](img/5a7a7dcca79de15dcb8f298b35d50918.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--kBCr8c-2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-13.png)

7.flexWrap:'wrap'|'nowrap '。

[![](img/fedc65e0e5b2c30242cd6284ecd0a388.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--s-ekYtxq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-14.png)

8.箱状模式

[![](img/790e3bbbc332cafb6904721d446c8226.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Icua6igz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-16.png)

宽度=边框宽度(25)+帕丁顿 left(25)+100+边框宽度(25)+帕丁顿 Right(25)=200

height = border pwidth(25)+padding op(25)+100+border color width(25)+padding bottom(25)= 200

```
class Main extends Component {
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.header}>
          <Text style={styles.text}>200X100</Text>
        </View>
        <View style={styles.main}>
          <View  style={styles.mainContent}>
            <Text style={styles.text}>100X100</Text>
          </View>
        </View>
        <View style={styles.footer}>
          <Text style={styles.text}>200X100</Text>
        </View>
      </View>
    );
  }
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center'
  },
  header: {
    height: 100,
    width: 200,
    backgroundColor: 'red'
  },
  main: {
    height: 200,
    width: 200,
    padding: 25,
    borderWidth: 25,
    borderColor: 'black',
    margin: 25,
    backgroundColor: 'blue'
  },
  mainContent: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: 'red'
  },
  footer: {
    height: 100,
    width: 200,
    backgroundColor: 'green'
  },
  text: {
    color: '#ffffff',
    fontSize: 20
  }
}); 
```

[![](img/a4010a33063367db967035ec647d46a2.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--j8M5lU06--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160705-17.png)

# 3.2 绝对&相对

1 .绝对

[![](img/3e7414aeb3820b06e12ed71202035e65.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--10axAj5v--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-0.png)T3】

```
class Position extends Component {
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.box1}>
          <Text style={styles.text}>1</Text>
        </View>
        <View style={styles.box2}>
          <Text style={styles.text}>2</Text>
        </View>
        <View style={styles.box3}>
          <Text style={styles.text}>3</Text>
        </View>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  container: {
    flex: 1
  },
  box1: {
    position: 'absolute',
    top: 40,
    left: 40,
    width: 100,
    height: 100,
    backgroundColor: 'red'
  },
  box2: {
    position: 'absolute',
    top: 80,
    left: 80,
    width: 100,
    height: 100,
    backgroundColor: 'blue'
  },
  box3: {
    position: 'absolute',
    top: 120,
    left: 120,
    width: 100,
    height: 100,
    backgroundColor: 'green'
  },
  text: {
    color: '#ffffff',
    fontSize: 80
  }
}); 
```

2.zIndex， [v0.29](https://github.com/facebook/react-native/commit/d64368b9e239b574039f4a6508bf2aeb0806121b) 或[变换](http://facebook.github.io/react-native/docs/transforms.html)

[![](img/d475b97a39973b7b9a3e8f8ce389a5c8.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Iuf_Hk0c--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-2.png)T3】

```
 box2: {
    position: 'absolute',
    top: 80,
    left: 80,
    width: 100,
    height: 100,
    backgroundColor: 'blue',
    transform: [{'translate': [0,0, 1]}]
  }, 
```

3 .相对(默认)

[![](img/378e15e330f4ca064c69d46ed582229d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--OLA5x2TP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-1.png)T3】

```
class Relative extends Component {
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.box1}>
          <Text style={styles.text}>1</Text>
          <View style={styles.ball}/>
        </View>
        <View style={styles.box2}>
          <Text style={styles.text}>2</Text>
        </View>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  container: {
    flex: 1
  },
  box1: {
    position: 'relative',
    top: 40,
    left: 40,
    width: 100,
    height: 100,
    backgroundColor: 'red'
  },
  box2: {
    position: 'absolute',
    top: 100,
    left: 100,
    width: 100,
    height: 100,
    backgroundColor: 'blue'
  },
  ball: {
    position: 'absolute',
    top: 40,
    left: 40,
    width: 40,
    height: 40,
    borderRadius: 20,
    backgroundColor: 'yellow'
  },
  text: {
    color: '#ffffff',
    fontSize: 80
  }
}); 
```

4 .固定

[![](img/9848cb5c752b55240e87a00f68b97233.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--D9YjLugj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-3.png)T3】

```
class Fixed extends Component {
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.tbar}>
          <Text style={styles.text}>Fixed top bar</Text>
        </View>
        <ScrollView style={styles.main}>
          <View style={styles.item}><Text style={styles.text}>1</Text></View>
          <View style={styles.item}><Text style={styles.text}>2</Text></View>
          <View style={styles.item}><Text style={styles.text}>3</Text></View>
        </ScrollView>
        <View style={styles.bbar}>
          <Text style={styles.text}>Fixed bottom bar</Text>
        </View>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  container: {
    flex: 1
  },
  tbar: {
    width: 375,
    height: 100,
    borderBottomWidth: 5,
    borderColor: 'black',
    backgroundColor: 'red'
  },
  main: {
    flex: 1
  },
  item: {
    height: 200,
    width: 375,
    marginTop: 10,
    backgroundColor: 'green'
  },
  bbar: {
    width: 375,
    height: 100,
    borderTopWidth: 5,
    borderColor: 'black',
    backgroundColor: 'red'
  },
  text: {
    color: '#ffffff',
    fontSize: 40
  }
}); 
```

# 3.3 尺寸&尺寸& onLayout

1 .窗口大小

[![](img/988560aea5dd405c5115ddedd55db732.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--oXlA9Q_l--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-4.png)T3】

```
let winSize = Dimensions.get('window');
console.log(winSize);
class Size extends Component {
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.block}/>
        <Text style={styles.text}>some text</Text>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  container: {
    flex: 1,
    alignItems: 'flex-start'
  },
  block: {
    height: 100,
    width: winSize.width,
    backgroundColor: 'red'
  },
  text: {
    color: '#ffffff',
    fontSize: 40/winSize.scale,
    backgroundColor: 'blue'
  }
}); 
```

2. [onLayout](http://facebook.github.io/react-native/releases/0.28/docs/view.html#onlayout)

```
class Size extends Component {
  handleTextLayout(evt){
    console.log(evt.nativeEvent.layout);
  }
  render() {
    return (
      <View style={styles.container}>
        <View style={styles.block}/>
        <Text style={styles.text}
          onLayout={this.handleTextLayout}>some text</Text>
      </View>
    );
  }
} 
```

# 3.4 继承

1 .传风格当道具

```
class InheritanceStyle extends Component {
  render() {
    return (
      <View style={this.props.parentColor}>
      </View>
    );
  }
}

class Main extends Component {
  handleReady(str){
    console.log(str);
  }
  render() {
    return (
      <View style={styles.container}>
        <InheritanceStyle parentColor={styles.blue}/>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  container: {
    flex: 1
  },
  blue: {
    flex: 1,
    backgroundColor: 'blue'
  }
}); 
```

2 .串联样式

BaseStyles.js

```
import { StyleSheet,Dimensions } from 'react-native';
let winSize = Dimensions.get('window');
const BaseStyles = StyleSheet.create({
  text: {
    fontSize: 40/winSize.scale
  }
});
export default BaseStyles; 
```

```
import BaseStyles from './BaseStyles';

class InheritanceStyle extends Component {
  render() {
    return (
      <View style={this.props.parentColor}>
        <Text style={[BaseStyles.text, styles.text]}> this is a long text </Text>
      </View>
    );
  }
}
const styles = StyleSheet.create({
  text:{
    color: '#ffffff'
  }
}); 
```

[![](img/8d0a7506e52966b0537f8aa30c660cc0.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--KeVOxkgI--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160706-5.png)

# 3.5 资源

*   [Flexbox 完整指南](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)
*   [CSS3 Flexbox 属性的可视化指南](https://scotch.io/tutorials/a-visual-guide-to-css3-flexbox-properties)
*   [了解弯曲方向](http://www.standardista.com/understanding-flex-direction/)
*   [本章演示脚本](https://github.com/unbug/react-native-train-scripts)

# 4 架构

1.MVC 问题

[![](img/0dc6701c69cd679aea2413ae168f849d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--AA0rqKCk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160722-0.png)

2.[通量](http://facebook.github.io/flux/docs/overview.html)

[![](img/f57bbeb5a781dd72c26c840922122171.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--3R22_RwH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/flux-diagram-white-background.png) 

3。数据流

[![](img/1098e8aba633161160e58adb6de24a28.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--MFoPsNlq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160719-1.png)

[通量 TodoMVC 示例](https://github.com/facebook/flux/tree/master/examples/flux-todomvc/)

# 4.1 Redux

1.[动作](https://github.com/acdlite/flux-standard-action) &动作创建者

```
//action type
const ADD_TODO = 'ADD_TODO';

//action creator, semantic methods that create actions
//collected together in a module to become an API
function addTodoAction(title, hour) {
  //action, an object with a type property and new data, like events
  return {type: ADD_TODO, title, hour}
} 
```

2.[减速器](http://redux.js.org/docs/basics/Reducers.html)

```
//a function that accepts an accumulation and a value and returns a new accumulation.
function todoReducers(state = [], action) {
  switch (action.type) {
    case ADD_TODO:
      //always return a new state, never mutate old state
      return [
        {
          id: Utils.GUID(),
          title: "action.title,"
          endTime: getEndTime(action.hour),
          completed: false
        },
        ...state
      ]
    default:
      //return default state
      return state
  }
} 
```

3.商店

```
import { createStore } from 'redux';
//1\. define store
let store = createStore(todoReducers);

class App extends Component {
  constructor(props){
    super(props);
    this.state = {todos: []};
  }
  componentDidMount(){
    //2\. subscribe store
    this.unsubscribeStore = store.subscribe(() =>{
      //3\. getState
      this.setState({todos: store.getState()});
    });
  }
  componentWillUnmount(){
    //5\. unsubscribe store
    this.unsubscribeStore();
  }
  renderTodoList = ()=>{
    //reder todo list
    return this.state.todos.map( (todo)=> {
      return <Text key={todo.id}>Todo: {todo.title}</Text>
    });
  }
  handleAddTodo = ()=>{
    //4\. dispatching actions
    store.dispatch( addTodoAction('Create a new todo', 8) );
  }
  render() {
    return (
      <View>
        <TouchableHighlight onPress={this.handleAddTodo}>
          <Text>Add Todo</Text>
        </TouchableHighlight>
        <ScrollView>{this.renderTodoList()}</ScrollView>
      </View>
    );
  }
} 
```

4.数据流

[![](img/2b3bce640675b518e064553faeb09c6d.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--BBqGWQN0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160724-0.png)

[![](img/b4e82a5b62af1189e9ff1214a4371606.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--euiKGn2g--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160721-2.png)

[![](img/b7eb5573231db5a5229506e49f65f903.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--9F5qUoH0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160721-3.png)

# 4.2 [反应-还原](https://github.com/reactjs/react-redux)

1.行动

```
import * as  navigationActions from './navigation';
import * as  todosActions from './todos';

export default {...navigationActions, ...todosActions}; 
```

2.combineReducers()

```
import { combineReducers } from 'redux';
import navigation from './navigation';
import todos from './todos';

const rootReducer = combineReducers({
  navigation, todos
});

export default rootReducer; 
```

3.configureStore()显示的应用程序状态

```
import { createStore } from 'redux';
import reducers from '../reducers';

export default function configureStore() {
  const store = createStore(reducers);
  return store;
} 
```

4.mapStateToProps & mapDispatchToProps & bindActionCreators

```
import { bindActionCreators } from 'redux';
import { connect } from 'react-redux';

class App extends Component {
  renderTodoList = ()=>{
    //reder todo list
    return this.props.todos.map( (todo)=> {
      return <Text key={todo.id}>Todo: {todo.title}</Text>
    });
  }
  handleAddTodo = ()=>{
    this.props.actions.addTodoAction('Create a new todo', 8);
  }
  render() {
    return (
      <View>
        <TouchableHighlight onPress={this.handleAddTodo}>
          <Text>Add Todo</Text>
        </TouchableHighlight>
        <ScrollView>{this.renderTodoList()}</ScrollView>
      </View>
    );
  }
}

function mapStateToProps(state) {
  return {
    todos: state.todos
  };
}

function mapDispatchToProps(dispatch) {
  return {
    actions: bindActionCreators(Actions, dispatch)
  }
}

export default connect(
  mapStateToProps,
  mapDispatchToProps
)(App); 
```

5.用`<Provider/>`
路过店铺

```
import React, { Component } from 'react';
import { Provider } from 'react-redux';

import App from './containers/App';
import configureStore from './store/configureStore';

class Root extends Component {
  render() {
    return (
      <Provider store={configureStore()}>
        <App />
      </Provider>
    );
  }
}

export default Root; 
```

# 4.3 容器&组件

1.[表示和容器组件](http://redux.js.org/docs/basics/UsageWithReact.html)

|  | 表象成分 | 容器组件 |
| --- | --- | --- |
| 目的 | 事物的外观(标记、样式) | 工作原理(数据获取、状态更新) |
| 意识到 Redux | 不 | 是 |
| 读取数据 | 从道具中读取数据 | 订阅 Redux 状态 |
| 要更改数据 | 从 props 调用回调 | 调度冗余操作 |
| 都写好了 | 用手 | 通常由 React Redux 生成 |

2.`components/home-view`&T1】

2.1 主视图组件

[![](img/c471329572843f13c95407d82f3ad93a.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--1XDs0TLz--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160721-1.png)

2.2 HomeView 容器

```
import {
  Header,
  Main,
} from '../components/home-view';
import Actions from '../actions';

class HomeView extends Component {
  render() {
    return (
      <View>
        <Header {...this.props}/>
        <Main {...this.props} isVisible={this.state.isVisible}/>
      </View>
    );
  }
}

function mapStateToProps(state) {
  return {
    todos: state.todos
  };
}

function mapDispatchToProps(dispatch) {
  return {
    actions: bindActionCreators(Actions, dispatch)
  }
}

export default connect(
  mapStateToProps,
  mapDispatchToProps
)(HomeView); 
```

# 4.4 [Todo React 原生 App](https://github.com/unbug/TodoRN)

1.概观

[![](img/83386f75c44478b54509639beeb7fe70.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--aSvBFZkW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160722-1.png)

2.结构

[![](img/fd87a9a7034080f6a6b0b77b106fc6ce.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--FPCTld_3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160721-8.png)

3.容器和组件

[![](img/679272e2117559bd4b1b1a5af485d293.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--q5m9JPbN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160721-6.png)

# 4.5 命名约定

1.容器和组件

1.1.容器文件:

```
src/containers/ModuleNameView.js 
```

组件文件:

```
src/components/module-name-view
 - index.js
 - Main.js
 - Header.js
 - ...
 - img
   - icon@2x.png
   - icon@3x.png 
```

1.2.事件名称:

```
handleEventName = ()=>{//todo}
...
<MyComponent onEventName={this.handleEventName}/> 
```

1.3.渲染方法:

```
 renderMethodName = () => {
   //todo
  }
  render() {
    return (
      <View>
        {this.renderMethodName()}
      </View>
    );
  } 
```

`
1.4\. mapStateToProps & mapDispatchToProps

``javascript
函数 mapStateToProps(state){
return {
todos:state . todos
}；
}`

 `函数 mapDispatchToProps(dispatch){
return {
Actions:bindActionCreators(Actions，dispatch)
}
}
`

 `2 .动作``src/actions``

 ````index.js
todos.js
navigation.js`` 

 ``2.1 ``src/constants/ActionTypes.js``

 ```` JavaScript
export const SWITCH _ MAIN _ TAB = ' SWITCH _ MAIN _ TAB '；`

 `' src/actions/todos . js ```JavaScript
import * as types from '../常量/操作类型``

 ``导出函数 addTodo(title，hour) {
返回{type: types。ADD_TODO，title，hour}
}

 `3 .减速器``src/reducers``
``
index.js
todos.js
navigation.js
``
3.1。``src/reducers/todos.js``
` `javascript
导入{ ADD_TODO，DELETE_TODO，EDIT_TODO，COMPLETE_TODO }自'../constants/action types '
const initial state =[]`

 `导出默认函数 todos(state = initialState，action){
switch(action . type){
case ADD _ TODO:
//TODO
默认:
返回状态
}
}

 ``4.styles` `src/styles``

 `````
index.js
Basic.js
Theme.js
``
4.1 ``src/styles/Basic.js``

` `javascript
从' react-native '导入{ StyleSheet，Dimensions }；
让 winSize = dimensions . get(' window ')；
const Basic = style sheet . create({
text:{
fontSize:32/winsize . scale
}
})；
导出默认基本；`

 ```4.2` `src/styles/Theme.js``

 `````JavaScript
//colors
const color = {
绿色:' #00551e '，
棕色:' #693504 '，
红色:' #db2828'
}`

 `//other
const active = {
opacity:0.6

'导出默认{color，active}
 ``4.3` `导入{Theme，BasicStyle}自'../../styles '；`````

 ```# 4.6 资源

*   [通量](http://facebook.github.io/flux/docs/overview.html)
*   [脸书:MVC 不可伸缩，用通量代替](https://www.infoq.com/news/2014/05/facebook-mvc-flux)
*   [还原](http://redux.js.org/index.html)
*   比尔·费希尔的 fluxchat
*   [介绍助焊剂&在练习中反应(KKBOX)](http://www.slideshare.net/randylien/introduce-flux-react-in-kkbox)
*   比尔·费希尔著
*   [通量 TodoMVC 示例](https://github.com/facebook/flux/tree/master/examples/flux-todomvc)
*   [Todo React 原生 App](https://github.com/unbug/TodoRN)

# 5 个数据

1.[联网](http://facebook.github.io/react-native/releases/0.30/docs/network.html)

*   取得
*   XMLHttpRequest API
*   WebSocket

# 5.1 获取

1 .应用 [redux-thunk](https://github.com/gaearon/redux-thunk) 中间件

` `javascript
从' redux '导入{ applyMiddleware，createStore，compose }；
从‘redux-thunk’导入 thunk；
从“redux-logger”导入 createLogger
从'进口减速器../reducers '；`

 `var middleware = compose(applyMiddleware(thunk)，autore hydrate())；

导出默认函数 configure store(){
const store = createStore(reducers，undefined，middlewares
退货店铺；
}

 `2 .开始和结束动作类型

``javascript
//todo action types
export const START_FETCH_ALL_TODOS = 'START_FETCH_ALL_TODOS';
export const FETCH_ALL_TODOS = 'FETCH_ALL_TODOS';
``
3 .取流
``JavaScript
import * as types from '../constants/actiontype '；
将*作为 API 从'导入../constants/server API '；`

 `函数 shouldFetchAllTodos(state){
const data = state . todos；
if(data&&data . isfetchingalltodos){
返回 false
}
返回 true
}

导出函数 fetchAllTodos(){
return async(dispatch，getState)=>{
//验证
if(！shouldFetchAllTodos(getState()){
return promise . resolve()；
}

```
//dispatch fetch start action
dispatch({type: types.START_FETCH_ALL_TODOS});

//fetching
const response = await fetch(APIs.allTodos);
//response
const data = await response.json();

//dispatch fetch end action
return dispatch({
  type: types.FETCH_ALL_TODOS,
  data
}); 
```

}
}
```

 `4 .减速器

` `javascript
导出默认函数 todos(state = initialState，action){
switch(action . type){
case 类型。START _ FETCH _ ALL _ TODOS:
return object . assign({ }，state，{ isFetchingAllTodos:true })；`

 ````
case types.FETCH_ALL_TODOS:
  return Object.assign({}, state, {
    isFetchingAllTodos: false,
    data: action.data.data.reduce(function (pre, cur) {
      //remove duplicates
      !pre.find( key=> key.id===cur.id) && pre.push(cur);
      return pre;
    }, [...state.data])
  });
...
...
default:
  return state 
```

}
}
``
5 .分派&渲染`

 ```javascript
...
componentDidMount(){
//fetch data from server
this.props.actions.fetchAllTodos();
}
...
...
renderLoading = () => {
if (this.props.todos.isFetchingAllTodos) {
return (
<View style={styles.loading}>
<Text style={styles.loadingText}>Loading...</Text>
</View>
)
}
return null;
}
...
``

[![](img/7399f41ce4ecc461a4e3eba8207efd4f.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--4Cz0I_6c--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160726-2.png)

# 5.2 持久

1.[异步存储](https://facebook.github.io/react-native/docs/asyncstorage.html)

2 .应用 [redux-persist](https://github.com/rt2zz/redux-persist) 中间件

` `javascript
从' react-native '导入{ async storage }；
从‘redux’导入{ applyMiddleware，createStore，compose }；
从‘redux-thunk’导入 thunk；
从‘redux-persist’导入{persistStore，auto rehydrate }；
从'进口减速器../reducers '；`

 `var middleware = compose(applyMiddleware(thunk)，autore hydrate())；

导出默认函数 configure store(){
const store = createStore(reducers，undefined，middlewares
persistStore(store，{ storage:async storage })；
退货商店；
}

 `# 5.3 资源

*   [Redux 异步动作](http://redux.js.org/docs/advanced/AsyncActions.html)
*   [Todo React 原生 App](https://github.com/unbug/TodoRN)

# 6 路由器

*   [航海家](https://facebook.github.io/react-native/docs/navigatorios.html)
*   [导航仪](https://facebook.github.io/react-native/docs/navigator.html)

# 6.1 导航器

1 .定义路线

` `javascript`

 `从'导入 MainTabsView。/maintaibsview '；
从'导入编辑视图。/edit view '；
从'导入 BroswerView。/BroswerView '；

const ROUTES = { MainTabsView，BroswerView，edit view }；
```

 `2 .配置导航器

``javascript
class App extends Component {
renderScene = (route, navigator) => {
let Scene = ROUTES[route.name];
return <Scene {...route} navigator={navigator}/>;
}
configureScene = (route, routeStack) => {
switch (route.name){
case 'EditView':
return Navigator.SceneConfigs.FloatFromBottom;
default:
return Navigator.SceneConfigs.PushFromRight;
}
}
render() {
return (
<View style={styles.container}>
<StatusBar barStyle="light-content"/>
<Navigator
initialRoute={{name: 'MainTabsView'}}
renderScene={this.renderScene}
configureScene={this.configureScene}/>
</View>
)
}
}
``

3 .前进和后退

[![](img/9f3230ffc0857dc534372bc6d93235da.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--pAGUjCgi--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160727-2.png)

``javascript
...
handleEdit = ()=>{
//Navigate forward to a new scene
this.props.navigator.push({name: 'EditView', data: this.props.data});
}
...
``

``javascript
...
close = ()=>{
//Transition back and unmount the current scene
this.props.navigator.pop();
}
...
``
[![](img/6fb09c96b1582e12059c0af137901f0c.png)T4】](https://res.cloudinary.com/practicaldev/image/fetch/s--s6y7sCcB--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/QQ20160727-1.png)

4.onDidFocus & onWillFocus

``javascript
...
componentDidMount(){
this.currentRoute = this.props.navigator.navigationContext.currentRoute;
this.bindEvents();
}
componentWillUnmount(){
this.unBindEvents();
}
bindEvents = ()=>{
this.willFocusSubscription = this.props.navigator.navigationContext.addListener('willfocus', (event) => {
if (this.currentRoute !== event.data.route) {
this.setState({isVisible: false});
}
});
this.didFocusSubscription = this.props.navigator.navigationContext.addListener('didfocus', (event) => {
if (this.currentRoute === event.data.route) {
this.setState({isVisible: true});
}
});
}
unBindEvents = ()=>{
this.willFocusSubscription.remove();
this.didFocusSubscription.remove();
}
...
``

# 6.2 资源

*   [React Native 中的路由和导航](http://blog.paracode.com/2016/01/05/routing-and-navigation-in-react-native/)

# 7 个原生模块

在您的 RN 代码中，插入:

``console.log(__fbBatchedBridge);``

然后在您的调试器([http://localhost:8081/debugger-ui](http://localhost:8081/debugger-ui))中，您会看到类似下面的内容，

[![](img/8be74f30664e4fb94ea8882adf4aa2fe.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--haUn4Etp--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/native_modules_screenshot.png) 
这就是我们本章要讲的内容。

# 8 整合

很多时候我们并不是在开始一个新的 app，只是想用 react-native 开发一些新的功能，所以集成应该是 react-native 开发者必备的技能。

假设您已经在 AwesomeProject 中创建了一些特性，那么您希望为您当前的项目创建一个完全相同的环境。

[![](img/a281628a9770f530bbd5d11b770d0313.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Uv5LoNpX--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integrationdemo.png)

**注意**版本在你的应用发布后非常重要。如果你想升级 react-native 和包代码，那几乎意味着你不想再维护旧版本了。

# 8.1 iOS

*   ## 具有局部路径的余足类

    要求:[椰子](https://cocoapods.org/)

    pod **版本> 1.0** 后，需要识别目标。在项目根文件夹中创建“pod file”:
    ``
    target 'MyiOSApp' do
    pod 'React', :path => '../../AwesomeProject/node_modules/react-native', :subspecs => [
    'Core',
    'RCTImage',
    'RCTNetwork',
    'RCTText',
    'RCTWebSocket',
    ]
    end
    ``

然后``pod install``

[![](img/78a4072faa7d78d2ccef9625aa63c9f3.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--WQ8kShWM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/pod_integration.png)

# 8.1.1 包

``
react-native bundle
--platform ios
--dev false
--entry-file index.ios.js
--bundle-output ios/bundle/index.ios.bundle
--assets-dest ios/bundle``

# 8.2 安卓

起初，我遵循了官方的说明(这看起来很简单)，但是出现了很多构建或运行时错误😂。

比如:

`` Can't find variable: __fbBatchedBridge (<unknown file>:1)``

``java.lang.UnsatisfiedLinkError: could find DSO to load: libreactnativejni.so``

``android.view.WindowManager$BadTokenException: Unable to add window android.view.ViewRootImpl$W@5d992cf -- permission denied for this window type``

但是演示工作正常，所以我决定复制它的构建设置。最后，它在我的 Nexus 5X 上正常工作。步骤:

*   添加路径到根 gradle 文件，
    [![](img/b8d3bd11c16339874f1efb87cdff0f9c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--TfrZ-xKQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step11.png)

*   修改 app gradle 文件，
    [![](img/8b184d0714fec761508c294f8a9ca4fd.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--yJechyLQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step22.png)

    *1.官方演示使用这个变量来控制是否为 CPU 构建不同的应用程序，这将减少每个应用程序的大小，我在这里忽略它。

    *2.版本支持包很重要..由于 react-native Android 使用许多开源项目，如果你已经使用了其中一些，你应该检查版本或从依赖项中排除。[目前的名单](https://github.com/facebook/react-native/blob/master/ReactAndroid/build.gradle)

    ``
    compile 'com.android.support:appcompat-v7:23.0.1'
    compile 'com.android.support:recyclerview-v7:23.0.1'
    compile 'com.facebook.fresco:fresco:0.11.0'
    compile 'com.facebook.fresco:imagepipeline-okhttp3:0.11.0'
    compile 'com.fasterxml.jackson.core:jackson-core:2.2.3'
    compile 'com.google.code.findbugs:jsr305:3.0.0'
    compile 'com.squareup.okhttp3:okhttp:3.2.0'
    compile 'com.squareup.okhttp3:okhttp-urlconnection:3.2.0'
    compile 'com.squareup.okhttp3:okhttp-ws:3.2.0'
    compile 'com.squareup.okio:okio:1.8.0'
    compile 'org.webkit:android-jsc:r174650'
    ``

*   修改根 gradle.properties，
    [![](img/5b5b83d9a0e31fc557e3e548e5491fd7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--_qp8KHz3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step3.png)

*   添加 proguard 规则，
    [![](img/148a0459ec5e21b6b2296c02f1fedb08.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--J2cmFeBj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step4.png)

*   AndroidManifest.xml，如果不需要调试模式，可以移除权限。
    [![](img/ffdd2b83521d32d61a220f440886b181.png)T3】](https://res.cloudinary.com/practicaldev/image/fetch/s--IXiwOxW---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step5.png)

# 8.2 安卓

起初，我遵循了官方的说明(这看起来很简单)，但是出现了很多构建或运行时错误😂。

比如:

`` Can't find variable: __fbBatchedBridge (<unknown file>:1)``

``java.lang.UnsatisfiedLinkError: could find DSO to load: libreactnativejni.so``

``android.view.WindowManager$BadTokenException: Unable to add window android.view.ViewRootImpl$W@5d992cf -- permission denied for this window type``

但是演示工作正常，所以我决定复制它的构建设置。最后，它在我的 Nexus 5X 上正常工作。步骤:

*   添加路径到根 gradle 文件，
    [![](img/b8d3bd11c16339874f1efb87cdff0f9c.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--TfrZ-xKQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step11.png)

*   修改 app gradle 文件，
    [![](img/8b184d0714fec761508c294f8a9ca4fd.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--yJechyLQ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step22.png)

    *1.官方演示使用这个变量来控制是否为 CPU 构建不同的应用程序，这将减少每个应用程序的大小，我在这里忽略它。

    *2.版本支持包很重要..由于 react-native Android 使用许多开源项目，如果您已经使用了其中的一些，您应该检查版本或从依赖项中排除它们。[当前列表](https://github.com/facebook/react-native/blob/master/ReactAndroid/build.gradle)
    T0】

*   修改根 gradle.properties，
    [![](img/5b5b83d9a0e31fc557e3e548e5491fd7.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--_qp8KHz3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step3.png)

*   添加 proguard 规则，
    [![](img/148a0459ec5e21b6b2296c02f1fedb08.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--J2cmFeBj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step4.png)

*   AndroidManifest.xml，如果不需要调试模式，可以移除权限。
    [![](img/ffdd2b83521d32d61a220f440886b181.png)T3】](https://res.cloudinary.com/practicaldev/image/fetch/s--IXiwOxW---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/integration_android_step5.png)

# 8.2.1 包

``
react-native bundle
--platform android
--dev false
--entry-file index.android.js
--bundle-output android/bundle/index.android.bundle
--assets-dest android/bundle/
``

# 8.3 出版前

*   关闭调试设置。
*   异常处理程序的实现。

# 8.3 资源

*   [与现有应用集成- iOS](https://facebook.github.io/react-native/docs/embedded-app-ios.html)
*   [与现有应用整合- Android](https://facebook.github.io/react-native/docs/embedded-app-android.html)

# 9 热更新(draf)

# 10 性能

# 10.1 shouldcomponentdupdate

本章可适用于所有 react 应用。

## shouldcomponentdupdate

React 通常很快，但是您仍然可以通过优化函数 [shouldComponentUpdate](https://facebook.github.io/react/docs/component-specs.html#updating-shouldcomponentupdate) 来提高性能。默认情况下，它返回真，如果返回假，渲染函数将被跳过。

当状态或属性改变时，这个函数经常被调用。所以**保持简单快速**很重要。
当您调用`setState`时，`render`功能将一直执行，即使先前状态等于当前状态。这是我们可以做一些优化的地方。

[演示 1](https://jsbin.com/figuse/edit?html,js,output)

在演示 1 中，当单击按钮时，它将设置相同的状态，但渲染时间仍会增加。

[演示 2](http://jsbin.com/culipes/5/edit?html,js,output)

在 demo2 中，我们检查 name 的值是否等于之前的值，如果等于则返回 false，那么我们减少渲染函数的次数。

但是如果我们的状态结构很复杂，比如`{ a: { b: { c: [1, 2, 3] }}}`，我们就要深入比较它们。这显然违反了我们上面提到的规则，**保持 shouldComponentUpdate 简单**

## 不可变-js

[不可变](https://en.wikipedia.org/wiki/Immutable_object)是来自[函数式编程](https://en.wikipedia.org/wiki/Functional_programming)的一个概念，不可变数据的特点之一是一旦创建就不能修改。所以有一些算法为每个数据结构创建散列(更多[细节](https://en.wikipedia.org/wiki/Persistent_data_structure))。
我们可以利用这个特性来防止深度比较，浅度比较就足够了。
这里我们将使用来自 facebook 的[不可变-js](https://facebook.github.io/immutable-js/)

[演示 3](http://jsbin.com/vofubiy/8/edit?html,js,output)

在演示 3 中，我们多次单击第一个按钮，次数只会增加一次，单击第二个按钮，次数会增加。

# 10.2 资源

*   [React.js 对账](https://www.infoq.com/presentations/react-reconciliation)
*   [对账](https://facebook.github.io/react/docs/reconciliation.html)
*   [高级性能](https://facebook.github.io/react/docs/advanced-performance.html)
*   [不可变-js](https://facebook.github.io/immutable-js/)
*   [ShouldComponentUpdate](https://facebook.github.io/react/docs/component-specs.html#updating-shouldcomponentupdate)
*   [功能编程](https://en.wikipedia.org/wiki/Functional_programming)

# 资源

*   [反应堆](https://facebook.github.io/react/)
*   [反应原生](https://facebook.github.io/react-native/)
*   [牛逼-反应](https://github.com/enaqx/awesome-react)
*   [awesome-react-native](https://github.com/jondot/awesome-react-native)
*   [构建与反应](http://buildwithreact.com/)

### 书籍

*   [学习反应原生](http://shop.oreilly.com/product/0636920041511.do)

## - [形成反应边缘](http://shop.oreilly.com/product/9781939902122.do)

## 由 [@unbug](https://twitter.com/unbug) 创作:

*   MIHTool-iOS Web Debugger Pro:MIHTool 帮助前端工程师在 iPad 和 iPhone 上调试和优化他们的网页。
*   [代码自我-变量命名神器](https://unbug.github.io/codelf/):整理你的 GitHub stars 和资源库。在 GitHub 的项目中搜索，找到真实世界中使用的变量名。
*   [js-middleware](https://github.com/unbug/js-middleware) :强大的 Javascript 中间件模式实现，将 Middleware es 应用于任何对象。一个无痛的解决方案，使代码像 ReduxJS 和 ExpressJS 一样可伸缩和可维护。
*   [对自杀的公共许可说不](https://github.com/unbug/snts):我们失去了太多天才开发者，他们自杀了，比如 Aaron Hillel Swartz(1986 年 11 月 8 日-2013 年 1 月 11 日)。作为开发者，社区需要你，世界需要你，请让自己活下去。``````````````````````````````````
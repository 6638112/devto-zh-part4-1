# 究竟什么是微服务架构？

> 原文:[https://dev . to/Brewster bhg/what-the-heck-a-microservice-architecture-anything-4hl](https://dev.to/brewsterbhg/what-the-heck-is-a-microservice-architecture-anyways-4hl)

你是红色游侠，空手道全明星和强大的变形力量游侠的领袖。你正坐在巨型机器人的头上。由其他游侠的佐德组成的消灭外星人、挥舞宝剑的机器人。在 Megazord 中，你是不可战胜的——丽塔·伊斯帕沙送给你的任何东西都比不上你巨大的力量。你盯着今天的“本周怪物”；一个巨大的外星人，全身覆盖着眼球，手臂上有触须。你的脸扭曲成腼腆的假笑；用你摩天大楼大小的剑轻轻一挥，一切就结束了。“好吧，游骑兵，”你大喊，“让我们抓住他！”

[![Megazord kicking an alien](../Images/38e0ee0a037a9915897cb6054b01f70b.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--tBflLJNA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/iizme509wvhrzpqbvjbl.gif)

> 没有比这更好的了。

“嗯，可能有问题？”金伯利，粉色护林员紧张地说。

“那是什么？”

"比利得了单核细胞增多症，所以他来不了了。"

你向下凝视，意识到巨型机器人的左腿不见了。几乎是在意识到这一点的时候，巨型机器人开始不受控制地摇晃起来。随着一声巨响，你重重地摔在地上。当你被扔进驾驶舱的墙壁时，世界以慢动作运转。当你慢慢从迷迷糊糊中清醒过来时，你抬头看到怪物正快速靠近。

“接我们！”你对扎克大喊大叫，他是黑游侠，控制着巨人族的武器。

“更多的坏消息，”他回答，“但是 QA 仍然在对我们上周在 my Zord 中发现的 bug 进行回归测试。它今天还没有准备好发布。”

[![Red and Green Ranger in pain](../Images/d8fe98cf0dc2e849bc43afa973b0a322.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--MShpodq9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8soorcpejd6rjly1aswi.gif)

> 大概就是你现在的感觉。

* * *

忽略 Megazord 显然比组成它的单个组件更强大的事实(因为如果一个超级酷的巨型机器人最终分裂成客观上不那么酷的更小的机器人，那就不那么壮观了)，我想尝试向您介绍微服务的概念，以及为什么它们在过去几年中成为一种流行的架构模式。这不是一个完美的类比——我真的只是想有机会做一个 Power Rangers 的参考。

如果你看了过去几年软件开发人员的招聘信息，你很有可能会看到“熟悉微服务架构”这一行。您可能不知道它到底是什么，但是有一些事情您几乎可以立即推断出来:它涉及一些小的服务，并且是一种架构模式。你对自己说，“好吧，我把 Ruby on Rails 放在我的简历上，我所做的只是写了一个 Hello World 应用程序——我确信我可以通过阅读互联网上的一篇文章来获得微服务的短暂知识。”我不会做任何承诺，但希望在我的文章结束时，你可以面对面试官说，“是的，我 ***是*** 熟悉微服务架构！”在用喉音嚎叫之前，扯下你采访上衣的袖子，一个爆炸性的投掷就掀翻了采访台的桌子。

如果你读过我关于[声明式编程](https://dev.to/brewsterbhg/what-the-heck-is-declarative-programming-anyways-2bj2)的文章，你可能已经看到我提到声明式编程有一个对立面。微服务**也**有一个对立面，被称为*单片架构*。这只是描述作为单个逻辑单元构建的系统的一种方式。简单来说，这意味着一个包含不同功能层的代码库(例如:服务器端应用程序、表示层、数据库层等)。从历史上看，这就是企业构建应用程序的方式。然而，将所有应用程序代码放在一个地方也有一些缺点。随着代码库在永无止境的运营变动周期中增长，维护它的能力也在增长。你将开始招致技术债务。新功能变得更加难以实现。bug 变得更难发现。开发人员将开始反抗上层管理。沙皇将在暴力抗议中被推翻。

[![A screenshot of Netflix's The Last Czar](../Images/91b3ecd249f0f53ce5b684e6cce28e9a.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--1di2mubr--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/76fookwohlw74vnjqmqf.jpg)

> 太快了？

微服务架构模式产生于这样一种需求，即随着企业应用程序规模的扩大，减轻维护企业应用程序的困难。近年来出现了一些模式来帮助解决这个问题，例如，领域驱动设计有助于管理当功能与应用程序的不同领域过于紧密耦合时可能出现的副作用。然而，随着时间的推移，继续维护这种结构变得越来越困难——这就是微服务的用武之地。微服务寻求从代码库中剥离公共功能，并将其抽象为自己的服务。因为这项服务是独立运行的，所以它现在可以专注于特定的业务边界。

我将尝试将一项微服务分解为其单独的特征(有点像将一个应用程序分解为多个微服务，这是您的第一个示例，*哈哈*)。

#### 他们很小

“好的*明显的船长*，”你对着你正在阅读这篇文章的屏幕大声说话。是的，我知道这可能是从名字中暗示的，但是可能不那么明显的是**它们应该有多小。不幸的是，答案并不那么简单:这要看情况。如果你把一个服务分解成*太多的微服务*会怎么样？如果你最终用一个臃肿的微服务处理太多的功能怎么办？**

这里有一个很好的经验法则:决定服务的业务边界，并从那里开始。这里有一个例子，假设你有一个应用程序，用户可以创建个人资料和写文章(男孩，这听起来很熟悉)。您已经创建了一个处理上传照片的函数。这张照片需要转换和上传到 AWS S3 桶，然后元数据需要保存到数据库。这有一个非常明确的业务边界(照片上传管理)，这似乎是一个很好的剥离出来成为微服务的候选。

你可能会在网上听到关于“两个披萨”规则的讨论(由亚马逊推广)，这意味着微服务应该足够小，以至于工作团队可以吃两个披萨。在大学的时候，我一口气吃了一整块特大号披萨，所以我对这个标准不太有信心。我还认为没有确切的公式，虽然这种做法可能对大型企业很有效，但微服务的价值比这更普遍。这应该由最适合你的个人和/或组织需求来决定。

[![A delicious looking pizza](../Images/a926780be950ad169246fbab29c620fd.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--CZUJ7eLM--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/j1kgpqspbjm3u5e1x3gl.jpg)

> 不完全是我吃的披萨，只是一个剧本。

#### [](#single-responsibility-principle)单一责任原则

你可能对这个术语很熟悉(就是 [SOLID](https://en.wikipedia.org/wiki/SOLID) 中的“S”)。如果你不熟悉，我来解释一下。这是将因相同原因而变化的事物分组的想法。既然我已经给出了一个非常模糊的答案，那就让我们更深入一点。

SRP 坚持认为一个类应该只因为一个原因而改变。如果有两个原因可能会改变，它应该分为两类。这听起来可能有点过头了，但是随着应用程序变得越来越复杂，保持代码的弹性是很重要的。当一个类有多种原因需要改变时，很难预测副作用。一个变更将会无意中影响同一个类如何实现其他职责。一切都变得彼此紧密耦合；如果需要更改某些内容，可能会破坏类中的其他功能。

微服务借用了同样的原则，每个服务应该只管理一个职责。每个服务都有自己的任务，但是可以与其他服务通信来解决更大、更复杂的业务问题。毕竟，团队合作让梦想成真。

[![One man band](../Images/a04afbb1a139c20b81eb2e88cb595da1.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--jZGMzZqO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/b881fa07zwhx6irr6qtr.jpeg)

> 如果你的微服务是这样的，那你就做错了。

#### [](#communication)沟通

在微服务架构中，每个服务应该封装自己的领域知识，每个服务的实现细节对其他服务是隐藏的(这又回到了我关于[声明式编程](https://dev.to/brewsterbhg/what-the-heck-is-declarative-programming-anyways-2bj2)的文章)。这意味着在与我们的照片上传微服务交流时，客户端不需要知道任何关于*实际上是如何处理*图像的信息。它只关心传递一个要处理的图像。对于微服务，精心设计定义良好的 API 非常重要。正确处理版本控制也很重要，这样才不会破坏依赖于它的服务。花时间适当地起草你的微服务的 API 将会省去你一个大麻烦。

#### 它们可以独立部署

单一系统的一个痛点是变更周期被捆绑在一起；对应用程序的一个小部分的更改需要重新构建和部署整个应用程序。微服务应该能够独立部署，而不需要在其他任何地方进行更改。如果对微服务的更改需要对主应用程序进行更改，那么您的微服务的功能可能与您的代码库结合得太紧密了。

#### [](#decentralization)放权

这是什么，*区块链*？( **笑轨戏** )。分散治理是微服务的重要组成部分。如果一个服务与其他业务流程的耦合过于紧密，那么您就失去了微服务架构的一些主要优势。如果您的服务是分散的，您就不会受限于任何特定的技术栈、库或框架。你可以通过 Golang 运行照片上传功能，但通过节点 API 处理账户管理。

不仅是应用程序的概念模型可以去中心化，数据存储也是如此。微服务负责保存它们自己的数据和状态。单块系统会有一个数据层来管理整个应用程序的数据持久性，而微服务要灵活得多。您可以让您的服务运行同一数据库的不同实例——或者，如果您觉得特别时髦的话——完全不同的数据库系统。

## [](#why-microservices)为什么要微服务？

#### [](#scalability)可扩展性

使用单片应用程序，您可以通过在负载平衡器后运行应用程序的多个实例来实现水平扩展。然而，这需要扩展整个应用程序，而不仅仅是需要额外资源的部分。从理论上讲，如果站点上 90%的流量都通过一个功能，那么您需要扩展整个应用程序来管理这个端点。因为微服务是单独部署的，所以它们也可以单独扩展以满足需求。干净利落。

#### [](#resiliency)恢复能力

微服务的好处之一是，如果它失败了，它不会把你的整个应用程序沉入海底。请记住，必须有适当的故障保护——因为服务是自治的，当客户端向它们发送请求时，它们不知道您的微服务的健康/状态。通过结合监控和其他故障保护措施(重试请求、短路以避免瓶颈等)来管理这些场景是很重要的。

#### [](#faster-development)发展更快

拥有自主服务意味着更容易添加功能和管理错误修复。可以独立于主应用程序进行更改。如果更新出错，您可以安全地回滚到以前的版本。你可以实现更改，而不用担心它是否会在应用程序的其他地方产生副作用；这意味着测试时间更少，需要解决的总体问题更少。

## [](#designing-microservices)设计微服务

设计微服务没有完美的公式。它需要仔细考虑应用程序的业务领域和目标。定义单个服务的边界将是最大的挑战，但是确保遵循单一责任原则将有助于在您的服务做得太多的情况下提供一个思路。围绕业务边界设计的微服务应该是“垂直的”，也就是说，不是围绕应用程序的水平层设计的。您不会将整个数据层迁移到微服务，因为不同的数据会在应用程序的不同域中上下文化。微软已经编制了一份方便的微服务设计模式列表，你可以在这里阅读。

## [](#its-not-without-drawbacks)它不是没有缺点

[![](../Images/28b2ab880379bff1c7f5a366fd4b1af2.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--iRNN3BO5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/uibu0at4vkorynivj5va.png)

> 等一下，我们需要谈谈。

听起来很酷，微服务架构并不总是适合组织的需求。微服务有一种跷跷板效应；尽管它们带来了很多好处，但是管理架构的复杂性也随之增加。你可能会说，“但是 Keith，微服务架构不是从管理单片系统中的应用程序复杂性的需求中诞生的吗”？别担心，讽刺的是我并没有忘记——但是你本质上是在用一个问题交换另一个问题。

在单一系统中，添加新特性或更新现有特性变得很困难，因为职责或功能可能会广泛分布在应用程序中。一项服务的改变可能会对应用程序的其他部分产生连锁反应。这导致了一个漫长的集成过程，因为所有的团队都需要知道正在实现的变更。微服务通过确保每个服务管理一个单独的职责来解决这个问题(为此，不同的团队可以管理不同的微服务)。这听起来很棒，但是现在你不得不尝试管理一个巨大的自治服务网络。

你有没有过这样的经历:你需要把一大堆东西搬到另一个房间，但你不想多走一趟？所以你小心翼翼地将物品夹在双臂之间；你的左手小指钩住了比你应该依靠你的小指来搬运的东西更重的东西的把手。你开始慢慢挪动你的脚，小心翼翼地平衡物品，因为它们不可避免地会从你的手中滑落。这就是管理微服务架构的基本内容。

还有其他事情要考虑。因为每个微服务负责自己的数据持久性，所以很难跨多个服务维护数据完整性。过于繁琐的服务可能会增加延迟时间，因为请求会在服务之间来回跳转。也是因为权力下放，代码中缺乏治理。如果不设定规范或标准，这些服务的独立性会使事情难以维护(特别是如果它们是用不同的语言编写的)。它需要一套不同的技能来管理这种高度分布式的体系结构，因此这可能被认为是组织的另一个障碍。

重要的是了解您的组织需求，并权衡成本和收益。如果您认为微服务架构非常适合您，那就尽情发挥吧！关于设计微服务架构还有很多要说的，如果你想继续研究，还有很多很好的资源。

因此，下次面试官问你是否熟悉微服务架构时，只要回想一下这篇文章，然后说:“我认为它与 Power Rangers 有关？”

感谢阅读，我希望我能教你一些东西！

[![Yellow Ranger celebrating](../Images/8e9020b58ff18ac58283939af18f15de.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--0WE8UcgP--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/jkxflsqsoc3amqonokku.gif)

最美好的祝愿，
基思·布鲁斯特([推特](https://twitter.com/switchcasebreak)
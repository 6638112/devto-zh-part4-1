# 案例研究:构建组件库

> 原文：<https://dev.to/kathryngrayson/case-study-building-a-component-library-e90>

在过去的一年半时间里，我一直在领导一个项目，创建并实现一个健壮的组件库。我们的组件库是一项非常有益的工作，它使我们的 web 应用程序套件更具内聚性、更易访问，并且(坦率地说)更美观。其他(不太倾向于前端的)开发人员喜欢在不用担心 UI 设计决策或接触任何 CSS 的情况下进行构建——这是我个人喜欢做的两件事。最近，我们甚至开始采取措施将组件库扩展成一个完整的设计系统(但这完全是另一篇文章)。

如果您对在自己的工作场所实现组件库感兴趣，这篇文章将详细介绍我采取的步骤、我学到的经验以及启发和指导我前进的资源。

因为这是相当长的*(嘿，让一个组件库离开地面涉及很多)*，这里有一个链接的目录:

**[步骤:实际实现你的新库](#steps)**

1.  [选择工具](#choosing-tools)
2.  [重新创建现有的基本组件](#recreating)
3.  [在我们的应用中安装库并替换现有组件](#installing)
4.  [构建组件“愿望列表”](#wishlist)
5.  [创建新组件和移除旧组件](#new-components)
6.  [机会性维护](#maintenance)

**[经验教训:我希望在开始](#lessons)** 时就知道

*   [保持常规](#general)
*   [在库中有未完成的组件是没问题的(实际上是有益的)](#wip)
*   [在组件中构建可访问性，以便在应用程序中“免费获得”](#accessibility)
*   [记得偶尔“缩小”](#zoom-out)

如果你已经读到这里...T3】

## 步骤:实际实现你的新库

### 1。选择工具

我的团队创建并维护了一套主要在 **[React](https://reactjs.org/)** 中构建的 web 应用程序(当然，它已经非常适合使用组件库)。只需要一点点研究就可以找到 [**Storybook.js**](https://storybook.js.org/) ，“一个用于独立开发 React、Vue 和 Angular UI 组件的开源工具。”幸运的是，启动并运行它是一个非常顺利的过程，只需要很少的学习时间，这要感谢他们非常可靠的文档。在 Storybook 中，我们使用 [**Info 插件**](https://github.com/storybookjs/storybook/tree/master/addons/info) 、Viewport 插件**和 **[Story-Router](https://github.com/gvaldambrini/storybook-router)** 。我们还使用 **[Rollup.js](https://rollupjs.org/guide/en/)** 将所有东西编译成一个库，这个库可以通过包管理器导入到我们的其他应用程序中，并像其他依赖项一样进行处理。在实际的组件中，我们使用 [**字体牛逼的**](https://fontawesome.com/) 图标来满足我们更一般的图标需求，作为我们可爱的(但有限的)定制品牌特定图标库的补充。我们的 CSS 是使用 **[Sass](https://sass-lang.com/) ，**编写的，这对于组件库特别有用，因为它允许您使用变量(尽管普通 CSS 很快就能赶上！)和筑巢。在未来，我们希望更多地利用 partials 和 mixins，但我承认我们目前没有充分利用它们的潜力。**

 **### 2。重新创建现有的基本组件

所以你已经设置好了，准备构建一些组件——当然！但是如何决定先构建什么呢？想要 100%从头开始，或者只是重新创建另一家公司的另一个更成熟的组件库的组件列表，这可能很有诱惑力，但是您实际上最好浏览一下您已经构建的组件。如果你有一个现有的应用程序或网站，是时候一页一页地浏览并开始分类了——每一页上的按钮看起来像什么？头球怎么样？情态动词怎么样？布拉德·弗罗斯特称之为 [**【界面清单】**](http://bradfrost.com/blog/post/interface-inventory/) ，这是你刚开始做的一件非常有益的事情。一旦你有了一个列表，看看你最常用的 UI 和 bam——这就是你的入门组件列表。

如果你已经有了一个相当一致的设计，那么你只需要将一个按钮的代码复制到组件库中，并做一些必要的小调整。但是，更有可能的是，你会发现你有 3 或 5 个(...或更多)模糊相似(...或者不是)不同的按钮设计，现在你需要选择哪一个将是*按钮设计 <sup>TM</sup>* 。当你做这个决定时，一定要记住在你的应用程序中使用按钮的所有不同的上下文。你可能会发现你需要几个按钮组件来满足你各种各样的需求，这也很好——也许你会做一个主按钮，一个小按钮，一个幽灵按钮，等等。

作为这个过程的一部分，确保你不仅仅是写代码，还要定义使用指南和写文档，这样其他开发人员就可以理解如何使用不同的组件。我不能夸大这一点的重要性；我知道写文档不是最有趣的部分，但在这种情况下，它绝对是至关重要的——组件库的部分目标是视觉一致性，这包括组件使用方式的一致性...人们不知道他们应该或者不应该如何使用一个组件，除非你为它写文档。

### 3。在我们的应用程序中安装库并替换现有组件

此时，您应该有一个包含 5-10 个基本组件的基本库——这些组件在您的应用程序中的很多地方都被使用过。现在，是时候用新的、导入的组件库组件替换旧的组件了，这样我们就可以开始收获好处了。根据您的设置，在集成方面，您可能会有一些小问题需要解决——我记得有一个特别令人沮丧的问题，我们的一个应用程序使用了一个旧版本的 React，它不完全支持 JSX 片段(*这些家伙:* `<> </>`)，所以我们不得不返回并用组件库中的`<span>`替换它们，直到我们准备好更新。此时，您可能还会注意到，您在组件库的气泡中创建的一些组件并不完全符合您在现实应用程序中想要使用它们的实际需求——您可能需要进行一些调整(有关如何尽可能避免这种情况的更多信息，请参见下面的“经验教训”部分)。

希望路上的这些颠簸相对较小，并且被你删除所有代码的巨大喜悦所压倒——因为真的，有什么比把你的代码弄得一团糟感觉更好的吗？？？

### 4。构建组件“愿望清单”

一旦你满足了基本需求，就该开始考虑那些值得拥有的东西了。我们保留了一个组件“愿望清单”，它基本上只是一个我们希望在某一天构建的组件想法的列表，但是现在并没有迫切的需求。这可能是你想要重新设计或改进的东西，你预期将来某个特性需要的东西，或者你已经收到请求的东西。把这些都写下来有几个好处:

*   它确保你不会忘记你对一个组件的好主意
*   当其他人有一个小时左右的空闲时间可以投入到组件库的工作中时，这使得他们可以很容易地接受任务
*   这有助于用户看到该库仍然是活跃的和不断增长的
*   它让人们放心，他们提出的任何组件请求都不会被发送到无效的地方

### 5。创建新组件和删除旧组件

在构建组件库的推荐阅读方面，我怎么推荐 [**原子设计**](http://bradfrost.com/blog/post/atomic-web-design/) 都不够。这就是我们在实际部件制造中采用的方法——将我们的小部件组合成更大的“有机体”。例如，我们的按钮组件变成了搜索表单组件的一部分，子标题组件变成了仪表板平铺组件的一部分。这不仅让你的生活变得更容易，而且还应该保证你创建的组件是正确的-如果你发现自己一遍又一遍地使用它们，那么它们显然是需要的。

另一方面，你也可能会发现一些你*认为*你需要的组件实际上并没有被使用。不时地检查和盘点是有好处的，这样你就可以从库中挑选不用的组件，减少混乱。与其他开发人员或设计人员一起检查一下为什么组件没有用也可能是有用的——可能组件太有限或固执己见，或者只是关于组件如何构建有一些不方便的地方。好消息是，这类事情很容易调整——询问可以防止你把孩子和洗澡水一起倒掉。

### 6。机会性维护

与我们实践 [**机会主义重构**](https://martinfowler.com/bliki/OpportunisticRefactoring.html) 的方式相同，我们也采取机会主义的方法来维护组件库。坦率地说，在每个 sprint 中都安排专用的组件库时间并不总是现实的——更坦率地说，一旦你开始运行，就不总是*必要的*。我们着眼于即将到来的任务，看看我们可以将新组件创建(或旧组件重构)结合到工作中的什么地方，并将其作为故事的一部分进行评估。在 sprint 规划期间保持你的“愿望清单”——当你谈论即将到来的工作时，看看是否有任何新的组件会有用，或者为以后的清单添加新的想法。自从组件库创建以来(大约一年前)，我们每个月都会对其进行贡献或编辑，我主要归功于这种方法。您可能听说过一些公司花费大量时间和精力创建了一个组件库，却因为没有维护它而没有使用它—**在您的工作流程中有机会地构建少量、定期的组件库工作可以有效地防止这种情况的发生。**

## 经验教训:我希望我开始时就知道

### 保持它的一般

这是迄今为止我最希望在我开始充实图书馆时得到的建议。当创建组件时，最好保持它们的广泛性，并对各种用途和解释开放。当我第一次开始制作组件时，我希望它们是相当有限的——我知道我的开发伙伴对设计决策不感兴趣，所以我尽量坚持己见。

例如:我担心人们会把太多的信息放入一个弹出模式中——我强烈认为这个组件应该少用，文本要少。我想象有整段文字和巨大图片的模态在手机上导航会很糟糕——所以我把它做成一个模态组件，你只能传入一个标题和一些描述性的文字。但是我们需要一个带按钮的模态...所以我修改了组件，让它有一个按钮。然后这个模态还需要第二个按钮，最终是一个文本输入。当我回去从我的模态组件中清除所有预先写好的垃圾时，我想到我应该一开始就让人们传入他们想要的东西。最终，我发现自己被自己咄咄逼人的限制所挫败。

你无法预知未来，试图猜测人们使用(或误用)一个组件的所有方式会让你发疯。从一个更通用的、非自以为是的组件开始，使用文档来指定应该如何使用它——如果真的需要，您可以随时返回并添加限制。**灵活性让你的组件更加可用**，这是一天结束时的目标。

### 库中有未完成的组件是没问题的(而且实际上是有益的)

在我们的程序中，我们在组件名中包含了一个[WIP]标签，所以你知道它还不能在我们的应用程序中使用。起初，组件库是我的宝贝，除了*绝对完美，我不希望任何人以任何形式看到它。这是一个错误；它阻止了人们看到正在进行的工作，提出建议，或者思考如何将即将到来的组件结合进来。这也让人们在自己创建或编辑组件时感到不舒服。组件库不是一个艺术博物馆，而是一个艺术工作室——如果它有点乱也没关系，只要它是有组织的混乱。*

### 在组件中内置可访问性以在应用程序中“免费获取”

通常，“让我们的应用程序/网站可访问”的任务令人望而生畏，势不可挡——这绝对是我的公司目前正在努力解决的问题。我希望早些时候有人向我们指出组件库在这方面对我们有多大帮助。构建可访问性的过程变得更加...嗯，当你把它分成小块，一次解决一个部分时，它就变得容易了。

### 记得偶尔“缩小”

尽管 Storybook 很棒，但它的一个内在方面是一把真正的双刃剑:你总是孤立地设计和开发每个组件。虽然这在能够真正关注细节方面是有用的，但它也可能无意中导致您创建的组件不能真正与您的其他东西融合。我记得在一个按钮上花了很多时间，将它导入到应用程序中...意识到与页面上的其他东西相比，它看起来是多么的巨大。每隔一段时间，重要的是要着眼于大局，看看你的组件将如何在原地一起工作。

## 如果你读到这里...

在使用组件库*一整年之后，每一次 sprint* 我都确信前期投入的时间和资源是值得的。我可以毫不犹豫地说，它让我自己的工作变得更容易，我自豪地看到它成为我的同事的参考——不仅是在我自己的团队，而且令人惊讶的是在公司的其他团队也是如此。如果构建一个组件库吸引了你，我绝对鼓励你去研究它——如果你有任何问题(关于我们做了什么或者你如何在你的公司做同样的事情),我会尽我所能回答他们！**
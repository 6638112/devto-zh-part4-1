# 易于部署的应用程序与易于调试的应用程序

> 原文：<https://dev.to/edo248/deployment-friendly-applications-vs-debug-friendly-applications-kk4>

当你写你的应用程序时(在这种情况下是用 Python 写的 web 应用程序，但是
并不重要),你想要关注它的逻辑和有用的功能。但是我们始终需要从一开始就考虑生产就绪性、部署能力和未来可维护性。我通常发现这很难，尤其是在不同的框架、底层后端等之间移动时。

一位知心朋友推荐了我在今年的 PyCon 上由 Hynek Schlawack 发表的演讲“如何编写部署友好的应用程序”,我觉得这非常有趣，也很有帮助。

[https://www.youtube.com/watch?v=wuCpCkrfeMs](https://www.youtube.com/watch?v=wuCpCkrfeMs)

以下是我对我真正喜欢(并将使用)的东西的想法，以及我仍然需要找到答案的东西。

### 主报带走

> 即使您像动物一样在 prod 服务器上部署 git-pull。

这是一句非常中肯的话，我现在会一直用它。不幸的是，我确实看到了需要这个的情况；)

### 日志应该转到标准输出

我真的很喜欢这个想法在这次演讲中被重复。我以前也见过，我发现这是将你的应用从环境中分离出来的非常重要的一部分。您的代码不应该知道或关心日志将被存储在哪里，它们是如何被处理的。

引用海尼克的话:

> 现在请不要再尝试登录文件，上帝也不允许你自己尝试旋转它们。

### 生产中的机器可读日志

这一点通常也不明显，但却非常真实。我很惊讶地看到人们用正则表达式解析自己应用的日志(比如动物；).除非对日志格式有一些外部要求(像 apache 格式，或者类似的)，为什么不直接用结构化格式写呢？

### 重新部署应用程序以更改配置(无需重新加载)

这听起来非常像*不可变部署*。这看起来非常有用，绝对是你的应用生态系统中的一个概念。这确实增加了在应用程序的“旧”和“新”版本之间协调切换的复杂性。但是不管怎样，你还是会因为其他原因拥有它，另一方面，它提供的好处应该超过这些。

### 由环境变量配置

我喜欢 env 变量在不同环境中的“标准”性，它确实是获取配置的好地方。虽然我喜欢这个想法，但不幸的是，它仍然需要某种“配置示例”来传达给用户/客户应用程序支持的变量列表。

### 就绪/健康/指标 API 端点

这是一个伟大的想法，类似于 Java 的 JMX(度量)。而且应用程序有一个清晰的 API 来询问‘你还好吗？’或者“你是 redy 吗？”比试图根据副作用来判断健康状况要好得多。当然，这并不意味着你不需要外部健康探测器。对于度量收集来说更是如此。除了应用程序本身，还有谁能够收集并提供重要的指标来进行监控？

### 在变量和文件命名中使用约定

这是一个有争议的问题。我只想说，只有当约定能够很容易地传达给项目中的每一个人时，它们才是伟大的。这通常很难，尤其是从长期来看。在这个特定的示例中，应用程序包括 gunicorn(第三方代码),它从 env 变量 HOST/PORT 获取配置。这看起来很酷，但我真的很担心第一个将调试几个小时的人，为什么 gunciron 在一些边缘情况下选择了错误的端口，却发现了这个惯例。从我在过去的应用程序中看到的，过度依赖于“不成文”的约定，最终导致“它可以工作，但我们不确定如何工作”的状态，并从头开始重写。

你们觉得这个话题怎么样？与你过去的经历如何匹配？
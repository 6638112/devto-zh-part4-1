# 大重构指南

> 原文:[https://dev . to/pepopowitz/guidance-for-the-big-refactor-3o 49](https://dev.to/pepopowitz/guidance-for-the-big-refactor-3o49)

大多数重构资源都是关于您可以在代码中采取的特定操作。提取方法，去除中间人，...在[refactoring.com/catalog/](https://refactoring.com/catalog/)有详细记录的各种行动。缺少的是对经历**大重构**的更一般的指导。你知道的。你害怕的那个，但是你知道你最终需要做的。你有想法但不知道如何开始的那个。最终会偿还大量技术债务，但会耗费你大量的脑力。

我现在正处于其中之一。我觉得我现在有点像在杂草中，挣扎着寻找户外的空气。所以，是的-这篇文章对你对我都一样重要。但是我的情况促使我后退一步，开始思考 meta。当我在自己的**大重构**中挣扎，思考那些进展顺利或不顺利的事情时，我向你提供这些建议——即将进入**大重构**的勇敢的灵魂。

## [](#1-move-things-out-of-the-way-that-dont-belong)1。把不属于它的东西移开

首先，给自己一个干净的工作空间。你要处理的代码中有一些不应该存在的函数。与当前对象无关的实用程序。对象与你正在改变的代码相关，但是可以独立存在。将这些东西从问题中移走——将它们提取到其他地方的方法或对象中。

## [](#2-choose-your-replacement-strategy)2。选择您的替代策略

你会不会...

*   修改现有的代码路径？这需要您在提交之前完成。取决于这个**大重构**有多大**大**，这可能会有问题和压力。
*   并行创建第二个代码路径？这样事情会变得不同步。在合并之前，您需要查找对原始代码的更改，或者在两个代码路径中强制进行更改。这个*允许你并行测试，这很好。*
*   使用[抽象分支](https://martinfowler.com/bliki/BranchByAbstraction.html)逐步引入你的新代码？我添加这个选项是为了听起来更聪明——我只是在今天寻找一些指导时才知道它，还没有想出如何在我当前的场景中应用它。虽然听起来很棒！

我不知道正确的答案是什么，对我还是对你。有时候，它们都是有意义的，我没有一个好的启发式方法来确定合适的人选。我常常后悔我选择的道路——我后悔我最初为这个**大重构**选择的道路。我怀疑你会想用我的启发法，即使我有一个。

在开始之前，花些时间思考一下这些途径中哪一个最合适。

## [](#3-cover-the-system-with-tests)3。用测试覆盖系统

不是一般的测试，是正确的测试。而不是测试现有代码实现的测试——那些会在你重构时被删除，不会告诉你你是否破坏了什么。

正确的测试比您替换/重写的测试处于更高的层次，并且不关心您正在编写的实现。

它们可能是集成测试。它们可能是用户界面测试(我现在正在全力挖掘那些测试)。对我来说，这可能是一个有争议的观点——它们不一定必须是*永久的*测试——它们现在可以只是你的指南，你可以在完成后删除它们。

用这些测试覆盖你将要替换的所有东西。您将在此过程中使用它们来测试回归。

## [](#4-focus-on-your-health)4。关注你的健康。

你会被这个问题淹没。不要让它带走你知道你需要健康和快乐的东西。别失眠，别不吃饭，别不运动。把它当成一场马拉松，而不是短跑。慢慢来。你不会经历**的大重构**。

休息一下。让你的思绪游走，独自思考问题。不用你强迫，你的大脑会解决这个问题。叫做[孵化](https://en.wikipedia.org/wiki/Incubation_(psychology))。

## [](#5-document-everything)5。记录一切。

在您的代码库中保存一个 NOTES.md 文件，就在您的更改旁边，这样每个人都可以看到它。记录...

*   你发现的事情，你知道你必须解释
*   你认为可能帮助你解决问题的事情
*   你遇到的问题，你知道你必须解决
*   关于你想改变的事情的想法——积压下来，不要一次都去做

## [](#6-commit-amp-get-feedback-frequently)6。提交&经常获得反馈。

经常承诺并不困难。通过提交和推动工作来完成你的**大重构**的每个阶段。这允许你以一个干净的石板开始每个下一阶段；这使得当你陷入困境或决定改变方向时，更容易恢复原状。

经常得到反馈更难，至少对我来说是这样。我喜欢在提交工作以获得反馈之前对其进行合理的润色。我在努力做得更好。正如我的同事克里斯今天告诉我的那样，他本可以向我保证，到目前为止，我已经完成了一半的工作，这是正确的。一两天前，我的情绪状态*肯定*可以使用这种鼓励。

对于大问题，反馈尤其困难，因为你的大脑中有一个大的问题空间，很难与他人分享。让某人进入你的模型会让你感觉适得其反——有很多解释要做。尽管如此，还是要抵制住独自前行的诱惑。获得反馈将有助于你确保你走在正确的道路上，并在前进的道路上给你灵感。

## [](#7-take-baby-steps)7。一步一步来。

大致知道你要去哪里，但是想想你如何以尽可能小的步骤到达那里。应用小的重构动作，并经常提交它们。

如果可以的话，尽早解决最大的问题，但是如果你还不确定正确的抽象，不要强迫他们。合适的时机会出现的。

## [](#8-acknowledge-that-the-big-refactor-is-hard-work)8。承认**大重构**是艰苦的工作。

允许自己花时间。编写解决新问题的代码比编写解决旧问题的代码更容易。当你在解决一个新问题时，你不知道太多的边界情况，你可以用更简单的抽象来处理。当你在解决一个老问题时，边缘情况都是已知的，涵盖它们的正确抽象都需要更多的思考和考虑。

## [](#good-luck)好运！

希望你的**大重构**好好待你！或者至少，你带着最小的伤痕还清了一些债务。让我知道进展如何，[给我发电子邮件](//mailto:steven.j.hicks@gmail.com)或者[在 Twitter 上给我打电话](https://twitter.com/pepopowitz)如果你有我没有提到的建议！
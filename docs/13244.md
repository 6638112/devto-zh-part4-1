# 云日志清单

> 原文：<https://dev.to/sensedeep/cloud-logging-checklist-228e>

有效的日志记录是任何云应用程序或服务的重要基础。然而，仅仅打印语句并将日志转储到您的 **"SumoSplunkDog"** 日志记录解决方案中并不能保证有效的日志记录，也不能保证在火灾发生时快速诊断问题的能力。

该清单适用于**中小型**云应用和服务，重点是 AWS。它不适用于大型网飞规模的服务。

这份清单是一份简单的、激励性的清单，并不能解决所有可能的问题。并不期望所有的站点都能够或应该实现所有的项目。然而，我希望在设计或改进您的日志记录基础设施时，这个清单可以激发您的一些想法。

我尽量保持列表紧凑和集中，但是如果你有你认为我应该添加到列表中的项目，请评论。

## **集中你的日志**

*   [ ]集中存储和处理整个服务的所有日志和指标数据。这大大简化了日志管理、分析和关联任务。

> 集中式日志管理是将所有服务器、应用程序、服务和设备的日志汇总到一个位置。集中位置实现了对访问、控制、存储、监控、警报和分析的单点管理。

## **选择合适的日志服务**

*   [ ]选择在以下几个方面具有优势的日志记录服务:低复杂性、快速捕获、安全存储、方便的日志查看和强大的查询。漂亮的图表排在最后。许多企业日志解决方案对于需求来说太过复杂，可用性排在众多功能之后。如果预算不多，可以单独考虑 CloudWatch。预算有限的 cloud watch。- >

*   [ ]选择能够提供快速日志捕获和接收的日志记录提供商。许多日志供应商在日志数据可用之前强加了几分钟的延迟。一些“接近实时的直播尾”观看实际上意味着“等待 5 分钟”。

*   [ ]快速的 UI 和 UX 体验是必不可少的基础。避免使用加载或遍历日志事件缓慢的日志查看器。强大的查询无法弥补缓慢的浏览速度。考虑一下 [SenseDeep AWS CloudWatch 日志查看器](https://www.sensedeep.com/) *。

*   [ ]选择一个日志记录服务，该服务可以聚合日志以关联所有服务中的问题。这在微服务和/或无服务器环境中是必不可少的。

## **记录格式**

*   [ ]以机器可读的格式发出日志数据。不要发出纯文本字符串。而是使用 JSON 或者键/值对来发出结构化数据(真的，就用 JSON)。

*   [ ]尽可能在所有服务中使用一致的日志记录格式。

*   [ ]使用一个日志库，使开发人员可以轻松地检测他们的代码。

*   [ ]定义并记录您的日志模式。

## **要记录什么**

*   [ ]为参与请求处理或可能影响您的服务的所有服务或组件捕获相关的、唯一的日志信息。

*   [ ]具有丰富结构化上下文的日志，包括:时间戳、消息类型、应用程序名称、用户/帐户、地区/位置、客户端/代理、UI 页面和计时信息。

> 要做到“可观察”，您需要记录足够的信息，以满足未来的日志诊断需求。但是要注意日志信息的总量。过多的数据会掩盖关键信息。

*   [ ]发出高基数字段，如用户 id 和请求 id，可用于在上下文中跨日志关联相关事件。

*   [ ]使用可以追溯到代码的独特消息。考虑将源文件/行添加到日志消息中。

*   [ ]记录可疑的输入验证错误和增加的身份验证和验证错误率。

*   [ ]记录身份验证失败，包括源 IP 和识别客户端信息。

*   [ ]测量并记录关键操作所用的时间(从用户的角度)。

*   [ ]记录数据库“慢速查询”,以了解哪些查询对您的系统来说最慢。

## **什么不日志**

*   [ ]不要泄露密码、密钥、访问令牌、会话标识符等机密。

*   [ ]不要发布个人身份信息或健康相关信息。

*   [ ]不要在不匿名的情况下透露银行账户、财务关键信息或信用卡信息。

*   [ ]不要发出 IP 地址或内部端点。

*   [ ]不要发出数据库连接字符串或内部文件路径。

*   [ ]不要记录冗余信息——要精益。

## **动态日志**

*   [ ]能够在不重新部署代码的情况下，为特定维度(如帐户、用户或请求)启用深度日志记录。

*   [ ]能够在运行时启用或禁用日志记录，或者基于每个服务或代码模块增加或减少消息的详细程度。

*   [ ]拥有一个系统，您可以在其中为特定的请求或用户启用完整的调试日志记录，而不必重新部署代码。

*   [ ]始终记录一小部分请求的完整请求路径，比如 1-2%。这大大有助于诊断系统范围的中断或瞬时中断。

## **度量和监控**

*   [ ]决定并记录您的关键绩效指标，并关注它们。考虑:系统可用性、请求延迟、服务吞吐量、可用容量、最坏情况响应时间和关键错误指示器。

*   [ ]发布描述最终用户响应时间和体验的指标。

*   [ ]发布所有关键服务、应用程序和系统错误的指标。

*   [ ]在所有影响服务的行动期间发布关键绩效指标。

*   [ ]发布关键安全指标，如身份验证失败和请求验证失败的增加。

*   [ ]监控云资源利用率，如自动扩展集群大小和无服务器峰值实例数。监控相关的云成本，并在超过每月关键支出限额时发出警报。

*   [ ]如果记录大量数据，请考虑为指标建立单独的日志组/流，以便可以有效地提取和监控它们。

## **报警**

*   [ ]通过警报和通知自动监控您的服务。

*   [ ]针对顶级服务异常启用主动警报。

*   [ ]能够通过从指标和日志中提取趋势数据来发现异常。

*   [ ]设置请求率突然下降时的警报，因为这可能意味着停机。

*   [ ]能够基于特定指标或日志条件自动发出警报。

*   [ ]在可能的情况下，根据警报调用自动纠正措施。

*   [ ]采用简单、清晰的顶级仪表板，重点关注服务的总体状态和关键绩效指标。

## **治理**

*   [ ]了解您对日志保留的强制性法规遵从性要求。

*   [ ]管理所有区域中所有日志的日志保留时间。永久保存日志可能会非常昂贵。AWS 可以将日志分散到您认为不活跃的区域(CloudFront)。

*   [ ]保留日志，以便安全审计可以全面诊断历史高级持续威胁。

## **安全**

*   [ ]确保安全地存储日志数据，并在传输中和存放时对其进行加密。

*   [ ]使用适当的加密 AES-256 位加密静态日志数据，而不是 MD5 或 SHA1。

*   [ ]确保日志数据在传输或存放过程中不会被篡改或伪造。

*   [ ]确保您可以跨服务快速关联事件，以查看活动威胁的根本原因。

*   [ ]重复:不要记录机密或访问令牌。由于包含机密的备份日志安全性差，许多网站遭到了黑客攻击。

## 保持迭代

最重要的是，不断改进您的日志基础设施。日志记录是捕获足够数据和摄取过多数据之间的平衡。如果您从集中日志记录和以正确的格式发出结构化日志数据开始，那么您将走在为您的服务和应用程序实现“可观察性”的正确道路上。

## 了解更多关于 SenseDeep 的信息

[![SenseDeep AWS CloudWatch Logs Viewer](img/abb2920852ee855f858600cdfba78442.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--wnEYzrjq--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://www.sensedeep.cimg/sensedeep/drag-viewer.png)

在 SenseDeep 开发云服务时，我们希望使用 CloudWatch 作为我们日志记录基础设施的基础，但我们需要一个更好、更简单的日志查看器和分析工具，支持快速平滑滚动和更好的日志查询和数据呈现。

因此，我们在 SenseDeep 中添加了一个非常棒的 CloudWatch 日志查看器。跑得飞快。它透明地将日志事件下载并存储在浏览器应用程序缓存中，以便立即查看和以后查看。它提供了平滑的滚动、实时的尾部和强大的结构化查询。它理解结构化的日志数据，以便进行智能呈现和查询。

在[https://app.sensedeep.com](https://app.sensedeep.com/)免费试用，或在[https://www.sensedeep.com](https://www.sensedeep.com/)了解更多信息。
# 我是一个 MonkeyPatch 调试器

> 原文:[https://dev . to/npras/use-this-trick-to-test-your-rails-patch-quick-in-production-without-publishing-it-33io](https://dev.to/npras/use-this-trick-to-test-your-rails-patch-quickly-in-production-without-yet-publishing-it-33io)

与大公司和老公司相比，初创公司的部署周期会更快。您的修复在生产中投入使用需要时间。因此，任何微小的失误都将付出高昂的代价。

如果您可以访问生产环境或试运行环境，并且非常小心，那么这个技巧将节省您的时间，并为补丁带来新的见解。

很简单。通常，您的修复可能是方法、类或模块的更改。也许您添加了新的行/方法或者删除了一些。在 rails 控制台中，您可以打开该类/模块，然后在控制台中进行更改和测试。

这里有一个例子。

假设你有一门课`User`。对当前 bug 的修复(或者可能只是增加了一个特性，而不是一个 bug)可能是给它添加一个`full_name`方法。

在本地，您可以在您的`user.rb` :
中进行更改

```
class User
  # 100s of lines of other methods
  def full_name
    first_name + ' ' + last_name
  end
end 
```

然后简单地将整个类复制粘贴到生产环境中。现在，在那里，你可以使用这个方法。可以看看是否如预期的那样起作用:

```
u = User.new('Patrick', 'Jane')
u.full_name 
```

你甚至不用粘贴整个大类。在一个单独的文件中，您可以“打开”User 类并添加方法。由于 ruby 的“开放类”功能，这个方法将被添加到现有的类中。

请注意，这不会影响可能仍在该服务器上运行的现有 rails 服务器进程。这些进程没有意识到这种变化。这只是在`rails console`的上下文中，一旦你退出它就会消失。

你为什么想这么做？公平的问题。一个理智的人会在本地做，写测试来验证他的假设，也测试他的修正。

但是有时很难在本地设置所有需要的数据。固定装置和工厂可能已经不在那里了，你可以很容易地挑选和演示错误和修复。为你现在处理的特殊怪异的案件建立数据需要时间。

另一方面，生产拥有您想要的所有数据，而且它们也是真实的！所以当你给类打补丁的时候，你可以使用真实的数据。

有了新发现的快速修复工作的信心，您现在可以回到您的开发环境，添加修复，编写测试，并通过常规的部署管道。

我知道你在想什么。**“这是危险的建议”。**确实是。但前提是你不知道自己在做什么。如果补丁改变了应用程序的状态，我一般**不会**这么做。也就是说，如果它对系统进行了永久性的更改，如任何数据库插入/更新/删除或缓存系统更新等。只有当我需要从数据库中读取一些数据时，我才会这样做。这样不会伤害任何人或任何事。

调试 ruby 应用程序有很多很好的方法:pry，byebug，redmine 的断点， [puts](https://tenderlovemaking.com/2016/02/05/i-am-a-puts-debuggerer.html) ，tracepoint，profiles，benchmarking 等等。但我从未见过有人写这种方法，可能是因为它很傻(也很危险)。但我发现，在很多情况下，快速接触和感受修复的脉搏是有帮助的。

下次试试吧。尽管安全！
# AWS Amplify 中的所有无服务器功能-第 2 部分

> 原文:[https://dev . to/the worst dev/everything-server less-functions-in-AWS-amplify-part-2-18 F2](https://dev.to/theworstdev/everything-serverless-functions-in-aws-amplify-part-2-18f2)

[https://www.youtube.com/embed/X-DtDvtQIsc](https://www.youtube.com/embed/X-DtDvtQIsc)

在第二个视频中，我们将深入探讨 AppSync 中用作解析器的无服务器函数。我们看看如何访问传递给函数的参数，以及如何访问解析器中的兄弟数据和如何处理分页。我们使用“amplify mock”命令并在本地运行环境。

## [](#links-from-video)链接自视频:

*   [AWS Amplify 中的所有无服务器功能-第 1 部分](https://dev.to/kkemple/everything-serverless-functions-in-aws-amplify-part-1-26e3)

## [](#transcripts)抄本:

0:09

大家好，欢迎回到 AWS amplify 中的一切服务功能。是啊。上周，我们停下来，创建了一个添加了 amplify 的 react 应用程序，使用 App sync 建立了一个非常基本的图形 QL API。这是图表。我们刚刚创建了一个 Hello World 函数，它连接到一个服务器列表函数。是的，本质上，这又回来了。所以它看起来更像这样。

0:46

对，就这样。是的，所以我们做了一个函数，可以返回 hello world，我们在浏览器中检查了一下，一切都很好。所以如果你还没看过，这里会有第一个的链接，所以我强烈建议你去看看。但是我们今天要学的是，我们要用这个函数。

1:09

我们将扩展它的功能。然后我们将进行更改，我们将添加另一个函数，并从 API 中获取一些数据。所以也许，你知道，我们会看到我们能走多远，什么时候感觉是一个好的停止点。但是，基本上，现在我们知道了如何建立一个服务功能，就像我们在第一部分中所做的那样，我们将会看到你可以用它做的所有不同类型的事情。所以应该很有趣。

1:37

是的，让我们开始吧。因此，我实际上要做的第一件事是，我们在这一点上并不真正需要 UI。所以我们正在决定模式看起来会是什么样子，你知道，数据结构，在这一点上，你知道，在 UI 中检查看起来很像一个非常慢的反馈循环。

2:00

我们也不希望将东西部署到 AWS。我在上一集提到的是，我们将使用一种叫做模拟的东西来模拟 API、数据存储和所有有趣的东西。这正是我们要做的。所以我要做的第一件事就是跑，放大我的。

2:21
有趣的是，您可以看到有一个模拟端点正在运行，这只是来自我的机器的 IP，所以 localhost:20002。因此，我将继续打开它，我刚刚将浏览器预览配置为默认设置。所以现在我可以稍微滑动一下。你知道，我们可以藏起来，给探索者看，以获得更多空间。但是现在我们有了图像版权。

3:00

所以我们可以，我们可以在这里看到我们的查询。然后我们有服务器列表功能，它连接到所谓的 hello world。所以给定这个模式，它应该返回一个字符串。然后这个字符串应该来自函数。所以这应该会返回 hello world。因此，我将关闭这里的资源管理器并删除它。哎呀，让我们运行查询。

你好，世界。

3:35
果然是 hello world。这只是本地运行在我的机器上。所以这很酷。为了测试这一点，看它本质上是在做一件热重装的事情。我们可以把这个改成你好宇宙。我们保存它，重新运行查询，并查看 Hello universe。所以这很酷。你可以和

4:00
你会得到这种非常快速的反馈循环，你知道，这让你的工作速度大大加快，对吧，这太棒了。有一件事是，如果我们想改变模式，因为 graphical 正在进行模式自省，以确定哪些是可用的，那么在这种情况下，我们必须重新加载 graphical，但我认为我可以接受，对吗？所以让我们为 message 添加一个参数，使它成为可选的，并使它成为一个字符串。所以还是会返回一个字符串，我们还是会调用这个函数。所以现在我们给这个查询传递一个参数，对吗？我们想根据一些数据做一些具体的事情。

4:46

那么我们如何在 lambda 函数中处理它呢？所以 lambda 函数得到的是一个叫做事件的东西。因此，本质上，发生的事情是因为它在一个管道中，它连接到应用程序同步，这个事件会为您填充。你知道，一切都映射到事件，当它连接到这个 lambda 函数时，它连接到抱歉，就像你的图形 QL 模式中的一个字段，它知道，好的，所以如果任何参数都通过连接它们，我们将看看你如何也可以像兄弟数据一样访问，就像你在任何其他图形中一样。QL 项目，对吗？比如，有时你可能想要获取相关数据，然后做一些更大的事情，比如，获取纬度和经度，然后返回一件衣服，反之亦然，对，你有一个完整的地址。所以你拿着它返回一个纬度或经度。

5:32
有许多使用案例。好了，我们有活动了。所以我们可以说所有的东西都到这里来了。用事件和事件数据来看我们的论点是什么，所以一切都在事件论点下，对吧。这就像存储任何类型的传递的参数。这里我们有消息，所以我们可以期待事件到参数停止消息。我们不能期望它，因为它不是必需的，但是如果它被传入，它应该是可用的。

6:24

所以我们可以说消息等于事件自变量。或者你知道，你可以做任何你想做的事情。然后在这里我们只说，信息。如果没有，你好，宇宙实际上将离开那个你好的宇宙。好的，我们将保存它，但是现在记住，我们改变了模式。所以，如果我只是来到这里，我喜欢，啊，信息，啊，看，它会对我们大喊大叫，说，嘿，我们不知道什么信息的权利。所以我们得到了这个未知的论点。所以我们得到了

7:00

本质上，我们运行我们的查询。所以我们可以把它复制出来。但是它很小。但是现在我们有消息了。所以它应该返回 Hello universal，让我们做 hello world。它将运行这个 hello world。所以让我们去掉它，对吧。所以如果我们回去看看这个函数，它应该会返回 Hello universe。所以让我们运行它。我们得到了你好宇宙。这就是你处理争论的方式。太酷了。

7:40

好了，我们已经了解了如何使用参数和传递数据。所以我们要建立一个新的函数，我们要用这个函数调用一个 API，我们要看看用一些参数来处理分页。所以我要在这里添加一个新的属性。

8:00

所以，在我们的口袋妖怪列表中，我们希望能够设置一个限制。尽管这不是必需的。也可以从我们停止的地方继续。所以我们称这个为下一个令牌。在这种情况下，下一个令牌将是一个 int。

8:33

8:46

这意味着当我们返回它时，因为它是一个列表，我们需要分页，我们需要一种方法来识别，嘿，最后给出的项目是什么？

9:00

比如，或者，你知道的，或者我在这个口袋妖怪列表里的位置。因此，当你从这里得到一个响应时，你真正想要的是项目，实际的口袋妖怪，以及下一个令牌，所以它有点像一个中间层，而不只是返回口袋妖怪的数组。我们还想要下一个令牌。所以我们有一个 Pokemon 类型的连接，它有一个下一个令牌，这是一个字符串，它不是，或者不好意思，在这种情况下，它是一个事件。它不是必需的，因为它可能不是。如果答案是否定的，那就意味着，嘿，你已经结束了，没有下一个令牌了，你已经结束了。然后我们想要物品。为了简洁起见，物品不会太多，但会是口袋妖怪。

9:46

但是我们必须为此创建一个类型。所以我将快进这个口袋妖怪类型的创作，然后我们再继续

10:04

好了，我们已经创建了一个口袋妖怪连接，一个口袋妖怪类型和一个口袋妖怪移动。所以我们要做的第一件事是建立一个函数来列出口袋妖怪。所以说函数名。我们必须将它命名为 ES，用于所有服务器列表。

10:34

其实没有破折号只是口袋妖怪。当然，我们想做 dash 环境。因此，我们可以在任何环境下创建一个。好吧，所以我们只是我们现在要坚持这一点，口袋妖怪的动作还不需要。所以我们现在不会担心这些，但是我们会担心口袋妖怪的上市

11:01

所以我们这里要做的是运行放大函数。所以如果你在终端往下看，它说，实际上，让我把那个拉上来一个，就这样。嗯，好吧，所以它说，请运行放大相加功能。所以它已经告诉我们，嘿，你添加了一个函数，但它并不存在。所以让我们实现它。所以我们要说，放大加法函数。

11:33
对，lyst Pokemon，或者为标签，然后为 lambda 函数名会保持不变。我们想要一个 Hello World 函数。所以我要选那个。

11:51

在这种情况下，我们不想访问任何其他资源。我们将访问第三方 API

11:59

现在要编辑本地 lambda 函数吗？是的，我们当然知道。所以我们要点击是。

12:07
所以我们需要注意这一点。我们可能还会收到下一个令牌。因此

12:31

我要去拿口袋妖怪的网址。好的，回到这里，是的，建立口袋妖怪 URL，这将是一个函数，接受一个限制和下一个令牌，它将返回一个字符串。这是口袋妖怪的基本网址，我们已经知道它有两个重要的参数。这是有限。下一个标志，或者不好意思，API 接受极限和偏移量。这就是你如何做分页。所以对我们来说，这是一个相当容易的转换。所以我们只说极限。这将等于在他的爱中传递的，然后我们将有抵消。这将等于下一个传入的令牌。所以这和分页一样简单。

13:44

好的，我们知道我们想要这个 URL。现在我们需要一个极限。我们需要下一个令牌。所以让我们开始吧。所以我们说常数极限。我们在这里说等于，我们做 20。这将是违约，因为我们可能得不到它。然后我们将寻找下一个令牌，也将有一个默认值 0。这就是我们的偏移量，所以我们没有得到一个 X 标记，我们是从起点开始的。如果我们没有得到一个极限，那么我们一次做 20 个，这就等于事件自变量。

14:38

好了，现在我们有了它，也有了一个 URL。我们要做的是，我要给它多一点空间。我们需要获取这些数据，我们需要以某种方式获取这些数据，所以我对 x iOS 很熟悉，它还没有安装。我们将安装它，我们要说获取网址。所以现在我们正在做一些基本的事情。所以这很酷。让 g 等于 x，是的，得到 URL，因为它返回给我们承诺。我们一会儿会在这里试着接球。

15:26

所以现在我们有了结果。所以我们要返回的是记住，这是上市口袋妖怪。但如果我们回到图式，这是一种联系。所以我们需要形成一种联系，而不仅仅是归还物品本身，我们想要一个 ID 和一个名字。所以我们必须得到它。所以我们开始吧。我们会说响应等于。首先，让我们关注下一个令牌，它将检查我们的结果列表，看看我们是否在最后。但是现在，让我们把它当作极限加。

16:21

下一个令牌是吧？所以不管我们从哪里开始，加上我们获取的，我们都把它当作默认值，只是暂时返回一些东西。然后我们会说，items，等于我想说的结果数据。我认为那是正确的。我去查一下 API 文档，马上回来。

16:51

17:00

为我们的下一个令牌，所以记住，如果我们有更多的结果，我们要返回这个。但是如果我们没有呢？如果这就是结局，我们可以说，结果数据。其次，因为如果有更多的话，它会以 URL 的形式返回，如果你能获取更多的话。所以如果我们想要那个，如果我们如果我们知道有下一个，我们可以假设会得到更多。

17:27

否则，没有下一个我们返回 no 的令牌。

17:32

所以现在在这个函数里，我们不想返回这个。我们希望返回以连接的数据结构格式化的响应。但是现在，我们正在处理哦，听着，从某种程度上来说，我是个失踪的人。我想知道你们中有多少人看到了这个，我们会说，哦，你错过了。这是一种突破。

17:53
因此

18:00

让我们设法抓住他们。

18:04

我应该让漂亮点的人去做。

18:07

好了，接住。错误

18:11

我们将首先将控制台日志记录下来

18:18

为了好玩，也是 console.log 吧。哦，我们没有回复。所以我们将 I 上下文做了那个错误。所以如果你出错了，这是第一个参数，在这里，因为以前在这里，看起来好多了。好吧，我们得到了我们的极限。所有这些看起来都不错。所以应该应该是好的。我们应该可以去这里了。所以我们要点击继续。好吧，让我们，呃，让我们把它旋转起来。

18:52
所以当你列出资源的时候，它真正给你的只是名字和获取那个口袋妖怪的 URL。所以我们要做的是尽快把它们拿回来。所以我们会说原因。

19:35

所以我们实际上，所以我们有这个名字。让我们把那些属性加回来。

19:42

19:51

保存那个。我们需要项目 ID 和名称，让我们运行它。所以我们什么都有。

20:00

现在是口袋妖怪 API，我可以想象他们的缓存已经很热了，但是我们在我们不能之前得到了口袋妖怪的 ID。所以现在我们有了动作，这是口袋妖怪的动作。所以我们有一个名字，财产和权力，准确性和优先权。所以我实际上要做的是创建一个名为 stats 的新属性。这将返回口袋妖怪的统计数据。

20:30

但它将由一个函数驱动。

20:34

而这个函数，它的名字将会叫它 ES。

20:40

口袋妖怪统计。同样，我们需要为环境指定。因此

20:49

我们实际上要做的是把它们拿出来。

20:52

我们要创造一种新的类型

20:57

我们称之为口袋妖怪统计。

21:04
所以从技术上来说，我们必须做三件事。但是首先，让我们现在删除这个声明。不需要那个。好吧抱歉。是的，所以我们要这么做。所以我们不需要创建一个新函数

21:24
所以现在我们不回任何移动。我们没有做任何深入的事情。我们得到了口袋妖怪，但我们没有动作。

21:44

嘿，爽。好吧。谢谢你坚持和我在一起。所以我们知道了名字。所以现在，我们想知道细节，对，随时都可以。也许我们想获得这方面的统计数据。所以我们需要口袋妖怪的统计数据

22:00

我们需要这样

22:03

功能对吧？就像我们需要得到它，以及如何得到它。我们将使用名称或源属性来查询 API，比如 stats 的兄弟属性。因此，我们将看到，不仅可以将数据作为参数引入，还可以访问 lambda 函数正在解析的字段的兄弟数据。好，我们保存它，然后我们会得到通知，它会说，嘿，你需要一个函数。所以让我们继续创建这个函数。所以我们要回到根本，我明白了。我们会说放大加法函数。

22:48

23:01

Hello World 函数，我们不想访问其他资源。我们将在下一集讨论这个问题。

23:08

23:13

爽。所以我实际上要做的是我们要用

23:19

这东西的量还过得去。因此，我们将把它全部引入到我们的新函数中。

23:27

我们要改变这个东西。所以首先，

23:30

这个不会在这里。所以这里会有名字，不会来自事件源的参数。所以来源是

23:47

来源是同级数据，对吗？因此，在这种情况下，对于移动，下一个将有统计数据，这是名称的权利，我们想要的名称。因此，现在我们会说，我们将只保留它建立口袋妖怪

24:00

URL，但取而代之的是它要取一个名字。所以看起来它需要一个名字。

24:07

24:12

移动。我相信我们不需要这些，只需要斜线然后命名。

24:24

所以我要快速验证一下。在文件上。

24:29
移动。这不是新闻。它动了。有道理。好了，现在我们有了网址。所以我们要建立我们的结果。我们不需要

24:40

24:54

25:00

25:06

功率、

25:08

准确度、

25:10
和另一个

25:12

优先级。

25:15

这些将等于结果数据。

25:23

这就是我们要回应的。

25:29
我们把它们退回来，正是因为它是 QL 图表。由于我们所说的仅有的三个数据字段是可用的，所以 it 部门只希望将这三个字段返回给最终用户。但是我们会把它展开，这样你就可以看到，

25:53

我说我们的限制是五个

25:57

名字移动了

26:00

姓名和所有统计数据。好吧。

26:07
也许我们打了一个四或四

26:18
但这很有趣。这是另一个。我猜是同一个的又一次进化。但是，是的，所以那只是看起来不见了。但是，是的，我们已经得到了我们的数据。现在我们有了，如果我们回到我们的模式，我们有三个函数。

26:42

而且我们做了很多事情。首先，我们允许传递参数。我们已经设置了如何处理基于参数的分页。最后，如何访问可能隐藏在服务功能中的兄弟数据

27:00

您的模式和不在查询的根。所以我希望这是有趣和愉快的，我会看到你在下一个。

转录自 [https://otter.ai](https://otter.ai)
# 防止恶意认证尝试，同时避免验证码。

> 原文：<https://dev.to/tarialfaro/preventing-malicious-authentication-attempts-while-avoiding-captchas-3bpl>

我们必须非常小心地保护凭证，比如用像 [Argon2](https://argon2.com/) 或 [Scrypt](https://www.tarsnap.com/scrypt.html) 这样的算法适当地散列低熵秘密。

多重身份验证因素对于保护帐户非常重要。比如知道一个秘密并拥有某样东西。

尽管正确实施了加密和凭证管理，但仍然存在诸如恶意第三方试图访问帐户之类的问题。很难停止这一切。

## 用验证码就好！先别想那个。

通常情况下，仍然有可能通过尝试众所周知的“秘密”来攻击大量的服务。一些服务试图通过[验证码](https://wikipedia.org/wiki/captcha) ( [官方网站](http://captcha.net/))来防止这种情况。

我注意到的一件事是，验证码要么容易被获取，要么对自动操作有足够的抵抗力。通常两者都不是。有时候两者都不是！即使我没有任何残疾，我仍然很难完成它们。

[谷歌的验证码](https://www.google.com/recaptcha/intro/v3.html)很多时候不喜欢 [Tor](https://torproject.org/) 网络活动经常因为“可能的自动查询”而拒绝有效的验证码答案。通常我发现的解决方案是切换出口节点。这是流行的代理和 VPN 的问题，不仅仅是 Tor 用户的问题。[更多信息请点击这里。](https://fossbytes.com/google-knows-using-tor/)

不幸的是，除了谷歌的验证码，我不知道还有什么体面的尊重隐私的免费开源软件。

所以验证码可能不是最好的选择。

## 我的解决方案。

### 外国账户。

对于存储的每组凭证，还有一个唯一的**外国账户**与之相关联，这可以是真实个人拥有的电子邮件、XMPP 或电话号码。

### 数据。

必须有某种数据发送到外国帐户，以证明他们有权访问它。数据必须是短暂的和随机的。这可能是附加到链接的软件令牌，在该链接中允许几次身份验证尝试。或者容易键入的秘密(例如:8 位数字代码)。

为了安全地存储数据并验证外部帐户访问数据，必须对其进行适当的哈希处理。一般秘密都是低熵的，所以要用 Argon2 或者 Scrypt 来存储。

然而，如果数据来自具有> = 128 位熵的 [CSPRNG](https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator) 输出，我们使用一个容易计算的散列函数。以 [BLAKE2](https://blake2.net/) 哈希算法为例。

用于深度防御或作为替代策略:使用非对称加密来确保只有真实的个人才能访问数据。这可以被发送到相关联的国外账户或立即给出。

示例机密(易于输入):

```
8 1 7 1 5 9 4 6 
```

示例链接(更难猜测):

```
https://application.network/authenticate/d96c7bf0c9faf4c2c80a2d7e087aa258 
```

### 锁定机构。

现在，拼图中有两个非常重要的部分聚集在一起，那就是**外国账户**和**数据**。我们还有最后一件东西要收集。

我们要用那两块做什么？它们可以用作一种双因素身份验证的形式。

根据定义，“锁定”意味着应用 2FA。当然，我们可以不断地应用它(防止几乎所有的恶意认证尝试)，但是...我们可以试着让*有根据的猜测*只在账户可能受到攻击时应用 2FA。

这意味着在保持可用性的同时，可以使帐户更加安全。

#### 我们锁定什么，何时锁定，锁定多久？

我们可以锁定在特定时间段内尝试进行身份验证失败特定次数的 IP。如果我们锁定一个 IP，它是全球性的。这意味着在没有验证外国帐户访问的情况下，不允许 IP 尝试对任何帐户进行身份验证。这也适用于白名单中的 IP。

还有一种处理 IP 的方法。每个帐户可以拥有避免锁定的白名单 IP(仅当白名单 IP 没有锁定时)，而任何未识别的 IP 都被自动要求通过锁定，即使 IP 本身没有锁定。这可以提供一些更好的安全性，同时仍然保留一些可用性。

另一种方法是通过帐户锁定。如果在特定时间段内一定数量的认证尝试失败，它将被锁定。这意味着**没有 IP**可以尝试在这个帐户上进行验证。这包括白名单中的 IP。

防御攻击的唯一有效方法是同时使用这两种方法。通过 IP 和帐户锁定，最好在锁定前使用相同的允许验证失败尝试。

我们不能完全依赖第一种方法，因为大多数有经验的攻击者都知道，他们只需用代理就可以切换他们的 IP。

我们也不能完全依赖第二种方法，因为一个 IP 可能攻击所有的帐户。相反，我们使用两种方法来防止这两个问题。

然而，只有第二种方法总比只有第一种好。而且最好是*都有*。

1.  如果一个帐户允许在 24 小时内尝试 3 次失败，一个 IP 允许在 24 小时内尝试 6 次失败...他们可以用*一个* IP 攻击*两个*账号。

2.  如果一个账户在 24 小时内允许 6 次无效认证尝试，一个 IP 在 24 小时内允许 3 次失败尝试，我们可以用*两个*IP 攻击*一个*账户。这可能比 1)更糟，因为每个帐户可以尝试更多次。

帐户或 IP 锁定的时间可以是固定的、递增的(取决于先前锁定的次数)或随机的。

还有一些其他的事情需要考虑。您可以通过确定使用哪个 IP 和哪个帐户进行身份验证的请求数量来做出准确的有根据的猜测。如果您 99%确定一批帐户可能受到攻击，监控并自动锁定所有帐户一段时间，并警告用户可能有攻击被阻止。

这是我仍在探索的一个领域，如何准确地确定是否有攻击正在进行。(尽管从我的理解来看，这非常困难，需要大量的数学，甚至可能需要人工智能。)

这是我的认证表格的替代品。这并不是要取代验证码，而是要尽可能避免验证码，并在验证时提供一个更安全、更易访问的解决方案。

**最安全的解决方案是始终应用 2FA，使用非对称加密和高熵数据，例如连接到链接的软件令牌。但这对于一般用户来说太不方便了。**

请注意，如果您尚未登录您的电子邮件(假设这是您的外国帐户)，则电子邮件服务可能会在登录过程中要求验证码。

如果你有任何问题或想讨论什么，请通过[电子邮件](//mailto:tari-alfaro@keemail.me)、[乳齿象](https://mastodon.technology/@tari_alfaro)、[论坛](https://forum.privacytools.io/u/tari-alfaro)、 [DEV.to](https://dev.to/tarialfaro) 或 [XMPP](//xmpp:tari-alfaro@xmpp.is) 联系我。

[十字架从这里张贴出来。](https://write.privacytools.io/tari-alfaro/preventing-malicious-authentication-attempts-while-avoiding-captchas)
# CMS 与 JAMstack 站点集成的注意事项

> 原文：<https://dev.to/megazear7/considerations-for-cms-integrations-with-jamstack-sites-42f3>

人们通常认为静态站点生成器有局限性，服务器端呈现或客户端呈现必须克服这些局限性。单页应用程序、渐进式网络应用程序、引人入胜的动态用户界面、与数据库和内容管理系统的集成；这些不能用于静态生成的站点，是吗？他们当然可以。这种技术有一个名字叫 JAMstack。虽然在我看来，服务器向浏览器发送预构建的 HTML 应该是标准，但由于 web 开发的服务器端和浏览器端都变得繁琐和过于复杂，因此有必要为其命名。

然而，在构建 JAMstack 网站时，有许多事情需要考虑。你如何整合内容和数据库？如何用 SPA、PWA 等现代 web 开发技术来增强呢？我们将看看其中的一些考虑因素，特别是它们如何应用于 web 内容管理。

## 微调构建钩子

如果你的网站足够大，重建它可能会给你的内容提供商和数据库带来沉重的负担。构建发生的频率、变更的来源和范围，以及对内容提供者和数据库的请求数量都需要在设计构建过程时加以考虑。假设您正在构建一个拥有数万页的新闻媒体，并且数据每天都在变化数百次。在这种情况下，重要的是只重建受任何给定内容或代码更改影响的站点部分。我们将研究一些微调构建过程的方法，只重新构建网站中必要的部分，这样我们的 JAMstack 站点就可以无限扩展。

#### 当这不成问题

首先，理解什么时候这不是问题是很重要的。如果您的站点有大约一百个页面，并且每天都要根据代码和数据的变化进行几次重建，那么这只会产生几百个页面。如果您的内容提供商能够每天进行数百万次的阅读，那么这就不是一个问题了。此外，扩展数据和内容提供商的能力通常比处理限制性的构建过程更容易。也就是说，在某些情况下，微调构建过程是必要的。

#### 搭钩子

部署 JAMstack 站点时，您通常需要在数据或内容发生变化时重建站点。要做到这一点，你的托管解决方案需要有构建钩子，这样当它需要执行重建时，其他系统可以通知它。您依次选择的内容提供者、数据库和代码托管解决方案需要能够进行 web 挂钩，以便它们可以通知托管服务需要重新构建。它们还需要能够传递详细的信息，以便构建过程能够准确地识别需要重建的内容。此外，您对静态站点生成器的选择将限制或启用微调的构建挂钩，并将影响每次内容或数据更新时您的站点需要重建的数量。

### 全局数据

网站总是会有全球数据。这可能是出现在所有或许多页面中的名称、元数据和其他信息。另一个例子是出现在你网站每一页上的“最新文章”部分。每当这些数据发生变化时，每个页面都可能需要更新，除非您实际执行构建，否则无从得知。一个解决方案是重新构建你的网站功能，以避免遇到这个问题，但这当然是有限的，我们宁愿找到一个解决方案，使我们能够保持这些功能。有两种方法可以解决这个问题。

#### 受控变化

第一种选择是简单地限制对全局内容的更改数量。这种更严格的控制允许您维护相同的构建过程，保持简单的构建系统具有最高的最终用户性能。这可能表现为限制谁有权更新内容，或者限制将内容更改集成到构建中的频率。这样做的好处是简单性和最终用户性能。然而，这限制了您使用全局数据的灵活性以及将更改集成到站点的速度。

#### 异步 UI

另一种选择是在页面加载后从一个始终最新的 API 异步加载这些内容。这意味着数据可以根据您的需要随时更改，并且更改可以在做出时集成到最终用户体验中。此选项的限制是复杂性和性能，因为它引入了客户端渲染。必须加载页面和任何相关的库，请求数据，并更新 UI。这是几乎所有 web 框架都遵循的设计，也是现代 web 速度缓慢的原因。然而，有时为了实现高度交互和数据密集型 UI，这是必要的。在这些场景中，以谨慎和有选择的方式使用这种异步 UI 方法可以提供内容灵活性和更实时的内容更新。

### 用户数据

JAMstack 站点的另一个数据考虑因素是经验认证。用户有自己的数据吗？有些内容需要认证吗？有些视图是特定于用户的吗，他们看到的内容取决于他们的个人资料？在这些场景中，关于如何交付这些视图，有一些额外的考虑。

#### 预建视图

您仍然可以遵循预先构建的 HTML 的 JAMstack 模式，但是这一次只能通过经过身份验证的 UI 来交付。这意味着您的静态服务器需要能够授权请求，这增加了托管的复杂性，但也意味着您保持了预构建 HTML 的性能优势。值得注意的是，这不是一个非常常见的解决方案，许多构建过程要么不支持这一点，要么需要大量的定制。

#### 异步 UI

认证体验的另一个选择是异步 UI。这是目前许多网站的标准，理由很充分:最大的灵活性。您只需在页面加载后加载您授权的数据，并用 JavaScript 库构建您的 UI。这将我们带回到基于 JavaScript 的 UI 的世界，需要仔细考虑，以便 UI 的这些部分不会降低初始页面加载的速度或超出它们的受欢迎程度。任何可以预构建的 UI 都应该预构建。需要根据用户数据和交互进行更新的用户特定 UI 可能需要在页面加载后生成。然而，这很容易蔓延到 UI 的其余部分，减慢初始页面加载和呈现，并且不必要地在用户需要时才生成 UI，而不是为他们准备好。

## 持续整合

JAMstack 站点非常适合简化的持续集成。您的构建过程已经生成了一个可以简单静态交付的站点。我们已经讨论了强制站点重建的构建钩子的需求。同样的过程可以很容易地扩展到版本控制中。如果你的编码主机系统(比如 GitHub)使用一个 web 钩子来触发主机系统的构建钩子，那么所有这些都是必需的。

然而，并不是每一次代码更改都需要完全重建站点。静态站点生成器通常会有一个与最终网站相匹配的源目录层次结构。在这种情况下，如果源代码中只有一个页面被修改，那么可能只有该页面需要重新构建。

## 单页申请

人们通常认为静态站点生成不能是单页面应用程序。事实上，这与事实相去甚远。将两者结合起来可以让您两全其美，SPA 体系结构减少了网络流量，静态站点生成减少了运行时处理量。单页面应用程序通过只加载更新视图所需的信息来提高性能，而无需重新加载和重新呈现整个页面。静态站点擅长于限制运行时处理的数量，只是在用户需要时提供预先构建的 HTML。这些可以结合起来，以产生一个网站，最大限度地发挥。

为此，您选择的静态站点生成器不仅需要能够呈现完整的静态页面，包括元数据、页脚、页眉和其他布局元素，还需要只生成页面的 HTML。这样，客户端代码可以在导航时加载到这些视图中，而无需加载整个页面布局和元数据

## 渐进式网络应用

渐进式 web 应用程序肯定需要比静态站点生成器更复杂的基础设施，对吗？还是那句话，完全不是这么回事。事实上，他们密切相关。服务人员通常需要提前了解您的站点的结构，而静态站点生成正好提供了这种类型的信息，否则这些信息可能直到在服务器端或客户端呈现方案中运行时才知道。渐进式 web 应用程序可以将您的静态 HTML 和 JavaScript 转换为可安装的离线应用程序，可以访问远程 API、实时数据库、认证服务和云功能，从而将它们转换为具有丰富功能的真正应用程序。

## JAMstack 建议

考虑到这些因素，我有以下建议来实现一个与 CMS 并行的 JAMstack 站点:
通过维护一个有意义的站点层次结构和选择正确的内容、托管和站点生成解决方案来启用微调的构建钩子。
通过选择能够以各种格式生成内容的静态站点生成器来启用单页面应用程序，例如包括和不包括布局。

通过客户端渲染解决方案实现用户特定体验，无需占用整个应用程序即可实现其目的。
通过提前规划您的页面布局和功能，限制全局数据更改的数量以及小的内容更改需要整个网站重建的地方。提前知道哪些特性会产生这样的影响也很重要，这样您就可以相应地进行规划。
了解您在构建成本与数据请求成本等式的哪一边。您的数据库能够满足比构建所需数量级更多的请求吗？然后跳过微调的构建过程。您是否会有数百万个产品页面，即使重新构建一次也会给数据库带来沉重的负担？然后仔细规划一个微调的构建过程。

查看我的博客,了解更多我对技术和其他各种话题的思考。
# 为我的公司制作“内部 Heroku”的 3 个经验教训。

> 原文：<https://dev.to/markhopson/3-lessons-learned-from-making-an-internal-heroku-for-my-company-49hd>

2 年前，我的公司有 500 多名员工。

这时，我们注意到创建和管理系统的过程降低了我们的生产力。

特别是，我们的 SRE 团队被开发人员的请求弄得不知所措，因为所有事情(从提供资源到授予访问权限)都需要他们的协助和签署。

我们希望通过授权给团队来恢复我们的开发速度，这样他们就不必一直依赖 SRE 团队。

那时，我们决定构建一个自助式基础架构门户，以帮助团队更加自主。

该门户将使团队能够创建和管理他们自己的回购、CI/CD 渠道、计算服务和其他资源。有点像内部英雄。

18 个月前，我们在全公司范围内发布了这个门户网站。从那时起，我们已经推出了 300 多项服务。

以下是我学到的三条经验。

# 记录每一单任务

每个 SRE 任务都必须有一张票。这需要在自动化之前开始。

一开始，我们的目标是自动化 SRE 团队执行的常见手动任务，并使这些任务自助化。

例如，部署系统或创建 Github repo 这样的任务需要 SRE——这些都是我们想要自动化的例子。

但是，由于软件的不可见性，发现这些常见的任务(除了令人痛苦的显而易见的任务)被证明是困难的。我在[的另一篇文章](https://medium.com/hackernoon/how-toyota-guides-the-evolution-of-our-infrastructure-and-makes-me-appreciate-jira-bcb766822a3e)中漫谈了这个问题。

如果您不知道 SRE 团队执行什么任务，以及他们执行这些任务的频率，您怎么能确定自动化什么呢？

不，你不能依赖轶事证据或记忆。需要有一些有形的东西，可以用来做出客观的、数据驱动的决策。

这就是为什么有一个处理传入 SRE 请求的流程非常重要。每一项任务，不管多小，都必须被记录下来(我们用的是吉拉的票)，这样以后就可以计算和回顾了。

这意味着开发者再也不能在没有书面请求或“入场券”的情况下，向他们最爱的 SRE 寻求小小的帮助。这同样适用于有紧急业务需求的产品经理。

这些 SRE 入场券至关重要，因为它们揭示了有效的基础设施门户对您的组织来说是什么样子的。

# 对自己理想的架构有一个愿景

仅仅自动化目前存在的最常见的手动任务是不够的。

你应该对什么是你的企业最有效的架构有自己的看法。

单个团队(通常)不会关注公司其他人的设计选择。

然而，为了让一个软件公司有效地扩大规模，技术的复杂性和广度必须得到控制。这有助于提供两个主要好处:

*   在公司内部开发和利用现有专业知识和工具的机会
*   一个通用的开发环境，可以提高开发人员在团队中的资源灵活性

对于你的公司和业务来说，应该有一个理想架构的观点——而不仅仅是对于开发团队的子集。

对我们来说，我们认为事件驱动的微服务(EDM)是最好的，这影响了我们追求的工具。

例如，当我们注意到许多团队需要为他们的服务提供状态存储时，我们在考虑数据库之前自动提供 Kafka 主题。

这并不意味着 EDM 是您公司的最佳设计选择(这取决于您的业务)。但是，无论选择是什么，它都应该指导您对自助服务流程的设想。这将强烈影响你的团队如何构建新系统

因此，不要只是自动化系统当前是如何构建的，而是要在满足现有需求和理想状态的愿景之间取得平衡。

# 自助*和*自组织

一旦团队有能力自由构建和创造，他们就会。

如果您的自助式门户成功了，很可能会有更多的人开始使用它来提供资源(而且会更频繁)。

这意味着资源(如回购、CI/CD 渠道、服务等)将被更频繁地创建。“要记录的东西”越多，有一个组织一切的策略就越重要。

为了让您的公司顺利运营，*每个人*都应该能够回答(或找到答案)这些问题:

*   有哪些资源(或服务)可用？
*   这项服务依赖于哪些资源(或服务)？
*   该资源属于哪个服务？

拥有命名或标记策略对于基础架构的长期健康至关重要。

根据我们的经验，我们发现拥有一个“注册表”来跟踪资源是有用的，但是这可能不是每个人都需要的。

但所有这些都是达到目的的手段。组织战略要回答的最重要的问题是:

> 谁负责这项资源(或服务)？

这个问题的答案应该总是一个人(即使是共享资源)——通常是团队领导。

问责制在自助环境中至关重要。这并不意味着如果出了问题，某人会受到“惩罚”(这是一种常见的误解)，但这确实意味着我们需要知道:

*   谁管理对该资源的更改？
*   如果此资源没有响应，应该通知谁？
*   谁在监控该资源的成本？

能够回答这些问题有助于使自助式基础架构在第[天和第](https://dzone.com/articles/defining-day-2-operations)天保持同样的效率，并避免将您的基础架构变成意大利面条。

我们的自助式门户增加了我们的资源，任何个人或团队都不可能跟踪所有的事情。因此，就像我们如何在团队之间分配许多 SRE 职责一样，我们决定通过在所有自动化中包括可审计性和所有权来组织我们自己。
# 高级 Kubernetes 隐喻

> 原文:[https://dev.to/daveford/high-level-kubernetes-metaphor-do5](https://dev.to/daveford/high-level-kubernetes-metaphor-do5)

我的任务是创建一个 kubernetes 集群，并部署一个 Node JS API 项目。那时，我知道 kubernetes，但并不完全了解它是如何工作的。我开始阅读如何设置集群以及如何将项目部署到集群中。听完我的介绍后，我想到了一个关于如何思考集群和部署的比喻，我曾用这个比喻向 it 员工解释过。

比方说，你制作了一份传单，内容是关于你非常感兴趣的一个主题。你工作非常努力，付出了巨大的努力，希望你的传单能吸引很多人的注意。当你制作完这张传单后，你可以把它贴在公告栏上或者让人们看到。然后，你看到你的努力得到了关注，现在有很多人想看你制作的传单。让我们看看在使用 kubernetes 的环境中如何处理这个问题。

首先你要建立你的传单(项目)。这将根据您使用的技术而有所不同，但这里要做的重要事情是您需要创建一个模板，以便轻松复制。你需要制作一份主传单，你可以用它来复制更多的传单。这就是像 docker 这样的东西出现的地方，它允许你在你的项目中制作一个 Docker 图像。你需要一个文件柜来存放你的主传单和任何以前版本的传单。对我们来说，这将是一个容器注册表，它将保存您的图像的最新副本和一些以前的版本。当您构建项目时，您需要将最新的图像推送到容器注册表中。

现在我们已经创建了我们的传单，并将主版本和以前的版本一起存储在我们的文件柜中，我们准备将它张贴到公告栏。将我们的传单张贴到公告栏是将我们的图像部署到 kubernetes 集群的过程。在 kubernetes 中部署 pod 的一个非常简单的比喻是，把它想象成拿走你的主传单，制作它的副本，然后把副本张贴到公告栏。对我们来说，这意味着 kubernetes 将转到容器注册表，获取最新的图像，然后使用该图像创建一个新的 pod，这是我们的应用程序将运行的地方。pod 的环境由映像定义，例如 docker 映像将使用 docker 文件来定义和设置环境。所以现在我们努力制作和完善的宣传单贴在了公告栏上，现在我们就等着看是否有人来看我们的作品。

我们的传单已经贴了一段时间了，来看我们传单的人越来越多。人群越来越多，每个人都很难一次看完传单，因为有太多的人挤在周围。这是个好问题，但还是个问题。如果我们能有传单的另一个实例，那就太好了，这样每个人都不需要挤在一个传单周围。然后，我们记得我们有一个传单的主副本，所以我们决定制作一个新的副本，然后张贴在第二个公告栏上。完美！Kubernetes 再次出手相救。我们可以将 kubernetes 设置为根据我们应用程序的流量进行伸缩。这意味着 kubernetes 将从我们的容器注册中心获取应用程序映像，制作一个副本并创建一个新的 pod，该 pod 可以定向流量(接下来我将介绍定向流量)。因此，现在我们有两个 pod 运行相同的主映像副本，这将允许流量在两个 pod 之间分流。如果流量对两个 pod 来说仍然太多，kubernetes 可以用主映像的相同副本创建更多的 pod。然后，一旦流量减缓，kubernetes 可以缩小到一个豆荚。

所以，现在我们有多张传单贴在不同的公告板上，我们需要一种方法让人们知道他们可以去查看另一个公告板上的传单。在那里，我们有一个人坐在入口处，他可以指引人们到人最少的公告栏，以便他们获得最佳的观看体验。我们不希望人们看到我们的传单时有不好的体验。尽管这不是我们的错，但有一大群人挤在公告栏周围，当人们想到我们的传单时，他们会记住他们的糟糕经历。这就是负载平衡器的用武之地。这是我们的应用程序的入口，它接收到达我们的应用程序的请求，并将它们定向到服务于该请求的最佳 pod。这个负载均衡器知道集群中运行的 pod 以及其他元数据，以帮助负载均衡器将请求传输到适当的 pod，并保存它，以便每个人都有尽可能快的响应时间。

这是我用来帮助自己理解 kubernetes，然后向他人解释 kubernetes 的比喻。我希望这能帮助那些试图在高层次上理解 kubernetes 的人。我也欢迎任何关于改进我的比喻的方法的反馈，或者让我知道我是否误解了一些事情是如何工作的。
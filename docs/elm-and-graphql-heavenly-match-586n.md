# Elm 欧洲 2019 - Elm 和 GraphQL 天作之合

> 原文：<https://dev.to/elmupdate/elm-and-graphql-heavenly-match-586n>

今天我在 Elm Europe 参加了一整天的 Elm-GraphQL 研讨会，由软件包的作者 Dillon Kearns 主持。

共有 10 名与会者，他们都有各种各样的兴趣，从了解更多关于榆树生态系统的知识到增加他们的工作或家庭项目技能。包括我在内的一些人正在或曾经在使用 GraphQL 而不是 Elm 的环境中工作，所以这是一个将两个世界结合在一起的好机会。

以及这两个世界共同带来的音乐。GraphQL 实际上是一个增强的类型系统，位于客户端前端和后端数据之间。它允许您发送嵌套查询，而不必为每个变体设置或改变 REST 端点。很容易明确你想从后端得到什么，而不是“过度提取”或“不足提取”，使用 REST 很容易做到这一点。

相反，您可以使用对象样式定义进行查询，并为可能要调用的每种数据类型设置“解析器”。如果一种类型的数据中有另一种类型的数据，那么就为内部数据调用解析器，依此类推。另一方面，这可能意味着对数据库的更多单独调用，这可能是一个问题，具体取决于您的应用程序需求和后端 GraphQL 服务器在生成 SQL 调用时的复杂程度。

这整个 GraphQL 的东西来自脸书，你可以直观地看到它如何解决了他们在从不同的人和不同类型的记录的不同视图中收集数据时的许多“图形”访问挑战。如今，许多公司都在使用 GraphQL，包括 GitHub、Shopify 和 Twitter。

无论 GraphQL 实现是服务器端的，都有一个声明的模式、自省和文档，这为 Dillon 提供了创建代码生成工具的机会，该工具为您提供了 Elm 中的等效类型和解码器。它与 Elm 包一起提供了一种无缝检索数据的方法。所以不用再自己做解码器了。Dillon 也有一个用于 Typescript 和 Elm 的相关工具。

这意味着您将获得预制的 Elm 模块，这些模块允许您构建完全类型化的查询，并且您知道如果这些查询能够编译，它们将会工作(当然，前提是您的 GraphQL 后端是完全可靠的)。Elm 编译器的所有好处都被放到了后端。

因此，graphql 查询看起来就像一个 JS 或 JSON 对象，但只是您想要的数据的键，嵌套得尽可能远。get 查询返回包含值的对象。

graphql 变异查询也可以返回一个查询，但主要目的当然是改变特定的字段。还有一个用于设置数据更改通知的订阅查询，通常可以通过 web 套接字进行反馈。GraphQL 是一个与传输无关的规范。

我们讨论了很多关于可空字段、标量字段、枚举、列表等等的细节。然后我们开始练习，向我们介绍这一切在 Elm 中的样子。如果你比较左右，它有点冗长和令人生畏，但一旦你开始玩它，你可以看到它的力量。

Elm-GraphQL 并不只是模仿您在常规 GraphQL 客户端中可以做的事情。Dillon 将它描述为在一个更高的抽象层次上操作，因为 Elm 本身增加了这个等式。

从 GraphQL 服务器实现的自省中，编译器可以获得一些信息。能够在编译时获得无效查询的 Elm 编译错误是一个好处。在你的编辑器中有文档，只是能够把你的查询写成 Elm 语言而不是魔术字符串。

Dillon 还专注于编写代码的过程，这就像是研讨会上的一份额外礼物。例如，一次编写一些可以编译和运行的小程序，并在编写过程中使用虚拟值来减少认知负荷。

这也鼓励我们尝试管道模式，看看它如何影响错误消息。在 Elm-GraphQL 中，您可以通过在 SelectionSet.mapN 函数调用中指定字段或通过构建以 SelectionSet.succeed 开始的管道来构建查询“选择集”。这种方法和权衡对一些人来说是熟悉的。

我特意在这篇博文中省略了代码，因为它会很快变得深奥。我不想让你认为这是在公园散步。有一个学习曲线，如果你一开始就对 Elm 语言的特性范围有信心，这会很有帮助。

即使 Elm-GraphQL 代码生成流畅，现实情况是两个世界正在融合。你仍然会发现自己茫然地盯着某样东西，不确定它与图形的简单性有什么关系——QL 对象。您将导入生成的代码，并且您需要理解这些文件中的内容。编译器会给你很大帮助，但有时错误信息会令人困惑。

然而，我们可以看到 Dillon 围绕着他的例子流动，这只是实践——同时，你应该完全跟上不透明和幻影类型的速度，因为这些可以帮助理解事情。

消除不确定性的能力是这一切的意义所在，正如 Dillon 之前花了很多时间谈论的那样。有了 GraphQL 强制执行的传递给 Elm 的契约，您就可以确信，如果您的查询编译成功，将会得到您想要的数据。

这是一种非常好的感觉。

[https://package . elm-lang . org/packages/dillon kearns/elm-graph QL/](https://package.elm-lang.org/packages/dillonkearns/elm-graphql/)
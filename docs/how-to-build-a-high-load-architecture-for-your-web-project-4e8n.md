# 如何为你的 web 项目构建一个高负载架构？

> 原文：<https://dev.to/smartym/how-to-build-a-high-load-architecture-for-your-web-project-4e8n>

为您的 web 产品选择正确的架构是您在考虑其开发时需要解决的一个关键问题。首先，它应该是可扩展的，能够处理高负载。尤其是如果你在做一个功能网站，在线预订服务，或者电子商务解决方案。

还记得深受人们喜爱的黑色星期五吗？你知道吗，有时网站和网络应用程序无法承受如此巨大的用户涌入，会损失很多钱？

也许，当您不得不等待网页加载或您的交易最终获得批准的漫长时间时，您也会感到恼火。并停止与为您提供糟糕客户体验的公司做生意。

页面和部分内容加载缓慢、崩溃、随机错误、与互联网断开连接都是缺乏高负载架构的可能后果。这就是为什么创建一个能够处理高负载的软件系统至关重要。即使您的 web 项目相当小，在某个时候可能会有大量用户涌入，或者您可能需要弹性伸缩。

**看看一些关于高负荷的事实:**

*   当一台物理服务器变得不能有效地执行数据处理时，高负载就开始了
*   如果一个实例同时为 10，000 个连接提供服务，这就是高负载高负载是指同时为数以千计的用户提供服务
*   如果你[在 AWS](https://smartym.pro/blog/software-project-development-how-to-scale-your-application-with-amazon-web-services/) (亚马逊网络服务)[、微软 Azure](https://en.wikipedia.org/wiki/Microsoft_Azure) 或谷歌云平台上部署一个网络解决方案，你就在维护一个高负载架构

**如果您的 web 解决方案不能承受高负载，您可能会面临以下问题:**

*   缓慢或无休止的页面加载
*   随机误差
*   断开与 web 服务器的连接
*   部分内容加载
*   用户受众活动减少
*   客户损失

正如你所看到的，项目架构影响它的成功。没有快乐的顾客，就没有成功和利润。要实现可伸缩的 web 应用程序，您需要理解开发高性能软件解决方案的原则。

## 构建高性能解决方案的原则

### 动态和灵活性

你永远不知道明天你的项目会发生什么。或者一些次要的产品功能会在没人预料的时候开始流行。

或者您可能需要添加各种功能。或者你会决定推广你的应用，吸引客户。因此，您必须能够弹性伸缩并处理高负载。

当开发大规模的 web 解决方案时，关注灵活性，因为它将使您能够轻松地进行更改和扩展。灵活性，没有各方面的前期规划，是任何快速成长的软件系统最重要的特点。

### 项目逐步增长

很难预测未来几年的受众规模，因此最好将重点放在可扩展性上。应用程序架构也是如此。渐进的解决方案是成功的软件工程的基础。

如果您正在运行一个新产品，那么立即提供一个能够承受数百万用户并同时处理他们的多个请求的基础设施是没有意义的。

使用云来托管新项目，因为它允许他们降低服务器的成本，促进他们的管理，并轻松地部署应用程序。

此外，许多云托管服务提供私有网络服务，使软件开发人员能够安全地使用云中的服务器，并使系统可伸缩。

**web 解决方案的扩展是一个渐进的过程，有 4 个主要步骤:**

*   负载分析
*   确定受负载影响最大的区域
*   将这些区域转移到单个节点及其优化
*   负载分析

## 可扩展 web 项目架构的开发

在大多数情况下，一个新的软件解决方案运行在一台服务器上，运行着 web 服务器、数据库和解决方案本身。你不会从一开始就构建一个大型复杂的项目。相反，应关注产品的可扩展性，并选择能够在必要时处理高负载的强大服务器。

这种方法将帮助您节省时间并降低开发成本。下面，您可以看到一些有助于您开发高性能可伸缩 web 应用程序的方法。

### 数据库分离

最常见的情况是，第一个处于负载下的节点是数据库。用户对应用程序的每个请求通常是 10 到 100 次数据库查询。独立服务器上的数据库分支将提高其性能，并减少对其他组件的负面影响(PHP、 [Nginx](https://github.com/nginx/nginx) 等)。).

### 数据库迁移

在某些情况下，将数据库移动到另一台服务器可能会给正在工作的 web 解决方案带来问题。您应该做以下事情来有效地迁移它:

*   使用一个简单的解决方案——在网站上发布一个关于计划工作的公告，然后进行转移。最好在用户受众活跃度最低的晚上做。

*   使用复制将数据从一台服务器同步到另一台服务器。配置完成后，您应该将应用程序中的数据库 IP 地址更改为新的服务器。然后–关闭旧服务器。

### web 服务器的分离

此后，分离 web 服务器，将其分配给单独的节点将允许为应用程序留出更多资源。说到 PHP 的例子，您应该将产品部署配置到 Nginx 服务器和 PHP 服务器，代表后端。

然后，Nginx 本身会给出静态文件，PHP 服务器只会处理脚本。Nginx 支持通过 IP 地址连接到后端:

*服务器{
服务器名 ruhighload.com；*

*root/var/www/ruhighload；
索引 index.php；*

*地点~*。(PHP)$ {
fastcgi _ pass 10 . 10 . 10 . 1:9000；【index.php T2】fastcgi _ index；
包含 fastcgi _ params
fastcgi _ param SCRIPT _ FILENAME $ document _ root $ fastcgi _ SCRIPT _ name；*
*}
}*

请记住，如果您使用文件加载，您将需要将文件存储分配到一个单独的节点。

### 使用几个后端

当负载增加时，web 应用程序开始工作得更慢。在某种程度上，原因已经存在于实现本身。为了避免这样的问题，您应该使用几个 PHP 后端。

安装后端时，请确保它们具有相同的配置。使用 Nginx 来平衡它们之间的负载。为此，您应该在上游中定义后端列表，并在配置中使用它:

*上游后端{
服务器 10 . 10 . 10 . 1；
服务器 10 . 10 . 10 . 2；
服务器 10 . 10 . 10 . 3；【ruhighload.com】}
服务器{
服务器 _ 名称；
root/var/www/ruhighload；
索引 index.php；
位置~ *。(php) $ {
fastcgi_pass 后端；
fastcgi _ index index.php；
包含 fastcgi _ params
fastcgi _ param SCRIPT _ FILENAME $ document _ root $ fastcgi _ SCRIPT _ name；
}
}*

当您开始使用多个后端时，来自同一个用户的请求将被发送到不同的服务器。这将要求所有会话使用一个存储库。

例如，你可以选择 Memcache。此外，您应该连接缓存服务器。Memcache 将使用常量哈希算法在所有服务器之间独立分配负载。

### 任务队列和 DNS 平衡

任务队列支持异步执行繁重的操作，而不会降低主应用程序的速度。当队列服务器从 web 解决方案接收任务时，其他服务器将处理它们。如果队列中的平均任务数会增加，请增加服务器的数量以平衡负载。

DNS 支持基于循环的平衡，允许指定多个接收 web 服务器的 IP 地址，称为前端。这里你需要安装几个相同的前端，以便 DNS 将不同的 IP 地址给不同的客户端。这样，您将确保前端之间的平衡。

### 文件存储

文件上传和处理通常发生在后端。有几个后端是完全不方便和低效的，因为软件工程师必须记住他们在哪个后端上传每个文件。

此外，它们会降低后端性能。为了避免这些困难，您应该使用不同的服务器来加载、存储和处理文件。

**你可以用下面的方法制作:**

*   为文件服务器定义一个单独的子域
*   在服务器上部署 Nginx 和一个可以存储和处理文件的小应用程序
*   通过添加新的服务器和子域(例如，images1、images2、images3 等)进行扩展。)
*   将文件负载转移到客户端，以便表单向某个服务器发送请求

创建一个应用程序并没有什么大不了的，它可以随着流量的增长而在服务器之间成比例地扩展。一切无状态，负载平衡，90%缓存，可靠的内容交付网络，等等——你有一个高负载架构。

但是，性价比是关键。假设您有 10 万个用户和一台服务器。因此，要获得 13 万台服务器，您需要放置另一台服务器。这似乎是相当困难的，不是吗？

因此，你应该退一步思考——系统的哪个部分导致了问题？如果是数据库，在开始项目开发之前，选择一个高可伸缩性的数据库。或者您可以使用几个数据库，例如，一个用于写，一个用于读(CQRS)。

提前定义并解决此类性能问题，并且不大幅增加基础设施成本，是确保高负载的有效做法。
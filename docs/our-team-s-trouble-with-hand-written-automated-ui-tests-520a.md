# 我们团队在手写自动化 UI 测试方面的问题

> 原文：<https://dev.to/twynsicle/our-team-s-trouble-with-hand-written-automated-ui-tests-520a>

在发布新功能之前，您需要确保现有功能仍然可用。您将每个版本交给 QA 团队来执行手工回归测试。测试人员/QA 团队有他们的脚本，并花几天时间浏览它们，寻找回归和错误。随着时间的推移，您会添加新的特性，脚本的大小会增加，执行手动测试所需的时间也会增加。您对手工测试的依赖开始变得有问题，因此您开始寻找替代方法。自动化 UI 测试听起来很吸引人。它似乎承诺您可以继续运行相同的回归测试脚本，但是用自动化框架的手和眼睛代替人类的手和眼睛。

每个人都开始对自动化 UI 测试感到非常兴奋。

*   手工回归测试是一项单调乏味的任务，每个人都乐于看到它被取代。
*   它解放了 QA 团队的时间来进行特别的和探索性的测试。
*   当手工回归测试步骤花费了这么多的时间来完成时，一点点的延迟都会使您的发布面临风险。也许测试需要重新开始，或者开始时间推后几天，或者您的回归环境需要同时共享两个不同的发布。
*   您的发布节奏受到手工回归测试的限制。两天或更多天的手工回归测试意味着你一个月最多只能发布两次。此外，您需要一次性发布所有内容。要么全有，要么全无，因为你需要一起测试所有的东西。
*   自动化测试是有形的。你可以让它们在墙上的设备上运行，并向参观者展示。
*   自动化意味着回归测试可以在你开发的时候发生，在你的冲刺阶段，减少了将工作扔过一堵墙，等待结果的需要。

您可以购买一个商业工具来帮助您创建和管理您的测试。或者，也许您选择的框架带有内置的自动化解决方案。太好了，这篇文章不适合你。或者，您可以考虑使用 Selenium 或 Appium 之类的工具来手写您的测试。这是我的团队得到的方法，经过几个月的工作，我们放弃了测试。事实证明，它们并不适合我们的测试套件、我们的架构、我们的团队或者我们的期望。通过这个过程，我们学到了许多经验教训，也遇到了许多本应提前考虑的问题。

### 是否适合你的手动回归套件？

对自动化测试所涵盖的内容要现实一点，它不会是你的整个手工回归套件。有些部分太复杂或太耗时，不值得自动化。

*   无法分割的一连串行动。UI 测试的不可靠性使得在一次运行中完成所有测试变得很有挑战性。
*   测试与第二个应用程序的交互。
*   检查 pdf 和其他生成文件的输出。
*   测试与 Windows 或 Windows 文件系统交互的任务。
*   后续运行会产生不同结果的测试。您的测试运行是否会受到之前测试运行结果的影响？手动回归可能两周发生一次，而自动化 UI 测试可能一分钟或一小时多次重试相同的测试，增加了冲突的几率。
*   如果测试运行失败或中途崩溃，应用程序可能会处于不一致状态的测试。这需要人为干预来补救吗？
*   在这种情况下，你对应用程序中显示的数据没有足够的控制权，这使得设置测试前提条件变得很困难。测试人员是否必须在应用程序中寻找匹配的数据，而不是能够创建或直接导航到那个场景？

小心不要变得过于教条，在不适合的地方强行进行 UI 自动化测试。它们不仅难以编写，而且不可靠，难以维护。在开始之前，对什么可以自动化持现实态度。无论是谁在自动化测试，都需要说不的自由。

### 它是否适合您的应用架构？

根据您的应用程序是如何构建的以及它是如何发展的，您可能会发现自动化需要花费不合理的时间来设置。UI 自动化是编写测试步骤的一部分，也是建立测试基础设施的一部分。如果您遵循页面对象模型模式，那么对于应用程序中的每个页面和控件，您都要创建模型，以便您的测试可以找到该页面或控件上的元素并与之交互。您需要编写的基础结构代码的数量取决于项目。您是否有几个不同的页面接受许多不同的输入，或者许多工作流分布在许多专门的页面上？你有一个可以重复使用的控件库吗？或者每个控件都是定制的，因为你的用户界面已经随着时间的推移而改变了？到目前为止，您开发应用程序的方式决定了您需要投入多少精力来编写测试基础设施。反过来，这会影响编写自动化 UI 测试所需的时间。

### 你的自动化测试会发现错误和回归吗？

在开始之前，检查自动化 UI 测试是否会找到您期望的回归。您应该有以前在回归和生产中发现的错误的记录。你计划用自动化 UI 测试来捕捉其中的多少个呢？

有很多情况 UI 测试不会发现。

*   步骤中的问题，这些问题不包括在手动回归脚本中布置的路径中。因为有人在测试应用程序的那个区域，而不是被明确地包含在测试步骤中，错误被发现的频率有多高？
*   当特性及其测试都不正确时。
*   边缘情况或不常见场景中的 bug。
*   您的单元和集成测试层捕获的任何东西。
*   其结果在应用程序中不可见的任何操作。避免仅仅为了自动化测试而试图隐藏应用程序中的数据。
*   视觉误差。
*   性能问题。
*   任何测试用例最终都过于复杂和难以自动化。

自动化测试将在您的过程中扮演什么角色？他们如何最好地支持你的 QA 团队和回归过程？也许，你的目标不是找到 bug，而是腾出 QA 时间。当执行更详尽的特别和探索性测试时，您可以跳过 QA 涵盖的领域。你期望自动化 UI 测试发现什么，应该通知你选择包括什么领域，以及你计划写多少。

### 您预计花费多少？

将你花在编写测试上的时间与你可能节省的时间进行比较是很容易的。自动化我们的一个特性花费了 200 多个小时来节省每个版本 20 分钟的时间。考虑到自动化测试花费的时间比节省的时间多得多，你所预见的收益值得吗？它们是否会花费很长时间来创建，以至于您永远无法完成测试套件的创建？

### 谁将编写测试？

您可能希望通过使用页面对象模型模式，开发人员可以编写测试基础设施，然后 QA 可以使用它来编写测试。我们的经验并非如此，开发人员需要编写基础设施和测试。

*   您的测试基础设施可能无法在多个测试中重用。如果没有重用，您最终会在编写测试的同时编写支持代码。
*   编写测试可能还需要对您的应用程序进行许多更新。
*   自动化框架没有提供足够的信息来知道测试失败是因为基础设施还是测试。
*   如果您的 QA 团队缺乏编码或自动化方面的经验，您可能无法使框架简单易用。
*   这些测试需要太多关于应用程序内部的知识。
*   测试碎片化导致开发人员不断返回来修复测试基础设施。

当您在为自动化测试进行概念验证时，让任何想要扩展和维护测试的人都参与进来。确保你所做的适合他们的技能和对你的应用的理解。

### 你有干净的数据集来测试吗？

开始时，您可能会使用与常规开发活动相同的数据库。然而，过不了多久，你就会花越来越多的时间在数据集上。

*   你需要找到先决条件，而不是已经设置好了，或者它们应该容易创建。
*   随着更多数据的创建，您的 UI 也会发生变化。例如，额外的数据将一个元素推离页面，测试失败，因为它们不能与之交互。
*   同一测试可能会在同一分钟内重新运行。您需要检查一个元素是来自当前的测试还是以前的测试运行。
*   测试失败是因为测试用户进入了意外状态，需要手动干预或测试在每个无效状态下预先过滤用户。
*   对数据集进行大范围更改会改变您一直使用的数据。例如，您可能会定期清除开发人员数据库，或者用从另一个系统导入的数据刷新它。
*   同时测试运行或开发人员使用同一个数据库会导致意外的交互和测试失败。
*   能够在多种环境下运行测试的诱惑悄然而至。在开发期间针对开发数据库，在签署期间针对回归环境。

您的每个测试都可能有各种需要设置的前提条件。依靠自动化测试来设置它们的前提条件将会把每个测试变成一个长长的动作链。这些额外的步骤不仅会降低测试的编写和运行速度，还会使测试变得更加脆弱，并且更难找到故障点。如果您不能从应用程序内部创建测试场景的前提条件，该怎么办？测试需要在应用程序中搜寻合适的数据吗？有了一个干净的数据集，你可以拥有已知的测试条件和已知的测试用户，就像你在单元测试中如何使用一个对象母。

您需要一个可以重置并用固定数据填充的数据库。如果您还没有这些，那么您将需要许多新的基础设施:一个新的数据库，一个用于填充有效测试数据的工具，指向这个新数据库的 API，以及构建用于部署这个环境的管道。

### 你的 UI 框架和组件做的比你意识到的要多

你的每个测试都需要考虑每个 UI 组件能做的一切。以下面的例子为例，我们在测试之间不重置数据库，我们想点击列表中的一个元素。

*   我们点击元素；测试通过。
*   随后的运行将更多的项目添加到列表中，将目标推到屏幕之外；我们需要更新我们的测试，以便在单击之前跳转到元素。
*   这个列表变得很长，以至于 UI 虚拟化开始出现。我们的目标已经不在页面上了。我们不能跳到它，而是需要通过慢慢滚动来搜索列表。
*   列表中出现重复项；您需要找出哪个元素来自当前的测试运行。
*   另一个元素变大，将整个列表推到屏幕之外；在与列表交互之前，您需要滚动到列表。
*   先前的测试运行未能完成，测试实体处于隐藏整个列表的状态。

应用程序中的每个 UI 控件都需要类似的过程。您可能会发现自己在创建测试后的几周内会重新访问它们，因为您在 UI 控件中遇到了您没有预料到的边缘情况。

### 片状剥落

自动化测试经常失败，而且经常，你不知道为什么。失败可能有很多原因

*   您正在使用的自动化框架无法在屏幕上找到元素。
*   自动化框架无法识别您的应用程序已经启动。
*   测试驱动程序无法连接。
*   您在 UI 组件中遇到了边缘情况。
*   一个元素被推到屏幕之外，所以你的自动化框架不能与之交互。
*   时间问题:也许在测试试图点击一个元素之前，一个掩码没有完全隐藏。
*   由于屏幕上或屏幕外的元素不同，测试在不同的屏幕尺寸和分辨率下会有不同的效果。
*   前面提到的所有问题都与每个测试运行没有一个干净、隔离的数据库实例有关。

我们使用 Appium 和 WinAppDriver，对于大多数失败，我们没有得到有用的错误消息，没有日志和堆栈跟踪。我们的测试失败是因为找不到某个元素，但是无法判断哪个元素出了问题。更糟糕的是，由于故障是间歇性的，并且可能是特定于设备或环境的，所以需要很长时间来确定原因。

对易变测试的一个解决方案是运行每个测试直到它通过。这带来了几个问题:测试运行的持续时间变长，使得从测试中获得及时的反馈变得更加困难。其次，它使得编写新的测试变得更加困难，你可能要等十分钟或者更长时间来测试一个单独的变化。理想情况下，当剥落增加时，您应该解决它。随着时间的推移，跟踪测试剥落，并对您收到的模糊错误信息进行分组。当你没有有用的日志时，知道剥落何时开始是追踪它的一个重要线索。

为了解决这一问题，我们维护了一个长长的列表，列出了所有可能导致问题的东西——所有的边缘案例以及测试套件和应用程序之间的 UI 交互。这不仅花费了很长的时间和大量的反复试验，而且增加了与其他开发人员共享测试套件的学习曲线。

### 重构很难

自动化 UI 测试很难重构。测试可能需要几个小时来运行，这使得很难获得大范围变化的反馈。一些测试可能严重依赖于仔细安排时间，一旦有任何变化就会中断。由于自动化测试对你的团队来说可能是新的，当开发人员试图找出最佳策略，然后努力将它们应用到测试用例中时，你可能会面临许多不同的方法。拥有不同的方法使得新加入项目的人很难判断哪个是最好的方法。当您对应用程序的 UI 进行任何更改时，它也会产生影响。您可能会发现自己需要更改几十个自动化 UI 测试，每个测试都有不同的实现。

### 人为因素

当将新工具、技术或流程引入团队时，需要考虑各种人为因素:

*   使用新工具的生活质量如何？是沮丧还是缓慢？
*   有人愿意成为新技术的拥护者吗？如果他们走了，谁来接手？
*   当工具导致延迟时会发生什么？当你没有时间的时候，自动化测试会被放弃吗？企业能容忍多少额外的时间来对一个特性进行自动化的 UI 测试？
*   如果这个工具在团队中名声不好，会发生什么？
*   是否每个人都认同编写自动化测试的价值，或者他们认为这是浪费时间？

正如我们到目前为止所讨论的，关于这些测试的价值，有许多潜在的痛点和许多问题。没有答案，你的测试套件不可能持续很久。

## 有没有更好的选择？

也许创建自动化 UI 测试看起来并不是一个吸引人的选择。然而，您仍然不希望手工回归测试花费这么多时间，那么还有什么其他的选择呢？

### 不要试图实现整个手工回归脚本

避免尝试自动化您的整个手动测试套件。它是在考虑人工测试人员的情况下编写的，没有意识到自动化的困难或不可能。至关重要的是，无论是谁编写自动化测试，都可以选择不自动化测试用例。无情地剔除你自动化的东西。自动化不适合自动化的特性不仅会花费很长时间，而且会导致最脆弱和最难维护的测试。

### 先填写测试金字塔的其余部分

没有一种单一的测试可以提供完整的覆盖范围。您需要各种具有不同特异性和隔离级别的测试——金字塔底部有许多特定的、隔离的测试。然后，随着你向上移动，会有更少的测试变得不那么具体，并覆盖应用程序的更多部分。底层的单元测试，然后是集成测试，然后是端到端测试。

金字塔的每一层都协同工作，有不同的优势和劣势。如果可能的话，我们宁愿尽可能多地覆盖单元层和集成层。这些测试更容易编写，提供更具体的反馈，并且可以在开发期间运行。单元测试更适合覆盖边缘情况和错误场景。自动化 UI 测试可以覆盖单元测试可能无法覆盖的 UI 逻辑，这取决于您的应用程序。自动化 UI 测试还测试应用程序的多个部分是否如预期的那样协同工作。

您的应用程序的金字塔目前看起来是什么样的，在您计划的 UI 自动化套件之后会是什么样的？它是倒置的，还是沙漏形的？您是否计划编写太多的 UI 自动化测试，因为金字塔的其余部分不在那里？

没有一种类型的测试可以为您提供完整的测试覆盖范围。如果您已经有了现有的单元和集成测试，您可能已经覆盖了您的手动回归测试脚本的步骤。编写复杂的自动化 UI 测试来覆盖已经覆盖的内容没有什么价值。除了用自动化的 UI 测试来取代一对一的手工回归测试，你能不能用不同类型的测试组合来取代它们呢？

### 重温商业工装

回顾一下你为什么选择手工编写自动化 UI 测试。考虑到手写自动化测试的困难，这些理由仍然正确吗？我们放弃商业工具的主要原因之一是担心它不能覆盖我们所有的手动测试套件。几个月的工作之后，手写的 UI 测试写起来非常慢，以至于我们甚至没有在我们希望覆盖的内容上取得任何进展。

### 皮下检测

你写 UI 自动化是为了测试你的 UI，还是为了方便端到端的测试？如果你不需要测试 UI 层，那么皮下测试可能是一个更好的选择。这种方法允许您在 UI 层下一步执行端到端测试。您可以调用事件处理程序并直接在视图模型上设置公共属性，而不是单击按钮或填写文本字段。这种方法避免了与 UI 交互和使用自动化框架的困难。这种方法的缺点是，根据应用程序使用的技术，可能没有很多具体的指导。我们的应用程序是在 UWP 编写的，所以我们必须自己找出如何在模拟 UI 的测试框架中运行它。一旦它开始工作，它被证明比自动化 UI 测试更快更容易使用。

## 结论

UI 自动化的潜在好处是令人兴奋的，发现 bug，释放 QA 时间，消除手动回归测试，并在开发人员冲刺阶段获得反馈。然而，与任何重要的新技术一样，预先做一些调查是必要的。希望上面已经提供了一些在您开始手工自动化您的手工回归测试套件之前要问的问题。它可能不是一个很好的选择，无论是对于你期望发现的回归错误，你的应用程序的架构，还是你期望由谁来编写和维护测试。挑战是存在的:处理不可靠的数据，UI 做的事情超出了您的预期，自动化框架中的不完整和糟糕的错误消息。你需要问谁将编写测试，当情况变得困难时，谁将支持它们。最后，您是否将手写测试与其他可用的商业产品进行了比较，是编写更多的集成和单元测试，还是编写皮下测试？

你写自动化 UI 测试的经验是什么？也许你对我们这些一直在奋斗的人有一些建议？请在下面的评论中告诉我们。
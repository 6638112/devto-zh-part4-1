# 掌握系统设计面试中信封计算的背面

> 原文：<https://dev.to/bootcode/mastering-back-of-the-envelope-calculation-for-system-design-interviews-37je>

信封背面计算:

~一个快速近似的计算，给我们进一步的洞察。

之所以这样命名，是因为你通常可以在信封或餐巾纸的背面进行计算。*注意:对于面试，这些应该称为白板计算。*

##### 我们为什么需要它？

有时，我们面临着在不同架构之间的选择。最简单的，我们可以问一台服务器是否足够？如果不是，我们需要多少台服务器？快速计算给我们一个大概的估计。

一般来说，计算告诉我们

*   如果体系结构能够满足功能需求，例如支持的用户数量、响应延迟，
*   资源需求。

##### 怎么做？

首先，我们需要**识别系统中的有限资源，然后估算实际使用量**。例如，我们的服务器有 2GHz 的 CPU，我们想知道是否可以使用一台服务器满足所有用户的请求。

那么如何近似实际使用情况呢？我们需要**把用法分解成它的构成因素，对那些因素**做一个粗略的估计(如果需要，进一步分解)，并把它们组合起来。

例如，我们可能期望有 1K 个活跃用户，每个用户每天发出 15 个请求。也就是每天 15K 个请求，或者说每秒 15K/86400 个请求。

当组合零件时，**一个技巧是积极地倒圆**。没有人想被 86400 整除。因此，让我们四舍五入到 20K/100K，剩下 0.2 秒的时间可用于服务单个请求。如果我们知道服务一个请求大约需要 0.7 秒，那么我们至少需要启动 4 台机器。当然，您不希望生活在边缘，所以让我们添加一些缓冲，使 10 台机器(这也是一个更好的数字)。

##### 进行快速操作

更喜欢使用小数字和震级的缩写(或者，如果需要的话，指数)，而不是写出一个完整的数字。10K 而不是 10000。

如果给定一个很大且过于精确的数字，例如 7432，立即转换并记为 7K。反正你是在逼近。

拥有这种形式的数字**使得乘法和除法快速**。K*K 是 M。G/M 是 K。4K * 7M = 28G。若要处理较大的数字，请将两者都四舍五入到 2 或 10 的小倍数。

*   27*14 ~ 30*10 = 300.
*   6500/250 ~ 6400/256 ~ 100 * 2^6 / 2^8 ~ 100 / 2^2 = 25.

##### 尺寸要近似

找出典型的有限尺寸，以及下面的练习。

*网络带宽*

假设每台机器 1Gbps 的链接，如果我们每天要抓取 70TB 的网站，一个爬虫系统需要多少台机器？

*存储空间*

存储 100 万个网页的内容需要多少空间？如果我们用一个整数索引代替每个单词会怎么样？64GB SSD 适合多少台机器？

*IO 吞吐量*

你将获取的网页存储在机械硬盘上，随机访问速度有限。用户发出每秒 100 个查询(qps)的请求，每个请求通常返回 20 页的内容。要保持低请求延迟，您需要多少个硬盘？

工程努力。

你需要提供一个新的功能。有 5 个程序员和 40 个任务。离可能发射还有几周？

*钱。*

一个用户每月为你的图像商店服务支付 10 美元，存储他们所有的照片，每张缩小到 3MB。一个月内，一个用户获取 1K 张照片。找到您最喜欢的云提供商的定价页面，并计算每个用户的相关费用。你每个用户的收入是多少？检查不同的假定照片数量。

其他包括 **CPU 时间、RAM 大小、各种延迟**(磁盘访问、RAM 访问、网络)、线程数。

##### 从哪里开始？

列举系统的典型**用例，并确定他们需要的最关键资源**。文档存储需要大量存储空间。猜测文档大小和数量是一个好的开始，但进一步的细节将取决于使用情况。多长时间添加一次新文档？文档可以搜索吗？我们需要指数吗？是写重还是读重的存储？

不同的用例可能需要非常不同的资源。例如，为文档提供服务可能需要大量的 RAM，但不需要 CPU，而对新文档的预处理正好相反。在同构机器上托管所有这些服务会浪费 CPU 和 RAM，因为您需要在两个维度上都达到最大的机器。

这种差异表明，这些特性应该被拆分到不同的服务中，托管在独立的机器集合上。

##### 真实数据

在系统设计面试之外，你可以接触到[实际数据](https://dilbert.com/strip/2010-08-11)。花一些时间挖掘监控仪表板，以获得通常的 CPU 使用情况。执行负载测试以测量峰值 RAM 消耗。运行 SQL 查询以获取用户存储的平均照片数量。

不必非此即彼。如果需要，用数据支持的事实来补充假设。

##### 有用的资源

每个工程师都应该知道的[数字汇总](https://gist.github.com/jboner/2841832)。或者知道去哪里查；)

*注:最初出现在[https://treetide.com/posts/back-of-envelope-calculation](https://treetide.com/posts/back-of-envelope-calculation)，这是我在 [CodeMentor.io](https://www.codementor.io/robinpalotai) 举行的一次指导会议上写的回应。我可以在那里接受一对一的治疗。*
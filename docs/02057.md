# nodejs 的停靠点

> 原文:# t0]https://dev . to/Rubin/docker-for-nodejs-3cjg

Docker 是一个很棒的内容化平台，拥有大量开箱即用的功能。因此，在这篇文章中，我们将跳过传统的使用 pm2 等包的应用程序托管(尽管我们仍然可以在 docker 中使用它)。
首先，我们将从制作一个`Dockerfile`开始。一个`Dockerfile`是打包你的应用程序的一种方式。
你可以通过[链接](https://www.docker.com/get-started)学习 docker 上的基础知识

Dockerfile 的内容将是这样的:

```
 FROM node:10

WORKDIR /usr/src/app

COPY package*.json ./

RUN npm install

COPY . .

EXPOSE 8080
CMD [ "node", "server.js" ] 
```

Enter fullscreen mode Exit fullscreen mode

这将告诉 docker 引擎使用 node:10 映像并执行这些步骤。虽然这个文件是不言自明的，但我还是要做一点解释

*   首先，如果在机器中找不到图像，它将从 dockerhub 中提取图像
*   然后它将使用目录`/usr/src/app`作为项目的工作目录
*   第三，它将把 package.json 和 package-lock.json 复制到工作目录中，并执行 npm 安装，这将依次安装所有需要的依赖项

*   安装完依赖项后，它会将主机中的所有文件复制到容器中。由于容器中已经有了 node_modules，我们可能想跳过它。这可以通过`.dockerignore`文件来完成。认为`dockerignore`与`gitignore`相同，但用于码头工人

样品**。dockerignore** 文件

```
# Logs
logs
*.log

# Runtime data
pids
*.pid
*.seed

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# node-waf configuration
.lock-wscript

dist

node_modules

server/*.spec.js 
```

Enter fullscreen mode Exit fullscreen mode

*   expose 命令将打开容器中的一个端口，后跟端口号，在我们的例子中是 8080。确保这与应用程序使用的端口相匹配

*   CMD 命令将执行传递的命令`node server.js`。甚至可以是类似`npm start`的 npm 脚本。这应该是启动服务器的命令

## 塑造你的形象

转到包含您的 Docker 文件的目录，运行以下命令来构建 Docker 映像。t 标志允许您标记您的图像，以便以后使用 docker images 命令更容易找到:

```
docker build -t <your username>/node-web-app . 
```

Enter fullscreen mode Exit fullscreen mode

## 运行图像

使用-d 运行您的映像会在分离模式下运行容器，让容器在后台运行。p 标志将公共端口重定向到容器内部的私有端口。运行您之前构建的映像:

```
docker run -p 49160:8080 -d <your username>/node-web-app 
```

Enter fullscreen mode Exit fullscreen mode

然而，这种方法并不反映映像构建后您在代码中所做的更改。因此，对于每个更改，您都必须一次又一次地执行构建和运行步骤。

幸运的是，docker 附带了一个叫做卷映射的东西，它不是复制文件，而是用主机上的文件映射工作目录。因此，每次应用程序中的任何文件发生变化时，它也会自动反映在容器中，不需要再次构建映像。
为了使用这种方法，dockerfile 文件变成了

```
 FROM node:10

WORKDIR /usr/src/app

COPY package.json .
RUN npm i
COPY . . 
```

Enter fullscreen mode Exit fullscreen mode

一旦修改了文件，就可以像以前一样构建映像了

不过，要运行构建的映像，有一点小小的变化

```
docker run -p 49160:8080 -v $(pwd):/usr/src/app -d <your username>/node-web-app 
```

Enter fullscreen mode Exit fullscreen mode

`pwd`是在 linux 中获取当前目录的命令，所以确保在 app 目录中使用 run 命令
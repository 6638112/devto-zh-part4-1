# 为什么我们使用 Web 组件

> 原文:[https://dev.to/ionic/why-we-use-web-components-2c1i](https://dev.to/ionic/why-we-use-web-components-2c1i)

由于 Rich Harris 关于为什么不使用 Web 组件的一篇很棒的文章，Web 组件(再次)遍布 Twitter。

Rich 详细介绍了 raw Web Components 标准的许多技术(和非技术)问题，特别是定制元素和 Shadow DOM APIs。Rich 把关于 Web 组件的技术细节*钉在他们自己的*上，但是得出一个我们根本不同意的结论，如果你只是稍微改变你如何看待什么是 Web 组件以及它们应该如何被使用。

注意:这并不是对里奇的攻击。我们是他的超级粉丝，尤其是 [Rollup](https://github.com/rollup/rollup) 为我们的大量开源项目提供了动力，包括 Stencil，我们将在这里详细讨论。也就是说，我们是 Web 组件的主要用户，觉得有必要分享我们的观点！

事实是，如果你在 Web 组件之上添加一个工具或库，比如 [Stencil](http://stenciljs.com/) ，突然之间，几乎所有这些问题都消失了，Web 组件的力量真正闪耀出来。不幸的是，围绕 Web 组件与第三方组件系统(如 React、Angular 或 Svelte)的争论似乎总是将第三方系统与没有工具的原始 API 进行比较，而涉及添加工具以获得相同结果的争论在这场争论中通常是不允许的。

这是不幸的，因为它将焦点放在原始 Web 组件 API 本身不能做的事情上，而不是将这些 API 视为低级的实用程序，如果您愿意在其上添加一些助手，这些实用程序可以转化为真正强大的工具。这也有点不公平吧，因为 React，Angular，Vue，Ember 等。利用工具和助手库在 DOM 之上添加强大的功能，这也是我们首先使用它们的原因。如果不允许工具进入 Web 组件的讨论，我们实际上就陷入了将`document.createElement`与更高层次的组件系统进行比较的困境，这是没有成效的。

考虑到这一点，我想就智能工具如何帮助您解决该帖子中列出的问题提出一些想法，而没有任何真正的缺点丰富的细节，然后谈论 Web 组件解决的目前第三方工具或框架没有解决的实际问题，为什么它们是相关的和重要的，以及为什么今天许多开发人员强烈拥抱它们。

## [](#addressing-the-issues)解决问题

让我们讨论一下 Rich outlines 的一些问题，以及如何通过上面的工具或助手库来解决这些问题。

**服务器端渲染和渐进增强**。就其本身而言，Web 组件不支持服务器端呈现，因此在客户端没有 JS 就无法工作，还有其他相关问题。然而，Web 组件的 SSR 实际上可以通过预先渲染 Web 组件并在客户端重新水合来完成，这甚至可以跨影子根工作！Stencil 提供了这一功能，据我们所知，Salesforce 团队正在为他们的 [Lightning Web 组件](https://developer.salesforce.com/docs/component-library/overview/components)使用一种类似的技术。这使得没有启用 JS 的客户端和搜索引擎能够访问每个组件的完整呈现版本，而不仅仅是标签，从而避免了这个问题。这是[的一个例子](https://twitter.com/adamdbradley/status/1143554342122938368)和[另一个例子](https://twitter.com/jthoms1/status/1144333475035713537)。

**JS**中未样式化内容和 CSS 的 Flash。为了避免无样式内容的闪现，我们可以做一些事情。一种方法是仅在组件被水合和定型后将组件设置为可见。例如，Stencil 跟踪组件是否已经水合，并且仅在它们的父组件已经加载时才显示那些组件。这意味着当一个组件绘制时，它已经完全样式化，所以没有闪光。另一种技术是使用[可构造样式表 API](https://developers.google.com/web/updates/2019/02/constructable-stylesheets) ，如果可用的话，Stencil 会使用它。最后，我们可以跨组件共享样式表信息。这意味着同一组件的多个实例在每个实例中不会有重复的样式数据。有了这些技术，FOUC 就成了过去式。

**老年客户需要 poly fill**。Stencil 自动、动态地计算出哪些客户需要聚合填充，并且仅在客户需要时才加载它们。事实证明，这个数字实际上非常低，因为大多数现代浏览器(和移动浏览器！)完全支持 Web 组件作者使用的 API。这解决了他文章中的第四个问题。

**控制是否呈现分时段内容**。在 DOM 中，元素的加载速度很快，这使得构建某些类型的内容需要缓慢加载的 UI 系统(比如路由器)变得很棘手。控制元素是否被加载的方法是，首先不要把它放在 DOM 中，或者管理如何在特定组件中呈现分时段内容。在顶部有一个渲染助手，比如[模板](http://stenciljs.com/)或者[元素](https://lit-element.polymer-project.org/)会有所帮助。实际上，我们并不认为这是一个大问题，我们已经使用模板构建的 web 组件构建了一个受 React Router 启发的路由器，我们在许多模板 Web 属性中使用这些组件。

**道具和属性混淆**。属性和属性在 DOM 中有一段混乱的历史，Web 组件可以使处理这两者变得更加复杂。然而，像 Stencil 这样的 Web 组件工具或 LitElement 这样的库使构建正确处理组件属性和属性更改的组件变得容易，而不需要大量的样板文件。在上面添加类似 TypeScript 的类型系统可以使处理类型化的 props 变得容易，并且在其他 web 组件内部使用 web 组件(或者通过 JS)使得向 props 传递非字符串数据的问题变得微不足道。

Rich 的属性管理和定制元素样板代码看起来很糟糕，没有开发人员会想写这样的组件代码。幸运的是，如果您将 Web 组件 API 视为低级原语，那么您不必如此。只要使用 Stencil 或 LitElement 或类似的东西，你就能写出看起来像你的框架的代码:

```
import { Component, Prop, h } from '@stencil/core';

@Component({
  tag: 'my-component'
})
export class MyComponent {
  @Prop() age: number = 0;

  render() {
    return (
      <div>I am {this.age} years old</div>
    );
  } 
} 
```

Rich 最后总结道，这些都是已经解决的问题，看起来 Web 组件刚刚开始与第三方组件模型平起平坐。一方面我们同意，另一方面我们认为 Web 组件确实在现有框架上提供了一些有意义的改进。

例如，Stencil 已经证明，使用 Web 组件和智能工具可以帮助你获得一些最小、最快的应用程序。把更多的工作推给浏览器有一些好处！

[![Stencil One bundle size](../Images/de5581e3d79e78461ab72e851aa4d36a.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--feOagVr1--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://ionicframework.com/blog/wp-content/uploads/2019/06/stencil-size-comparison.png)

尽管如此，我们实际上认为围绕 Web 组件的技术讨论不如非技术方面有趣，并且相信通过更好地理解非技术方面，我们可以开始明白为什么 Web 组件是有趣的，以及为什么它们的采用一直在稳步增长。

希望我们也能证明 Rich 的结论，即开发人员对 Web 组件标准基本上漠不关心，是完全不正确的！

## [](#solving-component-distribution-and-integration)求解组件分配和集成

如果 Web 组件仅仅是今天第三方组件模型的一个可怜的替代品，我们就不会在这里为它们争论了。然而，现在我们来谈谈 Web 组件实际上解决的问题和它们没有解决的问题。

当然，web 组件提供了一个本地的 web 组件模型，但是组件模型在前端 Web 开发中非常丰富。每个使用流行前端框架的开发人员都非常擅长在他们选择的框架中创建组件。显然，仅仅提供一个本地 web 组件模型并不能解决一个普遍的问题，这也是反对 Web 组件的一大理由。通常的观点是，第三方框架可以在组件模型上快速创新，而像 Web 组件这样的标准化框架将永远“落后”，并有固化过时方法的风险。

那么，提供本地 web 组件模型实际上解决了什么问题呢？嗯，它解决的最大问题是能够在浏览器中直接共享和使用开发人员创建的组件，而不管应用程序技术如何，并且是以一种非常高效的方式。

这实际上是团队面临的一个现实问题，但是你的团队可能没有这个问题！您是否在具有多种当前和未来前端技术选择的团队中构建和使用组件？你的公司使用 React 但是刚刚收购了一家使用 Angular 的公司吗？你是否需要将一个设计系统整合到一个传统的服务器渲染系统中，比如 JSP/ASP。NET/PHP/等。？您是否需要向没有运行传统“框架”的遗留 web 应用程序或 CMS 添加基于 JavaScript 的现代组件？你正在构建一个像 Ionic Framework 一样的 UI 框架，需要在任何前端技术中工作吗？

这些都是 Web 组件唯一能解决的问题，对于有这些问题的团队来说，没有什么能解决它们。事实上，如果你正在构建一个可重用的 UI 库，而不使用 Web 组件，那么从长远来看，你将面临一个伤害和明显受限的可寻址市场的世界，相信我们！

## [](#whos-using-web-components-today)如今谁在使用 Web 组件？

在 Web 组件的争论中，经常出现的一个问题是缺少 Web 组件使用的生产实例。

我们有一些我们认为展示了 Web 组件独特解决的问题。

先说[离子框架](https://ionicframework.com/)。Ionic Framework 最初是 AngularJS 的移动 UI 库，两年前经历了一次彻底的重写，转向了一个可以在任何基于 web 的前端环境中工作的组件模型，我们称之为 Ionic 4。我们受到业务指标的推动，如增长我们的社区和可寻址市场，以及技术动机，如不必为明天的框架重新编写 Ionic，以及大幅提高负载和渲染性能。我很自信地说，Ionic Framework 4 是最成功的基于 Web 组件的设计系统/UI 框架，凭借这一点，Web 组件现在出现在数以千计的 app store 应用程序中，并且每年有近 400 万个新的 Ionic Framework 项目被创建。这是一些严重的 Web 组件使用！最重要的是，Ionic Framework 4 开发人员可能甚至不知道他们正在使用 Web 组件，因为他们无缝集成在 Angular 以及我们即将推出的 React 和 Vue 支持中。

除了 Ionic 之外，今天我们有很多使用 Web 组件的创业公司和大型企业。在创业方面，流行的锻炼应用 Sworkit 最近[推出了他们新的 PWA 和使用 Ionic Framework 4 的原生应用](https://twitter.com/Corysmc/status/1133024548985565184)，在网络上和应用商店中都使用了 Web 组件。

你很难找到一个比 Salesforce 更大的例子，sales force 最近[将他们的 Lightning 组件转移到 Web 组件](https://developer.salesforce.com/docs/component-library/overview/components)，并且是基于 Web 组件的设计系统的先驱。

另一个例子是上市公司 Upwork，他们最近在主页上发布了用模板构建的 Web 组件。

政府也开始参与进来！密歇根州最近推出了一个基于网络组件和模板的设计系统。

最后，Stencil[越来越多地推动我们在 Ionic](https://twitter.com/maxlynch/status/1138896430884671489)的大部分业务。我们最近签约了几个知名企业客户，他们的主题都是模板和 Web 组件有助于解决他们在许多属性和团队中遇到的主要组件分发和创建问题，这些属性和团队通常没有使用一套规定的前端技术。我们希望将来能够谈论更多这样的例子。

## [](#competing-visions)争奇斗艳

Web 组件生态系统有各种各样的参与者，他们对 Web 组件能够做什么和应该做什么有着不同的长期愿景。

其中一些人认为 Web 组件应该取代第三方应用框架。其他人认为 Web 组件更适合叶子/风格/设计节点，不应该介入应用程序的组件系统。还有一大群应用框架开发者根本看不到这一点，或者认为 Web 组件是对前端创新的冒犯。

我们处于中间的某个位置，并不声称代表这个空间中的每个人。我们的长期愿景是，应用程序开发团队继续使用他们选择的框架，我们希望它继续变得更好、更小、更高效，并越来越好地支持定位和消费 web 组件(随着公司继续将 Web 组件用于共享设计系统，大型团队将消费越来越多的 Web 组件)。

同时，我们相信 Web 组件的杀手级应用程序正在解决组件分发和设计系统的问题。我们也相信 90%的市场没有这些问题，并且发现当前关于 Web 组件优点的争论有点徒劳。

奇怪的是，从商业角度来看，这个市场的形状确实很吸引人。大规模设计系统是大型团队和公司特有的问题，这意味着这里有一个自然强大的企业业务！

## [](#conclusion)结论

Web 组件是一项有争议的技术，有很多支持者和反对者。我们同意整个标准还有改进的空间，并希望 Rich 的文章和其他文章能够帮助浏览器厂商改进标准。

我也明白，我们的许多反驳意见不会让那些坚持认为 Web 组件只有在支持框架特性时才是现成的，而不需要任何额外工具的开发人员满意。

也就是说，我们一直认为 Web 组件是一种底层技术，当与适当的工具和库(如 Stencil 或 LitElement)配合使用时，我们对它们的强大感到惊讶。对于需要这一切的团队来说，我们真的认为 Stencil 是最好的解决方案，它将为您提供您想要的框架的一切，并结合了一些真正强大的功能，这些功能在您今天选择的框架中可能找不到，包括最小的代码包、SSR/预渲染、最佳 PWA 性能和高级延迟加载。for teams Stencil 可以从您的组件自动生成文档，运行可视化 UI 回归测试，并为 Angular、React 和 Vue 生成本机包装器。你可以在我们的 [1.0 公告帖](https://ionicframework.com/blog/introducing-stencil-one-1-0-0/)中了解更多信息。

Web 组件解决了一系列非常特殊的问题，而这些问题是许多团队(尤其是小团队)所没有的。对于那些团队来说，创建 Web 组件只会给他们的应用框架的组件模型带来边际价值。然而，随着 UI 库和设计系统作者[接受标准](https://ionicframework.com/blog/build-your-next-design-system-with-web-components/)及其比任何其他前端技术更好地解决特定问题的能力，我们预计这些团队将越来越多地使用 Web 组件。

对于确实存在这些问题的团队来说，没有其他技术能够充分解决这些问题，因为没有其他技术能够直接在浏览器中得到支持。今天，这些问题主要出现在对特定前端技术的使用没有严格规则的大公司，或者针对更广泛的 web 开发生态系统的团队，在这些地方没有单一的前端技术真正接管(没有，甚至没有反应)。

如果你是这些团队中的一员，我们希望你能认真看看 Web 组件能做什么，只要你给他们一点帮助。我们有信心说，Web 组件是 Ionic 作为一家公司和开源 UI 设计系统的创造者所经历过的最好的事情，我们希望如果你有这里谈到的任何问题，你可以看看它们！
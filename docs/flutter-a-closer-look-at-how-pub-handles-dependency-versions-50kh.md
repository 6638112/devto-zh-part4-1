# 仔细看看 Pub 是如何处理依赖版本的

> 原文：<https://dev.to/mainawycliffe/flutter-a-closer-look-at-how-pub-handles-dependency-versions-50kh>

在这篇文章中，我想仔细看看 dart pub 如何处理依赖版本。最终目标是帮助你理解如何巧妙地管理你的 flutter 依赖版本。所以，事不宜迟，我们开始吧。

### Dart Pub 如何处理依赖关系

Dart 包管理器(PUB)不允许同一依赖项的多个版本。相反，它使用版本约束，在您有两个依赖项依赖于同一依赖项的不同版本的情况下，为您提供了灵活性。

这意味着，您将指定一系列可以与您的应用程序或库一起工作的版本，而不是依赖项的特定版本。例如，如果两个依赖项需要相同但不同版本的依赖项。那么使用版本约束会增加指定版本范围重叠的机会。使用两个包版本要求重叠的最新版本。

例如，假设您有两个依赖项。其中第一依赖依赖于版本范围为`1.3 to 1.8`的`package-x`。而第二个依赖依赖于相同的`package-x`但是在版本`1.6 to 2.0`之间。在这种情况下，dart 包管理器将安装版本`1.7.x`，其中 x 是最新的补丁版本。这是因为这是两个依赖项所依赖的最新版本。

这在一个完美的世界中运行良好。但是我们生活的世界并不完美。在某些情况下，您可能会发现依赖项版本范围没有重叠。在这种情况下以及其他类似的情况下，你可能不得不选择一个依赖关系。

这只是 dart pub 包如何工作的概述，你可以在这里找到详细的文档。

### 语义版本化

为了使用版本约束，你需要知道哪些依赖项的未来版本不会破坏你的应用或库。这就是语义版本控制的用武之地。语义版本提供了如何升级依赖关系的指南。使用语义版本化，依赖版本是 X.Y.Z 的形式，其中 X 是主要版本，Y 是次要版本，Z 是补丁版本。更多信息，请查看语义版本的完整文档[这里](https://semver.org/spec/v2.0.0-rc.1.html)。

使用语义版本控制，当向后兼容的特性被添加到公共 API 时，次要版本就会增加。如果一个非向后兼容的特性被添加到公共 API 中，那么主版本就会增加。并且仅当引入向后兼容的错误修复时，补丁版本才增加。

记住这一点，您可以为您的库和应用程序完整版指定依赖项的版本约束，知道次要版本或 parch 版本不会破坏任何东西。你可以在这里了解更多关于语义版本[。](https://semver.org/spec/v2.0.0-rc.1.html)

> **NB:** Pub 使用语义版本化的 2.0.0-rc.1 版本，它允许包使用构建标识来区分不同的版本。这就是为什么你会遇到类似于`X.Y.Z+12345`的依赖版本。
> 
> **注意:**当主版本为零时——即`0.1.5`——dart 约定稍微偏离语义版本化。相反，上面的 X.Y.Z 解释向下移动了一个槽。这使得 Y 的行为像主要版本，而 Z 像次要版本。
> 
> 为了指示补丁版本，使用构建标识符，即`0.Y.Z+1`。这与修补程序版本的行为相同。
> 
> 这是因为在版本 1.0.0 之前，语义版本控制不保证版本之间的兼容性。另一方面，Dart 承诺不同版本之间的版本兼容性。

### 依赖的类型

Pub 支持两种类型的依赖——常规依赖和开发依赖。开发依赖是那些不属于应用程序或库的依赖，而是用于开发工作流的依赖。例如，测试依赖—`mockito`或`tests`—用于运行测试，或者生成器依赖，用于为您的应用程序生成 PODOs。常规依赖是在应用程序和库中使用的依赖，也就是说，它们对应用程序的运行很重要。

### 如何给你的应用添加依赖关系

您将依赖项添加到位于应用程序根目录下的`pubspec`文件中。这是在创建新的 flutter 应用程序时自动生成的。常规依赖项添加在`dependencies`字段下，而开发依赖项列在`dev_dependencies`字段下。点击可以了解更多关于`pubspec`文件[的字段。](https://dart.dev/tools/pub/pubspec)

要在 dart 中添加依赖项，只需指定依赖项的名称和想要使用的版本。

```
dependencies:
  flutter:
    sdk: flutter
  font_awesome_flutter: 8.4.0
  bloc: 0.14.4
  flutter_bloc: 0.18.3 
```

Enter fullscreen mode Exit fullscreen mode

对于依赖关系很少的应用程序，您可以指定一个确切的版本，并在新版本发布时手动更新。另一方面，您可能希望使用版本约束来获得最新的包，而不需要手动更新您的`pubspec`文件。因为 dart 使用语义版本控制，所以很容易预测在不破坏任何东西的情况下，您可以在您的应用程序中使用哪个未来版本的依赖项。

如果您正在开发 dart/flutter 库，强烈建议使用版本约束。正如我们上面讨论的，它给了你的库与应用开发者正在使用的其他库很高的兼容性。

要指定版本约束，可以使用如下所示的`greater than (>)`、`less than (<)`、`greater than or equal to (>=)`和`less than or equal to (<=)`符号:

1.  `>=1.0.0`–大于或等于`1.0.0`的任何版本–即`bloc: >=0.14.4`。
2.  `>1.0.0`–任何大于`1.0.0`的版本–即`bloc: >1.0.0`。
3.  `<=1.0.0`–小于或等于 1.0.0 的任何版本，即`bloc: <=1.0.0`–设置安装为版本 1 的版本上限，以及低于版本 1 的任何版本。
4.  `<1.0.0`–任何低于 1.0.0 的版本，即`bloc: <1.0.0`–除了不包括 1.0.0 版本之外，基本上与上述相同。
5.  `any`–该依赖关系的任何版本–出于性能原因，不推荐使用。与将版本部分留空相同，但更加明确。

除此之外，您还可以组合上述版本约束，为依赖关系提供上限和下限。例如:`bloc: '>=1.0.0 < 2.0.0'`它将您的 bloc 包的版本限制在 1 到 2 之间。这是特别推荐给图书馆的。

#### 插入符号语法(`^version`)

您可能遇到过这种情况，在依赖版本的前面有一个插入符号-`^version`。这提供了一种表达上面讨论的公共版本约束的简单方式。使用插入符号语法时，您将版本约束设置为大于或等于列出的版本，但小于下一个主要版本。你只是不想安装一个有重大改变的版本。例如，`^1.2.3`相当于`>=1.2.3 <2.0.0`，而`^0.1.2`相当于`>=0.1.2 <0.2.0`。

### 提示

对于库，建议不要提交依赖关系`lockfile`。另一方面，对于应用程序，您应该提交依赖关系`lockfile`。提交应用程序的`lockfile`的原因是为了确保所有的开发人员都工作在完全相同的依赖版本上。`lockfile`只在你升级依赖项(`flutter pub upgrade`)时更新，而不是在你获得包(`flutter pub get`)时更新。你可以在这里了解更多关于该做什么和不该做什么。

### 最后的想法

库是使用版本约束的最大受益者。如果你有一个 flutter/dart 库，你应该切换到版本约束。对于应用程序，我也认为使用版本约束是有益的。

例如，您可能希望在可用时安装某个依赖项的次要版本和补丁版本，而不必自己手动跟踪它们。这允许您运行`flutter pub upgrade`，它将在`pubspec`文件的版本约束内更新`lockfile`中的依赖版本。

> **注意:**对于 flutter 应用程序，你不应该使用`pub get`或`pub upgrade`命令来管理你的应用程序的依赖关系。相反，你应该使用`flutter pub get`或`flutter pub upgrade`。

这就是我说的，如果你有任何问题或批评，请使用下面的评论区。你也可以在 [twitter](https://twitter.com/coding_latte) 上关注我，或者加入我的 [slack workspace](https://forms.gle/PdD4RcAS8kK6TMbF9) 。我尽我所能提供帮助。

谢谢你。
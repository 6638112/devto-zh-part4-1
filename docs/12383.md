# 伟大的 Azure DevOps 迁移-第 2 部分:设置

> 原文:[https://dev . to/timothymcgrath/the-great-azure-devo PS-migration-setup-5d 7 I](https://dev.to/timothymcgrath/the-great-azure-devops-migration-setup-5d7i)

成功的 Azure DevOps 迁移的第一步是设置您的临时虚拟机。我想将我的迁移与我的实时 TFS 服务器完全隔离。

*如果你错过了介绍文章，在这里[赶上](https://scribblesofcode.com/2019/07/13/the-great-azure-devops-migration/)。*

*我强烈推荐[微软的 Azure DevOps 服务迁移指南](https://azure.microsoft.com/en-us/services/devops/migrate/)* 。

### [](#why-a-staging-vm)为什么要暂存虚拟机？

*   在导入 Azure DevOps 之前，我需要从我的 TFS 回购中删除一些代码。
*   我需要对项目模板进行一些修改，以通过验证。我不希望这些改变影响我的 TFS 服务器，以防我需要回滚。
*   我希望 TFS 服务器成为我删除代码的备份，以防我们需要再次访问它。

这些要求使得将我的暂存虚拟机与我的活动虚拟机完全隔离是最安全的。

### [](#but-first)但是首先...

需要做的第一件事是更新您现有的实时 TFS 服务器，以使用最新版本的 Azure DevOps Server。您需要在最新的两个版本中才能成功迁移。所以，在开始这个过程之前，更新你的 TFS 服务器。

### [](#setup-the-new-vm)设置新的虚拟机

第一步是设置将托管迁移的虚拟机。最安全的方法是不要克隆现有的虚拟机，而是从头开始设置一个新的虚拟机。这是因为克隆虚拟机将跨越指向您的实时 TFS 虚拟机的路径。

#### [](#server)服务器

以后省点力气，安装最新的 Windows Server 版本就行了。我最初使用的是我的 live TFS 服务器正在使用的版本(2012)，但是你以后需要一些工具，这些工具需要更高版本的 Windows Server。所以，现在安装最新的，它会工作得很好。

你还需要大量的硬盘空间。在这个过程中，我最终增加了大约 4 倍的服务器大小，因为我一直意识到我需要更多。给它足够的空间来开始。对于最后的导入，我将其设置为 1 TB。

#### [](#sql-server)SQL Server

安装与实时 TFS 服务器使用的 SQL Server 版本完全相同的 SQL Server。还要安装管理工具。你以后会需要的。

#### [](#install-iis)安装 IIS

访问新的 TFS 安装需要 IIS。从 Windows 功能安装它。

#### [](#install-azure-devops-server)安装 Azure DevOps 服务器

安装与您在实时 TFS 服务器上使用的 Azure DevOps 服务器版本完全相同的版本至关重要。我最初装的是 2019，后来不得不回去装 2019.0.1。它们必须完全匹配。

安装后，关闭启动对话框，我们将使用备份。

#### [](#take-full-backup-of-live-tfs-server)对 TFS 服务器进行完整备份

最好的方法是使用内置的 SQL 备份工具。我实际上并没有在 TFS 服务器上使用它，但是我想在这个过程中使用它，因为它是最简单的。

要使它工作，只需将 TFS 服务器上的 TFS 数据库临时改为完全备份(如果它们还没有)。在定时备份(在实时 TFS 服务器上)中，使用“立即执行完整备份”。

备份完成后，将其复制到新的临时服务器的 c 盘上。

如有必要，请务必将 TFS 服务器的备份设置更改为初始设置。

#### [](#hosts-file-if-youre-scared)主机文件(如果你害怕...)

如果您害怕意外影响您的实时 TFS 服务器(像我一样)，您可以通过阻止从临时迁移服务器访问您的实时 TFS 服务器来获得额外的安全。

打开 C:\ Windows \ System32 \ Drivers \ Etc \中的 hosts 文件，添加两行:

```
127.0.0.1 <LIVE TFS SERVER NAME>
127.0.0.1 <LIVE TFS SERVER NAME>.<DOMAIN>.local 
```

这将把对您的实时 TFS 服务器的任何调用都指向您的临时服务器。

嚄....感觉已经安全了！

#### [](#still-scared-shutdown-the-live-tfs-server)还怕？关闭实时 TFS 服务器

如果你仍然害怕，你也可以在做大的改变时关闭 TFS 服务器，比如删除旧代码。

我最大的担心是我不小心登录了错误的虚拟机，并在实时 TFS 服务器上运行命令。或者我点击了浏览器中的一个书签，不知不觉地把我带到了 TFS 直播服务器。

出于这些原因，在这个过程中关闭 TFS 服务器可能是值得的(如果可能的话)。如果你不能做到这一点，删除代码时要非常小心。

#### [](#restore-backups)恢复备份

回到临时服务器，使用 Azure DevOps 管理工具恢复 C:上的备份。

在定时备份中，选择还原数据库。这将为您处理 SQL 恢复。

#### [](#configure-azure-devops-service)配置 Azure DevOps 服务

现在，在 Azure DevOps 配置中心，配置安装。使用现有数据库，当系统询问时，选择配置为克隆。这将调整数据库中的所有网址，使它们不指向你的 TFS 服务器。

我在这个 TFS 安装中使用了与我在 TFS 服务器中使用的相同的服务用户，但是为了更加安全，你可以为这个临时服务器设置新用户。

#### [](#visual-studio-2019)Visual Studio 2019

需要的最后一步是安装 Visual Studio 2019。这在以后访问 TFS 司令部和 SSDT 司令部时会用到。

### [](#whats-next)接下来是什么？

我们现在已经设置好了临时迁移服务器，并准备开始清理要导入的数据。

下一步，我将删除我们不想移动到新 Azure DevOps 服务的数据。这将减少我们的进口规模，给我们一个干净的最终设置。
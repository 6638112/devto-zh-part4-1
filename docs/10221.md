# 健康的代码库需要的一个文化特征

> 原文:[https://dev . to/stepsize/the-one-cultural-character-you-need-for-a-healthy-code base-348n](https://dev.to/stepsize/the-one-cultural-characteristic-you-need-for-a-healthy-codebase-348n)

口头上支持公司文化很容易。但很少有公司会积极考虑那些对业绩有重大影响的少数文化特征——因为这是最难的部分。

对于软件团队来说，到目前为止，工程健康的最大预测者是所有权。在这份实用指南中，我们将考察如何将这一原则融入到你的工程团队的日常工作中，以便你的代码库能够自我保护。

作为 Stepsize 日常工作的一部分，我有幸遇到了一些世界上最好的工程师。当与 Skyscanner、Spotify、Palantir 等公司的顶级工程师讨论技术债务是如何产生的。，一个主题不断出现:所有权。

在高度协作、快速发展的工程团队(即现代团队)中，工程师可以致力于代码库的任何部分，代码很容易积累并成为弗兰肯斯坦式的怪物。当事情变得足够糟糕时，必须有人像惊奇队长一样突然出现，通过大规模重构来修复它们。

为了避免这种情况，工程团队试图遵循罗伯特·c·马丁(Robert C. Martin，即“鲍勃叔叔”)的许多明智建议之一，“童子军规则”:*让代码比你发现的更好*。[这里有一个免费的 VSCode 扩展，让你做起来更容易](http://bit.ly/VSCode-marketplace-Stepsize)。

然而，尽管工程师们有着高超的技术和良好的意愿，但似乎软件开发的一个不变法则是，技术债务会越积越多，直到无法承受，我们不得不腾出时间来进行一次大的重构。我们已经不情愿地接受这是软件开发生命周期的一部分。

这仅仅是因为缺乏纪律吗？我以前也这么认为。然后我遇到了 [Snyk.io](http://snyk.io) 的首席建筑师加雷思·维萨吉，他给我留下了这样的印象:

> 所有权是工程健康的主要指标。

他是什么意思？他怎么能这么说呢？

有大量的研究表明，当团队成员拥有自己的工作，被经理问责，并对成功和失败负责时，各种好事都会发生。

不幸的是，这在实践中很难实现。这部分是由于这样一个事实，有争议地，[工程生产率不能被测量](https://martinfowler.com/bliki/CannotMeasureProductivity.html)，并且现代工程实践可以被解释为在所有情况下都支持弱代码所有权。事实是，直到现在，在工程团队中恰当地测量所有权是非常困难的。。。所以我们甚至不知道“好”是什么样子。

幸运的是，[最近的学术研究](https://docs.microsoft.com/en-us/azure/devops/learn/devops-at-microsoft/code-ownership-software-quality)表明，代码所有权——工程团队中模糊概念“所有权”的最佳代理——可以从 Git 提交活动中测量。这是代码库健康状况的一个很好的先行指标。

代码库中那些接受很多人贡献的部分会随着时间的推移而积累，而那些接受较少人贡献的部分往往会处于更好的状态。不要仅仅相信我的话——微软的好人自己也调查过这个问题。

[![](../Images/1fb5f273ea0ef4cf2781815d58d029de.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--2dz93AAV--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://blog.stepsize.com/content/images/2019/07/image.png)

*鸣谢:微软研究院*

我已经可以听到你们中的一些人在尖叫，你们不希望只有一个开发人员被允许接触一段代码——这有令人讨厌的缺点。我听到了，这不是我们的提议。

听我说完。

## [](#types-of-code-ownership)代码所有权的类型

有不同类型的代码所有权，适用于不同的情况。

### [](#collaborative-ownership-vs-nonownership)合作所有权与非所有权

合作所有权。。。]一种所有权，代码是集体所有的，但是责任和进度是明确的。每个团队成员可以根据需要跨子系统或服务工作。*

**非所有权** -【。。。]几个开发人员对同一个子系统进行变更，但在质量或团队沟通方面很少协调或负责的情况。在这样的系统中，人们可能会认为质量很低。*

*来源:[微软研究院](https://docs.microsoft.com/en-us/azure/devops/learn/devops-at-microsoft/code-ownership-software-quality)T3】*

我们可以进一步细分，将孤立代码和绝对所有权添加到组合中，但我不想埋没 lede，所以这里有一个图表说明代码所有权范围:

[![](../Images/3c62513e55fc6dbb6ebe93a2bab7e411.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--jCP0zsVe--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://stepsize.ghost.io/content/images/2019/07/Ownership-spectrum.png)

**协作所有权**应该是你在大多数情况下的默认设置，也是你努力追求的目标。请注意，这并不意味着团队中只有一个工程师有权修改代码，或者他们的批准对于任何修改都是强制性的。这仅仅意味着每个工程师都绝对清楚如果他们有任何问题应该找谁，并且所有者可能是审查代码的最佳人选。通过这种方式，他们可以强制执行编码标准，并且知道他们所拥有的代码是如何被修改的。

代码所有者对他们代码的状态负责，管理者应该让他们对此负责。这并不意味着他们应该为每一个爬进来的 bug 而受到打击，但这确实意味着代码所有者有权做出与代码质量和技术债务相关的决定；他们将使用额外的支持性指标，如内聚性和流失率，对这些决策负责(详见我们的文章[关于技术债务指标](https://blog.stepsize.com/use-research-from-industry-leaders-to-measure-technical-debt/))。

无所有权或弱所有权与协作所有权相反，在大多数情况下应该避免。话虽如此——这可能是显而易见的——如果像 package.json 这样的文件没有明确的所有者也没关系。没必要过分热心。

孤儿代码
这是令人讨厌的非所有权类型，是代码所有权谱系中的一个极端。才是你真正不想要的。不惜一切代价避免它。。。除非这是你永远不会再碰的代码。但这很少见。

当主要贡献者停止贡献代码库时，代码被认为是孤立的。他们可能已经离开了组织，或者从编码部门转到了管理层。不管怎样，你和你的代码库都有麻烦了。

但是这也有一个解决方案。您需要将孤立代码转换为最适合它的任何其他类型的所有权。为了避免您的代码库中有任何孤立的代码，请确保您的离开和移交计划包括主要所有者让新代码所有者跟上速度。通过自动分配他们来检查修改代码的拉请求，使他们放松。如果做不到这一点，您可以简单地分配代码所有权，只要您认为合适。

无论您选择哪种方法，都不要让孤立代码在您的代码库中游荡。你永远不知道如果听其自然会发生什么。

绝对所有权
这是代码所有权谱上的另一个极端。它可以是奇妙的。它也可能带来麻烦。

当所有者是唯一可以修改或批准修改的工程师时，或者当所有者实质上是过去唯一修改过代码的工程师时，代码被认为是绝对拥有的。

小型创业公司经常在他们的数据中看到这种模式。每个工程师倾向于负责一个文件的全部历史，并被期望保持这种所有权。这不是世界末日。创业公司毕竟资源有限，需要做出牺牲。但是如果工程师被公共汽车撞倒，这部分代码将会被遗弃。你应该有一个应急计划。

在较大的工程组织中，低“总线因子”可能是一个真正的问题，尤其是当它涉及代码库的关键部分时，当员工流失率高时，以及如果公司承担了太多的技术债务时。例如，如果拼凑你的整个定制支付系统的工程师离开了，如果你想修改你的定价模式，或者如果你意识到代码库中有一个错误，几个月来一直对你的最大客户少收费，你会非常头疼。要么有人必须尝试理解代码来修改它，要么你必须宣布你的支付系统技术破产并重写它(但在你这么做之前，[请考虑这个](https://www.joelonsoftware.com/2000/04/06/things-you-should-never-do-part-i/))。

不要让它发生在你身上。

但是在某些情况下，绝对所有权是可以接受的，甚至是值得推荐的。你可能希望对那些“如果这件事失败了，我们可以打包走人，因为公司无法支付我们的薪水，或者因为我们要进监狱”的代码部分拥有绝对的所有权。

在这些情况下，即使您想在几个工程师之间传播关键代码的知识以维持一个健康的总线因子，您也可能想考虑设置规则来防止 PR 在没有绝对所有者批准的情况下被合并。

## [](#takeaways)外卖

争取代码库中绝大多数文件的协作所有权(任何给定文件 50% - 90%的代码所有权)，并在适当的情况下更加严格地增加代码所有权并减少技术债务。

### [](#benefits-will-include)好处将包括:

**编码标准更高，维护得当。**在一个信息灵通的小团队中，更容易保持高标准。这不仅适用于修改他们自己的代码的工程师，也适用于当他们的同事的代码修改了他们自己的领域时对他们的代码进行审查。

**更容易沟通。**清晰明确的所有权意味着团队中的每个工程师都知道谁最适合回答他们的问题。

更集中、更有影响力的重构。当你决定偿还一些技术债务时，强大的代码所有者最适合这项工作。[使用所有权、内聚性和代码流失度量](https://blog.stepsize.com/use-research-from-industry-leaders-to-measure-technical-debt/)对代码库中的问题区域进行三角测量。你的工程师将[明智地使用他们的技术债务预算](https://blog.stepsize.com/how-to-stop-wasting-engineering-time-on-technical-debt/)，他们再也不会浪费时间偿还错误的技术债务。

公车因素永远不会失控。您可以使用代码所有权来通知组织内的知识共享。如果所有权太高，将其他工程师分配到代码审查和修改有问题的代码的任务中。您将逐渐提高您的所有权分数，这将导致代码质量的提高和技术债务的减少。

像任何值得做的事情一样，创建并坚持代码所有权的工程文化需要时间和努力，但它会得到回报。它直接影响你能想象到的几乎任何工程健康 KPI。将它融入到你的文化中，它将成为一个巨大的长期竞争优势。

* * *

**此外，我们还开发了一款 SaaS 产品来为您完成所有这些工作，您可以在这里试用一下:)**
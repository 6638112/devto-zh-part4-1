# 代码重构:何时离开，何时留下

> 原文:[https://dev . to/technola aji/code-refactoring-when-to-leave-when-to-stay-4 AOB](https://dev.to/technolaaji/code-refactoring-when-to-leave-and-when-to-stay-4aob)

众所周知，在大多数公司，很难向非技术人员解释什么是代码重构

通常我会说，我正在修复一些错误并增强应用程序，因为我找到了一种使它更快、更容易维护的方法

当然，我总是被同样的问题困扰:

*   “你当初为什么不这么做？”
*   "所以我们所有的客户端应用程序都需要重构？"
*   “你为什么不花时间和你的 scrum jedi(对刚懂 scrum 的人的昵称，也被称为 scrum 大师)相处，并在几个月前把代码做得更好？
*   “你不会浪费几天时间做这个吧？因为我们还有其他重要的事情要做，你说的这个没意义！”

抱怨的例子不胜枚举，但是如果你想责怪某人的行为:你必须责怪团队中的每一个人，而不仅仅是参与这个项目的开发人员

# [](#say-again-why-everyone-on-the-team-should-be-blamed-)再说一遍？为什么团队中的每个人都应该受到责备？😮

为了简单起见，为什么不用一个真实的案例来解释呢(它确实发生在我身上)，好吗？

假设您的客户想要一个销售手工篮子的网站，您在 Adobe XD 上获得网站外观的初步设计

你计算了你需要工作的所有特性和方面，结果是需要 1 个半月才能完成

然后，客户回复销售部门，他将使用一个外部服务来处理库存管理，这个服务给他一个用于店内支付的读卡器

客户没有告诉销售部门该服务可能/可能不提供在线支付的 web 解决方案，销售部门没有询问客户也没有研究该服务以了解它是否可以执行该操作**(错误一:没有获得足够的信息)**

但是销售部门(没有与开发人员交谈)急切而自豪地告诉客户，这将为我们的开发人员节省时间，所以我们将时间减少到一个月**(错误二:没有咨询团队的其他成员就做出决定)**

第二天，销售部门在 slack 上向开发人员发送了一条消息，仅仅是服务的 url，并说:“使用这个，客户希望在网站上使用这个服务”**(错误三:缺乏澄清)**

scrum jedi 说，如果我们努力工作，我们仍然可以在一个月内完成**(错误四:当错误将要发生时，没有站出来支持团队，也就是不现实)**

开发人员开始在网站上工作，由于时间的限制，为了按时完成，很多东西需要妥协**(错误五:为了时间而妥协干净的代码，显然以后会后悔)**

月中，客户向销售部门发送电子邮件，称这项服务将花费他很多钱，并找到了另一项同样服务，但花费更少

售楼部告诉客户，这不是问题，开发商可以在规定时间内处理**(错误六:没有兑现对客户的承诺)**

写出来的代码太糟糕了，以至于仅仅添加一个特性就能让它与新服务一起工作需要花费很多时间**(错误七:糟糕的代码很难改进或改变)**

一个月过去了，网站还没有完成

客户对公司和给予他的承诺感到不满，因此他将起诉公司，因为他购买和库存的篮子花了他很多钱来储存它们，而场地还没有准备好(谈论每月 4000 美元的储存空间和价值 50，000 美元的物品)

销售部门向客户道歉，并承诺放弃部分付款，只是为了不产生费用**(错误八:当你不做作业时，有人会为此付出代价)**

首席执行官对 scrum master、开发团队和销售部门感到失望，以至于不再支付加班费

设计部门想要摆脱“加班没有报酬”的局面，所以他们为网站发送了一个新的复杂设计，这样他们就可以给 CEO 和客户留下深刻印象**(错误九:试图炫耀)**

销售部门向客户展示新设计，客户同意了，因为他免费获得了新的和额外的功能(作为一种道歉的方式)

在代码方面，由于已经做出的妥协，添加额外的功能几乎是不可能的，但是对于新的设计:让代码适应新的设计比抛弃它并重新开始需要更多的时间**(第十个错误:编写糟糕的代码很有可能被抛弃)**

五个月后，网站还没有完成

## [](#what-can-we-learn-from-this)我们能从中学到什么？🤔

如果项目时间没有减少，并给出一个实际的最终期限，那么开发人员就可以从一开始就专注于编写干净的代码，并且不增加更多的设计约束也更有意义

但是这个世界是没有阳光和彩虹的，你也很可能为这样的人工作(可能，不是说你会，但不是所有的事情都会从第一天开始向你展示)

我所做的是，我离开了公司，因为责任在我们(开发人员)身上，但很明显这是整个团队的问题(一个人的自我忍不住把责任推给自己，所以推给别人)

即使在我离开之后，处理代码仍然是一个绝对的噩梦，并且仍然不可维护

重构它是浪费时间

# [](#why-should-we-refactor)为什么要重构？🤔

重构代码不依赖于一件事，而是依赖于多个场景:

*   更新库并使其适应您的代码库
*   使代码比以前运行得更快，占用的资源更少
*   使代码更具可读性和可伸缩性

这样的例子不胜枚举

我们面临一个问题，我们不知道什么时候离开这段代码，什么时候重新开始，或者什么时候添加新的内容

# [](#the-dip)下探🗻

在塞思·戈丁的名为“The Dip”的书中(goodreads link:[https://www.goodreads.com/book/show/324748.The_Dip](https://www.goodreads.com/book/show/324748.The_Dip)

他解释说，我们都是从一个小悬崖(最著名的是蜜月阶段)开始的，在那里你会觉得自己站在世界之巅

然后你滚下一个小斜坡，这就是事情变得有趣的地方

看，当你滚下斜坡后，你有两个选择:

*   要么爬上另一个更陡峭的悬崖
*   深入到一个死胡同(或者他称之为死胡同)

但我们大多数人的问题是，我们害怕爬上另一个悬崖，所以我们选择更深地潜水

但事实上，我们梦想爬上那个悬崖

# 我们执着于某样东西是因为我们对它有感觉💟

通常被称为“舒适区”,实际上这是一个地狱般的区域

它阻止你前进，在那里你开始希望得到东西而不是实现它们

我们对那些不可维护的代码持有伤感的情绪，因为我们对它感到舒适

我们将很难放手，但有时你必须拿起猎枪，直接向项目的正面射击

# [](#it-is-okay-to-leave-you-know)离开你就知道没事了😶

回到“下降”这本书，赛斯也解释说离开并找到另一个悬崖是完全没问题的

如果面临死胡同的可能性很高，那么离开是正确的选择

同样的事情也发生在代码上，如果你试图重构你的代码，当你继续下去的时候，你会面临很多错误，那么在代码上浪费时间可能会导致一个永无止境的死胡同

# [](#compromises-compromises-compromises)妥协妥协妥协

不是所有的东西都可以重构，并且仍然表现相同的东西，所以你通过保留或放弃它来妥协

举个例子:

假设函数 A 可以输出 1，2，3，4，5

如果你给一个特定的参数，它可以从同一个函数中输出你想要的值

但是函数 A 很慢，会导致一些内存泄漏

函数 B 做了函数 A 应该做的事情:输出 1，2，3，4，5

此外，函数 B 使用了一些新的特性，这将使它更快，而且根本没有内存泄漏

但是当给定一个特定的参数时，函数 B 不再输出一个值

因此，您创建了函数 C，它接受函数 B 的值，并根据给定的参数输出一个值

从你的角度来看:我们是保持职能 A 还是坚持职能 B & C？🤔

嗯，实际上取决于应用

如果函数 B & C 的实现会给应用程序带来一些问题和麻烦，那么坚持使用 A 是一个正确的解决方案

还有一种可能是，A 导致了内存泄漏，并且它很慢，因为它依赖于另一个没有正确编写的函数，所以函数 A 可能没有写错

在这种情况下，重构代码是没有用的，因为基础没有正确构建，因此放弃重构部分并从头开始会更有意义

# [](#the-business-perspective-of-refactoring)重构的商业视角

在现实世界中，放弃一些东西并重新开始是一件愚蠢的差事，但在某些情况下，这是唯一的选择

您不会在拥有中等数据量的小型项目中看到这种情况，您会在为应用程序服务至少超过 10 年的公司中看到这种情况

那里有大量的数据需要处理

如果公司认为从长远来看，从零开始创建东西可以节省大量的时间和金钱，那么肯定创建一个新的代码库并在其上工作看起来是一个现实的选择

但是，如果创建一个新的代码库，并且仍然产生同样多的钱，使用同样多的时间，但是有一个更新的代码库，那么就不值得为了一个新的代码而放弃现有的代码。为一些重构分配一些额外的时间会更有意义

如果重构没有太大的帮助或者没有预期的帮助，那么你可以尝试用一个新的代码库来扩展你的遗留代码，这个新的代码库将会增强你的遗留代码库

以脸书为例:

脸书是用 PHP 编写的，将整个代码库转移到另一种语言，如 Python 或 Ruby on Rails，没有多大意义

PHP 可能有一些限制(不是所有的语言都被创造出来，也不是所有的语言都能解决所有的问题)

因此 Hack 被创造出来([https://hacklang.org/](https://hacklang.org/))，在 PHP 之上扩展

然后用 Python 等其他语言扩展遗留代码，但保留遗留代码

其背后的想法是:从商业角度来看，如果脸书没有那么多庞大的数据集，它应该会改变到另一个代码库

使用更新的代码库会产生更多的钱(也节省了更多的钱)

但是转移到更新的代码库可能会导致公司损失大量的钱，并且可能无法产生更多的钱

# [](#in-the-end)最后🤯

实际上，这取决于你所处的环境，你的工作是选择正确的决定，是否重构，或者何时放弃重构，从头开始重新构建
# 从亚马逊 EFS 获得最佳性能

> 原文:[https://dev . to/ilaibavati/get-the-best-performance-out-of-Amazon-EFS-52h 5](https://dev.to/ilaibavati/getting-the-best-performance-out-of-amazon-efs-52h5)

[![](../Images/01e6c6800ce7d50997cc9ae9f9aa09cd.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--LuJj1KmG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.pixabay.com/photo/2015/09/05/00/30/file-folders-923523_960_720.jpg) 

<figure>

<figcaption>图片来源:

<figure>[pix abay](https://pixabay.com/photos/file-folders-business-office-desk-923523/)

<figcaption></figcaption>

</figure>

</figcaption>

</figure>

亚马逊是使用最广泛的云提供商，新服务定期发布，这似乎不太可能很快改变。这是有意义的——如果你已经采用了 AWS 的产品，保持云服务的一致性会更容易管理。EFS 只是 AWS 提供的产品之一，它之所以有吸引力，是因为它既有作为独立产品的潜力，也有作为集成服务的实用性。

## EFS AWS 简介

AWS 弹性文件系统(EFS)是一个用于基于 Linux 的工作负载的自动扩展系统，可以与 AWS 或内部资源一起使用。EFS 是一项完全托管的服务，具有标准文件系统界面，通过实例、AWS Direct Connect 或 AWS VPN 提供文件共享。它旨在提供对数千个弹性云计算(EC2)实例的并行访问，以实现高聚合吞吐量和每秒 I/O 操作(IOPS)以及低延迟。

可以跨可用性区域、地区和 VPC 访问 EFS。它的主要用途是提升和转移企业应用程序、大数据分析、web 服务、内容管理、媒体和娱乐工作流以及数据库备份。

## [](#how-to-test-drive-efs)如何试驾 EFS

如果你还没有决定使用 [AWS EFS](https://cloud.netapp.com/blog/ebs-efs-amazons3-best-cloud-storage-system) ，最好的测试方法是从免费层开始，它允许你在 12 个月内使用 5 GB 的存储空间。这样做可以帮助您了解服务是如何工作的，它的局限性是什么，并开发一些成功操作所需的高级文件系统技术。

要进行设置，您需要创建并启动 EC2 实例，创建您的 EFS 文件系统，连接到您的实例，并挂载文件系统。这可以通过管理控制台或命令行界面(CLI)来完成，可以在 AWS 上找到演练。

一旦完成设置，您就可以开始测试它的功能，方法是使用单线程、多线程、可变数量的实例或您认为可能感兴趣的任何其他设置来编写文件。

## [](#performance-tuning)性能调谐

一旦您在生产中启动并运行了 EFS，您可能需要花一点时间调整您的配置以获得最佳性能。以下建议可以帮助你开始。

**增加您的限制**
在 EFS，由于不使用实例，I/O 限制由存储类型决定。您可以选择一般性能(针对低延迟和高可伸缩性)或最大 I/O(针对大传输量但较高延迟)。

无论您选择哪种方式，您的新卷开始时都只有 0.5 MB/s 的基线吞吐量和 7.2 分钟的 100MB/s 突发吞吐量，这只能通过增加文件系统的大小来提高。要解决这个问题，最简单的解决方案是向您的系统写入虚拟数据。这样做将强制您的基线吞吐量和突发限制。

**使用异步写**
如果启用了异步写特性，您可以将挂起的写操作缓冲到您的 EC2 实例上。这样做将消除每次写入从 EFS 到客户端的往返，并减少延迟。

**从指标中学习**
AWS CloudWatch [自动为您收集指标数据](https://www.trek10.com/blog/cloudwatch-deep-dive/)，可以通过 CLI、API 或控制台访问这些数据。这些数据可以让您了解系统的最新运行情况，并为您提供解决出现的任何问题所需的信息。收集的所有指标都可以提供价值，但特别需要关注突发信用，因为 EFS 用户经常会因信用耗尽而措手不及。

**分离您的操作**
为了最大限度地提高您的 EFS 性能，请考虑将延迟敏感型操作分离到单独的卷中。这将为它们授予单独的突发信用和吞吐量上限，从而保护它们免受时间不敏感操作的影响。您可能看不到与本地装载的文件相同的性能，但会获得更一致的性能。

**不要运行应用程序代码**
EFS 无法提供部署应用程序或管理代码库所需的高速度或大读取量。相反，它旨在用作大规模共享存储，用于媒体资产、异步日志或导出的数据文件。它当然可以用来存储应用程序数据，甚至可以被应用程序访问，但是对于实际的部署，您应该坚持使用本地文件系统或容器。

**自动备份**
与 AWS 的一些其他服务不同，EFS 没有快照功能，你必须使用其他方法来备份数据。AWS 备份、用 Lambda 定制脚本，或者通过第三方工具，都是可行的选择。备份的额外好处是能够管理其他 AWS 服务的备份，而 Lambda 和自定义脚本为您提供了最大的灵活性。

**小心挂载选项**
EFS [默认挂载选项](https://docs.aws.amazon.com/efs/latest/ug/mounting-fs-mount-cmd-general.html)对大多数用户来说已经足够了，所以你应该避免调整它们，除非你确定这样做会改善你的系统。在配置期间，如果可能的话，尝试使用网络文件系统(NFS)4.1 版，以避免错过协议改进。

EFS 最大的好处之一是它能够同时连接到数千个 EC2 实例，所以要确保利用这种能力来提高总吞吐量。

## [](#wrap-up)总结起来

EFS 只是 AWS 为文件存储提供的几项服务之一，它可能是您的正确选择。如果你需要大范围的共享文件，这可能是你最好的选择。

如果您一直在考虑这项服务，我鼓励您尝试免费层，记住这里提到的潜在性能问题。如果您已经采用了这项服务，那么希望本文能为您提供一些提高系统性能的有用技巧。
# 考虑将 AWS 批处理用于您的下一个后台作业

> 原文:[https://dev . to/Christopher lai/consider-AWS-batch-for-your-next-background-jobs-4725](https://dev.to/christopherlai/consider-aws-batch-for-your-next-background-jobs-4725)

我和一位同事目前正在更新我们堆栈中的一个老化服务。该服务被很好地隔离了——它需要一点输入，完成一些单元的工作，然后将结果放入一个特定的 S3 桶中，并在输入中提供一个键。

通常我会和本土的后台工作人员或像 shoryuken 这样的社区图书馆一起接触 SQS + EC2。然而，由于已经有几十台服务器投入生产，我想要一个不需要额外管理基础设施的解决方案。

如今，当我遇到与基础设施相关的挑战时，我会在 AWS 控制台中快速搜索，看看会出现什么。果然，AWS 有一个后台作业的服务，叫做 Batch。

乍一看，并不完全清楚 Batch 是如何工作的。我谷歌了几个不同的关键词排列，没有一个能找到特别有用的东西；到处都有一些文章，但没有一篇像深入的教程那样涵盖了我们的特定用例。

在浏览了入门指南之后，我发现 Batch 的设置非常简单。大部分开销都是为了克服传统后台工作程序设置的缺陷。

总的来说，批处理有几个特性非常适合后台作业。

## [](#compute-environment)计算环境

批处理作业在计算环境中运行。这只是 Batch 为您创建和管理的 ECS 集群。这些是将运行您的作业的节点/实例。

## [](#job-definition)作业定义

使用作业定义来定义作业，这允许您自定义 CPU、内存和重试次数的数量，以及设置环境变量和其他选项，如您想要使用的默认 Docker 映像。

我们从一开始就知道我们想要使用 Docker 图像。我们的工作有大量的运行时依赖，我们认为最好将它们打包成一个原子单元。Batch 非常适合，因为 Batch 支持 Docker 图像。

## [](#job-queue)作业队列

与其他后台作业库不同，Batch 有自己的排队系统，它不依赖于 SQS 或 Redis。

作业队列依赖于计算环境，可以有不同的优先级。作业被提交到由计算环境运行的作业队列中。

## [](#job)工作

使用作业定义将作业提交到作业队列。提交作业时，可以覆盖作业定义中设置的默认参数。

有几种提交作业的方法。我们使用 AWS 提供的批处理 gem 提交代码库中的作业。

关于 Batch，我还有很多需要学习的地方，但是我想分享一下我到目前为止使用它的经验。如果您有任何问题，请随时发表评论。
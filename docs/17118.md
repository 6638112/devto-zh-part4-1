# 使用 React 挂钩、HOC 或 Render Prop 获取 API 数据

> 原文:[https://dev . to/Kate Kate/fetching-API-data-with-react-hooks-hoc-or-render-prop-33ej](https://dev.to/katekate/fetching-api-data-with-react-hooks-hoc-or-render-prop-33ej)

让我们看看使用新朋友 React Hooks 和老朋友 Render Prop 和 HOC(高阶组件)来实现数据获取。并弄清楚这是不是真的——“老朋友和老酒是最好的”。

[![](../Images/5f156b0d5cb96c38f7a36523f2e638f8.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--MyLpdUWk--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/apfftof2d3jup9hv9f1o.jpg)

随着生活的不断变化，对变化做出更好的反应。2019 年 1 月，React 16.8.0 中添加了 React 挂钩。从那时起，我们可以在功能组件中使用本地状态和运行副作用。万岁！没有人相信这是可能的，但每个人都梦想着它。在阅读本文之前，请确保您已经阅读了关于 React 钩子的文档。

在大多数情况下，反应钩子提供了停止使用 HOC 和渲染道具的机会。因为我们对他们有很多抱怨:

特设+渲染属性:

1.  “包装地狱”使得阅读代码和调试变得复杂。

特设:

1.  类型注释的问题(流、类型脚本)。
2.  有时很难确定组件道具的所有者。
3.  道具“命名碰撞”。您可以用同一个键覆盖属性值。
4.  特设组成并不总是显而易见的。例如，您需要在“配置文件提取器特设”后使用“授权特设”包装的组件。这意味着应首先执行“临时授权”。

渲染属性:

1.  渲染道具通常不渲染任何 HTML 元素，与 JSX 一起使用。

2.  无用的“git diff ”,因为渲染道具中的整个 JSX 都有行缩进。看起来你改变了很多，但实际上只是增加了一个渲染道具。

让我们更深入地研究一下这个例子，看看反应钩子和渲染道具哪个更好。我们将使用 Render Prop，它的实现类似于 HOC，但不太详细。我们将编写一个从 API 获取数据的实用程序。我很确定你已经写了十几遍了，所以让我们看看是否能写得更好更优雅。

我们将使用流行的库“axios”。对于最简单的场景，我们应该处理以下状态和操作:

*   提取过程(正在提取)
*   成功响应(responseData)
*   响应失败(错误)
*   如果 url 更改，取消请求并发送新的请求
*   取消对未安装组件的请求

### [](#1-simple-scenario)1。简单场景

让我们编写初始状态和一个 reducer 函数，它根据获取的结果修改状态:成功或错误。

> 注意:术语“缩减器”来自函数式编程。很多 JS 开发者都是从 Redux 那里学来的。它是一个接受当前状态和动作并返回新状态的函数。
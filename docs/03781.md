# 来自地狱的弹出式杀手

> 原文:[https://dev.to/almenon/the-popup-killer-from-hell-4708](https://dev.to/almenon/the-popup-killer-from-hell-4708)

当我从事第一份编程工作时，我们的遗留代码库中明显缺乏单元测试。每一处改动都必须经过质量保证，因为哪怕一行字的改动都可能毁掉每个人的一天。为了解决这个问题，管理层雇佣了一名自动化工程师来编写一个庞大的自动化套件。他们使用 Ranorex 像真正的人类用户一样自动点击鼠标——点击这个按钮，然后那个，向下滚动，点击这里，等等。不幸的是，Ranorex 经常因为难以调试的奇怪原因而失败。有时它会找不到盯着它看的东西。其他时候它会失败，因为为什么不呢？

弹出窗口就是失败的原因之一。Ranorex 会很高兴地移动鼠标，当 BOOM - popup。如果弹出窗口掩盖了应用程序或者要求焦点，ranorex 就会失败。我的同事指责它导致弹出窗口，但最终厌倦了浏览它的官僚作风，并决定去核的问题-他做了一个脚本，将杀死一切，除了几个白名单进程。

我会给你几秒钟时间来思考这是如何出错的.....

所以有一天我开始调试自动化，除了 Visual Studio 之外的一切都突然死了。我惊恐地盯着屏幕 <sup id="fnref1">[1](#fn1)</sup> 。究竟发生了什么事？然后我意识到——*弹出杀手！*当然！它在一个单独的进程中启动，因为我在运行过程中停止了调试，所以跳过了类清理。

嗯，没关系。我会修复它，但与此同时，我只是重新打开浏览器...它关闭了。我再次打开 chrome，它再次关闭。单击关闭单击关闭。我试着打开记事本。同样的事情。哦上帝。我试图打开任务管理器，它就在我眼前被谋杀了。但是我打开了命令行。我运行`tasklist`来找到弹出窗口杀手进程，然后用`taskkill`来杀死它，但是 taskill 本身在运行之前就被杀死了！

事情看起来很糟糕。

类清理代码通过创建一个名为`killthekiller`的文件来终止进程。弹出式杀手寻找这个，看到它就自杀了。但是由于某种原因，当我创建文件时，什么也没发生。最后，我尝试在 Visual Studio 的[即时窗口](https://docs.microsoft.com/en-us/visualstudio/ide/reference/immediate-window?view=vs-2019)中使用 C#代码。这也不起作用——我不记得为什么了。现在我完全被耍了。我不得不重启电脑。

💀💀💀💀💀💀💀💀💀💀💀💀💀💀

重启后，我对代码做了一些修改。我把各种各样的程序放在白名单中，并且我改变了类清理来直接杀死进程。问题已修复。但是它的记忆将会在我的大脑中留下疤痕。

我现在为[155](https://www.15five.com)工作。我们有一个全面的单元测试套件，覆盖范围每个月都在增长。除了偶尔的时区问题，测试相当稳定。有时我想念我的老同事。但是让我告诉你:我不想念雷诺克斯。

* * *

1.  老实说，这是大约一年前的事了，我不太记得我当时的反应了。我用的是艺术许可证`¯\_(ツ)_/¯` [↩](#fnref1)
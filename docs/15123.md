# 如何不写传呼

> 原文:[https://dev.to/stegriff/how-not-to-write-a-pager-207c](https://dev.to/stegriff/how-not-to-write-a-pager-207c)

我真的不喜欢写传呼机。

无论是为了博文还是 API 结果，我都会为了避免写传呼机而跳月。但是为什么呢？首先，我记得每次我试图写一个时出现的所有挑剔的小问题！因此，也许是时候通过命名来消除这些讨厌问题的力量了！

## [](#0-which-way-does-time-run)0。时间往哪个方向走？

首先，设计决策:

*   你从第`0`页还是第`1`页开始？
*   第 0 页有最早的结果还是最新的结果(如果你的结果是按时间排序的)？

好吧，那么，如果你要用 UI 元素来导航页面，文本会说什么呢？“旧的”和“新的”，“上一个”和“下一个”，“更早的”和“更晚的”？你的 UI 元素诚实易懂吗？

## [](#1-what-happens-when-page-number-isnt-a-number)1。当页码不是数字时会发生什么？

对于那些喜欢在地址栏中输入`?p=shampoo`来看看会发生什么的混乱猴子来说...你就是我们不能拥有美好事物的原因！

[![You are punishing me because I do not think the way you do](../Images/9d4061b52a60ac1bc506dd8ada52a150.png)T2】](https://i.giphy.com/media/4pGmqPoRe7ihi/giphy.gif)

总是检查页码实际上是一个数字，通过在一个安全的转换中包装它或者像 C#中的`int.TryParse()`一样强制转换。

## [](#2-what-happens-when-page-number-is-out-of-bounds)2。页码越界了会怎么样？

如果页面低于`0`(或者`1`，如果你已经决定这是你的下限)，那么你可以修改它为`0`。如果你正在制作一个用户界面，如果当前页码也是`0`，记得隐藏“上一页”按钮。

如果页面越过了`numOfPages`，您可以将其向下绑定到`numOfPages`。请记住，在该页面上不要出现“下一页”链接。

一个技术性的问题——你会重定向到`?p={numOfPages}`还是会保留用户在地址栏中输入的内容，只给他们最终结果的视图？

## [](#3-speaking-of-which-how-do-we-calculate-raw-numofpages-endraw-)3。说到这里，我们如何计算`numOfPages`？

要找到您的`numOfPages`，您可以将项目数除以页面大小(每页的项目数)...只要记得有余数就加 1！你的编程语言可能有像整数除法和余数(模)这样的操作符来帮助你。

> 10 篇文章，每页 5 篇-> 2 页
> 11 篇文章，每页 5 篇- > 3 页

## [](#4-how-do-we-handle-userdefined-page-size)4。我们如何处理用户定义的页面大小？

您正在为自定义页面大小自找麻烦，但是您可以通过将我们刚刚讨论的所有边界检查也放在`pageSize`上来限制您的悲伤的表面区域:检查它是否高于合理的最小值，低于合理的限制，并且是数字的。您可以为您的用例决定合理的最大和最小页面大小。虽然一个 API 可能会将一个页面限制在 1000 个结果，但是一个博客可能需要限制在 50 或 100 个，以保持快速的加载时间。同样，对于一个页面来说，每页 1 个项目是不合理的少，但是 2 个项目呢...你同意吗？

## [](#5-can-the-final-page-load-fewer-results-than-the-others-without-crashing)5。最终页面可以比其他页面加载更少的结果而不崩溃吗？

如果您使用 ORM 从数据库中获取结果，并要求它为最后一页获取 10 个结果，但只有 4 个可用，那么它会被优雅地处理吗，或者您的程序会失败吗？请务必测试并找出答案。

## [](#6-how-do-we-avoid-a-page-with-0-results)6。我们如何避免一个结果为 0 的页面？

一些编码错误会导致最终页面没有结果。如果你总是*在第三个问题中*在页面大小上加 1，而没有先检查余数，这可能会发生。

## [](#7-how-do-we-avoid-duplicate-results-across-pages)7。我们如何避免跨页面的重复结果？

确保第 1 页的最后一个结果不是第 2 页的第一个结果。检查从数据库中检索帖子的逻辑专门填充页面:

> 第 0 页-项目 0 至 9(计数= 10)
> 第 1 页-项目 10 至 19(计数= 10)

这个算法可以表示为:`firstItemId = pageNum * pageSize` -你能想到任何边缘情况吗？

[![What about math? No. Not important](../Images/40374db402b8adac1e9ab7adfa660d13.png)T2】](https://i.giphy.com/media/XyOrJljDNBEpa/giphy.gif)

## [](#8-how-do-we-preserve-the-users-query-string)8。我们如何保存用户的查询字符串？

如果您必须更改用户的查询字符串(问号后面的 URL 位)，请确保保留他们查询的其他部分，如搜索词或过滤器。转到第 2 页或改变页面大小，发现网站已经忘记了你的“可爱的狗”过滤器，现在你正在查看第 2 页的 *everything* ！

您的语言或框架可能有工具将 querystring 提取为键值对，然后您可以添加和修改这些键值对，而不必进行令人讨厌的字符串操作。js 的 querystring 库有一个解析函数来完成这个任务，并且在。您可以使用 HttpUtility。ParseQueryString 。

## [](#wrap-up)总结起来

最后，请记住，如果您可以使用其他人久经考验的库来做这件事，那么就去做吧！如果可能的话，总是重复使用和保存你的工作。他们可能比你想得更久。

所以这是我能想到的！你对寻呼机有什么看法；你有什么故事，好的坏的，或者额外的小贴士？评论里 Lmk！

*综合自我的博客[stegriff.co.uk](https://stegriff.co.uk/upblog/pager-gotchas/)T3】*
# 让我们谈谈微前端和 iframe

> 原文：<https://dev.to/dechamp/let-s-talk-micro-frontends-and-the-iframe-4pn1>

最后提供了微前端的指南。

你好。听说过 iframe 吗？当然啦！如果你没有，可能是因为它比你大。

Iframe 包装不好，这并不是完全没有道理的。但同时，它也值得尊重。

我最近接受挑战，为我们的一些想法制作一个微型前端加载器。这使我走上了多条道路。

我的第一反应是“哎呀，这可能需要 iframe...但是我不想使用 iframe，感觉很糟糕”。

我一开始很坚强。我脑子里想出了一个主意，把它写成代码，然后嘣！成功了！我有多个 react 应用，不同版本的 react，托管在不同的主机上，都作为一个单一的网站工作。

这样做的价值是允许我们更新任何远程网站，而不必发布主机网站。

我使用 javascript 动态加载一个 iframe，然后将 javascript 包推送到那个 iframe。加载 iframe 后，它会附加一个对自身的引用，并将其传递给主机。

然后主机能够让它知道什么时候挂载，并给它 dom 元素来挂载。

所有人都努力工作。任何时候，如果某件事第一次做得完美无缺，你都应该多疑...

Welp！果然有效。太好了！第一次，我已经完成了我的工作。

没那么快！当我将 react 样式组件添加到主机时，大火就开始了。

[![fire](img/f7f39b27e41f02982a529b357b2d6c62.png)](https://i.giphy.com/media/NTur7XlVDUdqM/giphy.gif)

Styled-components 有这个问题(他们修复了这个问题)，如果有多个 styled-components 实例，就会互相覆盖。

我只是捆绑了整个网站和它的模块，然后把它安装到当前的网站...当然会有很多例子。它们可能被封装，但是只有一个 DOM 可以使用。

当你有两个实例运行时，Styled-components 足够好来警告你，所以支持它们。

我的同事找到了解决方法，我们回到了一个可行的微前端解决方案。

但这让我伤痕累累。如果我们有另一个做同样事情的图书馆呢？我们现在必须非常小心每一个行动，每一个包裹。不现实。

避免使用 iframe 的全部意义在于避免问题和工作的开销。但至少对于 iframe 来说，它的问题是众所周知的，并且经过了多年的严格测试，有可靠的解决方案。

所以我们就该做什么进行了长时间的讨论。我们保留这个工作版本，只是冒着奇怪的小错误可能出现的风险，而没有真正了解原因吗？

或者，我们是否应该放弃 iframe，继续使用它，因为它可以确保封装性？

是 Iframe。

使用 js，我基于清单动态创建了一个 iframe。它允许适当的传递，所以你可以有初始值来启动你的应用程序。

我使用 [postMessage api](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage) 在父母和孩子之间传递进一步的信息。

这给了我想要的。

一些利弊？

*   利:它确保封装
*   缺点:封装也意味着更难相互修改父/子。
*   利:非常容易实现
*   pro:为交叉通信提供了一个 api
*   优点:增加额外的安全性
*   缺点:使会话工作变得困难
*   缺点:使 iframe 内容难以适应主机
*   优点:允许你建立一个索引页面
*   缺点:你必须专门为 iframe 编码，这需要知道它们之间的细微差别

这些只是我第一次想到的。

你对 iframe 有什么体验？你的微前端加载解决方案是什么？我们不要说话！

如果你想了解更多关于微前端的知识，这里有几个参考。

*   [https://micro-frontends.org/](https://micro-frontends.org/)；
*   马丁·福勒微前端
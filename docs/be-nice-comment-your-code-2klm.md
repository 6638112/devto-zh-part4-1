# 友善一点——评论你的代码

> 原文：<https://dev.to/briansdevblog/be-nice-comment-your-code-2klm>

我一直是评论代码的粉丝。对我来说，这是显而易见的明智之举，也是构建易于理解和维护的软件的基础部分。然而，并不是每个人都同意。一些人认为注释是不必要的，只是让代码看起来没有应有的表现力。在这篇文章中，我将试图反驳这些观点，并告诉你为什么我认为高质量的注释是构建更容易理解和维护的软件的重要部分。

## 帮助他人理解你的代码

作为开发人员，我们花了大量的时间阅读并试图理解其他人的代码。有时，这可能是一项困难和令人沮丧的任务。我们大多数人都遇到过这样的情况，我们深陷在遗留代码中，没有文档，没有单元测试，也看不到注释。写这本书的人可能已经不在了，我们只能靠自己的设备去搞清楚到底发生了什么。没什么意思，是吗？

这些经历应该提醒我们，作为开发人员，我们有责任超越实现功能需求，并编写易于阅读、理解和维护的代码。一个易于理解的代码库，让你未来的自己和你身后的人的生活更轻松。它允许具有不同水平的技术能力和领域知识的开发人员跳入您的代码，并以最少的痛苦变得高效。

## 注释——只是拼图的一部分

当涉及到制作易于理解和维护的代码时，这个难题中有许多重要的部分。根据我自己的经验，我会如下订购这些。

*   良好的结构——具有单一职责的类，完成一件事情的函数
*   描述性命名——类、函数和变量应该有清晰的描述性名称
*   单元测试覆盖——单元测试描述了组件*应该如何表现。除了测试预期的行为之外，它们还是组件规范的一种形式*
*   注释——注释提供了代码不能轻易表达的重要信息。

你可能会惊讶，评论在列表的底部。这并不是贬低评论的重要性，而是强调其他因素的重要性。重点应该始终放在编写结构良好、易于理解的表达性代码上。把注释看作是蛋糕上的糖衣，它的存在是为了向读者提供代码本身不能轻易表达的信息。

## 考虑你的听众

在一个系统的生命周期中，具有不同水平的技术能力、经验和领域知识的开发人员将会处理代码。在光谱的一端，您可能有非常有经验的技术领导/架构师级别的人，而在另一端，您可能有刚从大学毕业的开发人员。关键是，你不知道将来谁会为你的代码工作，也不知道他们的专业水平如何。考虑到这一点，你应该让尽可能多的读者能够看到你的评论并从中受益。如果你是一个有丰富领域知识的有经验的技术领导者，你不应该在评论你的代码时假设后面的人和你知道的一样多。相反，在撰写您的评论时，要考虑到经验较少的开发人员。

你可能会争辩说，这冒着注释过于明显的风险，尤其是对于更有经验的开发人员。虽然这种*是*风险，但重要的是要记住，当我们将一条评论描述为*显而易见的*时，我们是主观的。对于一个有着 15 年经验的技术领导者来说显而易见的事情，对于一个初级开发人员来说可能一点也不明显。

## 什么和为什么

当其他开发人员查看您的代码时，您需要掌握两件事情。*代码在做什么*以及*为什么*它在做。让我们仔细看看。

### 注释说明*什么*

在许多情况下，写得好的代码是自文档化的。你的*目标*应该是让你的代码尽可能有表现力，因此减少对描述*代码做什么*的注释的需求。然而，有时候描述*代码所做的*是有用的。

*   当业务逻辑很复杂时，你应该使用注释来描述你的意图。是的，你仍然想让代码尽可能的自我描述，但是在这种情况下，注释通过描述*你在*试图实现什么来增加价值。众所周知，代码做什么和它打算做什么并不总是一回事![🙂](img/c1766ba8b46615e3a821a99042b0d85a.png)
*   有些代码就是没有表达能力。以正则表达式为例。是的，您可以给正则表达式起一个描述性的名字，但是它可能无法帮助读者理解正在被解析的模式。在这种情况下，描述模式并提供样本匹配的注释非常有用。复杂的 SQL 是另一个不太容易表达的代码例子。一些简单的注释可以通过描述语句的意图来帮助引导读者。
*   领域概念可能很难描述。这听起来很简单，但是很好地命名事物*和*可能非常棘手，尤其是在一个复杂的领域。我在人寿保险和养老金方面花了不少时间。我有时发现很难用一个简单的名字来概括一个类、函数或变量的用途。在这些情况下，我会尽可能想出一个最具描述性的名称，然后添加一个注释，用简单的英语描述这个类、方法或变量在业务术语中代表什么。

### 注释说明*为什么*

解释*为什么*你的代码做某事的注释非常重要，因为这些信息不能从代码中获得。下面是几个例子，说明什么时候解释*为什么*你选择做某事很重要。

*   设计决策——解释*为什么*你已经做出设计决策的评论是很重要的，尤其是如果你已经实现了某种模式，并且你希望其他开发人员在将来利用它。指导之手可以通过向人们展示扩展现有功能的最合适的方式来帮助他们指明正确的方向。弄清楚*你做某事的原因*也减少了将来有人重构你的代码并无意中破坏你已经建立的模式的机会。
*   变通办法——我们有时不得不解决由我们很少或根本无法控制的外部因素引起的问题。也许从外部系统接收的数据在处理之前需要在某些情况下进行调整。像这样的变通方法虽然不理想，但却是企业开发的现实，尤其是在涉及遗留系统的情况下。注释有助于解释问题的根源以及我们为什么需要解决它。注释为其他开发人员提供了上下文，并减少了有人因为不理解而删除变通办法的机会。
*   边缘案例——我们有时会编写逻辑来处理特殊的边缘案例。这些场景通常不是直观的，因此是注释的绝佳候选。处理古怪场景的逻辑通常看起来比它需要的更复杂。注释是解释边缘情况和为什么你已经实现了你的解决方案的好方法。

## 对话式评论

我尽量让我的评论不那么正式，像对话一样。想象一下，你的一个队友坐在你旁边，你正在解释你的部分代码是如何工作的。你应该用简单的术语解释，让你的队友尽可能容易理解。我认为评论应该用简单的语言来表达观点。记住，注释是用来提供代码不能提供的信息的，所以尽可能让它们容易理解。

## 质量超过数量

像生活中的大多数事情一样，应该强调质量而不是数量。注释应该仔细考虑，告诉读者一些代码不能轻易表达的东西。结构良好、富于表现力的代码加上少量有用的注释要比写得很差的代码好得多，这些代码用大量的注释来解释每一行是做什么的。

避免重复代码清晰描述的多余注释。注释和代码一样，会随着时间的推移而发展，需要维护。避免多余的注释可以减少维护开销，帮助读者关注重要的注释。

## 忌评论腐烂

注释腐烂是指代码更新了，但伴随的注释没有更新。这导致注释过时，并且经常与它们应该描述的代码相矛盾。注释腐烂经常被认为是注释代码的一个主要缺点，但是我认为这个论点是站不住脚的。虽然我同意注释腐烂是一件坏事，应该避免，但这并不是停止注释代码的足够好的理由。避免评论腐烂的最好方法是显而易见的…..更新代码时更新注释。像大多数好的实践一样，这需要以代码评审的形式将开发人员的纪律和治理结合起来。

## 包装完毕

注释不能代替结构良好、表达丰富的代码，但是它们可以提供代码本身不容易表达的信息。更容易阅读、理解和维护的代码，最终会转化为更高的生产力，带来更多的功能，我敢打赌，这就是让你的老板高兴的原因。

帖子[很好——评论你的代码](https://www.briansdevblog.com/2019/08/the-importance-of-comments-for-maintainable-code/)首先出现在 [briansdevblog](https://www.briansdevblog.com) 上。
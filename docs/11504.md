# P2P 网络的安全通信

> 原文:[https://dev.to/solanav/secure-comms-for-p2p-networks-2l33](https://dev.to/solanav/secure-comms-for-p2p-networks-2l33)

写软件和关于写软件的写作。

对于我现在正在开发的远程管理程序，我必须学习很多东西:p2p 网络和用于通信的密码学，X11 和用于与远程计算机交互的 Wayland 以及一般的 Linux。

上一篇文章，我漫谈了我对如何建立刘的 p2p 网络的想法。现在，我想谈一谈我将使用的密码，以避免被 MITMed。

我的第一个想法很简单。我将创建一个 RSA 密钥对，并将私钥保存在服务器上，将公钥硬编码在每个客户机上。RSA 只能加密比密钥长度短一点的数据，所以如果我的密钥是 2048 位，那么我的数据包就只有不到 256 字节。我决定最好使用 4096 位的密钥，这样我就有更多的空间向服务器发送数据。有了客户机拥有的公钥，它们可以发送多个加密的数据包，只有服务器能够用私钥解密它们。

尽管这是可能的，并且对于小消息来说听起来不错，但是我决定我需要更多的空间来发送日志和其他文件。在阅读了更多关于 RSA 的内容后，我还发现使用原始 RSA 进行加密是一个非常糟糕的主意，原因如下。所以我决定把 RSA(非对称加密)和 AES(对称加密)混合使用。我的想法是这样使用它:

1.  客户端有公钥，服务器有私钥。
2.  客户端生成一个 AES 密钥并加密一些数据。
3.  客户端用公开的 RSA 密钥加密 AES 密钥(仅 192 或 256 位)。
4.  客户端将现在加密的 AES 密钥发送给服务器。
5.  客户端将现在加密的数据发送到服务器。
6.  服务器用私有 RSA 密钥解密 AES 密钥。
7.  服务器现在有了 AES 密钥，可以让我们解密用户发送的数据。

这比第一个选项好得多，因为我们现在可以加密尽可能多的数据，而不用担心分割文件。我们还可以更快地加密大文件，因为 RSA 相当慢。这种技术也是我们在刘的加密插件中使用的，用来安全地加密给定计算机中的所有文件。该插件使用 AES 加密文件，然后将使用 RSA 加密的 AES 密钥发送到服务器，然后从客户端的计算机中删除 AES。这样我们就可以在受到攻击时远程保护我们的数据。

尽管该协议看起来不错，但它仍然缺乏更多的安全性。从客户端发送到服务器的消息是加密的，但是服务器发送到客户端的消息只是签名的。当你签署一封邮件时，你不加密它。您可以验证消息在连接过程中没有被篡改，但是人们可以读取您发送给客户端的任何内容。因此，为了让协议处理这个问题，我需要客户端生成另一个 RSA 密钥对。这一次，客户端将保留私有密钥，并将公共密钥发送给服务器。这样，连接的双方都可以用对方的公钥加密消息，并保持连接的安全。

因此，我们现在可以添加第 0 步，即密钥交换，其中客户端将密钥发送给服务器，服务器保存它以及与客户端连接所需的一些其他信息，如 IP 和客户端监听指令的端口。

我想以说这是一个非常糟糕的想法来结束这篇文章，除非你真的知道你在做什么(我不知道)，否则你永远不应该推出你自己的协议或你自己的密码。如果你想像我一样使用 UDP 并且需要安全通信，你应该使用 DTLS。它就像 SSL 或 TLS，但它使用 UDP 而不是 TCP。
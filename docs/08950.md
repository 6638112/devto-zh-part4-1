# 测试和 TDD 入门

> 原文：<https://dev.to/hagnerd/a-primer-on-testing-tdd-9a5>

世界上有两种人:爱在 React 里测试的，和没试过`@testing-library/react`的。

我开玩笑，但这篇文章只是简单介绍了什么是测试驱动的
开发，为什么我发现它对前端开发有用，应该测试什么的概述，以及不同类型的测试之间的区别。

我在这篇文章中表达的许多观点都与我个人的开发风格有关。你可能不同意我的部分或全部观点，这完全没关系。

这是 React 测试系列的第一篇文章。在下一篇文章中，我将讨论单元测试的`@testing-library/react`,所以如果你想在以后的文章中得到通知，请务必关注。

* * *

## 什么是测试驱动开发？

测试驱动开发在 21 世纪初兴起。基本的前提是，我们应该在编写实现之前编写测试，以避免在编写实现之后编写测试时出现误报的情况。

测试驱动开发的主要精神可以总结为三个词:红色、绿色、重构。

您编写了一个您知道会失败的测试，因为您还没有实现这个特性。您编写代码来通过测试。现在，您可以放心地重构经过测试的代码部分。

通过编写更多的测试来覆盖特性的其他方面，针对回归的测试，以及针对您发现的边缘情况的测试，您可以重复这个循环。

测试驱动的开发可能非常强大，但是，目标不是 100%的代码覆盖率，你不应该觉得有必要为每一件小事都编写测试。这可能是一个滑坡，在某些时候写更多的测试是*而不是*会增加你对代码库的信心，或者让你更有生产力。

* * *

## 为什么*我*要写测试？

我写测试是因为我发现当使用测试驱动的开发时，它帮助我写更多的符合人体工程学的组件。我第一次避免糟糕的设计选择，因为我在编写实现之前先编写用法。

为一个组件或特性编写测试有助于我自信地重构。如果在我做出改变之前测试通过了，并且行为预期是相同的，那么我所做的任何改变都不应该使测试失败。如果是这样，我要么 1)违反了合同，需要更新整个应用程序中组件的所有用法，要么 2)测试了实现细节，如果不需要，我应该删除测试，或者将它们更新为不测试实现细节。

我还发现，当实践测试驱动开发时，我会更加专注。我可以写下一些期望，设置 25 分钟的计时器，然后开始工作。我一次只专注于一件事。写一个测试。看着测试失败。开始实现该功能。看测试通过。如果需要，重构。然后继续下一件事。比起没有明确方向就开始写代码，我更倾向于完成更多更快的事情。

* * *

## 我们应该考什么？

更好的第一个问题可能是我们应该为谁编写测试？答案很简单。我们的用户。作为开发人员，我们的代码有两个用户。与我们的网站或应用程序交互的实际最终用户，以及我们未来的自己或其他将使用我们的代码来实现其他功能或对我们的代码进行更改的开发人员。

例如，假设我们需要在 React 中创建一个按钮。可能有开发人员在应用程序的不同部分使用该按钮，也可能有应用程序的用户与该按钮进行交互。

这两个用户需要交互的部分应该是我们测试的东西。他们的期望是什么？我们的意图是什么？

用户可能希望能够与之交互。根据页面上按钮的上下文，他们可以期望它提交一个表单，引导他们到一个新页面(一个看起来像按钮的链接)，增加一个计数器，保存一些数据，等等。

开发人员可能希望能够将他们自己的点击处理程序传递给它，并让它可靠地启动。他们可能希望能够更改按钮文本、覆盖、附加或修改样式，他们可能希望有某种机制来禁用按钮。

这些期望中的一些可以在单元级别以通用的方式进行测试，而一些作为集成测试更有意义，因为组件实际上是在特定的上下文中使用的。

我们甚至可以通过 linters 或者像 Storybook 和 a11y 插件这样的工具来使用静态测试来测试我们的代码以获得最佳实践。比如确保我们使用一个交互式元素的按钮，或者向 DOM 元素传递适用的 aria 属性，比如`role=button`、`aria-pressed`，如果我们使用 div 之类的东西，使其成为焦点。

> A11y 是可访问性的简写。a，中间 11 个字母，y。

* * *

## 单元 vs 集成 vs 端到端

Guillermo Rauch 曾经在推特上写道“写测试。不太多。大多是融合”。我认为这是一个很好的 tweet 来模拟你的测试实践。

那么有哪些不同类型的测试呢？

### 单元测试

单元测试是以代码单元为中心的测试。它可以是单个函数，也可以是一个组件。当你第一次开始测试时，你通常会写很多单元测试。不过很快你就会意识到，他们并没有真正给你对你的*应用*的信心，而是给你对一段*孤立的*代码的信心。你最终不得不模仿很多东西，任何时候你的测试中有模仿，你对这些测试的总体信心就会降低。

> 关于嘲讽的笔记。有时模仿某些功能或第三方库是必要的。以数据获取为例。您不希望在您的测试中向 API 发出请求，因为这会使您的测试变慢。您也不知道您的测试将在什么时候运行或者运行多少次，因此每次您的测试运行时都有可能产生几十或几百个请求😬这是我最大的遗憾。

### 集成测试

集成测试关注更大的代码块。在 React 中，它可以是一个页面，也可以是一个较大的组件，比如包含一堆较小组件的表单。集成测试是测试的基础。这是您测试组件实际使用情况的地方，而不是测试潜在使用情况的地方。

### 端到端测试

端到端测试通常更难设置，运行成本也更高。您仍然应该考虑在您的代码库中进行端到端测试。端到端测试通过整个应用程序/网站模拟用户交互。通常，您将通过应用程序测试某些流程，如注册用户、发布新帖子、编辑帖子或删除用户有权删除的帖子。

### 基于属性的测试

基于属性的测试并没有在 JavaScript 中掀起太多波澜，但在 Clojure 和 Elixir 等语言中很流行。在本系列中，我们不会进行任何基于属性的测试，但我们的想法是，针对您的代码测试一个可证明的属性(想想数学属性)，您使用某种输入生成，它可以捕捉该属性中断的边缘情况。

### 静态测试又名静态分析

虽然不一定是传统意义上的*测试*，但是静态分析是 Eslint 和类型检查器(如果您使用的是静态类型语言，如 TypeScript)等工具的组合，允许您以某种方式检查代码的正确性。当静态分析被正确使用时，它可以帮助您尽早发现潜在的错误，或者通知您正在做一些您不应该做的事情，比如在 div 上放置一个`onClick`处理程序，而不仅仅是使用一个按钮。当使用不当时，比如使用 Airbnb 的 Eslint 规则，静态分析会让你头疼，让你的工作效率明显降低，除非你在 Airbnb 工作，需要遵守他们的代码风格指南。

* * *

## 结论

我们已经讨论了什么是测试驱动开发，为什么我喜欢实践测试驱动开发，如何识别我们应该测试什么，以及不同类型的测试之间有什么区别。

如果你有任何问题，请在评论中发表。
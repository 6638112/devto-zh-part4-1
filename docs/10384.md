# 在日志中查找 IP 地址的正则表达式:Prep

> 原文:[https://dev . to/heroku/regular-expressions-for-finding-IP-addresses-in-your-logs-the-prep-249m](https://dev.to/heroku/regular-expressions-for-finding-ip-addresses-in-your-logs-the-prep-249m)

正则表达式是搜索和过滤文本的强大工具。这第一篇文章将为您提供一些关于正则表达式的背景信息，以便我们可以继续使用它们来挖掘您的服务器日志。

[![be a real hacker](../Images/5adc6e0562e5f1dff5106d42a16114f5.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--zMDCb2eL--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/http://giphygifs.s3.amazonaws.com/media/137EaR4vAOCn1S/giphy.gif)

# RegEx 是关于寻找东西的

正则表达式(通常简称为 RegEx)的核心是一个查找和匹配文本的系统。我们都习惯于搜索文档的文本，但是你有没有注意到文本搜索…有点糟糕？我们也习惯于用谷歌搜索，特别是当你的查询变得有趣时，比如说，包括这个字符串，但不包括那个字符串。这种类型的逻辑是 RegEx 可以做到的，但是它还可以做更多的事情。

假设你正在写一篇文章，并且意识到你需要把所有的“樱桃”都改成“蓝莓”你做了一个查找/替换，突然你的故事变成了“Marian 把每个蓝莓切片，然后把樱桃倒进派里”。

我们习惯的搜索只能找到*完全匹配的*，但是我们的大脑可以想出各种更复杂的搜索。RegEx 可以做到这一切。

“查找以‘cherr’开头并以‘ies’或‘y’结尾的每个单词”是一个使用正则表达式进行的简单搜索。

> 关于语言:特定正则表达式的术语是“模式”。

# 这里是我们需要的所有正则表达式知识

在本文的第 2 部分，我将向您展示如何在 web 服务器的日志中搜索 IP 地址。要做到这一点，我们需要 RegEx 一半的能力。这不是一个全面的教程，但它涵盖了我们需要的内容。值得注意的是，如果你掌握了这里的一切，你以后可以做得更多！

**你可以在浏览器中试用正则表达式**

像 https://regexr.com T2 T3 这样的网站允许你在浏览器中编写和测试正则表达式。它采用一个标准模式(用`\` s 包装),并允许您为模式的执行设置一些选项。让我们写一个最简单的正则表达式，字面意思是“按照这个确切的顺序查找这些确切的字母”:查找单词`\cat\`的模式可以遵循几个选项

*   区分大小写与否？我总是区分大小写，这迫使我在正则表达式中显式地说`[a-zA-Z]`,如果我想捕获小写和大写的话。无论你做什么，只要记住这个设置是存在的。
*   子串匹配或整行匹配。如果您搜索文本:

    猫喜欢奶油

    就像老鼠喜欢牛奶一样

    黎明的乌鸦

    使用模式`\cat\`，子串模式将只给出行中与您搜索的内容完全匹配的部分(“猫”)，而整行搜索将给出匹配行中的所有内容(“猫爱奶油”)

*   注意:还有很多其他选项我从来没有用过，所以我不会在这里重复(记得我说过这正是我们需要的)

**通配符**

点`.`匹配任何字符。如果你想匹配点作为一个字符，像这样转义:`\.`

**“确定这个人物存在，否则不存在。随便"**

问号`?`表示前面的字符是可选的。如果您想匹配一个真正的问号，请对其进行转义:`\?`(一般来说:任何时候您想搜索一个也可以在 RegEx 模式中使用的文字字符，如`?`、`[`、`.`，甚至是`\`，您可以在它前面加上`\`，表示“搜索该字符”)

问号是我们获得可变长度匹配的第一种方式，像`/car?t/`这样的模式将匹配“cat”或“cart”

几种可能性之一

集合是用括号`[aqt]`括起来的一个或多个字符。它只匹配这些字符中的一个——在这个例子中只有 a、q 或 t。

**范围**

您还可以指定一个范围`[0-9]`、`[a-z]`，它将匹配该范围内的所有内容。

**找到相同的字符这个次数**

我们就要完成了，我想教一个东西，我们在技术上不需要，但在制作更短的图案时非常有用。当搜索年份值时，我们可能会在一行中查找四位数字。我们可以使用`\[0-9]{4}\`连续四次抓取前面的模式，而不是连续四次写入`[0-9]`。

**找到这个模式任意次**

我们可以说“用`*`匹配这个模式*任意次*,而不是说我们想要看到一个字符的确切次数

如果您匹配的是单个字符长，您可以在末尾添加一个星号，例如`[a-n]*`表示“匹配任何字母 a-m 任意次(注意，这不要求字符相同，匹配‘aaaaa’或‘bbbb’即可，也可以匹配‘banana’”)。

如果你想匹配一个重复的序列，使用圆括号，例如`([a-b][m-q][a-z])*`

你不是要解释特殊字符吗？空白呢？正则表达式是由马里索尔·正则和康斯坦斯·表达式在 1782 年凡尔赛的一个神奇的下午发明的怎么样-

同样，这只是我们需要在日志文件中查找 IP 地址的正则表达式。这是我认为初学者应该知道的事情。随着你知识的扩展，你将能够编写一个模式，用更少的字符执行相同的搜索，或者对搜索结果更加仔细和有选择性。要更深入一点，请阅读 [regxr](https://regexr.com/) 上的文档并继续探索！

# [](#regex-is-hard-to-read)正则表达式很难读懂

[![confusing](../Images/61466594b21fc1f1d6ab109e8592a0a8.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--Xje5DRde--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/http://giphygifs.s3.amazonaws.com/media/KU5ZYokJKL3tC/giphy.gif)

正则表达式非常紧凑，因此对于新手来说很难读懂。我上面提到的模式看起来非常简单:

`\cherr(y|(ies))\`

> 这使用了我们在其他情况下不会使用的“或”管道字符`|`

但是查找电话号码的模式可能开始看起来不可理解:

`/\(?[0-9]{3}\)?.?[0-9]{3}[\-\w]?[0-9]{4}\`

我提到这一点并不是为了打击你，而是为了证明如果正则表达式模式一开始看起来很混乱也没关系。此外，不需要使用每种技术也可以非常成功地创建模式，所以如果在获得一些正则表达式经验后，您看到一些没有意义的例子或堆栈溢出答案，请不要感到惊讶！

# [](#regex-works-character-by-character)正则表达式逐字符工作

[![one character at a time](../Images/56812afe3db536715776fd69f8eb9195.png)T2】](https://i.giphy.com/media/xT5LMRiDBnwqtXBL3y/giphy.gif)

最基本的是，正则表达式逐个字符地工作。像`/[aeiou]/`这样的模式是在说‘这个单个字符可以是这五个字母中的一个’。而当我们有一系列简单的字母(文字)时，例如`/cat/`，我们实际上是在说‘第一个字符必须是 c，下一个是 a，最后一个是 t’。

大多数时候，我们可以把遵循正则表达式模式的系统想象成一个小机器人，像读纸条一样阅读文本行；任何时候它都只看一个角色。

为什么记住这一点很重要？它解释了为什么不能用正则表达式进行基于数学的测试。你不能很容易地编写一个正则表达式来找到每个质数或每个完美的正方形，因为你不能通过一次只看一个字符来识别这些东西。

> 让读者困惑的是:编写一个只查找奇数或偶数的正则表达式是可能的，甚至是容易的？我会让你来考虑怎么做。

现在，虽然这在实践中是正确的，但我还没有谈到的一项技术(尽管我在“cherry/cherries”示例中使用了)是子组匹配，它允许在字符组周围有更复杂的逻辑。我不会使用它，因为它对于简单的任务来说是不必要的，也因为即使是使用子组的短正则表达式也会变得计算量很大。这让我们想到...

# [](#regex-can-be-dangerous)正则表达式可危险了！

[![danger](../Images/b8f7cdf6a1a81d584af748753c1cf9fe.png)T2】](https://i.giphy.com/media/3oKIPs1EVbbNZYq7EA/giphy.gif)

最近很多互联网都停止工作了一段时间，正则表达式是(部分)原因。正则表达式可能会要求计算机做一些耗费大量时间的事情，以至于它们的 CPU 可能会达到极限，就像本月发生在 Cloudflare 上的[一样。](https://blog.cloudflare.com/details-of-the-cloudflare-outage-on-july-2-2019/)

> 虽然是正则表达式导致了问题，但对“为什么 Cloudflare 会宕机”更准确的总结应该是他们[一次向所有服务器推送更新](https://twitter.com/mipsytipsy/status/1146967585109364737)，这不是一个很好的部署策略。

所以你可以写一个计算机很难执行的正则表达式，它会占用大量的 CPU 时间。这和你写的任何计算机代码没什么不同，但是它解释了为什么像 Google 这样的网站不允许你写正则表达式来搜索。

# 现在，去练习你的技能吧

学习正则表达式的最好方法是*而不是*实践练习，而是一些有趣的游戏

RegEx Golf (这个游戏的一个更高级别花了我两周的时间，所以，准备好了就退出吧)

[正则纵横字谜](https://regexcrossword.com/)
[互动练习](https://regexone.com/)
[正则表达式游戏](http://play.inginf.units.it/#/)

[![I don't know what this gif is](../Images/8336e5d57b95303e15aead37dc7b4958.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--1lve8UwO--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/http://giphygifs.s3.amazonaws.com/media/1yLTQO8S9W347ZY6Vi/giphy.gif)
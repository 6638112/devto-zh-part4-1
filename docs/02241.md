# 关于 monorepos 和代码共享的思考

> 原文：<https://dev.to/norato/thoughts-about-monorepos-and-code-sharing-3gph>

几周前，我参加了一个会议，我听到了更多关于 monorepos 的信息，这让我大吃一惊。让我震惊的一点是如何以一种简单的方式在应用程序之间共享代码。

### 问题

我参与了一些项目，我真的想解决跨前端、库和微服务的代码共享问题。

在一个项目中，我们有一个 Angular Web 应用程序和许多节点微服务，每个都在不同的存储库中。而且在这些应用程序之间共享代码几乎是不可能的，因为我们没有私有的 npm。

在其他情况下，我们必须使用 Angular 组件库创建 Angular Web 应用程序和带有 Angular 应用程序电子桌面。都在同一个仓库里，这真的很难管理，但是，在这里我们可以共享代码。

对于这些项目，我认为使用 monorepo 可以解决这类问题，因为我们将所有的应用程序放在一个库中，我们可以轻松地共享代码。

但是，在第二个项目示例中，我们有一个 monorepo，它仍然会给项目管理带来困难。这是因为我们没有使用单一回购管理器，我们实际上不知道它是单一回购。

### 一种可能的解决方案

因此，真正解决在单个存储库中管理多个项目的复杂性的是 monorepo 管理器。从那以后，我一直在尝试 nwrl 的 nx。

NX 有一些命令来创建、构建、测试和检查应用程序和库之间的相互依赖关系。这真的很有用，它将保持所有组织没有多个海关命令，因为我们需要在第二个项目。

在这次学习和尝试 NX 管理 monorepos 的过程中，我可以列出一些使用它作为 javascript monorepo 的优点和缺点。

#### 优点

*   您不需要为每个项目下载大量的节点模块。它将被所有库和应用程序重用；

*   所有代码都在同一个地方，所以很容易在项目中导航；

*   您不需要在 npm 中复制或发布一些代码来通过应用程序共享代码。它使得重构和改进代码变得容易；

*   在私有项目中，您只需要允许访问单个存储库；

*   使用 monorepo 管理器，如 NX，您可以从其 CLI 使用许多命令来自动化流程；

*   你将让所有人都在同一个部门工作；

*   很容易一起测试所有的东西，并检查哪个工件受到了变更的影响。您也只能测试和构建受影响的工件；

*   创建新的应用程序很容易。很简单，因为我们可以使用 CLI 来创建它，并且所有配置和库都可以重用，这将节省大量时间。

#### 弊

*   一个未经测试的变更可能会破坏所有的项目，在同样的背景下，容易改进也容易破坏一切；

*   您不能拒绝开发人员访问应用程序，因为您将所有内容都保存在一个存储库中；

*   创建 CI/CD 来部署特定的工件并不容易。这是我仍在努力寻找简单解决方案的一点。

### 注意事项

我建议用一个新项目来测试它，看看这个选择是否符合你的需要。它可以防止这种影响！您可以问自己一些问题，以决定转向 monorepo:

1 -你需要在项目之间共享代码吗？2 -您有更多使用相同环境/语言的应用程序吗？
3 -你能允许所有开发者访问所有源代码吗？
5 -你会考虑创建需要重用现有代码的新项目吗？最重要的是，你真的认为这能帮助你更快交货吗？

当我决定尝试使用 monorepo 时，我问自己这个问题。我正在开发一个巨大的前端应用程序，我们将创建更多的项目。我们开始考虑加快我们的交付速度，并重用我们在另一个项目中创建的许多功能。因此，这种迁移的动机是期望在新项目到来时能够富有成效。

你呢？你已经测试过 monorepo 了吗？你对此有什么经验？
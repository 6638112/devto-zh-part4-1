# 以每月不到 5 美元的成本构建无限可扩展的云主机

> 原文:[https://dev . to/levinunnink/building-a-infinitely-scalable-cloud-host-for-less-5-mo-1 nkl](https://dev.to/levinunnink/building-an-infinitely-scalable-cloud-host-for-less-than-5-mo-1nkl)

所以我有了这个叫做“温德水桶”的想法。对于只会写 HTML & CSS 的设计师/开发者来说，这是一个简单的静态网站托管。我真的想开发一个可持续发展的应用。对我来说，可持续意味着*便宜*。

我需要一个系统:

*   如果没有人使用它，它是免费的。如果我的想法很糟糕，或者我花了很长时间才找到用户，那么我想，我不想为我没有使用的资源付费。
*   **自动扩展以满足需求。**如果我的想法成功了，人们开始注册，我不想遇到瓶颈。我的系统应该通过*扩展*来满足需求。
*   **以经济实惠的方式扩展以满足需求。**这很关键。随着系统的扩展，它需要为自己买单。我不能为一个爱好支付昂贵的托管费用。

鉴于 wunder bucket 是云托管，这可能会很快变得昂贵。

## [](#paper-napkin-business-model)餐巾纸商业模式

我的模式是免费增值，专业计划每月 5 美元，每年 60 美元。我假设我们将有 99%的免费用户和 1%的专业用户(相当标准的 SaaS 转换指标)。这意味着 **$5/mo 必须支付 100 个用户价值的云托管成本，并且要盈利**。这不是很多的利润。

*   如果云托管的成本是每 100 个用户 2.50 美元，我需要达到 500，000 个用户才能养活一个全职员工。在没有全职员工的情况下，似乎有很多用户需要支持。![](../Images/faf02af88a10a26a0a259f0ce17b4cd3.png)
*   但是如果每 100 个用户的托管成本只有 0.05 美元呢？看起来有些激进，但这意味着我可以让大约 20 万用户实现可持续发展。仍然有很多用户，但这可能更可行。

这个行业的动态非常简单:我能保持的每 100 个用户的云托管费用越低，它就能越快成为一个自我维持的企业。我打算这样设计这个系统，让它为我工作:

## [](#what-cloud-to-use)用什么云？

真的只有三个选项值得考虑: [AWS](https://aws.amazon.com/) 、[微软 Azure](http://azure.com) 和[谷歌云](https://cloud.google.com)。他们都在争夺彼此的生意，他们会给你秘密的折扣，所以很难选择。

我选择 AWS，因为我非常熟悉他们的产品组合。我过去用过 Azure 和 Google，它们也能很好地提供我想要的功能。在这种情况下，我需要依靠我过去的经验，快速行动，所以即使那些主机提前提供一些折扣，学习曲线对我来说也不值得。

总之，主要云之间没有任何明显的全面定价优势。他们都竞相压价。只需选择一个你最熟悉的、功能最符合你需求的。

反正我挑的是 AWS。

## [](#web-application-costs)Web 应用费用

这是我们进入第一个战略决策的地方。我的服务将有一个 [REST API](https://restfulapi.net/) 组件，客户将使用它来管理他们的站点。每次更新网站时，客户都需要与这个 API 进行交互，但是很难预测会有多频繁。无论如何，它需要快速，并快速响应客户端。

假设我想在几个具有负载平衡的 [EC2 实例](https://aws.amazon.com/ec2/)上托管我的 API web 应用程序。很标准的设置。

[![](../Images/9754947cb8d23cfd980cec9dccdc6164.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--iT_xM5TA--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8c49rmb92qrq57dqvm9u.png)

好了，这个模型已经有一个问题了:我的 web 应用程序托管成本是 61 美元/月。这意味着，在收支平衡之前，我需要有 13 个专业用户和 1300 个免费用户——远远超过每 100 个用户 0.05 美元的神圣盖尔。在达到这个数字之前，这种设置必须能够轻松支持 12 万用户。我不确定两个中型实例能够做到这一点。还有另一个问题:随着服务的扩展，我将不得不手动扩展这个基础架构:监控响应时间、CPU 使用率和延迟。这需要时间、注意力和更多的钱。有更好的方法。

叫做[无服务器](https://serverless.com)。

那么，如果我使用 [API 网关](https://aws.amazon.com/api-gateway/)后面的[无服务器 Lambda](https://aws.amazon.com/lambda/) 函数构建我的应用程序逻辑，会发生什么呢？

有了 Lambda，我不必担心服务器，我只需要知道一个 API 请求将占用多少内存，以及它应该运行多长时间。在我的设置中，每个 HTTP 请求转换成一个 Lambda 调用。我的所有请求都只是做一些事情，比如数据库查找和响应客户端(没有像调整图像大小这样的内存/cpu 密集型的事情)，所以每次调用使用 128MB 的内存我觉得很舒服。但是我的用户会提出多少请求呢？好了，这里还有一些餐巾纸数学:

*   假设每个用户每个月会更新他们的网站 200 次。(看起来很多，但是让我们积极一点。)
*   这意味着每月将有 100 个用户调用 2 万个 Lambdas。Lambda 每 100 万次调用收费 0.20 美元。这意味着 100 个用户每月将花费我 0.004 美元。

但是我也想使用 API 网关，所以我们也把它加入进来:

*   API Gateway 对每百万个请求收费 3.5 美元，这意味着 100 个用户每月将花费我 0.07 美元。

Lambda + API gateway 的另一个好处是它可以自动伸缩以满足需求。如果没人用它。我不付钱。如果使用的人多，我相应付费。我不需要监控服务器并尝试匹配我的 EC2 实例来满足需求。一切就这样发生了。这更具可持续性。

不过还有一点，Lambda 和 API Gateway 有一个免费层。我还需要一段时间才能开始付钱。有了这些数字，我可以在付费前扩展到 2.5 万用户。

**⚡️ Web 应用每 100 用户总成本(25k 用户后):`$0.074`**

## [](#database-costs)数据库费用

*叹*，数据库。没有它们就不可能构建一个 web 应用程序，但它们几乎总是瓶颈，是痛苦和折磨的主要来源。如果您没有正确地进行备份、优化您的查询和索引，以及正确地设置复制，您会发现自己处于一个充满伤害的世界中。如果你的应用很慢，那几乎总是因为你的数据库。幸运的是，我的服务有一个非常简单的数据模型:我们只是跟踪用户、网站以及这些网站上的内容。一个基本要求是自动化备份和恢复能力。一个简单的数据模型使 No-SQL 成为一个很好的候选者，但是让我们用几个不同的场景来看看这个:

*   关系数据库(MySQL/PostgresDB):如果我使用一个 db.t3.medium 实例(看起来很小，但可能会满足我的需求)，那么每月 60 美元。这里没有“自由层”。在盈利之前，我必须拥有 12 万用户。根据我使用 MySQL 的经验，我非常怀疑这个小实例能否扩展到 12 万用户。
*   [没有 SQL DB (Mongo)](https://aws.amazon.com/documentdb/) : Mongo 似乎更适合我的需求，但最低要求是——在 AWS 上使用完全托管选项 DocumentDB 在 db.r4.large 实例上托管它——每月 245 美元。没有空闲层。在我开始收支平衡数据库账单之前，我必须达到 5 万用户。在盈利到我想要的利润之前，我必须拥有 100 万用户。如果不改变 db.r4.large.25 中的实例，它是不可能扩展的

因此，仅仅是开始开发这些数据库，我就会立即失去金钱。

但是我们来看看 [DynamoDB](https://aws.amazon.com/dynamodb/) 。

迪纳摩对请求、存储和备份收费。让我们来分析一些数字:

*   **请求。**读写请求之间存在价格差异。我的主机服务将会被大量读取，所以我猜测 20%的写和 80%的读的比例。根据我的估计，每 100 个用户有 20，000 个请求，请求总数将花费 0.054 美元。($0.05 写操作和$0.004 读操作)。
*   **储存。**我将存储的数据非常小，即使是大规模的，所以我预计不会超过 25GB 的空闲层。
*   **备份。**假设我已经完成了 25GB 空闲层的一半。我的备份成本为每月 1.25 美元。这是风险最大的部分，因为除非我清除我的数据，否则这个成本会随着时间的推移而增加。仍然很便宜。我估计每个用户将消耗大约 10KB 的存储空间。这意味着每 100 名用户每月的备份成本为 0.00125 美元。

**⚡️数据库每 100 名用户总成本:`$0.05`**

## [](#file-hosting)文件托管

我服务的最后一部分是托管客户静态 web 文件，并通过 CDN 提供给他们。这就是事情变得非常危险的地方。如果有人托管一个嵌入视频的网页，并且该网页出现在 HackerNews 的前面，并且在一天内获得 20 万次访问，会发生什么？我需要非常小心地构建免费层和专业层，以免被带宽和存储所拖累。我是这么想的:

*   免费用户:100MB 总存储和 100MB 传输/月。
*   专业用户:1GB 总存储和 10GB 传输/月。

我正在建立一个静态的网络主机，而不是一个媒体服务。对于有 HTML、CSS、JS 和图片的普通网站来说，这些限制应该足够了。

对于块存储，我将使用 [S3](https://aws.amazon.com/s3/) ，对于 CDN，我将使用 [CloudFront](https://aws.amazon.com/cloudfront/) 。(我将把 CloudFront CDN 限制在美国和欧盟定价，只是为了让事情更简单。)

*   免费 S3 仓储费:0.23 美元
*   专业 S3 存储成本:0.23 美元
*   免费数据传输费用:0.084 美元
*   专业数据传输费用:0.85 美元

同样在这种模式下，我甚至不会开始检查免费层，直到我突破 5，000 个用户。

**⚡️每 100 个用户的数据存储和传输成本:`$1.394`**

## [](#wrapping-things-up)收拾东西

我写这篇文章的原因之一是，我想展示您的技术和架构选择对您业务的可持续性有多大的影响。开始时你需要保持低成本，但在扩大规模时你也需要保持低成本。如果你选择了错误的技术或错误的方式定价，你会发现自己无法支付托管费用。但是，如果你使用的技术是为你的需求和预算而设计的，你可以从小到大，同时保持健康的利润。

概括地说，下面是我在本文中提到的定价方案的范围:

*   306 美元/月开始。我需要达到 6000 个用户才能达到收支平衡。大约 30 万用户，然后我才开始健康盈利。但是我需要增加我的基础设施来容纳。对于 300，000 个用户，我可能会为我的 EC2 实例和数据库托管运行 5，000 美元/月的基础设施账单，这给了我 10，000 美元的利润率。这还不错，但对于全职员工来说还不够，而且这个系统需要不断的基础设施维护才能继续增长。
*   1.424 美元/月开始。自动缩放。零服务器维护。即时盈利，即使用户量很小。如果我有 30 万用户，我就能托管他们并获得 13，800 美元的利润。最好的部分是，这将自动扩展以满足需求，允许对产品进行投资，而不是投资扩展基础架构。

**⚡️最终每 100 个用户的托管成本:`$1.424/mo.` `$3.58/mo`利润。**

对我来说这看起来很可持续。

===

显然，除了选择无服务器的廉价技术，还有其他方法可以让你的业务盈利。你可以提高你的定价，增加免费的转换率，减少你给免费用户的昂贵功能的数量，等等。但我的建议是，起步时要便宜。建立一个随着你的成功而自动扩展的企业，并且不会因为早期的实验而让你的钱包受损。如果你有任何问题，打电话给我。玩得开心！
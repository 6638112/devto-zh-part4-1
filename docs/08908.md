# 不安全的 HTTPS 证书的奇怪案例

> 原文:[https://dev . to/slav ius/the-curious-case-of-insecurity-https-certificates-41pf](https://dev.to/slavius/the-curious-case-of-insecure-https-certificates-41pf)

本文是对我们以前的同事所做的所有声明的系列解释的第一篇，他声称在加入我们的团队后不久，他在我们的项目中发现了许多安全和性能问题。
你可以[在这里找到前言](https://dev.to/slavius/your-code-has-lots-of-security-and-performance-issues-he-said-24c7)。

让我们看看第一个声明:

> 我猜我们可能用 HTTPS 把数据从 GUI 传输到 API 服务器，但是这还不够。因为一个人可以很容易地用 DNS 欺骗获得 SSL 证书并监听包。所以第一件事是，我们发送我们的密码登录或任何其他交易作为一个纯文本，然后我们只会在数据库上加密它。当我们想要发送类似登录功能的请求时，我们还必须在客户端使用另一种 salt 或另一种类型的加密来加密密码。(为不同的顾客推荐不同的盐)

我们首先想到的问题是:为什么每个人，包括像微软、谷歌、Mozilla 和英特尔这样的大型国际公司，会投入如此多的时间和金钱来开发基本上所有 web 浏览器对 HTTPS 和 SSL/TLS 的支持，通过增强功能、错误和性能修复来改进 SSL/TLS 协议，建立认证机构，并为公司和个人创造证书卖点，而根据这种描述，克服 SSL/TLS 和基于证书的安全性的整体保护似乎是完全微不足道的？？？如果这是真的，你如何证明你的公司为一个网站购买一年 199 EV 的 SSL 证书是合理的？

我们先从 SSL 证书是如何获得的说起。大多数证书颁发机构(从现在开始称为 CAs)要求您证明您的个人身份以获得基本证书。这可以通过验证您的电子邮件地址并将其分配给 CA 帐户来实现。对于所谓的 EV(扩展验证)证书——它在浏览器的 URL 栏中为您提供了众所周知的“绿锁”,除了个人验证之外，您还需要经历更严格的程序，例如通过传真/影印公司证书、地址和/或通过使用与您公司在公共注册中关联的电话号码打电话来验证您的关系，或者使用邮政服务接收发送到您公司邮政地址的验证码。这保证了没有访问您的电子邮件、私人公司邮箱、办公室或电话设备的其他人可以验证他/她自己作为公司代表在 CA 为您的公司获得 EV 验证。

现在你已经验证了你的个人或公司，你需要证明你拥有你想要获得证书的域名。当然，例如，google.com 域名不再属于谷歌公司(它现在被称为 Alphabet)，所以当你作为一家公司被验证时，你有资格申请任何域名证书，而不仅仅是与你公司名称匹配的证书。
为此，您必须更改公共 DNS 记录或您的 HTTP 服务器设置，以返回对 CA 请求的预期响应。例如，您的 CA 可能会要求您建立一个名为 d24ecd160f4443b5ba55374b15516fc3.yourdomain.com 的特殊 DNS 记录，以指向他们的服务器或返回特定的 TXT 响应；或者，通过访问 URL[http://yourdomain.com/d24ecd160f4443b5ba55374b15516fc3.txt](http://yourdomain.com/d24ecd160f4443b5ba55374b15516fc3.txt)，您呈现了一个文本文件中的内容，该文本文件由 CA 发送到您之前验证过的电子邮件地址。
这样，只有能够访问您的域名的 DNS 管理和您的 DNS 记录所指向的 web 服务器的人，才能成功验证 CA 的证书请求。

正如你所看到的，如果没有广泛的社会工程、窃听、在适当的时候闯入某人的办公室或邮箱、黑掉你的 DNS 提供商和托管服务器，代表某人申请任意域名的证书是相当困难的。

坦率地说，在过去，由于人为错误和繁重的社会工程，一些不太知名的较小的 ca 错误地为不同的公司域(如 Google)颁发证书。这种情况可能会发生，但很快就被发现并纠正了。在这种情况下，必须使证书失效(撤销),并为受影响的站点重新颁发新证书。为此，每个 CA 公开所谓的证书撤销列表(CRL)。每次访问受证书保护的站点时，您的浏览器都会检查这些列表，以禁止访问受到危害的站点，以及使用已被 CA 吊销的证书的站点。

现在，当我们解释了伪造证书是多么困难(并非不可能)的时候，让我们探索一下如何在没有任何用户察觉的情况下做到这一点！

在这里，一切都归结为信任。让某人相信他正在访问一个完全有效和安全的受证书保护的网站的最简单的方法是对他撒谎。你问是什么意思？当你访问一个配置错误或虚假的网站时，通过查看浏览器显示的错误，你可以依靠浏览器来判断你正在访问的网站是否正常，或者是否有可疑之处。
**规则一:只使用从可靠来源下载的网页浏览器**
永远不要从不可靠来源下载网页浏览器(下载网站、warez 网站、GitHub 上的定制浏览器等)。).拥有一个“未被谷歌搜索的 Chromium”——基于 Chromium 并移除了谷歌间谍软件(TM)的完美浏览器可能很诱人。这些浏览器构建的唯一来源是互联网上随机出现的人。你可能会得到一个从官方 GitHub repo 构建的浏览器，删除了谷歌的东西，但偷偷添加了一个 CA 证书，处于攻击者的控制之下。结果可能是灾难性的。通过将攻击者控制的 CA 证书捆绑到您的浏览器中，除了 DNS 欺骗之外，还可以将您重定向到攻击者控制的服务器，该服务器托管 Gmail 登录页面的精确副本。只需输入凭证，它们就会在您不知不觉中被发送到攻击者的服务器上！
有些浏览器没有捆绑 CA 证书，而是依赖于操作系统的 CA 证书库。还存在与之相关的风险，因为此不可信浏览器下载的源代码中的代码可能已被修改为使用捆绑在其中的内部 CA 证书。
如果像 Internet Explorer 这样的浏览器在没有防病毒软件的情况下在 Windows 上运行，再加上来自未验证来源的不受信任的应用程序，可能会导致系统感染，将自己的 CA 证书导入 Windows/Linux CA 存储中。所有使用这些商店的浏览器都会受到危害，即使浏览器本身来自经过验证的供应商的网站。
**规则二:运行杀毒软件并结合来自可靠来源的软件**
做好你的工作，用供应商提供的散列来验证下载文件的散列。现在大部分都有了！
另一种方法是在沙箱或虚拟机中运行常规浏览器，仅在您的主操作系统上使用可信浏览器来访问重要网站(银行、邮件、公司门户、社交媒体等)。)

一些攻击也可能发生在不安全的网络上，尤其是公共 WiFi。这里，关于 DNS 欺骗的声明开始生效。尽管在不损害你的操作系统和/或网络浏览器的情况下，伪造证书是很难的，但实际可能发生的是，你对 gmail.com 的请求将由攻击者控制下的 DNS 服务器处理，你将被重定向到具有有效证书的类似外观的 gmial.com 域。这种把戏很常见，因为用户通常不会在他们收到的页面看起来像他们预期的那样后检查他们输入的内容。类似的基于错别字的域名被注册，并伪装成它们原来的对应物，所以要时刻提防不可信的网络。使用您自己的与 DNSSEC 或 HTTPS DNS 配对的 DNS 设置，或者使用 VPN 来浏览互联网。或者，如果您有这样选择，请不要连接到未知网络，而是使用蜂窝网络。
**规则三:永远不要相信未知的网络，如果需要就使用 VPN**

希望你喜欢这篇文章，感谢你的阅读！

在下一部分中，我们将了解为什么在某些情况下访问自签名证书站点也是安全的，以及与远程主机建立 SSL/TLS 会话意味着什么。
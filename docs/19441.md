# HOWTO:在现有项目中采用 GraphQL

> 原文:[https://dev . to/peternycander/how-I-would-adopt-graph QL-in-a-a-brown field-project-ap8](https://dev.to/peternycander/how-i-would-adopt-graphql-in-a-brownfield-project-ap8)

我最近在 C More 写了我在大规模 GraphQL 上的[经历。由于我对 GraphQL 的概念很感兴趣，我一直在思考如何在另一个棕色地带项目中实现它——从头开始。因此，这些是我给任何想在棕地项目中实现 GraphQL 的人的建议。](https://dev.to/peternycander/a-year-of-large-scale-graphql-the-biggest-takeaways-3d5n)

## [](#get-more-developers-excited)让更多开发者兴奋

当然，这只适用于你在一个更大的组织中工作的情况，但是我认为第一步应该是让其他开发人员兴奋起来。

如果你要创建和维护一个好的模式设计，你需要了解很多客户的需求。如果你只使用 javascript，你可能对 android 或 iOS 客户端如何使用 GraphQL 缺乏一些了解——例如；如果你在一个响应的联合中引入一个新的类型，他们会有什么样的体验？为了理解他们的需求，你将需要使用这些平台的开发者的帮助。

作为开发人员，我们通常有能力真正让事情发生，如果你像我一样，当你对某事感到兴奋时，你会工作得更努力、更快。如果其他团队中有开发人员对 GraphQL 感兴趣并支持它，那么您的实现就更有可能成功。

## [](#design-with-pen-and-paper)用笔和纸设计

不要从写代码开始！重复我在之前的[帖子](https://dev.to/peternycander/a-year-of-large-scale-graphql-the-biggest-takeaways-3d5n)中提到的一些错误将变得非常容易。相反，首先要规划出客户端的数据需求，以及连接这些数据的最佳方式。

根查询应该是什么，什么更适合作为另一种类型的字段？什么应该是接口，什么应该是联合？突变应该返回什么；是否有可能从该响应中解析出所有变异的数据？我知道如果没有 GraphQL 的经验，这可能会非常困难，但是请尽力而为。在设计模式时，不要过多考虑后端 API 是什么样的，我认为 GraphQL 应该是为了让客户端更容易。

我并不是建议你像瀑布项目一样运行这个项目，但是根据我的经验，设计中的一个错误比花一天时间真正了解你的领域以及 GraphQL 如何适应它的代价要大得多。

## [](#start-with-the-most-isolated-parts-of-the-design)从最孤立的部分开始设计

用 GraphQL 立即实现产品的核心特性是很诱人的。然而，这些是最容易出错的部分——而且你会出错。相反，找到一些不会*与图的其余部分*连接的特征。在生产中一路实现它，希望能跨越不同的客户。

当你实现更重要的部分时，这会给你有价值的洞察力。你会开始得到一些问题的答案，比如:

*   你喜欢 GraphQL 吗？
*   你的托管解决方案如何为你工作？
*   GraphQL 服务器上需要缓存吗？
*   缓存策略应该是什么样的(HTTP、CDN、内存中、Redis、是否规范化数据)？
*   你对自己处理错误的方式满意吗？

## 尽早改正你的错误

我说过，你会把事情搞砸的。在执行一两次后发现错误比执行 20 或 30 次要好得多。根据我的经验，一旦出现在代码库中，坏的模式就会成倍增加。更多初级开发人员会将现有代码视为如何实现功能的模板，错误将会蔓延开来。

至于如何纠正错误——注意 GraphQL 是没有版本的😱。您需要创建一个具有新名称的新字段，以便对该字段进行突破性的更改(记得与其他团队交流，了解他们的突破性更改是什么)。试图想出一个比上一次更好的名字是很诱人的，但是当您在同一个模式中创建第四个同义词时，就开始觉得很愚蠢了。

我觉得更实用、更符合逻辑的命名惯例是在名字后面加上“2”或“2”。客户可以在他们的查询中使用这个字段的别名来保持代码中的旧名称。一旦没有人使用原来的名字，你可以弃用“两个”版本，用新的类型定义回到原来的名字。客户端的迁移应该只是在该点删除别名。使用附加数字命名约定有望使人们明白为什么有两个非常相似的字段——第一个字段中有错误。

## [](#keep-the-pace-and-monitor-graphql-usage)保持节奏并监控 GraphQL 的使用情况

坚持下去——用 GraphQL 实现所有新特性，并利用潜在的停机时间将旧特性转移到 GraphQL。

对 GraphQL 服务器进行一些监控也是一个好主意。哪些查询很慢，为什么？哪些客户端正在使用哪些查询和字段？确保所有客户端都发送一些元数据，比如版本号和平台名称。为您的 GraphQL 服务器找到解决这个问题的产品，或者创建您自己的产品。

* * *

我在这里没有提到任何具体的技术，因为我不认为它真的有那么重要。我建议你使用一种语言中看起来最受支持的库，它本身不会是一个障碍。
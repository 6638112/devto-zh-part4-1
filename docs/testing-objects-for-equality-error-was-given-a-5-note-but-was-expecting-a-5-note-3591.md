# 测试对象的相等性-错误，给了一个 5 的注释，但需要一个 5 的注释

> 原文：<https://dev.to/becca9941/testing-objects-for-equality-error-was-given-a-5-note-but-was-expecting-a-5-note-3591>

想象你在收银台。你身后有一长串不耐烦等待服务的顾客。你购物的费用是 5 英镑。然而，你的钱包里有 12 张 5 英镑的钞票，在这个交替的世界里，你用哪一张钞票来支付你的购物很重要。没有一个可以替代另一个。

这会有多烦人？

当我们试图使用测试断言来测试对象的相等性时，就会出现这个问题。每个物体都不一样，所以你不能问这个 5 物体和另一个 5 物体是不是一样的，因为它们不一样。

解决这个问题的典型方法是查看 5 英镑纸币的内部并获取其值，然后我们对另一张 5 英镑纸币进行同样的操作，并比较这些值是否相同。这是可行的，但是违反了封装原则(而且非常不方便)。

在[务实的程序员](https://pragprog.com/book/tpp20/the-pragmatic-programmer-20th-anniversary-edition)中，有一个故事，讲的是一个报童敲你的门，告诉你你的论文总计 2。然后他会打开你的钱包，未经允许拿走你的钱。这是对你隐私(封装)的侵犯。报童应该做的是告诉你你的报纸花了 2 美元。然后你可以进入自己的钱包，取回你的钱并给他。

使用一个测试断言来比较两个对象的值就像一个报童把手伸进你的钱包，然后把手伸进你邻居的钱包来比较你的现金。

## 测试值对象的相等性

在测试两个对象是否相同之前，您首先要确保它们可以作为相同的对象进行比较。虽然两个 5 笔记对象被认为是相同的是有意义的，但是比较两个同名的人对象是没有意义的，即使他们也是双胞胎。他们是根本不同的人。

我们希望基于它们的值来等同的对象被称为‘值对象’(参见马丁·福勒)。为了理解如何改变这些对象的测试方式，我们首先需要知道大多数测试框架如何测试对象的相等性。

## 如何测试对象的相等性？

大多数测试框架通过查看它们的引用而不是它们包含的值来测试对象的相等性。当我们尝试比较属于同一类并具有相同值的两个对象时，我们会得到如下所示的错误消息:

错误:给了一张 5 英镑的钞票，但应该是 5 英镑的钞票

这是因为 equality 方法查看了第一个 5 英镑纸币对象(它的引用)的 id，然后将其与第二个 5 英镑纸币的 id 进行比较。这两个对象都有自己唯一的引用，所以因为引用不同，所以相等性测试失败。

equality 方法通常在 object 类上定义，所有其他对象都从 object 类继承(在面向对象的语言中)。默认的相等方法通过引用测试对象。

我们可以通过定义自己的等式方法来覆盖默认的等式方法。每当我们在一个对象上调用一个方法时，编译器首先查看该方法是否已经在它被调用的对象类中定义。如果它没有在那里找到它，它将查看这个超类是否已经在那里定义了它。

换句话说，我们定义的等式方法将被调用，而不是我们的对象继承的默认等式方法。

## 我们应该在哪里定义我们的平等法？

我们应该在我们想要通过值测试的对象的类上定义我们的等式方法。在这种情况下，我们将在 5 note 类上定义一个新的等式方法。

每当我们想通过值测试一个新的对象时，我们必须为那个对象类定义一个新的等式方法。即使你有一个很大的程序，你也不太可能想要通过它们的值来比较许多对象。即使您这样做了，这也是一个比每次为对象编写新的测试断言时手动进入对象并比较它们的值更好的解决方案(实际上和原则上)。
在我们写我们的平等法之前

在我们编写等式方法之前，我们需要一种方法来访问我们想要比较的值。在我们的 5 note 类中，我们需要添加一个实例变量，如果还没有的话，我们可以称之为‘amount’。

## 我们的平等法应该写什么？

在我们的 equality 方法中，我们希望返回这个对象的 amount 值是否与同一个类的另一个对象的 amount 值相同。

前面我们说过，任何对象都不应该能够触及另一个对象并查看它的私有状态(实例变量)。然而，如果我们希望这两个对象彼此“相等”，或者换句话说“同一个”，那么它们应该能够访问彼此之间的状态是有意义的。

我们在这里试图阻止的主要事情是其他对象进入 5 个 note 对象来比较它们的值，如果我们在测试断言中比较它们的值，而不是从它们自己内部比较，就会发生这种情况。

我们将编写的等式代码如下所示:

### JavaScript

```
equals(other) {

  return this.amount === other.amount;

} 
```

### 
  
红玉

```
def ==(other)

  @amount == other.amount

end 
```

### 
  
法罗

```
= other

  ^ amount == other amount 
```

## 
  
测试断言示例

在定义了我们的等式方法之后，我们将能够测试具有相同值的同一个类的两个不同对象是否彼此相等，如下例所示

### JavaScript

```
assert(fivePound1.equals(fivePound2)); 
```

### 
  
红玉

```
fivePound1.equal?(fivePound2) 
```

### 
  
法罗

```
self assert: fivePound1 equals: fivePound2 
```

## 
  
延伸阅读

*   马丁·福勒:价值对象
*   Nicolò Pignatelli:像专家一样评价对象
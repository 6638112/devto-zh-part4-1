# 软件架构:清晰简单的设计被低估了

> 原文:[https://dev . to/gergelyorosz/software-architecture-clear-and-simple-design-is-understand-2bj 9](https://dev.to/gergelyorosz/software-architecture-clear-and-simple-design-is-underrated-2bj9)

我在设计和构建大型系统方面有自己的份额。我参与了重写优步的分布式支付系统，设计和发布 Xbox One 上的 Skype，以及开源优步的移动架构框架——T2 肋骨。所有这些系统都有完整的设计，经历了多次迭代，并且有很多白板和讨论。然后，这些设计被浓缩成一份设计文件，在我们开始建造之前，这份文件被传阅以获得更多的反馈。

所有这些系统的规模都很大:成百上千的开发人员构建它们或者在它们之上构建它们，它们为每天数百万人使用的系统供电。它们也不仅仅是绿地项目。支付系统重写必须替换两个现有的支付系统，由数十个系统和数十个团队使用，所有这些都没有任何业务影响。重写优步应用程序是一个数百名工程师同时工作的项目，将现有功能移植到一个新的架构中。

让我从一些听起来可能令人惊讶的事情开始。首先，这些设计都没有使用任何标准的软件架构规划工具。我们没有使用 [UML](https://en.wikipedia.org/wiki/Unified_Modeling_Language) ，也没有使用 [4+1 模型](https://en.wikipedia.org/wiki/4%2B1_architectural_view_model)，也没有使用 [ADR](https://github.com/joelparkerhenderson/architecture_decision_record) ，也没有使用 [C4](https://c4model.com/) ，也没有使用[依赖图](https://herbertograca.com/2019/08/12/documenting-software-architecture/)。我们创建了大量的图表，但是没有一个遵循任何严格的规则。只是普通的旧框和箭头，类似的[这个描述信息流](https://eng.uber.com/migrating-functionality-between-production-systems/#attachment_6746)或者[这个概述类结构和组件之间的关系](https://github.com/uber/RIBs/wiki#user-content-parts-of-a-rib)。同一设计文档中的两个图表通常具有不同的布局，并且通常由不同的工程师添加和修改。

**其次，团队中没有拥有设计的架构师**。没有 [IT 架构师](https://martinfowler.com/articles/architect-elevator.html)或[企业架构师](https://martinfowler.com/articles/ea-in-lean-enterprise.html)。没错，优步和 Skype/微软都没有放手不管的软件架构师职位。更高级别的工程师，像参谋工程师一样，仍然被期望定期编码。对于所有的项目，我们都有经验丰富的工程师参与。然而，没有一个人拥有建筑或设计。虽然这些经验丰富的开发人员推动了设计过程，但即使是最初级的团队成员也参与其中，经常挑战决策并提供其他备选方案进行讨论。

第三，我们实际上没有参考通用架构模式和通用软件架构文献中参考的其他术语，例如[马丁·福勒的架构指南](https://martinfowler.com/architecture/)。没有提到微服务、无服务器架构、应用边界、事件驱动架构等等。其中一些确实在头脑风暴中出现过。然而，没有必要在设计文件中引用它们。

## [](#software-design-at-tech-companies-and-startups)科技公司和初创公司的软件设计

那么，我们是如何完成任务的呢？为什么我们没有遵循著名的软件架构方法所建议的方法呢？

我和方(FANG，，Amazon，，Google)等其他科技公司以及一些小公司的工程师们讨论过这个问题。大多数团队和项目——无论大小——都共享一个相似的设计和实现方法:

1.  **从业务问题**开始。我们要解决什么？我们要制造什么产品，为什么？我们如何衡量成功？
2.  **头脑风暴方法**。与团队一起，通过多次会议，找出可行的解决方案。保持头脑风暴的规模较小。从高层次开始，向下到较低层次。
3.  **用白板演示您的方法**。召集团队，让一个人起草团队要达成一致的方法。你应该能够在白板上清楚地解释你的系统/应用的架构，从高层开始，根据需要深入。如果你对这个解释有困难或者不够清楚，还需要在细节上做更多的工作。
4.  **根据您在白板上的解释，用简单的图表通过简单的文档记录下来**。尽量少用术语:你希望即使是初级工程师也能理解它的内容。用[清晰易懂的语言](https://blog.pragmaticengineer.com/on-writing-well/)来写。在优步，我们使用类似 RFC 的文档和基本模板。
5.  **谈论权衡和选择**。好的软件设计和好的架构都是关于做出正确的权衡。没有一个设计选择本身是好的或坏的:它完全取决于环境和目标。你的架构是否被分割成不同的服务？说明你为什么决定不选择大型服务，这可能有一些其他好处，比如更直接和更快速的部署。您是否选择用新功能来扩展服务或模块？权衡构建单独的服务或模块的选择，以及这种方法的利弊。
6.  **在团队/组织内传阅设计文件并获得反馈**。在优步，我们[曾经把我们所有的软件设计文档发给所有的工程师](https://blog.pragmaticengineer.com/scaling-engineering-teams-via-writing-things-down-rfcs/)，直到我们有大约 2000 人。现在我们更大了，我们仍然把它们分布得很广，但我们已经开始更多地平衡信噪比。鼓励人们提问并提供替代方案。务实地设定合理的时间限制来讨论反馈，并在需要的地方进行整合。直截了当的反馈可以当场迅速解决，而更详细的反馈当面解决可能更快。

为什么我们的方法不同于软件架构文献中通常提到的方法？实际上，对于大多数架构指南来说，我们的方法在原则上并没有什么不同。几乎所有的指南都建议从业务问题入手，概述解决方案和权衡:这也是我们所做的。我们没有做的是使用许多建筑师或建筑书籍提倡的许多更复杂的工具。我们尽可能简单地记录设计，使用最简单的工具:如 Google Docs 或 Office365。

我认为我们方法的主要差异可以归结为这些公司的工程文化。高度自治和很少的等级制度是科技公司和初创公司的共同特征:对于更传统的公司来说，这一点有时不太真实。这也是为什么这些地方做更多的“基于常识的设计”而不是过程驱动的设计，有更严格的规则。

我知道在银行和汽车公司，开发人员在没有得到上一级架构师的批准的情况下，是不愿意做出任何架构决策的，这些架构师管理着几个团队。这变成了一个缓慢的过程，架构师会被许多请求淹没。因此，这些架构师创建更多的正式文档，希望使用更多的普通文献描述的工具，使系统更加清晰。这些文档还强化了自上而下的方法，因为对于一个不是架构师的工程师来说，质疑或挑战已经使用正式方法记录的决策更具威胁性，因为他们并不精通这些方法。所以他们通常不会这么做。公平地说，这些公司通常希望优化开发人员，使其成为可交换的资源，允许他们在短时间内重新分配人员从事不同的项目。不同的工具在不同的环境中工作得更好，这并不奇怪。

## 简单、无术语的软件设计超过了架构模式

设计系统的目标应该是简单。系统越简单，越容易理解，越容易发现问题，越容易实现。描述语言越清晰，设计就越容易理解。避免使用不是每个团队成员都能理解的行话:最没有经验的人也应该能够同样清楚地理解事情。

干净的设计类似于干净的代码:易于阅读和理解。有许多很好的方法来编写干净的代码。然而，你很少会听到有人建议从在你的代码中应用四个设计模式开始。干净的代码从单一责任、清晰的命名和易于理解的约定开始。这些原则同样适用于清晰的架构。

那么架构模式的作用是什么？我认为它们和编码设计模式一样有用。他们可以给你一些如何改进代码或架构的想法。对于编码模式，当我看到一个[单例模式](https://en.wikipedia.org/wiki/Singleton_pattern)时，我会注意到它，当我看到一个充当[门面](https://en.wikipedia.org/wiki/Facade_pattern)的类时，我会扬起眉毛，更深入地挖掘，只做调用。但是我还没有想到*“这需要一个* [*抽象工厂模式*](https://en.wikipedia.org/wiki/Abstract_factory_pattern)*。事实上，我花了很长时间才理解这种模式的作用，并且“啊哈！”现在，在使用了大量的依赖注入之后——这是为数不多的使用这种模式的领域之一[实际上非常普遍和有用](https://stackoverflow.com/questions/2280170/why-do-we-need-abstract-factory-design-pattern)。我也承认，虽然我花了很多时间阅读和理解四人帮的设计模式，但与我从其他工程师那里得到的关于我的代码的反馈相比，它们对成为一名更好的程序员的影响要小得多。*

 *类似地，了解通用架构模式是一件好事:它有助于缩短与他人的讨论，这些人对它们的理解和你一样。但是架构模式不是目标，它们也不能代替更简单的系统设计。在设计系统时，您可能会发现自己意外地应用了一个众所周知的模式:这是一件好事。稍后，您可以更容易地参考您的方法。但是你最不想做的事情就是采用一个或多个架构模式，把它当作锤子，寻找钉子来使用它。

在工程师观察到在某些情况下如何做出相似的设计选择，并且这些设计选择被相似地实现之后，架构模式诞生了。这些选择然后被命名，写下来，并被广泛讨论。架构模式是在解决方案被解决之后出现的工具，希望让其他人的生活变得更容易。**作为一名工程师，你的目标应该更多的是解决方案并从中学习，而不是挑选一个闪亮的架构模式，希望这能解决你的问题。**

软件架构最佳实践、企业架构模式和描述系统的形式化方法都是有用的工具，并且有一天可能会派上用场。但是在设计系统时，从简单开始，尽可能保持简单。尽量避免更复杂的架构和正式工具固有的复杂性。

* * *

*这篇文章最初发表在[务实工程师博客](https://blog.pragmaticengineer.com)上[软件架构被高估，清晰简单的设计被低估](https://blog.pragmaticengineer.com/software-architecture-is-overrated/)下，这篇文章包含了一个关于如何更好地设计系统的技巧部分。*

*关于我:*我是一名工程师出身的工程经理，在硅谷&欧洲初创公司和科技公司的交汇处工作。关注我这里和推特上的。我在我的博客“务实的工程师 T4”上写关于软件工程的长篇文章。我还发送每月简讯,里面有关于软件工程、技术领先和我一直在思考的有趣事情的笔记。*
# 熟悉的第一天——我新的桌面角色扮演开源项目，用现代技术构建。

> 原文:[https://dev.to/nickblow/familiar-day-1-4nkm](https://dev.to/nickblow/familiar-day-1-4nkm)

作为本系列的一部分，我将(不定期地)向您介绍我是如何构建即将到来的开源项目的，熟悉，以及在这个过程中我(希望)克服了哪些困难和挑战。

## [](#what-is-familiar)什么是熟悉的？

[Familiar](https://github.com/NickBlow/familiar) 是一款一体化桌面角色扮演游戏助手，提供战役工具、虚拟桌面和实时聊天。它是以一个巫师的魔宠命名的，一种协助他们的小型魔法生物。因为给事物命名是计算机科学中最难的问题之一，所以我已经完成了一部分！

虽然最终我会需要一个可爱的标志...

## [](#who-are-you-and-why-should-i-care)你是谁，我为什么要管？

我目前在一家名为 [Wakelet](https://www.wakelet.com) 的初创公司领导着一个构建分布式系统的小团队，每月为成千上万的人和数千万个 API 调用提供服务。我已经花了大约 4 年的时间构建云原生应用程序。

我知道这个项目有点小众，但希望在它结束时，这个系列将对如何从零开始构建 web 应用程序有一个很好的概述。

* * *

## [](#enough-rambling-on-with-the-blog-post)散漫够了，上跟博文吧！

盯着一张白纸永远是写作最难的事情，软件也不例外。

我总是喜欢为自己设定目标，所以让我们从设定一些目标开始，并勾画一些高层次的基础设施。

## [](#goals)目标

我已经将这些目标添加到 GitHub 的 README 中，但是我将在这里为后人重现它:

1.  现代前端、渐进式 web 应用程序，使用一流的工具。
2.  反应灵敏、时尚的用户界面。
3.  高性能、架构良好的后端。
4.  经济高效的基础设施完全在 GCP 免费层内-只需为云 DNS 付费。
5.  利用开源项目的免费工具。
6.  完整的 CI/CD。

## [](#goals-in-depth)目标深入

### [](#ui)用户界面

首先是用户界面。我不是 Android 或 iOS 开发者，但幸运的是[进步的网络应用](https://developers.google.com/web/progressive-web-apps/)来拯救我了。他们肯定还没有为黄金时段做好准备，但在我看来，他们是未来。

我将要使用的工具是 [LitElement](https://github.com/Polymer/lit-element) ，因为 WebComponents 很酷，而且这个库非常有性能。不幸的是，它现在还不支持服务器端渲染/同构应用，但这已经在路线图上了😎。

我可能会使用一些预制的 CSS 和/或 WebComponents，我一直在看看起来很酷的[布尔玛](https://bulma.io)，我过去也使用过[材质设计组件](https://material.io)。我会第一个承认我不擅长 CSS，所以我把这当成一个学习的机会。

对于状态管理来说， [Redux](https://redux.js.org/) 是复杂项目的天赐之物。真的是国家管理的圣杯，除了很棒，没有太多可说的了。

### [](#back-end)后端

#### [](#quick-note-on-languages)语言速记

我可能会使用[打字稿](https://www.typescriptlang.org/)，和 [GoLang](https://golang.org/) 。
我对 JavaScript 又爱又恨，一方面它的快速原型制作令人惊讶，另一方面你看了 3 秒钟，你的新框架就被否决了。Go 正迅速成为我最喜欢的语言，它简单、高效，对于微服务开发来说令人惊叹。

有很多很棒的现代语言，但坚持使用两种语言意味着我不必不断切换上下文，它们都非常适合 web 开发。

#### [](#infrastructure-and-api-design)基础设施和 API 设计

总体目标是几乎完全符合谷歌云免费层。就原始计算而言，这为我们提供了 28 小时的应用引擎，以及免费的计算引擎实例和一些云函数调用。

每个服务都将是自己的 docker 容器，可能在 Kubernetes 上，因为托管的 Kubernetes 在 GCP 上是免费的(尽管我不确定这在一台小型免费机器上能有多好)。我可能会使用 [Traefik](https://traefik.io/) 来路由到内部容器并发布 SSL 证书。我打算用 Traefik 进行的基本设置将*而不是*在集群模式下工作，所以这是留给读者的练习。所有其他服务都是无状态的 docker 容器，因此可以毫无问题地水平扩展。

对于服务的前端，我真的不知道我会用什么，但有这么多的选择，我可能会选择一些帽子，它会工作得很好。

后端的其余部分将是一组微服务，如果我足够勇敢，可能会通过 [GRPC](https://grpc.io) 进行通信，否则就通过 JSON/REST，用 [GraphQL](https://graphql.org/) API 将它们缝合成一个连贯的整体。

对于实时通信，我将尝试让它运行在一个单独的服务器上(可能运行在计算引擎上，其他一切都在应用引擎上)。既然 Edge 正在转向 Chromium，并且所有其他主流浏览器都支持它，我将使用 GraphQL 订阅而不是服务器发送的事件——这已经基本完成，并且可能是第一个开源的服务。理想情况下，我也能够通过 HTTP/2 获得这种服务。

### [](#build-amp-test-tools)构建&测试工具

构建工具/开发操作对用户来说是不可见的，但是如果他们不在那里，你就会错过他们。我将从这里开始，强迫自己养成良好的习惯，并确保我没有手工制作任何基础设施。[牛不是宠物！](https://martinfowler.com/bliki/SnowflakeServer.html)

作为代码的基础设施(IAC)很棒，但 IAC 的许多 DSL 并不好。我最近已经使用了 [Terraform](https://terraform.io) ，它非常好，并且是云不可知的，所以我肯定会再次使用它。

对于一个构建系统，我有很多使用 Jenkins 的经验，这很好，尤其是他们使用 Jenkinsfiles 的声明性构建。然而，管理一个 Jenkins 服务器是多余的。我不会做很多构建。我将评估几个构建服务，如 [CircleCI](https://circleci.com/open-source/) 和 [TravisCI](https://travis-ci.org/) ，并挑选一个我认为最简单的。

对于测试，我不完全确定现在测试 WebComponents/ShadowDOM 的最佳方式是什么。我真的很喜欢 [Jest](https://jestjs.io) ，但是对于 DOM 测试来说，它包括了 JSDOM，目前还不支持影子 DOM。 [Karma](https://karma-runner.github.io/latest/index.html) 实际上运行在真正的浏览器上，而*实现了*影子 DOM，所以看起来是个不错的选择。在真正的浏览器上运行也暴露了他们的一些怪癖，这些怪癖可能不会被其他东西发现。希望在我写完最初的几个测试后，我会对此有更好的理解。

为了捆绑前端，我将尝试使用 [ParcelJS](https://parceljs.org/) ，因为理想情况下我想要的是*能够正常工作*的东西，但是如果我遇到问题，我将回到以前可靠的 [Webpack](https://webpack.js.org/) 。

## ~~结束~~开始？

### [](#next-time)下次

下次加入我，我将为 GCP 写一些地形模板，并旋转一些基础设施！
# 黑掉投票(虽然不是真的)

> 原文：<https://dev.to/benji/hack-the-vote-not-really-though-1hbk>

**重要信息:**我联系了节目的相关人员，他们核实了这个问题，并确认他们有其他方法来解决这个问题。以下是他们在描述了我发现的问题后的回应:

> 谢谢你提供的信息。我们的政策不是提供有关安全实践的细节，但是有多个层次的后处理来解决您提出的问题。我们感谢您愿意分享您的调查结果，并有机会验证控制措施是否到位。

我询问是否张贴我的发现，我收到了以下回复:

> 虽然我们感谢您的帮助，但我们无法同意节目或相关公司的命名。投票过程是积极的，是为合法选民保留的。谢谢你的理解。

我已经从帖子和代码中删除了对公司和节目的引用。

* * *

我在为一家不知名公司最近的电视喜剧才艺秀投票时遇到了这个问题。我不是这类节目的积极观众，但考虑到我关注的一个喜剧团体也在竞争，我想看他们的表演来支持他们。

在半决赛中，他们向观众开放了投票。投票过程要求我用电子邮件和密码注册。一个下拉菜单和两个复选框之后，我终于可以投票了。他们的投票系统是以这样一种方式建立的，一个个人电子邮件帐户可以投票多达 10 次。这是用一个足够简单的滑块来完成的，一旦你设置了你的投票，你提交就完成了。

我以为一切就此结束了。我已经通过投票完成了作为一个粉丝的职责，没有什么可做的了。也就是说，除了打开开发人员控制台，看看投票系统是如何工作的之外，别无他法。

我又投了几次票，看看这些请求是如何处理的，表面上看起来很正常。`POST`使用编码的`Authorization`值和 URL 编码的数据作为查询字符串的一部分进行请求。我的第一个想法是，`Authorization`值是基于我第一次登录网站时的原始“登录”，所以它当然会与我使用的电子邮件:密码组合联系在一起。但是在两三次请求之后，我注意到`Authorization`的值一直在变化。

由于网络请求没有告诉我更多的信息，所以我继续打开了源代码。美化代码并找到投票点后，我惊讶地发现,`Authorization`标记实际上只是精确查询参数的编码版本。我觉得奇怪的是，他们会要求你登录，但不以任何方式与这个投票`POST`请求联系起来。我还认为我没有办法修改数据并获得成功的响应。**我错了**。

我首先尝试将投票数从 10 改为 100。失败了。10 比 5？奏效了。电子邮件地址也是一个参数，所以我试着把它改成一个假的电子邮件地址，我知道它不会存在于系统中，预计它会失败。它没有。

那张选票根本不算数。我用我刚刚使用的假邮件创建了一个新帐户，我非常惊讶地发现我的新帐户已经有了我投票给的选手的 10 票。这意味着，即使一个电子邮件地址没有注册，它仍然可以投票并被计算在内。

显而易见，下一步是编写一个脚本，我可以用它从随机电子邮件中发送投票。这将保证我想要的选手会赢得比赛。

代码相当简单，因为实际发生的只是数据通过来自 [CryptoJS](https://github.com/brix/crypto-js) 的[HMAC-沙 256](https://en.wikipedia.org/wiki/HMAC) 哈希函数传递，然后发送`POST`请求。我还添加了一个 helper 函数来遍历一列`n`电子邮件以发送每封邮件的投票。

成功的响应将如下所示:

```
{
    response_code: '20',
    votestring: '{"total":10,"L1":10}'
} 
```

## 接下来是什么

在与展会上的信息安全人员来回发了几封电子邮件后，他们向我保证这不会像`there are multiple layers of post-processing that address the issues`那样被利用。如果不能访问他们的数据库，很难看出他们是如何解决这个问题的。我想到了几件事:

*   假设他们有一个注册用户和用户投票的表，他们应该能够交叉引用不是由“真正的”用户投票。
*   他们也可以记录 IP，并且只对唯一的 IP 计票。

不管他们如何绕过这个问题来计票，我认为真正的解决办法是实际发布一个身份验证令牌，用于在将来验证投票请求。这似乎是设计 API 的团队的疏忽，但我想不出任何好的理由来说明为什么您会将电子邮件地址作为投票的一部分，而不是将其与身份验证令牌联系起来。

有两个节目同时开放了投票时间表，我在为这两个节目投票时都得到了成功的回应，所以我认为这个问题会出现在所有其他需要观众投票参与的节目中。

## 来源

您可以在这里找到源代码以及如何运行它的说明:

[https://github.com/benjifs/votenow](https://github.com/benjifs/votenow)
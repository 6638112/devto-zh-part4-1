# 单元测试的五个阶段给我们的启示

> 原文：<https://dev.to/saidaspen/the-five-stages-to-unit-testing-enlightenment-3cli>

> 免责声明:这篇文章是为了娱乐，也许——仅仅是也许——让你反思你与软件单元测试的关系。

不定期编写单元测试的开发人员，不想*开始*编写单元测试。可能是因为惰性，抗拒改变的自然趋势。好像太繁琐了。然而，一旦这些开发人员开始编写测试，他们很快就会惊讶地发现，他们实际上很喜欢这样。*谁能想到呢？*
对单元测试有一种游戏化的质量。看到通过测试的绿色栏达到 100%的满分，这与吸引如此多人的 grinder 游戏对战利品或经验值的永无止境的追求没有什么不同。出于某种原因，收集这些点对我们很有吸引力。开发人员被拉进来——他们被迷住了。

很快，他们发现自己花更多的时间编写测试。他们想要——不，他们*需要*——代码覆盖率稳定在 100%。因此，他们花了一整天的时间在*堆栈溢出*上，以弄清楚如何欺骗他们的测试框架，使其相信他们的实用程序类的私有构造函数——无论如何，无论如何，都不会在生产中被调用——实际上已经被测试覆盖了。
他们测试他们所有的代码，甚至是散布在他们代码库中的无数琐碎的方法——他们*需要*测试*一切*，每个分支都必须被覆盖。在这一点上，他们只是通过编写大量的测试来拖延时间。他们觉得编写测试比开始他们的用户需要的下一个特性要容易得多(顺便说一下，这个需求太模糊了)。
*只不过，多了一行代码而已...*

我们，开发人员，都在这个旅程中，朝着测试启示，这就是它如何进行。

## 单元测试一无所知

很有可能，在开始的时候，你根本懒得去写测试。当然，你，在某种程度上，理解他们的观点，但是，它不适合你。这根本不值得麻烦。您需要处理生产代码。真正的代码，这才是最重要的，*对不对*？这就是你们*真正被评价的*，*对不对*？那么，为什么要花时间编写不相关的单元测试呢？你的测试和 QA 团队发现任何错误，然后，*对吗*？
在这一点上，你是一个**单元测试无知的**。有些人整个职业生涯都是这样。没有什么内在的东西能推动你前进。如果周围的每个人都对单元测试一无所知，那么他们就会一直这样下去。要进步，某事或某人，需要外在的东西。需要有打破现状的东西。

## 单元测试犹豫不决

在某些时候，你被迫开始编写单元测试。可能是一个经理，一个技术领导，一个同事，或者可能是你自己对不断降低的自我价值的印象，让你开始。你开始写测试主要是为了写测试。如果你在一分钟或不到一分钟的时间里，遇到了你不知道如何测试的代码，你可以悄悄地忽略它。“不管怎样，*模仿*和*间谍*之间到底有什么区别？”，你扪心自问。你测试你的 getters 和 setters，就是这样。你现在有资格获得**单元测试犹豫不决**的称号。

## 单元测试爱好者

接下来发生的事情对你来说是不可想象的，也是奇妙的，对你身边的每个人来说也是如此。突然间，在编写了几百行测试代码之后，这个过程——天啊——实际上开始变得令人愉快了。你会意识到事情并没有那么糟。当你看到绿色条慢慢上升到 100%时，在你的程序员灵魂深处，你会有一种温暖而模糊的感觉(或者你的测试服的颜色更好地描述为*祖母绿*？翡翠听起来更珍贵，不是吗？珍贵就是你的测试服，*对吗？*)。
所有测试通过。当然，每隔一段时间，您可能需要让团队中的专家向您描述如何捕获传递给模拟对象的参数。但是，你肯定是在正确的轨道上。你告诉自己。
当你开始说服别人编写测试时，你现在已经转变为一个**单元测试爱好者**，这对你有好处！

## 单元测试狂热者

在你意识到之前，你已经是古鲁了。你知道所有关于仿冒品和假货，TDD 和 BDD 的知识。你的非程序员朋友认为你已经像所有其他潮人一样对腌制蔬菜感兴趣了，因为你总是漫无边际地谈论小黄瓜。你写的代码绝对是百分之百可测试的。依赖注入是你的第二天性，没有商量的余地。你的代码可以毫不费力地被注入、删除、伪造、窥探、嘲笑等等。看不到一个古怪的测试。
如果*你*测试不了，那么*没人*能测试。对你来说，考试本身已经变得比什么都重要。对你来说，比你的产品代码更重要，因此，比你的用户和业务本身更重要。人们在网上论坛上花了很多时间来寻找如何欺骗你的测试框架，让它为你提供全面的覆盖。你安排你的经理坐下来，告诉他们单元测试的成本效益，以及“最重要的是，我们永远，永远，没有任何理由，无论如何，不允许任何一行代码在没有被测试充分覆盖的情况下被提交”。在这一点上，你通过编写测试有效地拖延了时间。还有，更糟糕的是，你已经变成了一个**测试狂热者**。

## 单元测试实用主义者

有些人达到了单元测试的顶点，也就是我们旅程的最后阶段。请注意，很少有人能在这里成功，因为很容易在路上的某个地方卡住。就像在 *AA* 一样，恢复的第一步是真诚地向自己承认，你有问题。你过于雄心勃勃的测试是你的问题*。在极端的情况下，同事们厌倦了测试狂热者的狂热，组织了一次干预——哦，多么尴尬！。
只有意识到这个问题，你才有可能达到测试的禅境，成为一名**单元测试实用主义者**。测试实用主义，测试启蒙，达到单元测试洞察力，涅槃，你有什么。在这一点上，您的测试之旅已经兜了一圈，回到了您开始的地方；交付特性和产品代码是你的主要目标。单元测试仅仅是一种工具，可以让特性更快、更少的出现错误。这是为了让你确信你的代码做了你认为它应该做的事情，而不是为了向任何人证明什么——当然也不是为了超越某些看似武断的度量标准或 KPI。您的测试是为了适应未来，并记录您的解决方案。
您测试复杂的、重要的、业务关键的代码，不去管 getters 和 setters。您测试与第三方代码、边缘案例、最近可能更改的代码或将来可能更改的代码的集成和接口。*

你的混蛋私有构造函数不再让你夜不能寐。作为程序员，你过着更平衡、更随遇而安、更满足的生活——让你的同事高兴，让你的客户和顾客满意。

我也在这个旅程中，我发现自己介于狂热分子和狂热分子之间。我正在努力改进。哦，天啊，我正在努力提高。在许多方面，这类似于禅宗和尚对开悟的追求:一个人越努力，就越不可能到达那里。

你走了多远了？